{"version":3,"file":"editor.js","sources":["webpack://microweber-webpack/../editor/editor.js","webpack://microweber-webpack/../editor/bar.js","webpack://microweber-webpack/../editor/api.js","webpack://microweber-webpack/../editor/helpers.js","webpack://microweber-webpack/../editor/tools.js","webpack://microweber-webpack/../editor/core.js","webpack://microweber-webpack/../editor/controllers.js","webpack://microweber-webpack/../editor/add.controller.js","webpack://microweber-webpack/../editor/interaction-controls.js","webpack://microweber-webpack/../editor/i18n.js","webpack://microweber-webpack/../editor/liveeditmode.js"],"sourcesContent":["\n\n\n\n\n\n\n\n\n\nvar EditorPredefinedControls = {\n    'default': [\n        [ 'bold', 'italic', 'underline' ],\n    ],\n    smallEditorDefault: [\n        ['bold', 'italic', '|', 'link']\n    ]\n};\n\nwindow.MWEditor = function (options) {\n    var defaults = {\n        regions: null,\n        document: document,\n        executionDocument: document,\n        mode: 'div', // iframe | div | document\n        controls: 'default',\n        smallEditor: false,\n        scripts: [],\n        cssFiles: [],\n        content: '',\n        url: null,\n        skin: 'default',\n        state: null,\n        iframeAreaSelector: null,\n        activeClass: 'active-control',\n        interactionControls: [\n            'image', 'linkTooltip', 'tableManager'\n        ],\n        language: 'en',\n        rootPath: mw.settings.modules_url + 'microweber/api/editor',\n        editMode: 'normal', // normal | liveedit\n        bar: null,\n    };\n\n    this.actionWindow = window;\n\n    options = options || {};\n\n    this.settings = mw.object.extend({}, defaults, options);\n\n\n    if (typeof this.settings.controls === 'string') {\n        this.settings.controls = EditorPredefinedControls[this.settings.controls] || EditorPredefinedControls.default;\n    }\n\n    if(!!this.settings.smallEditor) {\n        if(this.settings.smallEditor === true) {\n            this.settings.smallEditor = EditorPredefinedControls.smallEditorDefault;\n        } else if (typeof this.settings.smallEditor === 'string') {\n            this.settings.smallEditor = EditorPredefinedControls[this.settings.smallEditor] || EditorPredefinedControls.smallEditorDefault;\n        }\n    }\n\n    this.document = this.settings.document;\n\n    var scope = this;\n\n    if(!this.settings.selector && this.settings.element){\n        this.settings.selector = this.settings.element;\n    }\n\n    if(!this.settings.selector && this.settings.mode === 'document'){\n        this.settings.selector = this.document.body;\n    }\n    if(!this.settings.selector){\n        console.warn('MWEditor - selector not specified');\n        return;\n    }\n\n    this.settings.selectorNode = mw.$(this.settings.selector)[0];\n\n    if (this.settings.selectorNode) {\n        this.settings.selectorNode.__MWEditor = this;\n    }\n\n    this.settings.isTextArea = this.settings.selectorNode.nodeName && this.settings.selectorNode.nodeName === 'TEXTAREA';\n\n\n    this.getSelection = function () {\n        return scope.actionWindow.getSelection();\n    };\n\n    this.selection = this.getSelection();\n\n    this._interactionTime = new Date().getTime();\n\n    this.interactionControls = [];\n    this.createInteractionControls = function () {\n        this.settings.interactionControls.forEach(function(ctrl){\n            if (MWEditor.interactionControls[ctrl]) {\n                var int = new MWEditor.interactionControls[ctrl](scope, scope);\n                if(!int.element){\n                    int.element = int.render();\n                }\n                scope.actionWindow.document.body.appendChild(int.element.node);\n                scope.interactionControls.push(int);\n            }\n        });\n    };\n\n    this.lang = function (key) {\n        if (MWEditor.i18n[this.settings.language] && MWEditor.i18n[this.settings.language][key]) {\n            return  MWEditor.i18n[this.settings.language][key];\n        }\n        //console.warn(key + ' is not specified for ' + this.settings.language + ' language');\n        return key;\n    };\n\n    this.require = function () {\n\n    };\n\n    this.addDependencies = function (obj){\n        this.controls.forEach(function (ctrl) {\n            if (ctrl.dependencies) {\n                ctrl.dependencies.forEach(function (dep) {\n                    scope.addDependency(dep);\n                });\n            }\n        });\n        this.interactionControls.forEach(function (int) {\n            if (int.dependencies) {\n                int.dependencies.forEach(function (dep) {\n                    scope.addDependency(dep);\n                });\n            }\n        });\n        var node = scope.actionWindow.document.createElement('link');\n        node.href = this.settings.rootPath + '/area-styles.css';\n        node.type = 'text/css';\n        node.rel = 'stylesheet';\n        scope.actionWindow.document.body.appendChild(node);\n    };\n    this.addDependency = function (obj) {\n        targetWindow = obj.targetWindow || scope.actionWindow;\n        if (!type) {\n            type = url.split('.').pop();\n        }\n        if(!type || !url) return;\n        var node;\n        if(type === 'css') {\n            node = targetWindow.document.createElement('link');\n            node.rel = 'stylesheet';\n            node.href = url;\n            node.type = 'text/css';\n        } else if(type === 'js') {\n            node = targetWindow.document.createElement('script');\n            node.src = url;\n        }\n        targetWindow.document.body.appendChild(node);\n    };\n\n    this.interactionControlsRun = function (data) {\n        scope.interactionControls.forEach(function (ctrl) {\n            ctrl.interact(data);\n        });\n    };\n\n\n    this.initInteraction = function () {\n        var ait = 100,\n            currt = new Date().getTime();\n        this.interactionData = {};\n        $(scope.actionWindow.document).on('selectionchange', function(e){\n            $(scope).trigger('selectionchange', [{\n                event: e,\n                interactionData: scope.interactionData\n            }]);\n        });\n        var max = 78;\n        scope.$editArea.on('touchstart touchend click keydown execCommand mousemove touchmove', function(e){\n            var eventIsActionLike = e.type === 'click' || e.type === 'execCommand' || e.type === 'keydown';\n            var event = e.originaleEvent ? e.originaleEvent : e;\n            var localTarget = event.target;\n\n            var wTarget = localTarget;\n            if(eventIsActionLike) {\n                var shouldCloseSelects = false;\n                while (wTarget) {\n                    var cc = wTarget.classList;\n                    if(cc) {\n                        if(cc.contains('mw-editor-controller-component-select')) {\n                            break;\n                        } else if(cc.contains('mw-bar-control-item-group')) {\n                            break;\n                        } else if(cc.contains('mw-editor-area')) {\n                            shouldCloseSelects = true;\n                            break;\n                        } else if(cc.contains('mw-editor-frame-area')) {\n                            shouldCloseSelects = true;\n                            break;\n                        } else if(cc.contains('mw-editor-wrapper')) {\n                            shouldCloseSelects = true;\n                            break;\n                        }\n                    }\n                    wTarget = wTarget.parentNode;\n                }\n                if(shouldCloseSelects) {\n                    MWEditor.core._preSelect();\n                }\n            }\n            var time = new Date().getTime();\n            if(eventIsActionLike || (time - scope._interactionTime) > max){\n                if (e.pageX) {\n                    scope.interactionData.pageX = e.pageX;\n                    scope.interactionData.pageY = e.pageY;\n                }\n                scope._interactionTime = time;\n                scope.selection = scope.getSelection();\n                if (scope.selection.rangeCount === 0) {\n                    return;\n                }\n                var target = scope.api.elementNode( scope.selection.getRangeAt(0).commonAncestorContainer );\n                var css = mw.CSSParser(target);\n                var api = scope.api;\n\n\n                var iterData = {\n                    selection: scope.selection,\n                    target: target,\n                    localTarget: localTarget,\n                    isImage: localTarget.nodeName === 'IMG' || target.nodeName === 'IMG',\n                    css: css.get,\n                    cssNative: css.css,\n                    event: event,\n                    api: api,\n                    scope: scope,\n                    isEditable: scope.api.isSelectionEditable(),\n                    eventIsActionLike: eventIsActionLike,\n                };\n\n                scope.interactionControlsRun(iterData);\n                scope.controls.forEach(function (ctrl) {\n                    if(ctrl.checkSelection) {\n                        ctrl.checkSelection({\n                            selection: scope.selection,\n                            controller: ctrl,\n                            target: target,\n                            css: css.get,\n                            cssNative: css.css,\n                            api: api,\n                            eventIsActionLike: eventIsActionLike,\n                            scope: scope,\n                            isEditable: scope.api.isSelectionEditable()\n                        });\n                    }\n                });\n            }\n        });\n        this.createInteractionControls()\n    };\n\n    this._preventEvents = [];\n    this.preventEvents = function () {\n        var node;\n        if(this.area && this._preventEvents.indexOf(this.area.node) === -1) {\n            this._preventEvents.push(this.area.node);\n            node = this.area.node;\n        } else if(scope.$iframeArea && this._preventEvents.indexOf(scope.$iframeArea[0]) === -1) {\n            this._preventEvents.push(scope.$iframeArea[0]);\n            node = scope.$iframeArea[0];\n        }\n        var ctrlDown = false;\n        var ctrlKey = 17, vKey = 86, cKey = 67, zKey = 90;\n        node.onkeydown = function (e) {\n            if (e.keyCode === ctrlKey || e.keyCode === 91) {\n                ctrlDown = true;\n            }\n            if ((ctrlDown && e.keyCode === zKey) /*|| (ctrlDown && e.keyCode === vKey)*/ || (ctrlDown && e.keyCode === cKey)) {\n                e.preventDefault();\n                return false;\n            }\n        };\n        node.onkeyup = function(e) {\n            if (e.keyCode === 17 || e.keyCode === 91) {\n                ctrlDown = false;\n            }\n        };\n    };\n    this.initState = function () {\n        this.state = this.settings.state || (new mw.State());\n    };\n\n    this.controllerActive = function (node, active) {\n        node.classList[active ? 'add' : 'remove'](this.settings.activeClass);\n    };\n\n    this.createFrame = function () {\n        this.frame = this.document.createElement('iframe');\n        this.frame.className = 'mw-editor-frame';\n        this.frame.allow = 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture';\n        this.frame.allowFullscreen = true;\n        this.frame.scrolling = \"yes\";\n        this.frame.width = \"100%\";\n        this.frame.frameBorder = \"0\";\n        if (this.settings.url) {\n            this.frame.src = this.settings.url;\n        } else {\n\n        }\n\n        $(this.frame).on('load', function () {\n            if (!scope.settings.iframeAreaSelector) {\n                var area = document.createElement('div');\n                area.style.outline = 'none';\n                area.className = 'mw-editor-frame-area';\n                scope.settings.iframeAreaSelector =  '.' + area.className;\n                this.contentWindow.document.body.append(area);\n                area.style.minHeight = '100px';\n            }\n            scope.$iframeArea = $(scope.settings.iframeAreaSelector, this.contentWindow.document);\n\n            scope.$iframeArea.html(scope.settings.content || '');\n            scope.$iframeArea.on('input', function () {\n                scope.registerChange();\n            });\n            scope.actionWindow = this.contentWindow;\n            scope.$editArea = scope.$iframeArea;\n            mw.tools.iframeAutoHeight(scope.frame);\n\n            scope.preventEvents();\n            $(scope).trigger('ready');\n        });\n        this.wrapper.appendChild(this.frame);\n    };\n\n    this.createWrapper = function () {\n        this.wrapper = this.document.createElement('div');\n        this.wrapper.className = 'mw-editor-wrapper mw-editor-' + this.settings.skin;\n    };\n\n    this._syncTextArea = function (content) {\n        content = content || scope.$editArea.html();\n        if (scope.settings.isTextArea) {\n            $(scope.settings.selectorNode).val(content);\n            $(scope.settings.selectorNode).trigger('change');\n        }\n    };\n\n    this._registerChangeTimer = null;\n    this.registerChange = function (content) {\n        clearTimeout(this._registerChangeTimer);\n        this._registerChangeTimer = setTimeout(function () {\n            content = content || scope.$editArea.html();\n            scope._syncTextArea(content);\n            $(scope).trigger('change', [content]);\n        }, 78);\n    };\n\n    this.createArea = function () {\n        var content = this.settings.content || '';\n        if(!content && this.settings.isTextArea) {\n            content = this.settings.selectorNode.value;\n        }\n        this.area = mw.element({\n            props: { className: 'mw-editor-area', innerHTML: content }\n        });\n        this.area.node.contentEditable = true;\n        this.area.node.oninput = function() {\n            scope.registerChange();\n        };\n        this.wrapper.appendChild(this.area.node);\n        scope.$editArea = this.area.$node;\n        scope.preventEvents();\n        $(scope).trigger('ready');\n    };\n\n    this.documentMode = function () {\n        if(!this.settings.regions) {\n            console.warn('Regions are not defined in Document mode.');\n            return;\n        }\n        this.$editArea = $(this.document.body);\n        this.wrapper.className += ' mw-editor-wrapper-document-mode';\n        mw.$(this.document.body).append(this.wrapper)[0].mwEditor = this;\n        $(scope).trigger('ready');\n    };\n\n    this.setContent = function (content, trigger) {\n        if(typeof trigger === 'undefined'){\n            trigger = true;\n        }\n        this.$editArea.html(content);\n        if(trigger){\n            scope.registerChange(content);\n        }\n    };\n\n    this.nativeElement = function (node) {\n        return node.node ? node.node : node;\n    };\n\n    this.controls = [];\n    this.api = MWEditor.api(this);\n\n    this._addControllerGroups = [];\n    this.addControllerGroup = function (obj, row, bar) {\n        if(!bar) {\n            bar = 'bar';\n        }\n        var group = obj.group;\n        var id = mw.id('mw.editor-group-');\n        var el = mw.element({\n            props: {\n                className: 'mw-bar-control-item mw-bar-control-item-group',\n                id:id\n            }\n        });\n\n        var groupel = mw.element({\n                props:{\n                    className: 'mw-bar-control-item-group-contents'\n                }\n            });\n\n        var icon = MWEditor.core.button({\n            tag:'span',\n            props: {\n                className: ' mw-editor-group-button',\n                innerHTML: '<span class=\"mw-editor-group-button-caret\"></span>'\n            }\n        });\n        if(group.icon) {\n            icon.prepend('<span class=\"' + group.icon + ' mw-editor-group-button-icon\"></span>');\n            icon.on('click', function () {\n                MWEditor.core._preSelect(this.parentNode);\n                this.parentNode.classList.toggle('active');\n            });\n\n        } else if(group.controller) {\n            if(scope.controllers[group.controller]){\n                var ctrl = new scope.controllers[group.controller](scope, scope.api, scope);\n                scope.controls.push(ctrl);\n                icon.prepend(ctrl.element);\n                mw.element(icon.get(0).querySelector('.mw-editor-group-button-caret')).on('click', function () {\n                    MWEditor.core._preSelect(this.parentNode.parentNode);\n                    this.parentNode.parentNode.classList.toggle('active');\n                });\n            } else if(scope.controllersHelpers[group.controller]){\n                groupel.append(this.controllersHelpers[group.controller]());\n            }\n        }\n        el.append(icon);\n\n        groupel.on('click', function (){\n            MWEditor.core._preSelect();\n        });\n\n        var media;\n        obj.group.when = obj.group.when || 9999;\n        // at what point group buttons become like dropdown - by default it's always a dropdown\n        if (obj.group.when) {\n            if (typeof obj.group.when === 'number') {\n                media = '(max-width: ' + obj.group.when + 'px)';\n            } else {\n                media = obj.group.when;\n            }\n        }\n\n\n\n        el.append(groupel);\n        row = typeof row !== 'undefined' ? row :  this.settings.controls.length - 1;\n        group.controls.forEach(function (name) {\n            if(scope.controllers[name]){\n                var ctrl = new scope.controllers[name](scope, scope.api, scope);\n                scope.controls.push(ctrl);\n                groupel.append(ctrl.element);\n            } else if(scope.controllersHelpers[name]){\n                groupel.append(this.controllersHelpers[name]());\n            }\n        });\n\n        scope[bar].add(el, row);\n\n        this._addControllerGroups.push({\n            el: el,\n            row: row,\n            obj: obj,\n            media: media\n        });\n        return el;\n    };\n\n    this.controlGroupManager = function () {\n        var check = function() {\n            var i = 0, l = scope._addControllerGroups.length;\n            for ( ; i< l ; i++) {\n                var item = scope._addControllerGroups[i];\n                var media = item.media;\n                if(media) {\n                    var match = scope.document.defaultView.matchMedia(media);\n                    item.el.$node[match.matches ? 'addClass' : 'removeClass']('mw-editor-control-group-media-matches');\n                }\n            }\n        };\n        $(window).on('load resize orientationchange', function () {\n            check();\n        });\n        check();\n    };\n\n    this.addController = function (name, row, bar) {\n        row = typeof row !== 'undefined' ? row :  this.settings.controls.length - 1;\n        if (!bar) {\n            bar = 'bar';\n        }\n        if(this.controllers[name]){\n            var ctrl = new this.controllers[name](scope, scope.api, scope);\n            if (!ctrl.element) {\n                ctrl.element = ctrl.render();\n            }\n\n            this.controls.push(ctrl);\n            this[bar].add(ctrl.element, row);\n        } else if(this.controllersHelpers[name]){\n            this[bar].add(this.controllersHelpers[name](), row);\n        }\n    };\n\n    this.createSmallEditor = function () {\n        if (!this.settings.smallEditor) {\n            return;\n        }\n        this.smallEditor = mw.element({\n            props: {\n                className: 'mw-small-editor mw-small-editor-skin-' + this.settings.skin\n            }\n        });\n\n        this.smallEditorBar = mw.bar();\n\n        this.smallEditor.hide();\n        this.smallEditor.append(this.smallEditorBar.bar);\n        for (var i1 = 0; i1 < this.settings.smallEditor.length; i1++) {\n            var item = this.settings.smallEditor[i1];\n            this.smallEditorBar.createRow();\n            for (var i2 = 0; i2 < item.length; i2++) {\n                if( typeof item[i2] === 'string') {\n                    scope.addController(item[i2], i1, 'smallEditorBar');\n                } else if( typeof item[i2] === 'object') {\n                    scope.addControllerGroup(item[i2], i1, 'smallEditorBar');\n                }\n            }\n        }\n        scope.$editArea.on('mouseup touchend', function (e, data) {\n            if (scope.selection && !scope.selection.isCollapsed) {\n                if(!mw.tools.hasParentsWithClass(e.target, 'mw-bar')){\n                    scope.smallEditor.css({\n                        top: scope.interactionData.pageY - scope.smallEditor.$node.height() - 20,\n                        left: scope.interactionData.pageX,\n                        display: 'block'\n                    });\n                }\n            } else {\n                scope.smallEditor.hide();\n            }\n        });\n        this.actionWindow.document.body.appendChild(this.smallEditor.node);\n    };\n    this.createBar = function () {\n        this.bar = mw.settings.bar || mw.bar();\n        for (var i1 = 0; i1 < this.settings.controls.length; i1++) {\n            var item = this.settings.controls[i1];\n            this.bar.createRow();\n            for (var i2 = 0; i2 < item.length; i2++) {\n                if( typeof item[i2] === 'string') {\n                    scope.addController(item[i2], i1);\n                } else if( typeof item[i2] === 'object') {\n                    scope.addControllerGroup(item[i2], i1);\n                }\n            }\n        }\n        this.wrapper.appendChild(this.bar.bar);\n    };\n\n    this._onReady = function () {\n        $(this).on('ready', function () {\n            scope.initInteraction();\n            scope.api.execCommand('enableObjectResizing', false, 'false');\n            scope.api.execCommand('2D-Position', false, false);\n            scope.api.execCommand(\"enableInlineTableEditing\", null, false);\n            if(!scope.state.hasRecords()){\n                scope.state.record({\n                    $initial: true,\n                    target: scope.$editArea[0],\n                    value: scope.$editArea[0].innerHTML\n                });\n            }\n            scope.settings.regions = scope.settings.regions || scope.$editArea;\n            $(scope.settings.regions, scope.actionWindow.document).attr('contenteditable', true);\n            if (scope.settings.editMode === 'liveedit') {\n                scope.liveEditMode();\n            }\n            var css = {};\n            if(scope.settings.minHeight) {\n                css.minHeight = scope.settings.minHeight;\n            }\n            if(scope.settings.maxHeight) {\n                css.maxHeight = scope.settings.maxHeight;\n            }\n            if(scope.settings.height) {\n                css.height = scope.settings.height;\n            }\n            if(scope.settings.minWidth) {\n                css.minWidth = scope.settings.minWidth;\n            }\n            if(scope.settings.maxWidth) {\n                css.maxWidth = scope.settings.maxWidth;\n            }\n            if(scope.settings.width) {\n                css.width = scope.settings.width;\n            }\n            scope.$editArea.css(css);\n            scope.addDependencies();\n            scope.createSmallEditor();\n\n        });\n    };\n\n    this.liveEditMode = function () {\n        this.liveedit = MWEditor.liveeditMode(this.actionWindow.document.body, scope);\n    };\n\n    this._initInputRecordTime = null;\n    this._initInputRecord = function () {\n        $(this).on('change', function (e, html) {\n            clearTimeout(scope._initInputRecordTime);\n            scope._initInputRecordTime = setTimeout(function () {\n                scope.state.record({\n                    target: scope.$editArea[0],\n                    value: html\n                });\n            }, 600);\n\n        });\n    };\n\n    this.__insertEditor = function () {\n        if (this.settings.isTextArea) {\n            var el = mw.$(this.settings.selector);\n            el[0].mwEditor = this;\n            el.hide();\n            var areaWrapper = mw.element();\n            areaWrapper.node.mwEditor = this;\n            el.after(areaWrapper.node);\n            areaWrapper.append(this.wrapper);\n        } else {\n            mw.$(this.settings.selector).append(this.wrapper)[0].mwEditor = this;\n        }\n    };\n\n    this.init = function () {\n        this.controllers = MWEditor.controllers;\n        this.controllersHelpers = MWEditor.controllersHelpers;\n        this.initState();\n        this._onReady();\n        this.createWrapper();\n        this.createBar();\n\n        if (this.settings.mode === 'div') {\n            this.createArea();\n        } else if (this.settings.mode === 'iframe') {\n            this.createFrame();\n        } else if (this.settings.mode === 'document') {\n            this.documentMode();\n        }\n        if (this.settings.mode !== 'document') {\n            this._initInputRecord();\n            this.__insertEditor();\n        }\n        this.controlGroupManager();\n\n    };\n    this.init();\n};\n\nif (window.mw) {\n   mw.Editor = function (options){\n       options = options || {};\n       if(!options.selector && options.element){\n           options.selector = options.element;\n       }\n       if(options.selector){\n           if (typeof options.selector === 'string') {\n               options.selector = (options.document || document).querySelector(options.selector);\n           }\n           if (options.selector && options.selector.__MWEditor) {\n               console.log(options.selector.__MWEditor)\n               return options.selector.__MWEditor;\n           }\n       }\n       return new MWEditor(options);\n   };\n}\n\n\n/*mw.require('filemanager.js');\n\nmw.require('form-controls.js');\nmw.require('link-editor.js');\n\n\n\nmw.require('state.js');\n\nmw.require('editor/bar.js');\nmw.require('editor/api.js');\nmw.require('editor/helpers.js');\nmw.require('editor/tools.js');\nmw.require('editor/core.js');\nmw.require('editor/controllers.js');\nmw.require('editor/add.controller.js');\nmw.require('editor/interaction-controls.js');\nmw.require('editor/i18n.js');\nmw.require('editor/liveeditmode.js');\nmw.require('control_box.js');*/\n\n\n\n","(function(){\n    var Bar = function(options) {\n\n        options = options || {};\n        var defaults = {\n            document: document,\n            register: null\n        };\n        this.settings = $.extend({}, defaults, options);\n        this.document = this.settings.document || document;\n\n        this.register = [];\n\n        this.delimiter = function(){\n            var el = this.document.createElement('span');\n            el.className = 'mw-bar-delimiter';\n            return el;\n        };\n\n        this.create = function(){\n            this.bar = this.document.createElement('div');\n            this.bar.className = 'mw-bar';\n            this.element = mw.element(this.bar);\n        };\n\n        this.rows = [];\n\n        this.createRow = function () {\n            var row = this.document.createElement('div');\n            row.className = 'mw-bar-row';\n            this.rows.push(row);\n            this.bar.appendChild(row);\n        };\n        this.nativeElement = function (node) {\n            if(!node) return;\n            return node.node ? node.node : node;\n        };\n\n        this.add = function (what, row) {\n            row = row || 0;\n            if(!this.rows[row]) {\n                return;\n            }\n            if(what === '|') {\n                this.rows[row].appendChild(this.delimiter());\n            } else if(typeof what === 'function') {\n                this.rows[row].appendChild(what().node);\n            } else {\n                var el = this.nativeElement(what);\n                if(el) {\n                    el.classList.add('mw-bar-control-item')\n                    this.rows[row].appendChild(el);\n                }\n\n            }\n        };\n\n        this.init = function(){\n            this.create();\n        };\n        this.init();\n    };\n    mw.bar = function(options){\n        return new Bar(options);\n    };\n})();\n","\n\n\n\n\n\n\n\n\nMWEditor.api = function (scope) {\n    return {\n        getSelection: function () {\n            return scope.getSelection();\n        },\n        eachRange: function (c){\n            var sel = scope.getSelection();\n            if(sel.rangeCount && c) {\n                for(var i = 0; i < sel.rangeCount; i++) {\n                    var range = sel.getRangeAt(i);\n                    c.call(scope, range);\n                }\n            }\n        },\n        getSelectionHTML: function (){\n            var sel = scope.getSelection();\n            var html = document.createElement('div');\n            if(sel.rangeCount) {\n                var frag = sel.getRangeAt(0).cloneContents();\n                while (frag.firstChild) {\n                    html.append(frag.firstChild);\n                }\n            }\n            return html.innerHTML;\n        },\n        cleanWord: function (content) {\n            var wrapListRoots = function () {\n                var all = scope.$editArea.querySelectorAll('li[data-level]'), i = 0, has = false;\n                for (; i < all.length; i++) {\n                    var parent = all[i].parentElement.nodeName;\n                    if (parent !== 'OL' && parent !== 'UL') {\n                        has = true;\n                        var group = mw.$([]), curr = all[i];\n                        while (!!curr && curr.nodeName === 'LI') {\n                            group.push(curr);\n                            curr = curr.nextElementSibling;\n                        }\n                        var el = document.createElement(all[i].getAttribute('data-type') === 'ul' ? 'ul' : 'ol');\n                        el.className = 'element';\n                        group.wrapAll(el);\n                        break;\n                    }\n                }\n                if (has) return wrapListRoots();\n            };\n\n            var buildWordList = function (lists, count) {\n                var i, check = false, max = 0;\n                count = count || 0;\n                if (count === 0) {\n                    for (i in lists) {\n                        var curr = lists[i];\n                        if (!curr.nodeName || curr.nodeType !== 1) continue;\n                        var $curr = mw.$(curr);\n                        lists[i] = mw.tools.setTag(curr, 'li');\n                    }\n                }\n\n                lists.each(function () {\n                    var num = this.textContent.trim().split('.')[0], check = parseInt(num, 10);\n                    var curr = mw.$(this);\n                    if (!curr.attr('data-type')) {\n                        if (!isNaN(check) && num > 0) {\n                            this.innerHTML = this.innerHTML.replace(num + '.', '');\n                            curr.attr('data-type', 'ol');\n                        }\n                        else {\n                            curr.attr('data-type', 'ul');\n                        }\n                    }\n                    if (!this.__done) {\n                        this.__done = false;\n                        var level = parseInt($(this).attr('data-level'));\n                        if (!isNaN(level) && level > max) {\n                            max = level;\n                        }\n                        if (!isNaN(level) && level > 1) {\n                            var prev = this.previousElementSibling;\n                            if (!!prev && prev.nodeName === 'LI') {\n                                var type = this.getAttribute('data-type');\n                                var wrap = document.createElement(type === 'ul' ? 'ul' : 'ol');\n                                wrap.setAttribute('data-level', level);\n                                mw.$(wrap).append(this);\n                                mw.$(wrap).appendTo(prev);\n                                check = true;\n                            }\n                            else if (!!prev && (prev.nodeName === 'UL' || prev.nodeName === 'OL')) {\n                                var where = mw.$('li[data-level=\"' + level + '\"]', prev);\n                                if (where.length > 0) {\n                                    where.after(this);\n                                    check = true;\n                                }\n                                else {\n                                    var type = this.getAttribute('data-type');\n                                    var wrap = document.createElement(type === 'ul' ? 'ul' : 'ol');\n                                    wrap.setAttribute('data-level', level)\n                                    mw.$(wrap).append(this);\n                                    mw.$(wrap).appendTo($('li:last', prev))\n                                    check = true;\n                                }\n                            }\n                            else if (!prev && (this.parentNode.nodeName !== 'UL' && this.parentNode.nodeName !== 'OL')) {\n                                var $curr = mw.$([this]), curr = this;\n                                while ($(curr).next('li[data-level=\"' + level + '\"]').length > 0) {\n                                    $curr.push($(curr).next('li[data-level=\"' + level + '\"]')[0]);\n                                    curr = mw.$(curr).next('li[data-level=\"' + level + '\"]')[0];\n                                }\n                                $curr.wrapAll($curr.eq(0).attr('data-type') === 'ul' ? '<ul></ul>' : '<ol></ol>')\n                                check = true;\n                            }\n                        }\n                    }\n                });\n\n                mw.$(\"ul[data-level!='1'], ol[data-level!='1']\").each(function () {\n                    var level = parseInt($(this).attr('data-level'));\n                    if (!!this.previousElementSibling) {\n                        var plevel = parseInt($(this.previousElementSibling).attr('data-level'));\n                        if (level > plevel) {\n                            mw.$('li:last', this.previousElementSibling).append(this)\n                            check = true;\n                        }\n                    }\n                });\n                if (count === 0) {\n                    setTimeout(function () {\n                        buildWordList($('li[data-level]'), 1);\n                        wrapListRoots();\n                    }, 1);\n                }\n                return lists;\n            };\n\n            var word_listitem_get_level = function (item) {\n                var msspl = item.getAttribute('style').split('mso-list');\n                if (msspl.length > 1) {\n                    var mssplitems = msspl[1].split(' ');\n                    for (var i = 0; i < mssplitems.length; i++) {\n                        if (mssplitems[i].indexOf('level') !== -1) {\n                            return parseInt(mssplitems[i].split('level')[1], 10);\n                        }\n                    }\n                }\n            };\n\n            var isWordHtml = function (html) {\n                return html.indexOf('urn:schemas-microsoft-com:office:word') !== -1;\n            };\n\n            var _cleanWordList = function (html) {\n\n                if (!isWordHtml(html)) return html;\n                if (html.indexOf('</body>') !== -1) {\n                    html = html.split('</body>')[0];\n                }\n                var parser = mw.tools.parseHtml(html).body;\n\n                var lists = mw.$('[style*=\"mso-list:\"]', parser);\n                lists.each(function () {\n                    var level = word_listitem_get_level(this);\n                    if (!!level) {\n                        this.setAttribute('data-level', level)\n                        this.setAttribute('class', 'level-' + level)\n                    }\n\n                });\n\n                mw.$('[style]', parser).removeAttr('style');\n\n                if (lists.length > 0) {\n                    lists = buildWordList(lists);\n                    var start = mw.$([]);\n                    mw.$('li', parser).each(function () {\n                        this.innerHTML = this.innerHTML\n                            .replace(/�/g, '')/* Not a dot */\n                            .replace(new RegExp(String.fromCharCode(160), \"g\"), \"\")\n                            .replace(/&nbsp;/gi, '')\n                            .replace(/\\�/g, '')\n                            .replace(/<\\/?span[^>]*>/g, \"\")\n                            .replace('�', '');\n                    });\n                }\n                return parser.innerHTML;\n            };\n\n            var cleanWord = function (html) {\n                html = _cleanWordList(html);\n                html = html.replace(/<td([^>]*)>/gi, '<td>');\n                html = html.replace(/<table([^>]*)>/gi, '<table cellspacing=\"0\" cellpadding=\"0\" border=\"1\" style=\"width:100%;\" width=\"100%\" class=\"element\">');\n                html = html.replace(/<o:p>\\s*<\\/o:p>/g, '');\n                html = html.replace(/<o:p>[\\s\\S]*?<\\/o:p>/g, '&nbsp;');\n                html = html.replace(/\\s*mso-[^:]+:[^;\"]+;?/gi, '');\n                html = html.replace(/\\s*MARGIN: 0cm 0cm 0pt\\s*;/gi, '');\n                html = html.replace(/\\s*MARGIN: 0cm 0cm 0pt\\s*\"/gi, \"\\\"\");\n                html = html.replace(/\\s*TEXT-INDENT: 0cm\\s*;/gi, '');\n                html = html.replace(/\\s*TEXT-INDENT: 0cm\\s*\"/gi, \"\\\"\");\n                html = html.replace(/\\s*TEXT-ALIGN: [^\\s;]+;?\"/gi, \"\\\"\");\n                html = html.replace(/\\s*PAGE-BREAK-BEFORE: [^\\s;]+;?\"/gi, \"\\\"\");\n                html = html.replace(/\\s*FONT-VARIANT: [^\\s;]+;?\"/gi, \"\\\"\");\n                html = html.replace(/\\s*tab-stops:[^;\"]*;?/gi, '');\n                html = html.replace(/\\s*tab-stops:[^\"]*/gi, '');\n                html = html.replace(/\\s*face=\"[^\"]*\"/gi, '');\n                html = html.replace(/\\s*face=[^ >]*/gi, '');\n                html = html.replace(/\\s*FONT-FAMILY:[^;\"]*;?/gi, '');\n                html = html.replace(/<(\\w[^>]*) class=([^ |>]*)([^>]*)/gi, \"<$1$3\");\n                html = html.replace(/<STYLE[^>]*>[\\s\\S]*?<\\/STYLE[^>]*>/gi, '');\n                html = html.replace(/<(?:META|LINK)[^>]*>\\s*/gi, '');\n                html = html.replace(/\\s*style=\"\\s*\"/gi, '');\n                html = html.replace(/<SPAN\\s*[^>]*>\\s*&nbsp;\\s*<\\/SPAN>/gi, '&nbsp;');\n                html = html.replace(/<SPAN\\s*[^>]*><\\/SPAN>/gi, '');\n                html = html.replace(/<(\\w[^>]*) lang=([^ |>]*)([^>]*)/gi, \"<$1$3\");\n                html = html.replace(/<SPAN\\s*>([\\s\\S]*?)<\\/SPAN>/gi, '$1');\n                html = html.replace(/<FONT\\s*>([\\s\\S]*?)<\\/FONT>/gi, '$1');\n                html = html.replace(/<\\\\?\\?xml[^>]*>/gi, '');\n                html = html.replace(/<w:[^>]*>[\\s\\S]*?<\\/w:[^>]*>/gi, '');\n                html = html.replace(/<\\/?\\w+:[^>]*>/gi, '');\n                html = html.replace(/<\\!--[\\s\\S]*?-->/g, '');\n                html = html.replace(/<(U|I|STRIKE)>&nbsp;<\\/\\1>/g, '&nbsp;');\n                html = html.replace(/<H\\d>\\s*<\\/H\\d>/gi, '');\n                html = html.replace(/<(\\w+)[^>]*\\sstyle=\"[^\"]*DISPLAY\\s?:\\s?none[\\s\\S]*?<\\/\\1>/ig, '');\n                html = html.replace(/<(\\w[^>]*) language=([^ |>]*)([^>]*)/gi, \"<$1$3\");\n                html = html.replace(/<(\\w[^>]*) onmouseover=\"([^\\\"]*)\"([^>]*)/gi, \"<$1$3\");\n                html = html.replace(/<(\\w[^>]*) onmouseout=\"([^\\\"]*)\"([^>]*)/gi, \"<$1$3\");\n                html = html.replace(/<H(\\d)([^>]*)>/gi, '<h$1>');\n                html = html.replace(/<font size=2>(.*)<\\/font>/gi, '$1');\n                html = html.replace(/<font size=3>(.*)<\\/font>/gi, '$1');\n                html = html.replace(/<a name=.*>(.*)<\\/a>/gi, '$1');\n                html = html.replace(/<H1([^>]*)>/gi, '<H2$1>');\n                html = html.replace(/<\\/H1\\d>/gi, '<\\/H2>');\n                //html = html.replace(/<span>/gi, '$1');\n                html = html.replace(/<\\/span\\d>/gi, '');\n                html = html.replace(/<(H\\d)><FONT[^>]*>([\\s\\S]*?)<\\/FONT><\\/\\1>/gi, '<$1>$2<\\/$1>');\n                html = html.replace(/<(H\\d)><EM>([\\s\\S]*?)<\\/EM><\\/\\1>/gi, '<$1>$2<\\/$1>');\n                return html;\n            };\n\n            var cleanTables = function (root) {\n                var toRemove = \"tbody > *:not(tr), thead > *:not(tr), tr > *:not(td)\",\n                    all = root.querySelectorAll(toRemove),\n                    l = all.length,\n                    i = 0;\n                for (; i < l; i++) {\n                    mw.$(all[i]).remove();\n                }\n                var tables = root.querySelectorAll('table'),\n                    l = tables.length,\n                    i = 0;\n                for (; i < l; i++) {\n                    var item = tables[i],\n                        l = item.children.length,\n                        i = 0;\n                    for (; i < l; i++) {\n                        var item = item.children[i];\n                        if (typeof item !== 'undefined' && item.nodeType !== 3) {\n                            var name = item.nodeName.toLowerCase();\n                            var posibles = \"thead tfoot tr tbody col colgroup\";\n                            if (!posibles.contains(name)) {\n                                mw.$(item).remove();\n                            }\n                        }\n                    }\n                }\n            };\n            return cleanWord(content)\n\n        },\n        action: function(targetParent, func) {\n            scope.state.record({\n                target: targetParent,\n                value: targetParent.innerHTML\n            });\n            func.call();\n            setTimeout(function(){\n                scope.state.record({\n                    target: targetParent,\n                    value: targetParent.innerHTML\n                });\n            }, 78);\n        },\n        elementNode: function (c) {\n            if( !c || !c.parentNode || c.parentNode === document.body ){\n                return null;\n            }\n            try {   /* Firefox returns wrong target (div) when you click on a spin-button */\n                if (typeof c.querySelector === 'function') {\n                    return c;\n                }\n                else {\n                    return scope.api.elementNode(c.parentNode);\n                }\n            }\n            catch (e) {\n                return null;\n            }\n        },\n        fontFamily: function (font_name, sel) {\n            var range = (sel || scope.getSelection()).getRangeAt(0);\n            scope.api.execCommand(\"styleWithCSS\", null, true);\n            if (range.collapsed) {\n                var el = scope.api.elementNode(range.commonAncestorContainer);\n                scope.api.select_all(el);\n                scope.api.execCommand('fontName', null, font_name);\n                range.collapse();\n            }\n            else {\n                scope.api.execCommand('fontName', null, font_name);\n            }\n        },\n        selectAll: function (el) {\n            var range = scope.document.createRange();\n            range.selectNodeContents(el);\n            var selection = scope.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n        },\n        selectElement: function (el) {\n            var range = scope.document.createRange();\n            try {\n                range.selectNode(el);\n                var selection = scope.getSelection();\n                selection.removeAllRanges();\n                selection.addRange(range);\n            } catch (e) {\n\n            }\n        },\n        isSelectionEditable: function (sel) {\n            try {\n                var node = (sel || scope.getSelection()).focusNode;\n                if (node === null) {\n                    return false;\n                }\n                if (node.nodeType === 1) {\n                    return node.isContentEditable;\n                }\n                else {\n                    return node.parentNode.isContentEditable;\n                }\n            }\n            catch (e) {\n                return false;\n            }\n        },\n        isSafeMode: function(el) {\n            if (!el) {\n                var node = scope.getSelection().focusNode;\n                el = scope.api.elementNode(node);\n            }\n            var hasSafe = mw.tools.hasAnyOfClassesOnNodeOrParent(el, ['safe-mode']);\n            var regInsafe = mw.tools.parentsOrCurrentOrderMatchOrNone(el, ['regular-mode', 'safe-mode']);\n            return hasSafe && !regInsafe;\n        },\n        _execCommandCustom: {\n            removeFormat: function (cmd, def, val) {\n                scope.actionWindow.document.execCommand(cmd, def, val);\n                var sel = scope.getSelection();\n                var r = sel.getRangeAt(0);\n                var common = r.commonAncestorContainer;\n                var all = common.querySelectorAll('*'), l = all.length, i = 0;\n                for ( ; i < l; i++ ) {\n                    var el = all[i];\n                    if (typeof sel !== 'undefined' && sel.containsNode(el, true)) {\n                        all[i].removeAttribute('style');\n                    }\n                }\n            }\n        },\n        execCommand: function (cmd, def, val) {\n             scope.actionWindow.document.execCommand('styleWithCss', 'false', false);\n            var sel = scope.getSelection();\n            try {  // 0x80004005\n                 if (scope.actionWindow.document.queryCommandSupported(cmd) && scope.api.isSelectionEditable()) {\n                     def = def || false;\n                    val = val || false;\n                    if (sel.rangeCount > 0) {\n                         var node = scope.api.elementNode(sel.focusNode);\n                        scope.api.action(mw.tools.firstBlockLevel(node), function () {\n                             scope.actionWindow.document.execCommand(cmd, def, val);\n                            mw.$(scope.settings.iframeAreaSelector, scope.actionWindow.document).trigger('execCommand');\n                            mw.$(scope).trigger('execCommand');\n                        });\n                    }\n                }\n            }\n            catch (e) {\n            }\n        },\n        _fontSize: function (size, unit) {\n            unit = unit || 'px';\n            var fontSize = $('<span/>', {\n                'text': scope.getSelection()\n            }).css('font-size', size + unit).prop('outerHTML');\n            scope.api.execCommand('insertHTML', false, fontSize);\n        },\n        lineHeight: function (size) {\n\n            if (scope.api.isSelectionEditable()) {\n                var sel = scope.getSelection();\n                var el = scope.api.elementNode(sel.focusNode)\n                scope.api.action(mw.tools.firstBlockLevel(el), function () {\n                     el.style.lineHeight = size\n                });\n            }\n\n        },\n        fontSize: function (size) {\n            var sel = scope.getSelection();\n            if (sel.isCollapsed) {\n                scope.api.select_all(scope.api.elementNode(sel.focusNode));\n                sel = scope.getSelection();\n            }\n            var range = sel.getRangeAt(0),\n                common = scope.api.elementNode(range.commonAncestorContainer);\n            var nodrop_state = mw.tools.parentsOrCurrentOrderMatchOrOnlyFirstOrNone(common, ['allow-drop', 'nodrop']);\n            if (scope.api.isSelectionEditable() && nodrop_state) {\n                scope.api._fontSize(size, 'px');\n            }\n        },\n        saveSelection: function () {\n            var sel = scope.getSelection();\n            scope.api.savedSelection = {\n                selection: sel,\n                range: sel.getRangeAt(0),\n                element: mw.$(scope.api.elementNode(sel.getRangeAt(0).commonAncestorContainer))\n            };\n        },\n        restoreSelection: function () {\n            if (scope.api.savedSelection) {\n                var sel = scope.getSelection();\n                scope.api.savedSelection.element.attr(\"contenteditable\", \"true\");\n                scope.api.savedSelection.element.focus();\n                scope.api.savedSelection.selection.removeAllRanges();\n                scope.api.savedSelection.selection.addRange(scope.api.savedSelection.range);\n            }\n        },\n        _cleaner: document.createElement('div'),\n        cleanHTML: function(html) {\n             this._cleaner.innerHTML = html;\n            var elements = Array.prototype.slice.call(this._cleaner.querySelectorAll('iframe,script,noscript'));\n            while (elements.length) {\n                elements[0].remove();\n                elements.shift();\n            }\n            return this._cleaner.innerHTML;\n        },\n        insertHTML: function(html) {\n            console.log(this.cleanHTML(html))\n            return scope.api.execCommand('insertHTML', false, this.cleanHTML(html));\n        },\n        insertImage: function (url) {\n            var id =  mw.id('image_');\n            var img = '<img id=\"' + id + '\" contentEditable=\"false\" class=\"element\" src=\"' + url + '\" />';\n            scope.api.insertHTML(img);\n            img = mw.$(\"#\" + id);\n            img.removeAttr(\"_moz_dirty\");\n            return img[0];\n        },\n        link: function (result) {\n            var sel = scope.getSelection();\n            var el = scope.api.elementNode(sel.focusNode);\n            var elLink = el.nodeName === 'A' ? el : mw.tools.firstParentWithTag(el, 'a');\n            if (elLink) {\n                elLink.href = result.url;\n                if (result.text && result.text !== elLink.innerHTML) {\n                    elLink.innerHTML = result.text;\n                }\n            } else {\n                scope.api.insertHTML('<a href=\"'+ result.url +'\">'+ (result.text || (sel.toString().trim()) || result.url) +'</a>');\n            }\n        },\n        unlink: function () {\n            var sel = scope.getSelection();\n            if (!sel.isCollapsed) {\n                this.execCommand('unlink', null, null);\n            }\n            else {\n                var link = mw.tools.firstParentOrCurrentWithTag(this.elementNode(sel.focusNode), 'a');\n                if (!!link) {\n                    this.selectElement(link);\n                    this.execCommand('unlink', null, null);\n                }\n            }\n        }\n    };\n};\n","MWEditor.controllersHelpers = {\r\n    '|' : function () {\r\n        return mw.element({\r\n            tage: 'span',\r\n            props: {\r\n                className: 'mw-bar-delimiter'\r\n            }\r\n        });\r\n    }\r\n};\r\n","MWEditor.tools = {\n\n};\n","MWEditor.core = {\r\n    button: function(config) {\r\n        config = config || {};\r\n        var defaults = {\r\n            tag: 'button',\r\n            props: {\r\n                className: 'mdi mw-editor-controller-component mw-editor-controller-button',\r\n                type: 'button'\r\n            }\r\n        };\r\n        if (config.props && config.props.className){\r\n            config.props.className = defaults.props.className + ' ' + config.props.className;\r\n        }\r\n        var settings = $.extend(true, {}, defaults, config);\r\n        return mw.element(settings);\r\n    },\r\n    colorPicker: function(config) {\r\n        config = config || {};\r\n        var defaults = {\r\n            props: {\r\n                className: 'mw-editor-controller-component'\r\n            }\r\n        };\r\n        var settings = $.extend(true, {}, defaults, config);\r\n\r\n        var el = MWEditor.core.button(settings);\r\n        el.addClass('mw-editor-color-picker')\r\n        var input = mw.element({\r\n            tag: 'input',\r\n            props: {\r\n                type: 'color',\r\n                className: 'mw-editor-color-picker-node'\r\n            }\r\n        });\r\n        var time = null;\r\n        input.on('input', function (){\r\n            clearTimeout(time);\r\n            time = setTimeout(function (el, node){\r\n                console.log(node.value)\r\n                el.trigger('change', node.value);\r\n            }, 210, el, this);\r\n        });\r\n        el.append(input);\r\n        return el;\r\n    },\r\n    element: function(config) {\r\n        config = config || {};\r\n        var defaults = {\r\n            props: {\r\n                className: 'mw-editor-controller-component'\r\n            }\r\n        };\r\n        var settings = $.extend(true, {}, defaults, config);\r\n        var el = mw.element(settings);\r\n        el.on('mousedown touchstart', function (e) {\r\n            e.preventDefault();\r\n        });\r\n        return el;\r\n    },\r\n\r\n    _dropdownOption: function (data) {\r\n        // data: { label: string, value: any },\r\n        var option = MWEditor.core.element({\r\n            props: {\r\n                className: 'mw-editor-dropdown-option',\r\n                innerHTML: data.label\r\n            }\r\n        });\r\n        option.on('mousedown touchstart', function (e) {\r\n            e.preventDefault();\r\n        });\r\n        option.value = data.value;\r\n        return option;\r\n    },\r\n    dropdown: function (options) {\r\n        var lscope = this;\r\n        this.root = MWEditor.core.element();\r\n        this.select = MWEditor.core.element({\r\n            props: {\r\n                className: 'mw-editor-controller-component mw-editor-controller-component-select',\r\n                tooltip: options.placeholder || null\r\n            }\r\n        });\r\n        var displayValNode = MWEditor.core.button({\r\n            props: {\r\n                className: (options.icon ? 'mdi-' + options.icon + ' ' : '') + 'mw-editor-select-display-value',\r\n                innerHTML: options.placeholder || ''\r\n            }\r\n        });\r\n\r\n        var valueHolder = MWEditor.core.element({\r\n            props: {\r\n                className: 'mw-editor-controller-component-select-values-holder',\r\n\r\n            }\r\n        });\r\n        this.root.value = function (val){\r\n            this.displayValue(val.label);\r\n            this.value(val.value);\r\n        };\r\n\r\n        this.root.displayValue = function (val) {\r\n            displayValNode.text(val || options.placeholder || '');\r\n        };\r\n\r\n        this.select.append(displayValNode);\r\n        this.select.append(valueHolder);\r\n        this.select.valueHolder = valueHolder;\r\n        for (var i = 0; i < options.data.length; i++) {\r\n            var dt = options.data[i];\r\n            (function (dt){\r\n                var opt = MWEditor.core._dropdownOption(dt);\r\n                opt.on('click', function (){\r\n                    lscope.select.trigger('change', dt);\r\n                });\r\n                valueHolder.append(opt);\r\n            })(dt);\r\n\r\n        }\r\n\r\n        this.select.on('click', function (e){\r\n            e.stopPropagation();\r\n            var wrapper = mw.tools.firstParentWithClass(this.node, 'mw-editor-wrapper');\r\n            if (wrapper) {\r\n                var edOff = wrapper.getBoundingClientRect();\r\n                var selOff = this.node.getBoundingClientRect();\r\n                this.valueHolder.css({\r\n                    maxHeight: edOff.height - (selOff.top - edOff.top)\r\n                });\r\n            }\r\n            mw.element(this).toggleClass('active');\r\n        });\r\n        this.root.append(this.select);\r\n    },\r\n    _preSelect: function (node) {\r\n        var all = document.querySelectorAll('.mw-editor-controller-component-select.active, .mw-bar-control-item-group.active');\r\n        var parent = mw.tools.firstParentOrCurrentWithAnyOfClasses(node ? node.parentNode : null, ['mw-editor-controller-component-select','mw-bar-control-item-group']);\r\n        var i = 0, l = all.length;\r\n        for ( ; i < l; i++) {\r\n            if(!node || (all[i] !== node && all[i] !== parent)) {\r\n                all[i].classList.remove('active');\r\n            }\r\n        }\r\n    }\r\n};\r\n","MWEditor.controllers = {\n    align: function (scope, api, rootScope) {\n        this.root = MWEditor.core.element();\n        this.root.$node.addClass('mw-editor-state-component mw-editor-state-component-align');\n        this.buttons = [];\n\n        var arr = [\n            {align: 'left', icon: 'left', action: 'justifyLeft'},\n            {align: 'center', icon: 'center', action: 'justifyCenter'},\n            {align: 'right', icon: 'right', action: 'justifyRight'},\n            {align: 'justify', icon: 'justify', action: 'justifyFull'}\n        ];\n        this.render = function () {\n            var scope = this;\n            arr.forEach(function (item) {\n                var el = MWEditor.core.button({\n                    props: {\n                        className: 'mdi-format-align-' + item.icon\n                    }\n                });\n                el.on('mousedown touchstart', function (e) {\n                    api.execCommand(item.action);\n                });\n                scope.root.append(el);\n                scope.buttons.push(el);\n            });\n            return scope.root;\n        };\n        this.checkSelection = function (opt) {\n            var align = opt.css.alignNormalize();\n            for (var i = 0; i< this.buttons.length; i++) {\n                var state = arr[i].align === align;\n                rootScope.controllerActive(this.buttons[i].node, state);\n            }\n        };\n        this.element = this.render();\n    },\n    bold: function (scope, api, rootScope) {\n        this.render = function () {\n            var scope = this;\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-format-bold',\n                    tooltip: rootScope.lang('Bold')\n                }\n            });\n            el.on('mousedown touchstart', function (e) {\n                api.execCommand('bold');\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            if(opt.css.is().bold) {\n                rootScope.controllerActive(opt.controller.element.node, true);\n            } else {\n                rootScope.controllerActive(opt.controller.element.node, false);\n            }\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    strikeThrough: function (scope, api, rootScope) {\n        this.render = function () {\n            var scope = this;\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-format-strikethrough',\n                    tooltip: rootScope.lang('Strike through')\n                }\n            });\n\n            el.on('mousedown touchstart', function (e) {\n                api.execCommand('strikeThrough');\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            if(opt.css.is().striked) {\n                rootScope.controllerActive(opt.controller.element.node, true);\n            } else {\n                rootScope.controllerActive(opt.controller.element.node, false);\n            }\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    italic: function(scope, api, rootScope){\n        this.render = function () {\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-format-italic',\n                    tooltip: rootScope.lang('Italic')\n                }\n            });\n            el.on('mousedown touchstart', function (e) {\n                api.execCommand('italic');\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n            if(opt.css.is().italic) {\n                rootScope.controllerActive(opt.controller.element.node, true);\n            } else {\n                rootScope.controllerActive(opt.controller.element.node, false);\n            }\n        };\n        this.element = this.render();\n    },\n    'underline': function(scope, api, rootScope){\n        this.render = function () {\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-format-underline',\n                    tooltip: rootScope.lang('Underline')\n                }\n            });\n            el.on('mousedown touchstart', function (e) {\n                api.execCommand('underline');\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n            if(opt.css.is().underlined) {\n                rootScope.controllerActive(opt.controller.element.node, true);\n            } else {\n                rootScope.controllerActive(opt.controller.element.node, false);\n            }\n        };\n        this.element = this.render();\n    },\n    'image': function(scope, api, rootScope){\n        this.render = function () {\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-folder-multiple-image',\n                    tooltip: rootScope.lang('Insert Image')\n                }\n            });\n            el.on('click', function (e) {\n                var dialog;\n                var picker = new mw.filePicker({\n                    type: 'images',\n                    label: false,\n                    autoSelect: false,\n                    footer: true,\n                    _frameMaxHeight: true,\n                    onResult: function (res) {\n                        var url = res.src ? res.src : res;\n                        if(!url) return;\n                        url = url.toString();\n                        api.insertImage(url);\n                        dialog.remove();\n                    }\n                });\n                dialog = mw.top().dialog({\n                    content: picker.root,\n                    title: mw.lang('Select image'),\n                    footer: false\n                })\n\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    link: function(scope, api, rootScope){\n\n        this.render = function () {\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-link',\n                    tooltip: rootScope.lang('Insert link')\n                }\n            });\n\n            el.on('click', function (e) {\n                api.saveSelection();\n                var sel = scope.getSelection();\n\n                var target = mw.tools.firstParentWithTag(sel.focusNode, 'a');\n\n                var val;\n                if(target) {\n                    val = {\n                        url: target.href,\n                        text: target.innerHTML,\n                        target: target.target === '_blank'\n                    };\n                } else if(!sel.isCollapsed) {\n                    val = {\n                        url: '',\n                        text: api.getSelectionHTML(),\n                        target: false\n                    };\n                }\n                var linkEditor = new mw.LinkEditor({\n                    mode: 'dialog',\n                });\n                if(val) {\n                    linkEditor.setValue(val);\n                }\n\n                linkEditor.promise().then(function (data){\n                    var modal = linkEditor.dialog;\n                    if(data) {\n                        api.restoreSelection();\n                        api.link(data);\n                        modal.remove();\n                    } else {\n                        modal.remove();\n                    }\n                });\n\n\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    fontSize: function (scope, api, rootScope) {\n        this.checkSelection = function (opt) {\n            var css = opt.css;\n            var font = css.font();\n            var size = font.size;\n            opt.controller.element.displayValue(size);\n            opt.controller.element.disabled = !opt.api.isSelectionEditable();\n        };\n        this.render = function () {\n            var dropdown = new MWEditor.core.dropdown({\n                data: [\n                    { label: '8px', value: 8 },\n                    { label: '10px', value: 10 },\n                    { label: '12px', value: 12 },\n                    { label: '14px', value: 14 },\n                    { label: '16px', value: 16 },\n                    { label: '18px', value: 18 },\n                    { label: '20px', value: 20 },\n                    { label: '22px', value: 22 },\n                    { label: '24px', value: 24 },\n                    { label: '22px', value: 22 },\n                ],\n                placeholder: rootScope.lang('Font Size')\n            });\n            dropdown.select.on('change', function (e, val) {\n                api.fontSize(val.value);\n            });\n            return dropdown.root;\n        };\n        this.element = this.render();\n    },\n    lineHeight: function (scope, api, rootScope) {\n        this.checkSelection = function (opt) {\n            var css = opt.css;\n            var font = css.font();\n            var size = font.height;\n            opt.controller.element.displayValue(size);\n            opt.controller.element.disabled = !opt.api.isSelectionEditable();\n        };\n        this.render = function () {\n            var dropdown = new MWEditor.core.dropdown({\n                icon: 'format-line-spacing',\n                data: [\n                    { label: 'normal', value: 'normal' },\n                    { label: '14px', value:'14px' },\n                    { label: '16px', value:'16px' },\n                    { label: '19px', value:'19px' },\n                    { label: '21px', value:'21px' },\n                    { label: '24px', value:'24px' },\n                    { label: '25px', value:'25px' },\n                    { label: '27px', value:'27px' },\n                    { label: '30px', value:'30px' },\n                    { label: '35px', value:'35px' },\n                    { label: '40px', value:'40px' },\n                    { label: '45px', value:'45px' },\n                    { label: '50px', value:'50px' },\n                    { label: '55px', value:'55px' },\n                    { label: '60px', value:'60px' },\n                ],\n                placeholder: rootScope.lang('Line height')\n            });\n            dropdown.select.on('change', function (e, val) {\n                api.lineHeight(val.value);\n            });\n            return dropdown.root;\n        };\n        this.element = this.render();\n    },\n    format: function (scope, api, rootScope) {\n\n        this._availableTags = [\n            { label: '<h1>Title</h1>', value: 'h1' },\n            { label: '<h2>Title</h2>', value: 'h2' },\n            { label: '<h3>Title</h3>', value: 'h3' },\n            { label: '<h4>Title</h4>', value: 'h4' },\n            { label: '<h5>Title</h5>', value: 'h5' },\n            { label: '<h6>Title</h6>', value: 'h6' },\n            { label: 'Paragraph', value: 'p' },\n            { label: 'Block', value: 'div' },\n            { label: 'Pre formated', value: 'pre' }\n        ];\n\n        this.availableTags = function () {\n            if(this.__availableTags) {\n                return this.__availableTags;\n            }\n            this.__availableTags = this._availableTags.map(function (item) {\n                return item.value;\n            });\n            return this.availableTags();\n        };\n\n        this.getTagDisplayName = function (tag) {\n            tag = (tag || '').trim().toLowerCase();\n            if(!tag) return;\n            for (var i = 0; i < this._availableTags.length; i++) {\n                if(this._availableTags[i].value === tag) {\n                    return this._availableTags[i].label;\n                }\n            }\n        };\n\n        this.checkSelection = function (opt) {\n            var el = opt.api.elementNode(opt.selection.focusNode);\n            var parentEl = mw.tools.firstParentOrCurrentWithTag(el, this.availableTags());\n            opt.controller.element.displayValue(parentEl ? this.getTagDisplayName(parentEl.nodeName) : '');\n            opt.controller.element.disabled = !opt.api.isSelectionEditable();\n        };\n        this.render = function () {\n            var dropdown = new MWEditor.core.dropdown({\n                data: this._availableTags,\n                placeholder: rootScope.lang('Format')\n            });\n            dropdown.select.on('change', function (e, val) {\n                api.execCommand('formatBlock', false, e.detail.value);\n                /*var sel = scope.getSelection();\n                var range = sel.getRangeAt(0);\n                var el = scope.actionWindow.document.createElement(val.value);\n\n                var disableSelection = true;\n\n                if(sel.isCollapsed || disableSelection) {\n                    var selectionElement = api.elementNode(sel.focusNode);\n                    if(scope.$editArea[0] !== selectionElement) {\n                        mw.tools.setTag(selectionElement, val.value);\n                    } else {\n                        while (selectionElement.firstChild) {\n                            el.appendChild(selectionElement.firstChild);\n                        }\n                        selectionElement.appendChild(el);\n                    }\n                    var newRange = scope.actionWindow.document.createRange();\n                    newRange.setStart(sel.anchorNode, sel.anchorOffset);\n                    newRange.collapse(true);\n                    sel.removeAllRanges();\n                    sel.addRange(range);\n                } else {\n                    range.surroundContents(el);\n                }*/\n            });\n            return dropdown.root;\n        };\n        this.element = this.render();\n    },\n    fontSelector: function (scope, api, rootScope) {\n        this.checkSelection = function (opt) {\n            var css = opt.css;\n                var font = css.font();\n                var family_array = font.family.split(','), fam;\n                if (family_array.length === 1) {\n                    fam = font.family;\n                } else {\n                    fam = family_array.shift();\n                }\n                fam = fam.replace(/['\"]+/g, '');\n                opt.controller.element.displayValue(fam);\n                opt.controller.element.disabled = !opt.api.isSelectionEditable();\n\n        };\n        this.render = function () {\n            var dropdown = new MWEditor.core.dropdown({\n                data: [\n                    { label: 'Arial 1', value: 'Arial' },\n                    { label: 'Verdana 1', value: 'Verdana' },\n                ],\n                placeholder: rootScope.lang('Font')\n            });\n            dropdown.select.on('change', function (e, val, b) {\n                api.fontFamily(val.value);\n            });\n            return dropdown.root;\n        };\n        this.element = this.render();\n    },\n    undoRedo: function(scope, api, rootScope) {\n        this.render = function () {\n            this.root = MWEditor.core.element();\n            this.root.addClass('mw-ui-btn-nav mw-editor-state-component')\n            var undo = MWEditor.core.button({\n                props: {\n                    className: 'mdi-undo',\n                    tooltip: rootScope.lang('Undo')\n                }\n            });\n            undo.on('mousedown touchstart', function (e) {\n                rootScope.state.undo();\n                rootScope._syncTextArea();\n            });\n\n            var redo = MWEditor.core.button({\n                props: {\n                    className: 'mdi-redo',\n                    tooltip: rootScope.lang('Redo')\n                }\n            });\n            redo.on('mousedown touchstart', function (e) {\n                rootScope.state.redo();\n                rootScope._syncTextArea();\n            });\n            this.root.node.appendChild(undo.node);\n            this.root.node.appendChild(redo.node);\n            $(rootScope.state).on('stateRecord', function(e, data){\n                undo.node.disabled = !data.hasNext;\n                redo.node.disabled = !data.hasPrev;\n            })\n            .on('stateUndo stateRedo', function(e, data){\n                if(!data.active || !data.active.target) {\n                    undo.node.disabled = !data.hasNext;\n                    redo.node.disabled = !data.hasPrev;\n                    return;\n                }\n                if(scope.actionWindow.document.body.contains(data.active.target)) {\n                    mw.$(data.active.target).html(data.active.value);\n                } else{\n                    if(data.active.target.id) {\n                        mw.$(scope.actionWindow.document.getElementById(data.active.target.id)).html(data.active.value);\n                    }\n                }\n                if(data.active.prev) {\n                    mw.$(data.active.prev).html(data.active.prevValue);\n                }\n                // mw.drag.load_new_modules();\n                undo.node.disabled = !data.hasNext;\n                redo.node.disabled = !data.hasPrev;\n                $(scope).trigger(e.type, [data]);\n            });\n            setTimeout(function () {\n                var data = rootScope.state.eventData();\n                undo.node.disabled = !data.hasNext;\n                redo.node.disabled = !data.hasPrev;\n            }, 78);\n            return this.root;\n        };\n        this.element = this.render();\n    },\n    'ul': function(scope, api, rootScope){\n        this.render = function () {\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-format-list-bulleted'\n                }\n            });\n            el.on('mousedown touchstart', function (e) {\n                var sel = api.getSelection();\n                var node = api.elementNode(sel.focusNode);\n                var paragraph = mw.tools.firstParentOrCurrentWithTag(node, 'p');\n                if(paragraph) {\n                    scope.api.action(paragraph.parentNode, function () {\n                        var ul = scope.actionWindow.document.createElement('ul');\n                        var li = scope.actionWindow.document.createElement('li');\n                        ul.appendChild(li);\n                        while (paragraph.firstChild) {\n                            li.appendChild(node.firstChild);\n                        }\n                        paragraph.parentNode.insertBefore(ul, paragraph.nextSibling);\n                        paragraph.remove();\n                    });\n                } else {\n                    api.execCommand('insertUnorderedList');\n                }\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    'ol': function(scope, api, rootScope){\n        this.render = function () {\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-format-list-numbered tip',\n                    'data-tip': 'Ordered list'\n                }\n            });\n            el.on('mousedown touchstart', function (e) {\n                var sel = api.getSelection();\n                var node = api.elementNode(sel.focusNode);\n                var paragraph = mw.tools.firstParentOrCurrentWithTag(node, 'p');\n                if(paragraph) {\n                    scope.api.action(paragraph.parentNode, function () {\n                        var ul = scope.actionWindow.document.createElement('ol');\n                        var li = scope.actionWindow.document.createElement('li');\n                        ul.appendChild(li);\n                        while (paragraph.firstChild) {\n                            li.appendChild(paragraph.firstChild);\n                        }\n                        paragraph.parentNode.insertBefore(ul, paragraph.nextSibling);\n                        paragraph.remove();\n                    });\n                } else {\n                    api.execCommand('insertOrderedList');\n                }\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    'indent': function(scope, api, rootScope){\n        this.render = function () {\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-format-indent-increase',\n                    'data-tip': 'Indent'\n                }\n            });\n            el.on('mousedown touchstart', function (e) {\n                api.execCommand('indent');\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    'outdent': function(scope, api, rootScope){\n        this.render = function () {\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-format-indent-decrease',\n                    'data-tip': 'Indent'\n                }\n            });\n            el.on('mousedown touchstart', function (e) {\n                api.execCommand('outdent');\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    removeFormat: function (scope, api, rootScope) {\n        this.render = function () {\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-format-clear',\n                    tooltip: 'Remove Format'\n                }\n            });\n            el.on('mousedown touchstart', function (e) {\n                api.execCommand('removeFormat');\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    unlink: function (scope, api, rootScope) {\n        this.render = function () {\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-link-off', tooltip: 'Unlink'\n                }\n            });\n            el.on('mousedown touchstart', function (e) {\n                api.execCommand('unlink');\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    textColor: function (scope, api, rootScope) {\n        this.render = function () {\n            var el = MWEditor.core.colorPicker({\n                props: {\n                    className: 'mdi-format-color-text', tooltip: 'Text color'\n                }\n            });\n            el.on('change', function (e, val) {\n                console.log(val)\n                api.execCommand('foreColor', false, val);\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    textBackgroundColor: function (scope, api, rootScope) {\n        this.render = function () {\n            var el = MWEditor.core.colorPicker({\n                props: {\n                    className: 'mdi-format-color-fill', tooltip: 'Text background color'\n                }\n            });\n            el.on('change', function (e, val) {\n                console.log(e, val)\n                api.execCommand('backcolor', false, val);\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    table: function (scope, api, rootScope) {\n        this.render = function () {\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-table-large', tooltip: 'Insert Table'\n                }\n            });\n            el.on('mousedown touchstart', function (e) {\n                api.insertHTML('<table class=\"mw-ui-table\" border=\"1\" width=\"100%\"><tr><td></td><td></td></tr><tr><td></td><td></td></tr></table>');\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n    wordPaste: function (scope, api, rootScope) {\n        this.render = function () {\n            var el = MWEditor.core.button({\n                props: {\n                    className: 'mdi-file-word', tooltip: 'Paste from Word'\n                }\n            });\n            el.on('mousedown touchstart', function (e) {\n                api.saveSelection();\n                var dialog;\n                var ok = MWEditor.core.element({\n                    tag: 'span',\n                    props: {\n                        className: 'mw-ui-btn mw-ui-btn-info',\n                        innerHTML: rootScope.lang('OK')\n                    }\n                });\n                var cancel = MWEditor.core.element({\n                    tag: 'span',\n                    props: {\n                        className: 'mw-ui-btn',\n                        innerHTML: rootScope.lang('Cancel')\n                    }\n                });\n                var cleanEl = mw.element({\n                    props: {\n                        contentEditable: true,\n                        autofocus: true,\n                        style: {\n                            height: '250px'\n                        }\n                    }\n                });\n\n                var footer = mw.element();\n                cancel.on('click', function (){\n                    dialog.remove();\n                })\n                ok.on('click', function (){\n                    var content = cleanEl.html().trim();\n                    dialog.remove();\n                    api.restoreSelection();\n                    if(content){\n                        api.insertHTML(api.cleanWord(content));\n                    }\n\n                });\n                footer.append(cancel);\n                footer.append(ok);\n                dialog = mw.dialog({\n                    content: cleanEl.node,\n                    footer: footer.node\n                });\n            });\n            return el;\n        };\n        this.checkSelection = function (opt) {\n            opt.controller.element.node.disabled = !opt.api.isSelectionEditable(opt.selection);\n        };\n        this.element = this.render();\n    },\n\n\n\n};\n","\r\n/*************************************************************\r\n *\r\n        MWEditor.addController(\r\n            'underline',\r\n            function () {\r\n\r\n            }, function () {\r\n\r\n            }\r\n        );\r\n\r\n        MWEditor.addController({\r\n            name: 'underline',\r\n            render: function () {\r\n\r\n            },\r\n            checkSelection: function () {\r\n\r\n            }\r\n        })\r\n\r\n **************************************************************/\r\n\r\nMWEditor.controllers.insertEmailVariable = function (scope, api, rootScope) {\r\n    this.checkSelection = function (opt) {\r\n        opt.controller.element.disabled = !opt.api.isSelectionEditable();\r\n    };\r\n    this.render = function () {\r\n        var dropdown = new MWEditor.core.dropdown({\r\n            data: [\r\n                { label: 'User Name', value: '{user_name}' },\r\n                { label: '...', value: '{...}' },\r\n            ],\r\n            placeholder: rootScope.lang('Insert variable')\r\n        });\r\n        dropdown.select.on('change', function (e, val) {\r\n            api.insertHTML(val.value);\r\n        });\r\n        return dropdown.root;\r\n    };\r\n    this.element = this.render();\r\n};\r\n\r\nMWEditor.controllers.editSource = function (scope, api, rootScope) {\r\n    this.render = function () {\r\n\r\n        var scope = this;\r\n        var el = MWEditor.core.button({\r\n            props: {\r\n                className: 'mdi mdi-xml',\r\n                tooltip:  'Edit source'\r\n            }\r\n        });\r\n        el.on('mousedown touchstart', function (e) {\r\n\r\n            var ok = mw.element('<span class=\"mw-ui-btn mw-ui-btn-info\">'+mw.lang('OK')+'</span>');\r\n            var cancel = mw.element('<span class=\"mw-ui-btn\">'+mw.lang('Cancel')+'</span>');\r\n            var area = mw.element({ tag: 'textarea', props: {\r\n                    className: 'mw-ui-field',\r\n                }});\r\n            area.css({\r\n                height: 400\r\n            })\r\n            area.val(rootScope.$editArea.html());\r\n            var footer = mw.element();\r\n            footer.append(cancel).append(ok)\r\n            var dialog = mw.dialog({\r\n                overlay: true,\r\n                content: area.get(0),\r\n                footer: footer.get(0),\r\n                title: mw.lang('Edit source')\r\n            });\r\n\r\n            cancel.on('click', function (){\r\n                dialog.remove()\r\n            });\r\n            ok.on('click', function (){\r\n                rootScope.setContent(area.val(), true);\r\n                dialog.remove();\r\n            });\r\n\r\n        });\r\n        return el;\r\n    };\r\n    this.checkSelection = function () {\r\n        return true;\r\n    };\r\n};\r\n\r\n\r\nMWEditor.addController = function (name, render, checkSelection, dependencies) {\r\n    if (MWEditor.controllers[name]) {\r\n        console.warn(name + ' already defined');\r\n        return;\r\n    }\r\n    if (typeof name === 'object') {\r\n        var obj = name;\r\n        name = obj.name;\r\n        render = obj.render;\r\n        checkSelection = obj.checkSelection;\r\n        dependencies = obj.dependencies;\r\n    }\r\n    if(MWEditor.controllers[name]) {\r\n        console.warn(name + ' controller is already registered in the editor');\r\n        return;\r\n    }\r\n    MWEditor.controllers[name] = function () {\r\n        this.render = render;\r\n        if(checkSelection) {\r\n            this.checkSelection = checkSelection;\r\n        }\r\n        this.element = this.render();\r\n        this.dependencies = dependencies;\r\n    };\r\n};\r\n\r\n\r\nMWEditor.addInteractionController = function (name, render, interact, dependencies) {\r\n    if (MWEditor.controllers[name]) {\r\n        console.warn(name + ' already defined');\r\n        return;\r\n    }\r\n    if (typeof name === 'object') {\r\n        var obj = name;\r\n        name = obj.name;\r\n        render = obj.render;\r\n        interact = obj.interact;\r\n        dependencies = obj.dependencies;\r\n    }\r\n    if(MWEditor.interactionControls[name]) {\r\n        console.warn(name + ' controller is already registered in the editor')\r\n        return;\r\n    }\r\n    MWEditor.interactionControls[name] = function () {\r\n        this.render = render;\r\n        if(interact) {\r\n            this.interact = interact;\r\n        }\r\n        this.element = this.render();\r\n        this.dependencies = dependencies;\r\n    };\r\n};\r\n","/*\r\n*\r\n*  interface data {\r\n        target: Element,\r\n        component: Element,\r\n        isImage: boolean,\r\n        event: Event\r\n    };\r\n*\r\n*\r\n* */\r\n\r\nMWEditor.interactionControls = {\r\n    linkTooltip: function (rootScope) {\r\n        this.render = function () {\r\n            var scope = this;\r\n            var el = mw.element({\r\n                props: {\r\n                    className: 'mw-editor-link-tooltip'\r\n                }\r\n            });\r\n            var urlElement = mw.element({\r\n                tag: 'a',\r\n                props: {\r\n                    className: 'mw-editor-link-tooltip-url',\r\n                    target: 'blank'\r\n                }\r\n            });\r\n            var urlUnlink = MWEditor.core.button({\r\n                props: {\r\n                    className: 'mdi-link-off',\r\n                }\r\n            });\r\n\r\n            urlUnlink.on('click', function () {\r\n                rootScope.api.unlink();\r\n            });\r\n\r\n            el.urlElement = urlElement;\r\n            el.urlUnlink = urlUnlink;\r\n            el.append(urlElement);\r\n            el.append(urlUnlink);\r\n            el.target = null;\r\n            el.hide();\r\n            return el;\r\n        };\r\n        this.interact = function (data) {\r\n            var tg = mw.tools.firstParentOrCurrentWithTag(data.target,'a');\r\n            if(!tg) {\r\n                this.element.hide();\r\n                return;\r\n            }\r\n            var $target = $(data.target);\r\n            this.$target = $target;\r\n            var css = $target.offset();\r\n            css.top += $target.height();\r\n            this.element.urlElement.html(data.target.href);\r\n            this.element.urlElement.prop('href', data.target.href);\r\n            this.element.css(css).show();\r\n        };\r\n        this.element = this.render();\r\n    },\r\n    image: function (rootScope) {\r\n        this.nodes = [];\r\n        this.render = function () {\r\n            var scope = this;\r\n            var el = mw.element({\r\n                props: {\r\n                    className: 'mw-editor-image-handle-wrap'\r\n                }\r\n            });\r\n            var changeButton = mw.element({\r\n                props: {\r\n                    innerHTML: '<i class=\"mdi mdi-folder-multiple-image\"></i>',\r\n                    className: 'mw-ui-btn mw-ui-btn-medium tip',\r\n                    dataset: {\r\n                        tip: rootScope.lang('Change image')\r\n                    }\r\n                }\r\n            });\r\n            changeButton.on('click', function () {\r\n                var dialog;\r\n                var picker = new mw.filePicker({\r\n                    type: 'images',\r\n                    label: false,\r\n                    autoSelect: false,\r\n                    footer: true,\r\n                    _frameMaxHeight: true,\r\n                    onResult: function (res) {\r\n                        var url = res.src ? res.src : res;\r\n                        if(!url) return;\r\n                        url = url.toString();\r\n                        scope.$target.attr('src', url);\r\n                        dialog.remove();\r\n                    }\r\n                });\r\n                dialog = mw.top().dialog({\r\n                    content: picker.root,\r\n                    title: mw.lang('Select image'),\r\n                    footer: false\r\n                })\r\n\r\n            });\r\n            var editButton = mw.element({\r\n                props: {\r\n                    innerHTML: '<i class=\"mdi mdi-image-edit\"></i>',\r\n                    className: 'mw-ui-btn mw-ui-btn-medium tip',\r\n                    dataset: {\r\n                        tip: rootScope.lang('Edit image')\r\n                    }\r\n                }\r\n            });\r\n            var nav = mw.element({\r\n                props: {\r\n                    className: 'mw-ui-btn-nav'\r\n                }\r\n            });\r\n            nav.append(changeButton);\r\n            el.append(nav);\r\n            // nav.append(editButton);\r\n            this.nodes.push(el.node, changeButton.node, editButton.node);\r\n            el.hide();\r\n            return el;\r\n        };\r\n        this.interact = function (data) {\r\n            if(mw.tools.firstParentOrCurrentWithClass(data.localTarget, 'mw-editor-image-handle-wrap')) {\r\n                return;\r\n            }\r\n            if(this.nodes.indexOf(data.target) !== -1) {\r\n                this.element.$node.hide();\r\n                return;\r\n            }\r\n            if (data.isImage) {\r\n                var $target = $(data.localTarget);\r\n                this.$target = $target;\r\n                var css = $target.offset();\r\n                css.width = $target.outerWidth();\r\n                css.height = $target.outerHeight();\r\n                this.element.css(css).show();\r\n            } else {\r\n                this.element.hide();\r\n            }\r\n        };\r\n        this.element = this.render();\r\n    },\r\n    tableManager: function(rootScope){\r\n        var lscope = this;\r\n        this.interact = function (data) {\r\n            if (!data.eventIsActionLike) { return; }\r\n            var td = mw.tools.firstParentOrCurrentWithTag(data.localTarget, 'td');\r\n            if (td) {\r\n                var $target = $(td);\r\n                this.$target = $target;\r\n                var css = $target.offset();\r\n                css.top -= lscope.element.node.offsetHeight;\r\n                this.element.$node.css(css).show();\r\n            } else {\r\n                this.element.$node.hide();\r\n            }\r\n        };\r\n\r\n        this._afterAction = function () {\r\n            this.element.$node.hide();\r\n            rootScope.state.record({\r\n                target: rootScope.$editArea[0],\r\n                value: rootScope.$editArea[0].innerHTML\r\n            });\r\n        };\r\n\r\n        this.render = function () {\r\n            var root = mw.element({\r\n                props: {\r\n                    className: 'mw-editor-table-manager'\r\n                }\r\n            });\r\n            var bar = mw.bar();\r\n            bar.createRow();\r\n            root.append(bar.bar);\r\n\r\n            var insertDD = new MWEditor.core.dropdown({\r\n                data: [\r\n                    { label: 'Row Above', value: {action: 'insertRow', type: 'above'} },\r\n                    { label: 'Row Under', value: {action: 'insertRow', type: 'under'} },\r\n                    { label: 'Column on the left', value: {action: 'insertColumn', type: 'left'} },\r\n                    { label: 'Column on the right', value: {action: 'insertColumn', type: 'right'} },\r\n                ],\r\n                placeholder: 'Insert'\r\n            });\r\n\r\n            insertDD.select.on('change', function (e, data, node) {\r\n                rootScope.state.record({\r\n                    target: rootScope.$editArea[0],\r\n                    value: rootScope.$editArea[0].innerHTML\r\n                });\r\n                lscope[data.value.action](data.value.type);\r\n                lscope._afterAction();\r\n            });\r\n            var deletetDD = new MWEditor.core.dropdown({\r\n                data: [\r\n                    { label: 'Row', value: {action: 'deleteRow'} },\r\n                    { label: 'Column', value: {action: 'deleteColumn'} },\r\n                ],\r\n                placeholder: 'Delete'\r\n            });\r\n\r\n            deletetDD.select.on('change', function (e, data, node) {\r\n                rootScope.state.record({\r\n                    target: rootScope.$editArea[0],\r\n                    value: rootScope.$editArea[0].innerHTML\r\n                });\r\n                lscope[data.value.action]();\r\n                lscope._afterAction()\r\n            });\r\n\r\n            bar.add(insertDD.root.node);\r\n            bar.add(deletetDD.root.node);\r\n            root.hide();\r\n\r\n            return root;\r\n        };\r\n\r\n        this.deleteRow = function (cell) {\r\n            cell = cell || this.getActiveCell();\r\n            cell.parentNode.remove();\r\n        };\r\n\r\n\r\n        this.deleteColumn = function (cell) {\r\n            cell = cell || this.getActiveCell();\r\n            var index = mw.tools.index(cell),\r\n                body = cell.parentNode.parentNode,\r\n                rows = mw.$(body).children('tr'),\r\n                l = rows.length,\r\n                i = 0;\r\n            for (; i < l; i++) {\r\n                var row = rows[i];\r\n                row.getElementsByTagName('td')[index].remove();\r\n            }\r\n        };\r\n\r\n        this.getActiveCell = function () {\r\n            var node = rootScope.api.elementNode( rootScope.getSelection().focusNode);\r\n            return mw.tools.firstParentOrCurrentWithTag(node,'td');\r\n        };\r\n\r\n        this.insertColumn = function (dir, cell) {\r\n            cell = cell || this.getActiveCell();\r\n            cell = mw.$(cell)[0];\r\n            if (cell === null) {\r\n                return false;\r\n            }\r\n            dir = dir || 'right';\r\n            var rows = mw.$(cell.parentNode.parentNode).children('tr');\r\n            var i = 0, l = rows.length, index = mw.tools.index(cell);\r\n            for (; i < l; i++) {\r\n                var row = rows[i];\r\n                cell = mw.$(row).children('td')[index];\r\n                if (dir === 'left' || dir === 'both') {\r\n                    mw.$(cell).before(\"<td>&nbsp;</td>\");\r\n                }\r\n                if (dir === 'right' || dir === 'both') {\r\n                    mw.$(cell).after(\"<td>&nbsp;</td>\");\r\n                }\r\n            }\r\n        };\r\n        this.insertRow = function (dir, cell) {\r\n            cell = cell || this.getActiveCell();\r\n            cell = mw.$(cell)[0];\r\n            if (cell === null) {\r\n                return false;\r\n            }\r\n            dir = dir || 'under';\r\n            var parent = cell.parentNode, cells = mw.$(parent).children('td'), i = 0, l = cells.length,\r\n                html = '';\r\n            for (; i < l; i++) {\r\n                html += '<td>&nbsp;</td>';\r\n            }\r\n            html = '<tr>' + html + '</tr>';\r\n            if (dir === 'under' || dir === 'both') {\r\n                mw.$(parent).after(html)\r\n            }\r\n            if (dir === 'above' || dir === 'both') {\r\n                mw.$(parent).before(html)\r\n            }\r\n        };\r\n        this.deleteRow = function (cell) {\r\n            cell = cell || this.getActiveCell();\r\n            mw.$(cell.parentNode).remove();\r\n        };\r\n        this.deleteColumn = function (cell) {\r\n            cell = cell || this.getActiveCell();\r\n            var index = mw.tools.index(cell), body = cell.parentNode.parentNode, rows = mw.$(body).children('tr'), l = rows.length, i = 0;\r\n            for (; i < l; i++) {\r\n                var row = rows[i];\r\n                mw.$(row.getElementsByTagName('td')[index]).remove();\r\n            }\r\n        };\r\n\r\n        this.setStyle = function (cls, cell) {\r\n            cell = cell || this.getActiveCell();\r\n            var table = mw.tools.firstParentWithTag(cell, 'table');\r\n            mw.tools.classNamespaceDelete(table, 'mw-wysiwyg-table');\r\n            mw.$(table).addClass(cls);\r\n        };\r\n        this.element = this.render();\r\n    }\r\n\r\n};\r\n","MWEditor.i18n = {\r\n    en: {\r\n        'Change': 'Change',\r\n        'Edit image': 'Edit',\r\n    }\r\n};\r\n","\nvar canDestroy = function (event) {\n    var target = event.target;\n    return !mw.tools.hasAnyOfClassesOnNodeOrParent(event, ['safe-element']) && mw.tools.parentsOrCurrentOrderMatchOrOnlyFirstOrNone(target, ['allow-drop', 'nodrop']);\n};\n\n\n\n\nMWEditor.leSave = {\n   prepare: function(root){\n        if(!root) {\n            return null;\n        }\n       var doc = mw.tools.parseHtml();\n       var doc = document.implementation.createHTMLDocument(\"\");\n       doc.body.innerHTML = root.innerHTML;\n\n       mw.$('.element-current', doc).removeClass('element-current');\n       mw.$('.element-active', doc).removeClass('element-active');\n       mw.$('.disable-resize', doc).removeClass('disable-resize');\n       mw.$('.mw-webkit-drag-hover-binded', doc).removeClass('mw-webkit-drag-hover-binded');\n       mw.$('.module-cat-toggle-Modules', doc).removeClass('module-cat-toggle-Modules');\n       mw.$('.mw-module-drag-clone', doc).removeClass('mw-module-drag-clone');\n       mw.$('-module', doc).removeClass('-module');\n       mw.$('.empty-element', doc).remove();\n       mw.$('.empty-element', doc).remove();\n       mw.$('.edit .ui-resizable-handle', doc).remove();\n       mw.$('script', doc).remove();\n       mw.tools.classNamespaceDelete('all', 'ui-', doc, 'starts');\n       mw.$(\"[contenteditable]\", doc).removeAttr(\"contenteditable\");\n       var all = doc.querySelectorAll('[contenteditable]'),\n           l = all.length,\n           i = 0;\n       for (; i < l; i++) {\n           all[i].removeAttribute('contenteditable');\n       }\n       var all1 = doc.querySelectorAll('.module'),\n           l1 = all.length,\n           i1 = 0;\n       for (; i1 < l1; i1++) {\n           if (all[i1].querySelector('.edit') === null) {\n               all[i1].innerHTML = '';\n           }\n       }\n       return doc;\n   },\n   htmlAttrValidate:function(edits){\n        var final = [];\n        $.each(edits, function(){\n            var html = this.outerHTML;\n            html = html.replace(/url\\(&quot;/g, \"url('\");\n            html = html.replace(/jpg&quot;/g, \"jpg'\");\n            html = html.replace(/jpeg&quot;/g, \"jpeg'\");\n            html = html.replace(/png&quot;/g, \"png'\");\n            html = html.replace(/gif&quot;/g, \"gif'\");\n            final.push($(html)[0]);\n        })\n        return final;\n   },\n    pastedFromExcel: function (clipboard) {\n        var html = clipboard.getData('text/html');\n        return html.indexOf('ProgId content=Excel.Sheet') !== -1\n    },\n    areSameLike: function (el1, el2) {\n        if (!el1 || !el2) return false;\n        if (el1.nodeType !== el2.nodeType) return false;\n        if (!!el1.className.trim() || !!el2.className.trim()) {\n            return false;\n        }\n\n        var css1 = (el1.getAttribute('style') || '').replace(/\\s/g, '');\n        var css2 = (el2.getAttribute('style') || '').replace(/\\s/g, '');\n\n        if (css1 === css2 && el1.nodeName === el2.nodeName) {\n            return true;\n        }\n\n        return false;\n    },\n    cleanUnwantedTags: function (body) {\n        var scope = this;\n        mw.$('*', body).each(function () {\n            if (this.nodeName !== 'A' && mw.ea.helpers.isInlineLevel(this) && (this.className.trim && !this.className.trim())) {\n                if (scope.areSameLike(this, this.nextElementSibling) && this.nextElementSibling === this.nextSibling) {\n                    if (this.nextSibling !== this.nextElementSibling) {\n                        this.appendChild(this.nextSibling);\n                    }\n                    this.innerHTML = this.innerHTML + this.nextElementSibling.innerHTML;\n                    this.nextElementSibling.innerHTML = '';\n                    this.nextElementSibling.className = 'mw-skip-and-remove';\n                }\n            }\n        });\n        mw.$('.mw-skip-and-remove', body).remove();\n        return body;\n    },\n   getData: function(edits) {\n        mw.$(edits).each(function(){\n            mw.$('meta', this).remove();\n        });\n\n        edits = this.htmlAttrValidate(edits);\n        var l = edits.length,\n            i = 0,\n            helper = {},\n            master = {};\n        if (l > 0) {\n            for (; i < l; i++) {\n                helper.item = edits[i];\n                var rel = mw.tools.mwattr(helper.item, 'rel');\n                if (!rel) {\n                    mw.$(helper.item).removeClass('changed');\n                    mw.tools.foreachParents(helper.item, function(loop) {\n                        var cls = this.className;\n                        var rel = mw.tools.mwattr(this, 'rel');\n                        if (mw.tools.hasClass(cls, 'edit') && mw.tools.hasClass(cls, 'changed') && (!!rel)) {\n                            helper.item = this;\n                            mw.tools.stopLoop(loop);\n                        }\n                    });\n                }\n                var rel = mw.tools.mwattr(helper.item, 'rel');\n                if (!rel) {\n                    var field = !!helper.item.id ? '#'+helper.item.id : '';\n                    console.warn('Skipped save: .edit'+field+' element does not have rel attribute.');\n                    continue;\n                }\n                mw.$(helper.item).removeClass('changed orig_changed');\n                mw.$(helper.item).removeClass('module-over');\n\n                mw.$('.module-over', helper.item).each(function(){\n                    mw.$(this).removeClass('module-over');\n                });\n                mw.$('[class]', helper.item).each(function(){\n                    var cls = this.getAttribute(\"class\");\n                    if(typeof cls === 'string'){\n                        cls = cls.trim();\n                    }\n                    if(!cls){\n                        this.removeAttribute(\"class\");\n                    }\n                });\n                var content = this.cleanUnwantedTags(helper.item).innerHTML;\n                var attr_obj = {};\n                var attrs = helper.item.attributes;\n                if (attrs.length > 0) {\n                    var ai = 0,\n                        al = attrs.length;\n                    for (; ai < al; ai++) {\n                        attr_obj[attrs[ai].nodeName] = attrs[ai].nodeValue;\n                    }\n                }\n                var obj = {\n                    attributes: attr_obj,\n                    html: content\n                };\n                var objdata = \"field_data_\" + i;\n                master[objdata] = obj;\n            }\n        }\n        return master;\n    }\n};\n\nMWEditor.leCore = {};\n\n// methods accessible by scope.liveedit\n\nMWEditor.liveeditMode = function(scope){\n    return {\n\n        prepare: {\n            titles: function () {\n                var t = scope.querySelectorAll('[field=\"title\"]'),\n                    l = t.length,\n                    i = 0;\n\n                for (; i < l; i++) {\n                    mw.$(t[i]).addClass(\"nodrop\");\n                }\n            }\n        },\n\n        isSafeMode: function (el) {\n            if (!el) {\n                var sel = scope.selection;\n                if(!sel.rangeCount) return false;\n                var range = sel.getRangeAt(0);\n                el = scope.api.elementNode(range.commonAncestorContainer);\n            }\n            var hasSafe = mw.tools.hasAnyOfClassesOnNodeOrParent(el, ['safe-mode']);\n            var regInsafe = mw.tools.parentsOrCurrentOrderMatchOrNone(el, ['regular-mode', 'safe-mode']);\n            return hasSafe && !regInsafe;\n        },\n        init: function (body, scope) {\n            mw.$(body).on('keydown', function (event) {\n                if (event.type === 'keydown') {\n                    if (mw.tools.isField(event.target) || !event.target.isContentEditable) {\n                        return true;\n                    }\n                    var sel = scope.selection;\n                    if (mw.event.is.enter(event)) {\n                        if (MWEditor.liveeditMode.isSafeMode(event.target)) {\n                            var isList = mw.tools.firstMatchesOnNodeOrParent(event.target, ['li', 'ul', 'ol']);\n                            if (!isList) {\n                                event.preventDefault();\n                                scope.api.insertHTML('<br>\\u200C');\n                            }\n                        }\n                    }\n                    if (sel.rangeCount > 0) {\n                        var r = sel.getRangeAt(0);\n                        if (event.keyCode === 9 && !event.shiftKey && sel.focusNode.parentNode.isContentEditable && sel.isCollapsed) {   /* tab key */\n                            scope.api.insertHTML('&nbsp;&nbsp;&nbsp;&nbsp;');\n                            return false;\n                        }\n                        return manageDeleteAndBackspace(event, sel);\n                    }\n                }\n            });\n        },\n        manageDeleteAndBackspaceInSafeMode : function (event, sel) {\n            var node = scope.api.elementNode(sel.focusNode);\n            var range = sel.getRangeAt(0);\n            if(!node.textContent.replace(/\\s/gi, '')){\n                MWEditor.liveeditMode._manageDeleteAndBackspaceInSafeMode.emptyNode(event, node, sel, range);\n                return false;\n            }\n            MWEditor.liveeditMode._manageDeleteAndBackspaceInSafeMode.nodeBoundaries(event, node, sel, range);\n            return true;\n        },\n        merge: {\n            /* Executes on backspace or delete */\n            isMergeable: function (el) {\n                if (!el) return false;\n                if (el.nodeType === 3) return true;\n                var is = false;\n                var css =  getComputedStyle(el);\n                var display = css.getPropertyValue('display');\n                var position = css.getPropertyValue('position');\n                var isInline = display === 'inline';\n                if (isInline) return true;\n                var mergeables = ['p', '.element', 'div:not([class])', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n                mergeables.forEach(function (item) {\n                    if (el.matches(item)) {\n                        is = true;\n                    }\n                });\n\n                if (is) {\n                    if (el.querySelector('.module') !== null || mw.tools.hasClass(el, 'module')) {\n                        is = false;\n                    }\n                }\n                return is;\n            },\n            manageBreakables: function (curr, next, dir, event) {\n                var isnonbreakable = scope.liveedit.merge.isInNonbreakable(curr, dir);\n                if (isnonbreakable) {\n                    var conts = scope.selection.getRangeAt(0);\n                    event.preventDefault();\n                    if (next !== null) {\n                        if (next.nodeType === 3 && /\\r|\\n/.exec(next.nodeValue) !== null) {\n                            event.preventDefault();\n                            return false;\n                        }\n                        if (dir === 'next') {\n                            scope.liveedit.cursorToElement(next);\n                        }\n                        else {\n                            scope.liveedit.cursorToElement(next, 'end');\n                        }\n                    }\n                    else {\n                        return false;\n                    }\n                }\n            },\n            isInNonbreakable: function (el, dir) {\n                var absNext = scope.liveedit.merge.findNextNearest(el, dir);\n\n                if (absNext.nodeType === 3 && /\\r|\\n/.exec(absNext.nodeValue) !== null) {\n                    absNext = scope.liveedit.merge.findNextNearest(el, dir, true)\n                }\n\n                if (absNext.nodeType === 1) {\n                    if (mw.tools.hasAnyOfClasses(absNext, ['nodrop', 'allow-drop'])) {\n                        return false;\n                    }\n                    if (absNext.querySelector('.nodrop', '.allow-drop') !== null) {\n                        return false;\n                    }\n                }\n                if (scope.liveedit.merge.alwaysMergeable(absNext) && (scope.liveedit.merge.alwaysMergeable(absNext.firstElementChild) || !absNext.firstElementChild)) {\n                    return false;\n                }\n                if (el.textContent === '') {\n\n                    var absNextNext = scope.liveedit.merge.findNextNearest(absNext, dir);\n                    if (absNext.nodeType === 3 && /\\r|\\n/.exec(absNext.nodeValue) !== null) {\n                        return scope.liveedit.merge.isInNonbreakableClass(absNextNext)\n                    }\n                }\n\n                if (el.nodeType === 1 && !!el.textContent.trim()) {\n                    return false;\n                }\n                if (el.nextSibling === null && el.nodeType === 3 && dir == 'next') {\n                    var absNext = scope.liveedit.merge.findNextNearest(el, dir);\n                    var absNextNext = scope.liveedit.merge.findNextNearest(absNext, dir);\n                    if (/\\r|\\n/.exec(absNext.nodeValue) !== null) {\n                        return scope.liveedit.merge.isInNonbreakableClass(absNextNext)\n                    }\n\n                    if (absNextNext.nodeType === 1) {\n                        return scope.liveedit.merge.isInNonbreakableClass(absNextNext) || scope.liveedit.merge.isInNonbreakableClass(absNextNext.firstChild);\n                    }\n                    else if (absNextNext.nodeType === 3) {\n                        return true;\n                    }\n                    else {\n                        return false;\n                    }\n                }\n\n                if (el.previousSibling === null && el.nodeType === 3 && dir === 'prev') {\n                    var absNext = scope.liveedit.merge.findNextNearest(el, 'prev');\n                    var absNextNext = scope.liveedit.merge.findNextNearest(absNext, 'prev');\n                    if (absNextNext.nodeType === 1) {\n                        return scope.liveedit.merge.isInNonbreakableClass(absNextNext);\n                    }\n                    else if (absNextNext.nodeType === 3) {\n                        return true;\n                    }\n                    else {\n                        return false;\n                    }\n                }\n                el = scope.api.elementNode(el);\n\n                var is = scope.liveedit.merge.isInNonbreakableClass(el);\n                return is;\n            },\n            isInNonbreakableClass: function (el, dir) {\n                var absNext = scope.liveedit.merge.findNextNearest(el, dir);\n\n                if (el.nodeType === 3 && /\\r|\\n/.exec(absNext.nodeValue) === null) return false;\n                el = scope.api.elementNode(el);\n                var classes = ['unbreakable', '*col', '*row', '*btn', '*icon', 'module', 'edit'];\n                var is = false;\n                classes.forEach(function (item) {\n                    if (item.indexOf('*') === 0) {\n                        var item = item.split('*')[1];\n                        if (el.className.indexOf(item) !== -1) {\n                            is = true;\n                        }\n                        else {\n                            mw.tools.foreachParents(el, function (loop) {\n                                if (this.className.indexOf(item) !== -1 && !this.contains(el)) {\n                                    is = true;\n                                    mw.tools.stopLoop(loop);\n                                }\n                                else {\n                                    is = false;\n                                    mw.tools.stopLoop(loop);\n                                }\n                            });\n                        }\n                    }\n                    else {\n                        if (mw.tools.hasClass(el, item) || mw.tools.hasParentsWithClass(el, item)) {\n                            is = true;\n                        }\n                    }\n                });\n                return is;\n            },\n            getNext: function (curr) {\n                var next = curr.nextSibling;\n                while (curr !== null && curr.nextSibling === null) {\n                    curr = curr.parentNode;\n                    next = curr.nextSibling;\n                }\n                return next;\n            },\n            getPrev: function (curr) {\n                var next = curr.previousSibling;\n                while (curr !== null && curr.previousSibling === null) {\n                    curr = curr.parentNode;\n                    next = curr.previousSibling;\n                }\n                return next;\n            },\n            findNextNearest: function (el, dir, searchElement) {\n                searchElement = typeof searchElement === 'undefined' ? false : true;\n                if (dir === 'next') {\n                    var dosearch = searchElement ? 'nextElementSibling' : 'nextSibling';\n                    var next = el[dosearch];\n                    if (next === null) {\n                        while (el[dosearch] === null) {\n                            el = el.parentNode;\n                            next = el[dosearch];\n                        }\n                    }\n                }\n                else {\n                    var dosearch = searchElement ? 'previousElementSibling' : 'previousSibling';\n                    var next = el[dosearch];\n                    if (next === null) {\n                        while (el[dosearch] === null) {\n                            el = el.parentNode;\n                            next = el[dosearch];\n                        }\n                    }\n                }\n                return next;\n            },\n            alwaysMergeable: function (el) {\n                if (!el) {\n                    return false;\n                }\n                if (el.nodeType === 3) {\n                    return scope.liveedit.merge.alwaysMergeable(scope.api.elementNode(el))\n                }\n                if (el.nodeType === 1) {\n                    if (/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i.test(el.tagName)) {\n                        return true;\n                    }\n                    if (/^(?:strong|em|i|b|li)$/i.test(el.tagName)) {\n                        return true;\n                    }\n                    if (/^(?:span)$/i.test(el.tagName) && !el.className) {\n                        return true;\n                    }\n                }\n                if (mw.tools.hasClass(el, 'module')) return false;\n                if (mw.tools.hasParentsWithClass(el, 'module')) {\n                    var ord = mw.tools.parentsOrder(el, ['edit', 'module']);\n                }\n                var selectors = [\n                        'p.element', 'div.element', 'div:not([class])',\n                        'h1.element', 'h2.element', 'h3.element', 'h4.element', 'h5.element', 'h6.element',\n                        '.edit  h1', '.edit  h2', '.edit  h3', '.edit  h4', '.edit  h5', '.edit  h6',\n                        '.edit p'\n                    ],\n                    final = false,\n                    i = 0;\n                for (; i < selectors.length; i++) {\n                    var item = selectors[i];\n                    if (el.matches(item)) {\n                        final = true;\n                        break;\n                    }\n                }\n                return final;\n            }\n        },\n        _manageDeleteAndBackspaceInSafeMode : {\n            emptyNode: function (event, node, sel, range) {\n                if(!canDestroy(node)) {\n                    return;\n                }\n                var todelete = node;\n                if(mw.tools.hasAnyOfClasses(node.parentNode, ['text', 'title'])){\n                    todelete = node.parentNode;\n                }\n                var transfer, transferPosition;\n                if (mw.event.is.delete(event)) {\n                    transfer = todelete.nextElementSibling;\n                    transferPosition = 'start';\n                } else {\n                    transfer = todelete.previousElementSibling;\n                    transferPosition = 'end';\n                }\n                var parent = todelete.parentNode;\n                scope.record({\n                    target: parent,\n                    value: parent.innerHTML\n                });\n                $(todelete).remove();\n                if(transfer && mw.tools.isEditable(transfer)) {\n                    setTimeout(function () {\n                        scope.liveedit.cursorToElement(transfer, transferPosition);\n                    });\n                }\n                scope.record({\n                    target: parent,\n                    value: parent.innerHTML\n                });\n            },\n            nodeBoundaries: function (event, node, sel, range) {\n                var isStart = range.startOffset === 0 || !((sel.anchorNode.data || '').substring(0, range.startOffset).replace(/\\s/g, ''));\n                var curr, content;\n                if(mw.event.is.backSpace(event) && isStart && range.collapsed){ // is at the beginning\n                    curr = node;\n                    if(mw.tools.hasAnyOfClasses(node.parentNode, ['text', 'title'])){\n                        curr = node.parentNode;\n                    }\n                    var prev = curr.previousElementSibling;\n                    if(prev && prev.nodeName === node.nodeName && canDestroy(node)) {\n                        content = node.innerHTML;\n                        scope.liveedit.cursorToElement(prev, 'end');\n                        prev.appendChild(range.createContextualFragment(content));\n                        $(curr).remove();\n                    }\n                } else if(mw.event.is.delete(event)\n                    && range.collapsed\n                    && range.startOffset === sel.anchorNode.data.replace(/\\s*$/,'').length // is at the end\n                    && canDestroy(node)){\n                    curr = node;\n                    if(mw.tools.hasAnyOfClasses(node.parentNode, ['text', 'title'])){\n                        curr = node.parentNode;\n                    }\n                    var next = curr.nextElementSibling, deleteParent;\n                    if(mw.tools.hasAnyOfClasses(next, ['text', 'title'])){\n                        next = next.firstElementChild;\n                        deleteParent = true;\n                    }\n                    if(next && next.nodeName === curr.nodeName) {\n                        content = next.innerHTML;\n                        setTimeout(function(){\n                            var parent = deleteParent ? next.parentNode.parentNode : next.parentNode;\n                            scope.actionRecord(function() {\n                                    return {\n                                        target: parent,\n                                        value: parent.innerHTML\n                                    };\n                                }, function () {\n                                    curr.append(range.createContextualFragment(content));\n                                }\n                            );\n                        });\n                    }\n                }\n            }\n        },\n        manageDeleteAndBackspace: function (event, sel) {\n            if (mw.event.is.delete(event) || mw.event.is.backSpace(event)) {\n                if(!sel.rangeCount) return;\n                var r = sel.getRangeAt(0);\n                var isSafe = scope.liveedit.isSafeMode();\n\n                if(isSafe) {\n                    return scope.liveedit.manageDeleteAndBackspaceInSafeMode(event, sel);\n                }\n                var nextNode = null, nextchar, nextnextchar, nextel;\n\n                if (mw.event.is.delete(event)) {\n                    nextchar = sel.focusNode.textContent.charAt(sel.focusOffset);\n                    nextnextchar = sel.focusNode.textContent.charAt(sel.focusOffset + 1);\n                    nextel = sel.focusNode.nextSibling || sel.focusNode.nextElementSibling;\n\n                } else {\n                    nextchar = sel.focusNode.textContent.charAt(sel.focusOffset - 1);\n                    nextnextchar = sel.focusNode.textContent.charAt(sel.focusOffset - 2);\n                    nextel = sel.focusNode.previouSibling || sel.focusNode.previousElementSibling;\n                }\n\n                if ((nextchar === ' ' || /\\r|\\n/.exec(nextchar) !== null) && sel.focusNode.nodeType === 3 && !nextnextchar) {\n                    event.preventDefault();\n                    return false;\n                }\n\n                if (nextnextchar === '') {\n\n                    if (nextchar.replace(/\\s/g, '') === '' && r.collapsed) {\n\n                        if (nextel && !mw.tools.isBlockLevel(nextel) && ( typeof nextel.className === 'undefined' || !nextel.className.trim())) {\n                            return true;\n                        }\n                        else if (nextel && nextel.nodeName !== 'BR') {\n                            if (sel.focusNode.nodeName === 'P') {\n                                if (event.keyCode === 46) {\n                                    if (sel.focusNode.nextElementSibling.nodeName === 'P') {\n                                        return true;\n                                    }\n                                }\n                                if (event.keyCode === 8) {\n\n                                    if (sel.focusNode.previousElementSibling.nodeName === 'P') {\n                                        return true;\n                                    }\n                                }\n                            }\n                            event.preventDefault();\n                            return false;\n                        }\n\n                    }\n                    else if (\n                        (focus.previousElementSibling === null && rootfocus.previousElementSibling === null)\n                        && mw.tools.hasAnyOfClassesOnNodeOrParent(rootfocus, ['nodrop', 'allow-drop'])) {\n                        return false;\n                    }\n                }\n                if (nextchar === '') {\n\n                    if (mw.event.is.delete(event)) {\n                        nextNode = scope.liveedit.merge.getNext(sel.focusNode);\n                    }\n                    if (mw.event.is.backSpace(event)) {\n                        nextNode = scope.liveedit.merge.getPrev(sel.focusNode);\n                    }\n                    if (scope.liveedit.merge.alwaysMergeable(nextNode)) {\n                        return true;\n                    }\n\n                    var nonbr = scope.liveedit.merge.isInNonbreakable(nextNode)\n                    if (nonbr) {\n                        event.preventDefault();\n                        return false;\n                    }\n                    if (nextNode !== null && scope.liveedit.merge.isMergeable(nextNode)) {\n                        if (mw.event.is.delete(event)) {\n                            scope.liveedit.merge.manageBreakables(sel.focusNode, nextNode, 'next', event)\n                        }\n                        else {\n                            scope.liveedit.merge.manageBreakables(sel.focusNode, nextNode, 'prev', event)\n                        }\n                    }\n                    else {\n                        event.preventDefault();\n                    }\n                    if (nextNode === null) {\n                        nextNode = sel.focusNode.parentNode.nextSibling;\n                        if (!scope.liveedit.merge.isMergeable(nextNode)) {\n                            event.preventDefault();\n                        }\n                        if (mw.event.is.delete(event)) {\n                            scope.liveedit.merge.manageBreakables(sel.focusNode, nextNode, 'next', event)\n                        }\n                        else {\n                            scope.liveedit.merge.manageBreakables(sel.focusNode, nextNode, 'prev', event)\n                        }\n                    }\n                }\n            }\n            return true;\n        }\n\n    };\n};\n\n\n\n\n\n\n"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC1tBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC7eA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACTA;AACA;AACA;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AChJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC7sBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACnTA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}