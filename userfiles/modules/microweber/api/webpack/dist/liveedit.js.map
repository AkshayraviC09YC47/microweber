{"version":3,"file":"liveedit.js","sources":["webpack://microweber-webpack/../liveedit/beforeleave.js","webpack://microweber-webpack/../liveedit/cloneable.js","webpack://microweber-webpack/../liveedit/columns.js","webpack://microweber-webpack/../liveedit/data.js","webpack://microweber-webpack/../liveedit/drag.js","webpack://microweber-webpack/../liveedit/edit.fields.js","webpack://microweber-webpack/../liveedit/editor_externals.js","webpack://microweber-webpack/../liveedit/editors.js","webpack://microweber-webpack/../liveedit/element_analyzer.js","webpack://microweber-webpack/../liveedit/events.custom.js","webpack://microweber-webpack/../liveedit/events.js","webpack://microweber-webpack/../liveedit/external_callbacks.js","webpack://microweber-webpack/../liveedit/handles.js","webpack://microweber-webpack/../liveedit/initload.js","webpack://microweber-webpack/../liveedit/initready.js","webpack://microweber-webpack/../liveedit/inline.js","webpack://microweber-webpack/../liveedit/layoutplus.js","webpack://microweber-webpack/../liveedit/live_edit.js","webpack://microweber-webpack/../liveedit/liveedit_elements.js","webpack://microweber-webpack/../liveedit/liveedit_widgets.js","webpack://microweber-webpack/../liveedit/liveedit.js","webpack://microweber-webpack/../liveedit/manage.content.js","webpack://microweber-webpack/../liveedit/modules.toolbar.js","webpack://microweber-webpack/../liveedit/padding.js","webpack://microweber-webpack/../liveedit/plus.js","webpack://microweber-webpack/../liveedit/selector.js","webpack://microweber-webpack/../liveedit/source-edit.js","webpack://microweber-webpack/../liveedit/tempcss.js","webpack://microweber-webpack/../liveedit/toolbar.js","webpack://microweber-webpack/../liveedit/widgets.js","webpack://microweber-webpack/../liveedit/wysiwyg.js","webpack://microweber-webpack/../liveedit/wysiwygmdab.js"],"sourcesContent":["\r\n\r\nmw.liveedit.beforeleave = function(url) {\r\n    var beforeleave_html = \"\" +\r\n        \"<div class='mw-before-leave-container'>\" +\r\n        \"<p>Leave page by choosing an option</p>\" +\r\n        \"<span class='mw-ui-btn mw-ui-btn-important'>\" + mw.msg.before_leave + \"</span>\" +\r\n        \"<span class='mw-ui-btn mw-ui-btn-notification' >\" + mw.msg.save_and_continue + \"</span>\" +\r\n        \"<span class='mw-ui-btn' onclick='mw.dialog.remove(\\\"#modal_beforeleave\\\")'>\" + mw.msg.cancel + \"</span>\" +\r\n        \"</div>\";\r\n    if (mw.askusertostay && mw.$(\".edit.orig_changed\").length > 0) {\r\n        if (document.getElementById('modal_beforeleave') === null) {\r\n            var modal = mw.dialog({\r\n                html: beforeleave_html,\r\n                name: 'modal_beforeleave',\r\n                width: 470,\r\n                height: 230\r\n            });\r\n\r\n            var save = modal.container.querySelector('.mw-ui-btn-notification');\r\n            var go = modal.container.querySelector('.mw-ui-btn-important');\r\n\r\n            mw.$(save).click(function() {\r\n                mw.$(document.body).addClass(\"loading\");\r\n                mw.dialog.remove(modal);\r\n                mw.drag.save(undefined, function() {\r\n                    mw.askusertostay = false;\r\n                    window.location.href = url;\r\n                });\r\n            });\r\n            mw.$(go).click(function() {\r\n                mw.askusertostay = false;\r\n                window.location.href = url;\r\n            });\r\n        }\r\n\r\n        return false;\r\n    }\r\n}\r\n","mw.drag.onCloneableControl = function(target, isOverControl){\r\n    if(!this._onCloneableControl){\r\n        this._onCloneableControl = document.createElement('div');\r\n        this._onCloneableControl.className = 'mw-cloneable-control';\r\n        var html = '';\r\n        html += '<span class=\"mw-cloneable-control-item mw-cloneable-control-prev tip\" data-tip=\"Move backward\"></span>';\r\n        html += '<span class=\"mw-cloneable-control-item mw-cloneable-control-plus tip\" data-tip=\"Clone\"></span>';\r\n        html += '<span class=\"mw-cloneable-control-item mw-cloneable-control-minus tip\" data-tip=\"Remove\"></span>' ;\r\n        html += '<span class=\"mw-cloneable-control-item mw-cloneable-control-next tip\" data-tip=\"Move forward\"></span>';\r\n        this._onCloneableControl.innerHTML = html;\r\n\r\n        document.body.appendChild(this._onCloneableControl);\r\n        $('.mw-cloneable-control-plus', this._onCloneableControl).on('click', function(){\r\n            var $t = $(mw.drag._onCloneableControl.__target).parent()\r\n            mw.liveEditState.record({\r\n                target: $t[0],\r\n                value: $t[0].innerHTML\r\n            });\r\n            var parser = mw.tools.parseHtml(mw.drag._onCloneableControl.__target.outerHTML).body;\r\n            var all = parser.querySelectorAll('[id]'), i = 0;\r\n            for( ; i < all.length; i++){\r\n                all[i].id = 'mw-cl-id-' + mw.random();\r\n            }\r\n            $(mw.drag._onCloneableControl.__target).after(parser.innerHTML);\r\n            mw.liveEditState.record({\r\n                target: $t[0],\r\n                value: $t[0].innerHTML\r\n            });\r\n            mw.wysiwyg.change(mw.drag._onCloneableControl.__target);\r\n            mw.drag.onCloneableControl('hide');\r\n        });\r\n        $('.mw-cloneable-control-minus', this._onCloneableControl).on('click', function(){\r\n            var $t = $(mw.drag._onCloneableControl.__target).parent();\r\n            mw.liveEditState.record({\r\n                target: $t[0],\r\n                value: $t[0].innerHTML\r\n            });\r\n            $(mw.drag._onCloneableControl.__target).fadeOut(function(){\r\n                mw.wysiwyg.change(this);\r\n                $(this).remove();\r\n                mw.liveEditState.record({\r\n                    target: $t[0],\r\n                    value: $t[0].innerHTML\r\n                });\r\n            });\r\n            mw.drag.onCloneableControl('hide');\r\n        });\r\n        $('.mw-cloneable-control-next', this._onCloneableControl).on('click', function(){\r\n            var $t = $(mw.drag._onCloneableControl.__target).parent();\r\n            mw.liveEditState.record({\r\n                target: $t[0],\r\n                value: $t[0].innerHTML\r\n            });\r\n            $(mw.drag._onCloneableControl.__target).next().after(mw.drag._onCloneableControl.__target)\r\n            mw.liveEditState.record({\r\n                target: $t[0],\r\n                value: $t[0].innerHTML\r\n            });\r\n            mw.wysiwyg.change(mw.drag._onCloneableControl.__target);\r\n            mw.drag.onCloneableControl('hide');\r\n        });\r\n        $('.mw-cloneable-control-prev', this._onCloneableControl).on('click', function(){\r\n            var $t = $(mw.drag._onCloneableControl.__target).parent();\r\n            mw.liveEditState.record({\r\n                target: $t[0],\r\n                value: $t[0].innerHTML\r\n            });\r\n            $(mw.drag._onCloneableControl.__target).prev().before(mw.drag._onCloneableControl.__target);\r\n            mw.liveEditState.record({\r\n                target: $t[0],\r\n                value: $t[0].innerHTML\r\n            });\r\n            mw.wysiwyg.change(mw.drag._onCloneableControl.__target);\r\n            mw.drag.onCloneableControl('hide');\r\n        });\r\n    }\r\n    var clc = $(this._onCloneableControl);\r\n    if(target === 'hide'){\r\n        clc.hide();\r\n    }\r\n    else{\r\n        clc.show();\r\n        this._onCloneableControl.__target = target;\r\n\r\n        var next = $(this._onCloneableControl.__target).next();\r\n        var prev = $(this._onCloneableControl.__target).prev();\r\n        var el = $(target), off = el.offset();\r\n\r\n\r\n        if(next.length === 0){\r\n            $('.mw-cloneable-control-next', clc).hide();\r\n        }\r\n        else{\r\n            $('.mw-cloneable-control-next', clc).show();\r\n        }\r\n        if(prev.length === 0){\r\n            $('.mw-cloneable-control-prev', clc).hide();\r\n        }\r\n        else{\r\n            $('.mw-cloneable-control-prev', clc).show();\r\n        }\r\n        var leftCenter = (off.left > 0 ? off.left : 0) + (el.width()/2 - clc.width()/2) ;\r\n        clc.show();\r\n        if(isOverControl){\r\n            return;\r\n        }\r\n        clc.css({\r\n            top: off.top > 0 ? off.top : 0 ,\r\n            left: leftCenter\r\n        });\r\n\r\n\r\n        var cloner = document.querySelector('.mw-cloneable-control');\r\n        if(cloner) {\r\n            mw._initHandles.getAll().forEach(function (curr) {\r\n                masterRect = curr.wrapper.getBoundingClientRect();\r\n                var clonerect = cloner.getBoundingClientRect();\r\n\r\n                if (mw._initHandles.collide(masterRect, clonerect)) {\r\n                    cloner.style.top = (parseFloat(curr.wrapper.style.top) + 10) + 'px';\r\n                    cloner.style.left = ((parseInt(curr.wrapper.style.left, 10) + masterRect.width) + 10) + 'px';\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n}\r\n","mw.drag = mw.drag || {};\r\nmw.drag.columns = {\r\n    step: 0.8,\r\n    resizing: false,\r\n    prepare: function () {\r\n        mw.drag.columns.resizer = document.createElement('div');\r\n        mw.wysiwyg.contentEditable(mw.drag.columns.resizer, false);\r\n        mw.drag.columns.resizer.className = 'unselectable mw-columns-resizer';\r\n        mw.drag.columns.resizer.pos = 0;\r\n        mw.$(mw.drag.columns.resizer).on('mousedown', function () {\r\n            mw.drag.columns.resizing = true;\r\n            mw.drag.columns.resizer.pos = 0;\r\n        });\r\n        document.body.appendChild(mw.drag.columns.resizer);\r\n\r\n        mw.$(mw.drag.columns.resizer).hide();\r\n    },\r\n    resize: function (e) {\r\n        if (!mw.drag.columns.resizer.curr) return false;\r\n        var w = parseFloat(mw.drag.columns.resizer.curr.style.width);\r\n        var widthParentPixels;\r\n        if (isNaN(w)) {\r\n            w = mw.$(mw.drag.columns.resizer.curr).outerWidth();\r\n            widthParentPixels = mw.$(mw.drag.columns.resizer.curr).parent().outerWidth();\r\n            w = (w / widthParentPixels) * 100;\r\n        }\r\n        var next = mw.drag.columns.nextColumn(mw.drag.columns.resizer.curr);\r\n        if(!next){\r\n            mw.$(mw.drag.columns.resizer).hide();\r\n            return false;\r\n        }\r\n\r\n        var w2 = parseFloat(next.style.width);\r\n        if (isNaN(w2)) {\r\n            w2 = mw.$(next).outerWidth();\r\n            widthParentPixels = mw.$(next).parent().outerWidth();\r\n            w2 = (w2 / widthParentPixels) * 100;\r\n         }\r\n\r\n        if (mw.drag.columns.resizer.pos < e.pageX) {\r\n            if (w2 < 10 && !mw.tools.isRtl()) return false;\r\n            mw.drag.columns.resizer.curr.style.width = mw.tools.isRtl()?(w - mw.drag.columns.step):(w + mw.drag.columns.step) + '%';\r\n            var calc = mw.tools.isRtl() ? (w2 + mw.drag.columns.step) : (w2 - mw.drag.columns.step);\r\n            next.style.width =  calc + '%';\r\n        }\r\n        else {\r\n            if (w < 10 && !mw.tools.isRtl()) return false;\r\n            mw.drag.columns.resizer.curr.style.width = mw.tools.isRtl()?(w + mw.drag.columns.step):(w - mw.drag.columns.step) + '%';\r\n            var calc = mw.tools.isRtl() ? (w2 - mw.drag.columns.step) : (w2 + mw.drag.columns.step);\r\n            next.style.width = calc + '%';\r\n        }\r\n        mw.drag.columns.resizer.pos = e.pageX;\r\n        mw.drag.columns.position(mw.drag.columns.resizer.curr);\r\n        mw.trigger('columnResize', mw.drag.columns.resizer.curr);\r\n    },\r\n    position: function (el) {\r\n        if (!!mw.drag.columns.nextColumn(el)) {\r\n            mw.drag.columns.resizer.curr = el;\r\n            var off = mw.$(el).offset();\r\n            mw.$(mw.drag.columns.resizer).css({\r\n                top: off.top,\r\n                left: mw.tools.isRtl() ? off.left - 10 : off.left + el.offsetWidth - 10,\r\n                height: el.offsetHeight\r\n            }).show();\r\n        }\r\n    },\r\n    init: function () {\r\n        mw.drag.columns.prepare();\r\n        mw.on(\"ColumnOver\", function (e, col) {\r\n            mw.drag.columns.resizer.pos = 0;\r\n            mw.drag.columns.position(col);\r\n        });\r\n        mw.on(\"ColumnOut\", function (e, col) {\r\n            mw.$(mw.drag.columns.resizer).hide();\r\n        });\r\n\r\n    },\r\n    nextColumn: function (col) {\r\n        var next = col.nextElementSibling;\r\n        if (next === null) {\r\n            return;\r\n        }\r\n        if (mw.tools.hasClass(next, 'mw-col')) {\r\n            return next;\r\n        }\r\n        else {\r\n            return mw.drag.columns.nextColumn(next);\r\n        }\r\n    }\r\n}\r\n$(mwd).ready(function () {\r\n    mw.$(document.body).on('mouseup touchend', function () {\r\n        if (mw.drag.plus.locked) {\r\n            mw.wysiwyg.change(mw.drag.columns.resizer.curr);\r\n        }\r\n        mw.drag.columns.resizing = false;\r\n        mw.drag.plus.locked = false;\r\n        mw.tools.removeClass(document.body, 'mw-column-resizing');\r\n    });\r\n    mw.$(document.body).on('mousemove touchmove', function (e) {\r\n        if (mw.drag.columns.resizing === true && mw.isDrag === false) {\r\n            mw.drag.columns.resize(e);\r\n            e.preventDefault();\r\n            mw.drag.plus.locked = true;\r\n            mw.tools.addClass(document.body, 'mw-column-resizing');\r\n        }\r\n    });\r\n});\r\n","mw.liveedit.data = {\r\n    _data:{},\r\n    _target: null,\r\n    init: function() {\r\n        var scope = this;\r\n        mw.$(document.body)\r\n        .on('touchmove mousemove', function(e){\r\n            var hasLayout = !!mw.tools.firstMatchesOnNodeOrParent(e.target, ['[data-module-name=\"layouts\"]', '[data-type=\"layouts\"]']);\r\n            mw.liveedit.data.set('move', 'hasLayout', hasLayout);\r\n            mw.liveedit.data.set('move', 'hasModuleOrElement', mw.tools.hasAnyOfClassesOnNodeOrParent(e.target, ['module', 'element']));\r\n            if(scope._target !== e.target) {\r\n                scope._target = e.target;\r\n                mw.trigger('Liveedit');\r\n            }\r\n        })\r\n        .on('mouseup touchend', function(e){\r\n            mw.liveedit.data.set('mouseup', 'isIcon', mw.wysiwyg.firstElementThatHasFontIconClass(e.target));\r\n        });\r\n\r\n\r\n    },\r\n    set: function(action, item, value){\r\n        this._data[action] = this._data[action] || {};\r\n        this._data[action][item] = value;\r\n    },\r\n    get: function(action, item){\r\n        return this._data[action] ? this._data[action][item] : undefined;\r\n    }\r\n};\r\n","mw.drag = {\n    _fixDeniedParagraphHierarchySelector: ''\n    + '.edit p h1,.edit p h2,.edit p h3,'\n    + '.edit p h4,.edit p h5,.edit p h6,'\n    + '.edit p p,.edit p ul,.edit p ol,'\n    + '.edit p header,.edit p form,.edit p article,'\n    + '.edit p aside,.edit p blockquote,.edit p footer,.edit p div',\n    fixDeniedParagraphHierarchy: function (root) {\n        root = root || document.body;\n        var all = root.querySelectorAll(mw.drag._fixDeniedParagraphHierarchySelector);\n        if (all.length) {\n            var i = 0;\n            for ( ; i < all.length; i++ ) {\n                var the_parent = mw.tools.firstParentWithTag(all[i], 'p');\n                mw.tools.setTag(the_parent, 'div');\n            }\n        }\n    },\n    create_columns: function(selector, $numcols) {\n        if (!$(selector).hasClass(\"active\")) {\n\n            mw.$(mw.drag.columns.resizer).hide();\n\n            var id = mw._activeRowOver.id;\n\n            mw.$(selector).addClass(\"active\");\n            var $el_id = id !== '' ? id : mw.settings.mw - row_id;\n\n            mw.settings.sortables_created = false;\n            var $exisintg_num = mw.$('#' + $el_id).children(\".mw-col\").length;\n\n            if ($numcols === 0) {\n                $numcols = 1;\n            }\n            $numcols = parseInt($numcols);\n            if ($exisintg_num === 0) {\n                $exisintg_num = 1;\n            }\n            if ($numcols !== $exisintg_num) {\n                if ($numcols > $exisintg_num) { //more columns\n                    var i = $exisintg_num;\n                    for (; i < $numcols; i++) {\n                        var new_col = document.createElement('div');\n                        new_col.className = 'mw-col';\n                        new_col.innerHTML = '<div class=\"mw-col-container\"><div class=\"mw-empty element\" id=\"element_'+mw.random()+'\"></div></div>';\n                        mw.$('#' + $el_id).append(new_col);\n                        mw.drag.fix_placeholders(true, '#' + $el_id);\n                    }\n                    //mw.resizable_columns();\n                } else { //less columns\n                    var $cols_to_remove = $exisintg_num - $numcols;\n                    if ($cols_to_remove > 0) {\n                        var fragment = document.createDocumentFragment(),\n                            last_after_remove;\n\n                        mw.$('#' + $el_id).children(\".mw-col\").each(function(i) {\n                            if (i === ($numcols - 1)) {\n                                last_after_remove = mw.$(this);\n\n                            } else {\n                                if (i > ($numcols - 1)) {\n                                    if (this.querySelector('.mw-col-container') !== null) {\n                                        mw.tools.foreachChildren(this, function() {\n                                            if (mw.tools.hasClass(this.className, 'mw-col-container')) {\n                                                fragment.appendChild(this);\n                                            }\n                                        });\n                                    }\n                                    mw.$(this).remove();\n                                }\n                            }\n                        });\n                        var last_container = last_after_remove.find(\".mw-col-container\");\n\n                        var nodes = fragment.childNodes,\n                            i = 0,\n                            l = nodes.length;\n\n                        for (; i < l; i++) {\n                            var node = nodes[i];\n                            mw.$('.empty-element, .ui-resizable-handle', node).remove();\n                            last_container.append(node.innerHTML);\n                        }\n\n                        //last_after_remove.resizable(\"destroy\");\n                        mw.$('#' + $el_id).children(\".empty-element\").remove();\n                        mw.drag.fix_placeholders(true, '#' + $el_id);\n\n                    }\n                }\n\n                $exisintg_num = mw.$('#' + $el_id).children(\".mw-col\").size();\n                var $eq_w = 100 / $exisintg_num;\n                var $eq_w1 = $eq_w;\n                mw.$('#' + $el_id).children(\".mw-col\").width($eq_w1 + '%');\n            }\n        }\n        mw.wysiwyg.nceui();\n    },\n    replace:function(el, dir, callback){\n        var prev = el[dir]();\n        var thisOff = el.offset();\n        var prevOff = prev.offset();\n        prev\n            .css({\n                position:'relative'\n            })\n            .animate({top:thisOff.top-prevOff.top });\n\n        el\n            .css({\n                position:'relative'\n            })\n            .animate({top:prevOff.top - thisOff.top}, function(){\n                if(dir === 'prev'){\n                    prev.before(el);\n                }\n                else{\n                    prev.after(el);\n                }\n\n                el.css({'top': '', 'position':''})\n                prev.css({'top': '', 'position':''});\n                mw.wysiwyg.change(el[0])\n                if(!!callback){\n                    setTimeout(function(){\n                        callback.call()\n                    }, 10)\n                }\n\n            })\n    },\n    external_grids_col_classes: ['row', 'col-lg-1', 'col-lg-10', 'col-lg-11', 'col-lg-12', 'col-lg-2', 'col-lg-3', 'col-lg-4', 'col-lg-5', 'col-lg-6', 'col-lg-7', 'col-lg-8', 'col-lg-9', 'col-md-1', 'col-md-10', 'col-md-11', 'col-md-12', 'col-md-2', 'col-md-3', 'col-md-4', 'col-md-5', 'col-md-6', 'col-md-7', 'col-md-8', 'col-md-9', 'col-sm-1', 'col-sm-10', 'col-sm-11', 'col-sm-12', 'col-sm-2', 'col-sm-3', 'col-sm-4', 'col-sm-5', 'col-sm-6', 'col-sm-7', 'col-sm-8', 'col-sm-9', 'col-xs-1', 'col-xs-10', 'col-xs-11', 'col-xs-12', 'col-xs-2', 'col-xs-3', 'col-xs-4', 'col-xs-5', 'col-xs-6', 'col-xs-7', 'col-xs-8', 'col-xs-9'],\n    external_css_no_element_classes: ['container','navbar', 'navbar-header', 'navbar-collapse', 'navbar-static', 'navbar-static-top', 'navbar-default', 'navbar-text', 'navbar-right', 'navbar-center', 'navbar-left', 'nav navbar-nav', 'collapse', 'header-collapse', 'panel-heading', 'panel-body', 'panel-footer'],\n    section_selectors: ['.module-layouts'],\n    external_css_no_element_controll_classes: ['container', 'container-fluid', 'edit','noelement','no-element','allow-drop','nodrop', 'mw-open-module-settings','module-layouts'],\n    onCloneableControl:function(target, isOverControl){\n        if(!this._onCloneableControl){\n            this._onCloneableControl = document.createElement('div');\n            this._onCloneableControl.className = 'mw-cloneable-control';\n            var html = '';\n            html += '<span class=\"mw-cloneable-control-item mw-cloneable-control-prev\" title=\"Move backward\"></span>';\n            html += '<span class=\"mw-cloneable-control-item mw-cloneable-control-plus\" title=\"Clone\"></span>';\n            html += '<span class=\"mw-cloneable-control-item mw-cloneable-control-minus\" title=\"Remove\"></span>' ;\n            html += '<span class=\"mw-cloneable-control-item mw-cloneable-control-next\" title=\"Move forward\"></span>';\n            this._onCloneableControl.innerHTML = html;\n\n            document.body.appendChild(this._onCloneableControl);\n            mw.$('.mw-cloneable-control-plus', this._onCloneableControl).on('click', function(){\n                var $t = mw.$(mw.drag._onCloneableControl.__target).parent()\n                mw.liveEditState.record({\n                    target: $t[0],\n                    value: $t[0].innerHTML\n                });\n                var parser = mw.tools.parseHtml(mw.drag._onCloneableControl.__target.outerHTML).body;\n                var all = parser.querySelectorAll('[id]'), i = 0;\n                for( ; i<all.length; i++){\n                    all[i].id = 'mw-cl-id-' + mw.random();\n                }\n                mw.$(mw.drag._onCloneableControl.__target).after(parser.innerHTML);\n                mw.liveEditState.record({\n                    target: $t[0],\n                    value: $t[0].innerHTML\n                });\n                mw.wysiwyg.change(mw.drag._onCloneableControl.__target);\n                mw.drag.onCloneableControl('hide');\n            });\n            mw.$('.mw-cloneable-control-minus', this._onCloneableControl).on('click', function(){\n                var $t = mw.$(mw.drag._onCloneableControl.__target).parent();\n                mw.liveEditState.record({\n                    target: $t[0],\n                    value: $t[0].innerHTML\n                });\n                mw.$(mw.drag._onCloneableControl.__target).fadeOut(function(){\n                    mw.wysiwyg.change(this);\n                    mw.$(this).remove();\n                    mw.liveEditState.record({\n                        target: $t[0],\n                        value: $t[0].innerHTML\n                    });\n                });\n                mw.drag.onCloneableControl('hide');\n            });\n            mw.$('.mw-cloneable-control-next', this._onCloneableControl).on('click', function(){\n                var $t = mw.$(mw.drag._onCloneableControl.__target).parent();\n                mw.liveEditState.record({\n                    target: $t[0],\n                    value: $t[0].innerHTML\n                });\n                mw.$(mw.drag._onCloneableControl.__target).next().after(mw.drag._onCloneableControl.__target)\n                mw.liveEditState.record({\n                    target: $t[0],\n                    value: $t[0].innerHTML\n                });\n                mw.wysiwyg.change(mw.drag._onCloneableControl.__target);\n                mw.drag.onCloneableControl('hide');\n            });\n            mw.$('.mw-cloneable-control-prev', this._onCloneableControl).on('click', function(){\n                var $t = mw.$(mw.drag._onCloneableControl.__target).parent();\n                mw.liveEditState.record({\n                    target: $t[0],\n                    value: $t[0].innerHTML\n                });\n                mw.$(mw.drag._onCloneableControl.__target).prev().before(mw.drag._onCloneableControl.__target)\n                mw.liveEditState.record({\n                    target: $t[0],\n                    value: $t[0].innerHTML\n                });\n                mw.wysiwyg.change(mw.drag._onCloneableControl.__target);\n                mw.drag.onCloneableControl('hide');\n            });\n        }\n        var clc = mw.$(this._onCloneableControl);\n        if(target == 'hide'){\n            clc.hide();\n        }\n        else{\n            clc.show();\n            this._onCloneableControl.__target = target;\n\n            var next = mw.$(this._onCloneableControl.__target).next();\n            var prev = mw.$(this._onCloneableControl.__target).prev();\n            var el = mw.$(target), off = el.offset();\n\n\n            if(next.length == 0){\n                mw.$('.mw-cloneable-control-next', clc).hide();\n            }\n            else{\n                mw.$('.mw-cloneable-control-next', clc).show();\n            }\n            if(prev.length == 0){\n                mw.$('.mw-cloneable-control-prev', clc).hide();\n            }\n            else{\n                mw.$('.mw-cloneable-control-prev', clc).show();\n            }\n            var leftCenter = (off.left > 0 ? off.left : 0) + (el.width()/2 - clc.width()/2) ;\n            clc.show();\n            if(isOverControl){\n                return;\n            }\n            clc.css({\n                top: off.top > 0 ? off.top : 0 ,\n                //left: off.left > 0 ? off.left : 0\n                left: leftCenter\n            });\n\n\n            var cloner = document.querySelector('.mw-cloneable-control');\n            if(cloner) {\n                mw._initHandles.getAll().forEach(function (curr) {\n                    masterRect = curr.wrapper.getBoundingClientRect();\n                    var clonerect = cloner.getBoundingClientRect();\n\n                    if (mw._initHandles.collide(masterRect, clonerect)) {\n                        cloner.style.top = (parseFloat(curr.wrapper.style.top) + 10) + 'px';\n                        cloner.style.left = ((parseInt(curr.wrapper.style.left, 10) + masterRect.width) + 10) + 'px';\n                    }\n                });\n            }\n        }\n\n    },\n    noop: document.createElement('div'),\n    create: function() {\n\n        var edits = document.body.querySelectorAll(\".edit\"),\n            elen = edits.length,\n            ei = 0;\n        for (; ei < elen; ei++) {\n            var els = edits[ei].querySelectorAll('p,div,h1,h2,h3,h4,h5,h6,section,img'),\n                i = 0,\n                l = els.length;\n            for (; i < l; i++) {\n                var el = els[i];\n\n                if( !mw.drag.target.canBeElement(el) ){\n                    continue;\n                }\n                var cls = el.className;\n\n                var isEl = mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(el, ['element', 'module'])\n                    && !mw.tools.hasAnyOfClasses(el, ['mw-col','mw-col', 'mw-row', 'mw-zone']);\n                if (isEl) {\n                    mw.tools.addClass(el, 'element');\n                }\n            }\n        }\n        mw.$(\"#live_edit_toolbar_holder .module\").removeClass(\"module\");\n\n        mw.handlerMouse = {\n            x: 0,\n            y: 0\n        };\n\n        mw.$(document.body).on('mousemove touchmove', function(event) {\n\n            mw.dragSTOPCheck = false;\n            if (!mw.settings.resize_started) {\n\n                mw.emouse = mw.event.page(event);\n\n                /*var targetNode;\n                targetNode = mw.wysiwyg.validateCommonAncestorContainer(getSelection().focusNode);\n                if (targetNode && targetNode.isContentEditable) {\n                    mw.tools.addClass(this, 'isTyping');\n                    return;\n                }*/\n\n                mw.mm_target = event.target;\n                mw.$mm_target = mw.$(mw.mm_target);\n\n                if (!mw.isDrag) {\n                    if (mw.liveEditSelectMode === 'element') {\n                        //if(mw.tools.distance(mw.handlerMouse.x, mw.handlerMouse.y, mw.emouse.x, mw.emouse.y) > 20) {\n\n                            mw.tools.removeClass(this, 'isTyping');\n                            mw.handlerMouse = Object.assign({}, mw.emouse);\n                            mw.liveEditHandlers(event);\n\n\n                        //}\n                    }\n                } else {\n                    var sidebar = document.getElementById('live_edit_side_holder');\n                    if(sidebar && sidebar.contains && sidebar.contains(mw.mm_target)){\n                        mw.dropable.hide();\n                        mw.ea.data.target = null;\n                    } else {\n                        mw.ea.data.currentGrabbed = mw.dragCurrent;\n                        mw.tools.removeClass(this, 'isTyping');\n                        mw.ea.interactionAnalizer(event);\n                        mw.$(\".currentDragMouseOver\").removeClass(\"currentDragMouseOver\");\n                        mw.$(mw.currentDragMouseOver).addClass(\"currentDragMouseOver\");\n                    }\n\n                }\n            }\n        });\n        mw.dropables.prepare();\n\n        mw.drag.fix_placeholders(true);\n        mw.drag.fixes();\n\n        mw.$(document.body).on('mouseup touchend', function(event) {\n            mw.mouseDownStarted = false;\n            if (mw.isDrag && mw.dropable.is(\":hidden\")) {\n                mw.$(\".ui-draggable-dragging\").css({\n                    top: 0,\n                    left: 0\n                });\n            }\n            mw.$(this).removeClass(\"not-allowed\");\n        });\n        mw.$(document.body).on('mousedown touchstart', function(event) {\n            var target = event.target;\n            if ($(target).hasClass(\"image_free_text\")) {\n                mw.image._dragcurrent = target;\n                mw.image._dragparent = target.parentNode;\n                var pagePos = mw.event.page(event);\n                mw.image._dragcursorAt.x = pagePos.x- target.offsetLeft;\n                mw.image._dragcursorAt.y = pagePos.y - target.offsetTop;\n                target.startedY = target.offsetTop - target.parentNode.offsetTop;\n                target.startedX = target.offsetLeft - target.parentNode.offsetLeft;\n            }\n\n            if ($(\".desc_area_hover\").length === 0) {\n                mw.$(\".desc_area\").hide();\n            }\n            if (mw.tools.hasClass(event.target.className, 'mw-open-module-settings')) {\n\n                if(!mw.settings.live_edit_open_module_settings_in_sidebar){\n                    mw.drag.module_settings(mw.tools.firstParentOrCurrentWithAnyOfClasses(event.target, ['module']))\n                } else {\n                    var target = mw.tools.firstParentWithClass(event.target, 'module') ;\n                    mw.liveNodeSettings.set('module', target);\n                }\n            }\n\n            if (!mw.tools.hasParentsWithTag(event.target, 'TABLE') && !mw.tools.hasParentsWithClass(event.target, 'mw-inline-bar')) {\n                mw.$(mw.liveedit.inline.tableControl).hide();\n                mw.$(\".tc-activecell\").removeClass('tc-activecell');\n            }\n        });\n\n    },\n\n    init: function(selector, callback) {\n        mw.drag.the_drop();\n    },\n    properFocus: function(event) {\n        var tofocus;\n        if (mw.tools.hasClass(event.target, 'mw-row') || mw.tools.hasClass(event.target, 'mw-col')) {\n            if (mw.tools.hasClass(event.target, 'mw-col')) {\n                tofocus = event.target.querySelector('.mw-col-container');\n            } else {\n                var i = 0,\n                    cols = event.target.children,\n                    l = cols.length;\n                for (; i < l; i++) {\n                    var _cleft = mw.$(cols[i]).offset().left;\n                    var ePos = mw.event.page(event);\n                    if (_cleft < ePos.x && (_cleft + cols[i].clientWidth) > ePos.x) {\n                        tofocus = cols[i].querySelector('.mw-col-container');\n                        if (tofocus === null) {\n                            cols[i].innerHTML = '<div class=\"mw-col-container\">' + cols[i].innerHTML + '</div>';\n                        }\n                        tofocus = cols[i].querySelector('.mw-col-container');\n                        break;\n                    }\n                }\n            }\n            if (!!tofocus && tofocus.querySelector('.element') !== null) {\n                var arr = tofocus.querySelectorAll('.element'),\n                    l = arr.length;\n                tofocus = arr[l - 1];\n\n            }\n            if (!!tofocus) {\n                var range = document.createRange();\n                var sel = window.getSelection();\n                range.selectNodeContents(tofocus);\n                range.collapse(false);\n                sel.removeAllRanges();\n                sel.addRange(range);\n            }\n        }\n    },\n\n    toolbar_modules: function(selector) {\n        mw.liveedit.modulesToolbar.init(selector);\n    },\n    the_drop: function() {\n\n\n\n        if (!$(document.body).hasClass(\"bup\")) {\n            mw.$(document.body).addClass(\"bup\");\n\n\n\n            mw.$(document.body).on(\"mouseup touchend\", function(event) {\n                mw.image._dragcurrent = null;\n                mw.image._dragparent = null;\n                var sliders = document.getElementsByClassName(\"canvas-slider\"),\n                    len = sliders.length,\n                    i = 0;\n                for (; i < len; i++) {\n                    sliders[i].isDrag = false;\n                }\n\n                if((event.type === 'mouseup' || event.type === 'touchend') && mw.liveEditSelectMode === 'none'){\n                    mw.liveEditSelectMode = 'element';\n                }\n                if (!mw.isDrag) {\n                    var target = event.target;\n                    var componentsClasses = [\n                        'element',\n                        'safe-element',\n                        'module',\n                        'plain-text'\n                    ];\n\n                    var currentComponent = mw.tools.firstParentOrCurrentWithAnyOfClasses(target, componentsClasses);\n                    var fonttarget = mw.liveedit.data.get('mouseup', 'isIcon');\n\n                    if( mw.tools.hasAnyOfClassesOnNodeOrParent(target, componentsClasses)) {\n                        if (currentComponent && !fonttarget) {\n\n                            var order = mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(target, ['safe-mode', 'module']);\n                            if(mw.tools.hasClass(currentComponent, 'module')){\n                                mw.trigger(\"ComponentClick\", [target, 'module']);\n                            }\n                            else if (mw.wysiwyg.isSelectionEditable() && !mw.tools.hasAnyOfClasses(target, componentsClasses) && order) {\n                                mw.trigger(\"ComponentClick\", [target, 'element']);\n                            }\n                            else {\n                                if (!mw.tools.hasAnyOfClasses(target, componentsClasses)) {\n                                    var ctype;\n                                    var has = componentsClasses.filter(function (item) {\n                                        return currentComponent.classList.contains(item)\n                                    });\n                                    mw.trigger(\"ComponentClick\", [currentComponent, has[0]]);\n                                }\n                            }\n                        }\n\n                        var el = mw.tools.firstParentOrCurrentWithClass(target, 'element');\n\n                        var safeEl = mw.tools.firstParentOrCurrentWithClass(target, 'safe-element');\n                        var moduleEl = mw.tools.firstParentOrCurrentWithClass(target, 'module');\n\n                        if ($(target).hasClass(\"plain-text\")) {\n                            mw.trigger(\"PlainTextClick\", target);\n                        } else if (el) {\n                            mw.trigger(\"ElementClick\", [el, event]);\n                        }\n\n                        if (safeEl) {\n                            mw.trigger(\"SafeElementClick\", [safeEl, event]);\n                        }\n\n                        if (moduleEl) {\n                            mw.trigger(\"ModuleClick\", [moduleEl, event]);\n                        }\n                    }\n\n                    if (fonttarget && !mw.tools.hasAnyOfClasses(target, ['element', 'module'])) {\n                        if ((fonttarget.tagName === 'I' || fonttarget.tagName === 'SPAN') && !mw.tools.hasParentsWithClass(fonttarget, 'dropdown')) {\n                            if(mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(fonttarget, ['edit', 'module'])) {\n                                mw.trigger(\"IconElementClick\", fonttarget);\n                                mw.trigger(\"ComponentClick\", [fonttarget, 'icon']);\n                            }\n                        }\n                    }\n\n                    if ($(target).hasClass(\"mw_item\")) {\n                        mw.trigger(\"ItemClick\", target);\n                    } else if (mw.tools.hasParentsWithClass(target, 'mw_item')) {\n                        mw.trigger(\"ItemClick\", mw.$(target).parents(\".mw_item\")[0]);\n                    }\n                    if (target.tagName === 'IMG' && mw.tools.hasParentsWithClass(target, 'edit')) {\n                        var order = mw.tools.parentsOrder(mw.mm_target, ['edit', 'module']);\n                        if ((order.module == -1) || (order.edit > -1 && order.edit < order.module)) {\n                            if (!mw.tools.hasParentsWithClass(target, 'mw-defaults')) {\n                                mw.trigger(\"ImageClick\", target);\n                            }\n                            mw.wysiwyg.select_element(target);\n                        }\n                    }\n                    if (target.tagName === 'BODY') {\n                        mw.trigger(\"BodyClick\", target);\n                    }\n\n\n                    var isTd =  target.tagName === 'TD' ? target : mw.tools.firstParentWithTag(target, 'td');\n                    if(!!isTd){\n                        if(mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(target, ['edit', 'module'])){\n                            mw.trigger(\"TableTdClick\", target);\n                        }\n                    }\n\n                    if (mw.tools.hasClass(target, 'mw-empty') || mw.tools.hasParentsWithClass(target, 'mw-empty')) {\n\n                    } else {\n\n                    }\n                    if (mw.tools.hasClass(target, 'mw-empty') && target.innerHTML.trim() !== '') {\n                        target.className = 'element';\n                    }\n                    mw.drag.properFocus(event);\n                }\n                if (mw.isDrag) {\n                    mw.isDrag = false;\n\n\n                    mw.wysiwyg.change(mw.currentDragMouseOver);\n                    mw.$(mw.currentDragMouseOver).removeClass(\"currentDragMouseOver\");\n\n                    mw._initHandles.hideAll();\n\n                    setTimeout(function() {\n                        if(mw.ea.data.target && mw.ea.data.currentGrabbed){\n                            if(!!mw.ea.data.dropableAction && !!mw.ea.data.target && !!mw.ea.data.currentGrabbed){\n                                var ed = mw.tools.firstParentOrCurrentWithClass(mw.ea.data.target, 'edit');\n                                var prev = mw.ea.data.currentGrabbed.parentNode;\n                                var rec = {\n                                    target: ed,\n                                    value: ed.innerHTML\n                                };\n                                if(prev){\n                                    var prevDoc = mw.tools.parseHtml(prev.innerHTML);\n                                    mw.$(prevDoc.querySelector('.mw_drag_current')).css({\n                                        visibility: 'hidden',\n                                        opacity: 0\n                                    });\n                                    rec.prev = prev;\n                                    rec.prevValue = prevDoc.body.innerHTML;\n                                }\n\n                                mw.liveEditState.record(rec);\n                                mw.$(mw.ea.data.target)[mw.ea.data.dropableAction](mw.ea.data.currentGrabbed);\n\n\n\n\n                                setTimeout(function(ed) {\n                                    var nrec = {\n                                        target: ed,\n                                        value: ed.innerHTML\n                                    };\n                                    if(prev){\n                                        var prevDoc = mw.tools.parseHtml(prev.innerHTML);\n                                        mw.$(prevDoc.querySelector('.mw_drag_current')).css({\n                                            visibility: 'hidden',\n                                            opacity: 0\n                                        });\n                                        nrec.prev = prev;\n                                        nrec.prevValue = prevDoc.body.innerHTML;\n                                    }\n                                    mw.liveEditState.record(nrec);\n                                }, 50, ed);\n                            }\n                            else{\n\n                            }\n                        }\n                        mw.drag.fixes();\n                        setTimeout(function() {\n                            mw.drag.fix_placeholders();\n                            mw.ea.afterAction();\n                            if(mw.liveEditDomTree) {\n                                if(mw.ea.data.target) {\n                                    mw.liveEditDomTree.refresh(mw.ea.data.target.parentNode)\n                                }\n                            }\n                        }, 40);\n                        mw.dropable.hide();\n\n                    }, 77);\n\n\n                    setTimeout(function () {\n\n                        if (mw.have_new_items) {\n                            mw.drag.load_new_modules();\n                        }\n                    }, 120)\n                }\n            });\n        } //toremove\n    },\n\n\n    /**\n     * Various fixes\n     *\n     * @example mw.drag.fixes()\n     */\n    fixes: function() {\n        mw.$(\".edit .mw-col, .edit .mw-row\").height('auto');\n        mw.$(mw.dragCurrent).css({\n            top: '',\n            left: ''\n        });\n        var more_selectors = '';\n        //var cols = mw.drag.external_grids_col_classes;\n        var cols = [];\n        var index;\n        for (index = cols.length - 1; index >= 0; --index) {\n            more_selectors += ',.edit .row > .' + cols[index];\n        }\n        setTimeout(function() {\n            mw.$(\".edit .mw-col\" + more_selectors).each(function() {\n                var el = mw.$(this);\n                if (el.children().length === 0 || (el.children('.empty-element').length > 0) || el.children('.ui-draggable-dragging').length > 0) {\n                    el.height('auto');\n                    if (el.height() < el.parent().height()) {\n                        el.height(el.parent().height());\n                    } else {\n                        el.height('auto');\n                    }\n                } else {\n                    el.children('.empty-element').height('auto');\n                    el.height('auto');\n                    el.parents('.mw-row:first').height('auto')\n                }\n\n                el.height('auto');\n                var mwr = mw.tools.firstParentWithClass(this, 'mw-row');\n                if (!!mwr) {\n                    mwr.style.height = 'auto';\n                }\n                mw.drag.fixDeniedParagraphHierarchy();\n\n            });\n        }, 222);\n\n        var els = document.querySelectorAll('div.element'),\n            l = els.length,\n            i = 0;\n        if (l > 0) {\n            for (; i < l; i++) {\n                if (els[i].querySelector('p,div,li,h1,h2,h3,h4,h5,h6,figure,img') === null && !mw.tools.hasClass(els[i], 'plain-text')) {\n                    if (!mw.tools.hasClass(els[i].className, 'nodrop') && !mw.tools.hasClass(els[i].className, 'mw-empty')) {\n                        if(!mw.tools.hasAnyOfClassesOnNodeOrParent(els[i], ['safe-mode'])){\n                            els[i].innerHTML = '<p class=\"element\">' + els[i].innerHTML + '</p>';\n                        }\n                    }\n                }\n            }\n        }\n    },\n    /**\n     * fix_placeholders in the layout\n     *\n     * @example mw.drag.fix_placeholders(isHard , selector)\n     */\n    fix_placeholders: function(isHard, selector) {\n        selector = selector || '.edit .row';\n\n        var more_selectors2 = 'div.col-md';\n        var a = mw.drag.external_grids_col_classes;\n        var index;\n        for (index = a.length - 1; index >= 0; --index) {\n            more_selectors2 += ',div.' + a[index];\n        }\n        mw.$(selector).each(function() {\n            var el = mw.$(this);\n            el.children(more_selectors2).each(function() {\n                var empty_child = mw.$(this).children('*');\n                if (empty_child.size() == 0) {\n                    mw.$(this).append('<div class=\"element\" id=\"mw-element-' + mw.random() + '\">' + '</div>');\n                    var empty_child = mw.$(this).children(\"div.element\");\n                }\n            });\n        });\n\n    },\n    /**\n     * Removes contentEditable for ALL elements\n     *\n     * @example mw.drag.edit_remove();\n     */\n    edit_remove: function() {\n\n        //\t   \tmw.$('.edit [contenteditable]').removeAttr(\"contenteditable\");\n\n    },\n\n    target :  {\n\n        canBeElement: function(target) {\n            var el = target;\n            var noelements = ['mw-ui-col', 'mw-col-container', 'mw-ui-col-container'];\n\n            var noelements_bs3 = mw.drag.external_grids_col_classes;\n            var noelements_ext = mw.drag.external_css_no_element_classes;\n            var noelements_drag = mw.drag.external_css_no_element_controll_classes;\n            var section_selectors = mw.drag.section_selectors;\n            var icon_selectors =  mw.wysiwyg.fontIconFamilies;\n\n            noelements = noelements.concat(noelements_bs3);\n            noelements = noelements.concat(noelements_ext);\n            noelements = noelements.concat(noelements_drag);\n            noelements = noelements.concat(section_selectors);\n            noelements = noelements.concat(icon_selectors);\n\n            return mw.tools.hasAnyOfClasses(el, noelements);\n        },\n        canBeEditable: function(el) {\n            return el.isContentEditable || mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(el, ['edit','module']);\n        }\n    },\n\n    fancynateLoading: function(module) {\n        mw.$(module).addClass(\"module_loading\");\n        setTimeout(function() {\n            mw.$(module).addClass(\"module_activated\");\n            setTimeout(function() {\n                mw.$(module).removeClass(\"module_loading module_activated\");\n            }, 510);\n        }, 150);\n    },\n\n    /**\n     * Scans for new dropped modules and loads them\n     *\n     * @example mw.drag.load_new_modules()\n     * @return void\n     */\n    load_new_modules: function(callback) {\n        return mw.ea.afterAction();\n    },\n\n    module_view: function(view) {\n        var modal = mw.drag.module_settings(false, view);\n        return modal;\n    },\n    module_settings: function(a, view) {\n        return mw.tools.module_settings(a, view);\n    },\n    current_module_settings_tooltip_show_on_element: function(element_id, view, type) {\n        if (!element_id) {\n            return;\n        }\n\n        if (mw.$('#' + element_id).length === 0) {\n            return;\n        }\n\n        var curr = mw._activeModuleOver;\n        var tooltip_element = mw.$(\"#\" + element_id);\n        var attributes = {};\n        var type = type || 'modal';\n        $.each(curr.attributes, function(index, attr) {\n            attributes[attr.name] = attr.value;\n        });\n        var data1 = attributes;\n        var module_type = null;\n        if (data1['data-type']) {\n            module_type = data1['data-type'];\n            data1['data-type'] = data1['data-type'] + '/admin';\n        }\n        if (data1['data-module-name']) {\n            delete(data1['data-module-name']);\n        }\n        if (data1['type']) {\n            module_type = data1['type'];\n            data1['type'] = data1['type'] + '/admin';\n        }\n        if (module_type != null && view) {\n            data1['data-type'] = data1['type'] = module_type + '/' + view;\n        }\n\n        if (data1['class']) {\n            delete(data1['class']);\n        }\n        if (data1['style']) {\n            delete(data1['style']);\n        }\n        if (data1.contenteditable) {\n            delete(data1.contenteditable);\n        }\n        data1.live_edit = 'true';\n        data1.module_settings = 'true';\n        if (view != undefined) {\n            data1.view = view;\n        } else {\n            data1.view = 'admin';\n        }\n        if (data1.from_url == undefined) {\n            data1.from_url = window.parent.location;\n        }\n        var modal_name = 'module-settings-' + curr.id;\n        if (typeof(data1.view.hash) === 'function') {\n            var modal_name = 'module-settings-' + curr.id + (data1.view.hash());\n        }\n\n        if (mw.$('#' + modal_name).length > 0) {\n            var m = mw.$('#' + modal_name)[0];\n            m.scrollIntoView();\n            mw.tools.highlight(m);\n            return false;\n        }\n        var src = mw.settings.site_url + \"api/module?\" + json2url(data1);\n\n        if (type === 'modal') {\n            var modal = mw.top().dialogIframe({\n                url: src,\n                width: 532,\n                height: 150,\n                name: modal_name,\n                title: '',\n                callback: function() {\n                    mw.$(this.container).attr('data-settings-for-module', curr.id);\n                }\n            });\n            return modal;\n        }\n        if (type === 'tooltip') {\n            var id = 'mw-tooltip-iframe-'+ mw.random()\n            mw.tooltip({\n                id: 'module-settings-tooltip-' + modal_name,\n                group: 'module_settings_tooltip_show_on_btn',\n                close_on_click_outside: true,\n                content: '<iframe id=\"'+id+'\" frameborder=\"0\" class=\"mw-tooltip-iframe\" src=\"' + src + '\" scrolling=\"auto\"></iframe>',\n                element: tooltip_element\n            });\n            mw.tools.iframeAutoHeight(document.querySelector('#'+id))\n        }\n\n    },\n\n    /**\n     * Loads the module in the given dom element by the $update_element selector .\n     *\n     * @example mw.drag.load_module('user_login', '#login_box')\n     * @param $module_name\n     * @param $update_element\n     * @return void\n     */\n    load_module: function($module_name, $update_element) {\n        var attributes = {};\n        attributes.module = $module_name;\n        var url1 = mw.settings.site_url + 'api/module';\n        mw.$($update_element).load_modules(url1, attributes, function() {\n            window.mw_sortables_created = false;\n        });\n\n    },\n    /**\n     * Deletes element by id or selector\n     *\n     * @method mw.edit.delete_element(idobj)\n     * @param Element id or selector\n     */\n    delete_element: function(idobj, c) {\n        mw.tools.confirm(mw.settings.sorthandle_delete_confirmation_text, function() {\n            var el = mw.$(idobj);\n            mw.wysiwyg.change(idobj);\n            var elparent = el.parent()\n\n            mw.liveEditState.record({\n                target: elparent[0],\n                value: elparent.html()\n            });\n            el.addClass(\"mwfadeout\");\n            setTimeout(function() {\n                mw.$(idobj).remove();\n                mw.handleModule.hide();\n                mw.$(mw.handleModule).removeClass('mw-active-item');\n                mw.drag.fix_placeholders(true);\n                mw.liveEditState.record({\n                    target: elparent[0],\n                    value: elparent.html()\n                });\n                if(c){\n                    c.call()\n                }\n            }, 300);\n        });\n    },\n\n    grammarlyFix:function(html){\n        var data = mw.tools.parseHtml(html).body;\n        mw.$(\"grammarly-btn\", data).remove();\n        mw.$(\"grammarly-card\", data).remove();\n        mw.$(\"g.gr_\", data).each(function(){\n            mw.$(this).replaceWith(this.innerHTML);\n        });\n        mw.$(\"[data-gramm_id]\", data).removeAttr('data-gramm_id');\n        mw.$(\"[data-gramm]\", data).removeAttr('data-gramm');\n        mw.$(\"[data-gramm_id]\", data).removeAttr('data-gramm_id');\n        mw.$(\"grammarly-card\", data).remove();\n        mw.$(\"grammarly-inline-cards\", data).remove();\n        mw.$(\"grammarly-popups\", data).remove();\n        mw.$(\"grammarly-extension\", data).remove();\n        return data.innerHTML;\n    },\n    saving: false,\n    coreSave: function(data) {\n        if (!data) return false;\n        $.each(data, function(){\n            this.html = mw.drag.grammarlyFix(this.html)\n        });\n        mw.drag.saving = true;\n\n        /************  START base64  ************/\n        data = JSON.stringify(data);\n        data = btoa(encodeURIComponent(data).replace(/%([0-9A-F]{2})/g,\n            function toSolidBytes(match, p1) {\n                return String.fromCharCode('0x' + p1);\n            }));\n        data = {data_base64:data};\n        /************  END base64  ************/\n\n        var xhr = mw.ajax({\n            type: 'POST',\n            url: mw.settings.api_url + 'save_edit',\n            data: data,\n            dataType: \"json\",\n            success: function (saved_data) {\n                if(saved_data && saved_data.new_page_url && !mw.drag.DraftSaving){\n                    window.parent.mw.askusertostay = false;\n                    window.mw.askusertostay = false;\n                    window.location.href  = saved_data.new_page_url;\n\n                }\n            }\n        });\n\n        xhr.always(function() {\n            mw.drag.saving = false;\n        });\n        return xhr;\n    },\n    parseContent: function(root) {\n        var root = root || document.body;\n        var doc = mw.tools.parseHtml(root.innerHTML);\n        mw.$('.element-current', doc).removeClass('element-current');\n        mw.$('.element-active', doc).removeClass('element-active');\n        mw.$('.disable-resize', doc).removeClass('disable-resize');\n        mw.$('.mw-webkit-drag-hover-binded', doc).removeClass('mw-webkit-drag-hover-binded');\n        mw.$('.module-cat-toggle-Modules', doc).removeClass('module-cat-toggle-Modules');\n        mw.$('.mw-module-drag-clone', doc).removeClass('mw-module-drag-clone');\n        mw.$('-module', doc).removeClass('-module');\n        mw.$('.empty-element', doc).remove();\n        mw.$('.empty-element', doc).remove();\n        mw.$('.edit .ui-resizable-handle', doc).remove();\n        mw.$('script', doc).remove();\n\n        //var doc = mw.$(doc).find('script').remove();\n\n        mw.tools.classNamespaceDelete('all', 'ui-', doc, 'starts');\n        mw.$(\"[contenteditable]\", doc).removeAttr(\"contenteditable\");\n        var all = doc.querySelectorAll('[contenteditable]'),\n            l = all.length,\n            i = 0;\n        for (; i < l; i++) {\n            all[i].removeAttribute('contenteditable');\n        }\n        var all = doc.querySelectorAll('.module'),\n            l = all.length,\n            i = 0;\n        for (; i < l; i++) {\n            if (all[i].querySelector('.edit') === null) {\n                all[i].innerHTML = '';\n            }\n        }\n        return doc;\n    },\n    htmlAttrValidate:function(edits){\n        var final = [];\n        $.each(edits, function(){\n            var html = this.outerHTML;\n            html = html.replace(/url\\(&quot;/g, \"url('\");\n            html = html.replace(/jpg&quot;/g, \"jpg'\");\n            html = html.replace(/jpeg&quot;/g, \"jpeg'\");\n            html = html.replace(/png&quot;/g, \"png'\");\n            html = html.replace(/gif&quot;/g, \"gif'\");\n            final.push($(html)[0]);\n        })\n        return final;\n    },\n    collectData: function(edits) {\n        mw.$(edits).each(function(){\n            mw.$('meta', this).remove();\n        });\n\n        edits = this.htmlAttrValidate(edits);\n        var l = edits.length,\n            i = 0,\n            helper = {},\n            master = {};\n        if (l > 0) {\n            for (; i < l; i++) {\n                helper.item = edits[i];\n                var rel = mw.tools.mwattr(helper.item, 'rel');\n                if (!rel) {\n                    mw.$(helper.item).removeClass('changed');\n                    mw.tools.foreachParents(helper.item, function(loop) {\n                        var cls = this.className;\n                        var rel = mw.tools.mwattr(this, 'rel');\n                        if (mw.tools.hasClass(cls, 'edit') && mw.tools.hasClass(cls, 'changed') && (!!rel)) {\n                            helper.item = this;\n                            mw.tools.stopLoop(loop);\n                        }\n                    });\n                }\n                var rel = mw.tools.mwattr(helper.item, 'rel');\n                if (!rel) {\n                    var field = !!helper.item.id ? '#'+helper.item.id : '';\n                    console.warn('Skipped save: .edit'+field+' element does not have rel attribute.');\n                    continue;\n                }\n                mw.$(helper.item).removeClass('changed orig_changed');\n                mw.$(helper.item).removeClass('module-over');\n\n                mw.$('.module-over', helper.item).each(function(){\n                    mw.$(this).removeClass('module-over');\n                });\n                mw.$('[class]', helper.item).each(function(){\n                    var cls = this.getAttribute(\"class\");\n                    if(typeof cls === 'string'){\n                        cls = cls.trim();\n                    }\n                    if(!cls){\n                        this.removeAttribute(\"class\");\n                    }\n                });\n                var content = mw.wysiwyg.cleanUnwantedTags(helper.item).innerHTML;\n                var attr_obj = {};\n                var attrs = helper.item.attributes;\n                if (attrs.length > 0) {\n                    var ai = 0,\n                        al = attrs.length;\n                    for (; ai < al; ai++) {\n                        attr_obj[attrs[ai].nodeName] = attrs[ai].nodeValue;\n                    }\n                }\n                var obj = {\n                    attributes: attr_obj,\n                    html: content\n                };\n                var objdata = \"field_data_\" + i;\n                master[objdata] = obj;\n            }\n        }\n        return master;\n    },\n    getData: function(root) {\n        var body = mw.drag.parseContent(root).body,\n            edits = body.querySelectorAll('.edit.changed'),\n            data = mw.drag.collectData(edits);\n        return data;\n    },\n\n    saveDisabled: false,\n    draftDisabled: false,\n    save: function(data, success, fail) {\n        mw.trigger('beforeSaveStart', data);\n        if (mw.liveedit.cssEditor) {\n            mw.liveedit.cssEditor.publishIfChanged();\n        }\n        if (mw.drag.saveDisabled) return false;\n        if(!data){\n            var body = mw.drag.parseContent().body,\n                edits = body.querySelectorAll('.edit.changed');\n            data = mw.drag.collectData(edits);\n        }\n\n\n\n        if (mw.tools.isEmptyObject(data)) return false;\n\n        mw._liveeditData = data;\n\n        mw.trigger('saveStart', mw._liveeditData);\n\n        var xhr = mw.drag.coreSave(mw._liveeditData);\n        xhr.error(function(){\n\n            if(xhr.status == 403){\n                var modal = mw.dialog({\n                    id : 'save_content_error_iframe_modal',\n                    html:\"<iframe id='save_content_error_iframe' style='overflow-x:hidden;overflow-y:auto;' class='mw-modal-frame' ></iframe>\",\n                    width:$(window).width() - 90,\n                    height:$(window).height() - 90\n                });\n\n                mw.askusertostay = false;\n\n                mw.$(\"#save_content_error_iframe\").ready(function() {\n                    var doc = document.getElementById('save_content_error_iframe').contentWindow.document;\n                    doc.open();\n                    doc.write(xhr.responseText);\n                    doc.close();\n                    var save_content_error_iframe_reloads = 0;\n                    var doc = document.getElementById('save_content_error_iframe').contentWindow.document;\n\n                    mw.$(\"#save_content_error_iframe\").load(function(){\n                        // cloudflare captcha\n                        var is_cf =  mw.$('.challenge-form',doc).length;\n                        save_content_error_iframe_reloads++;\n\n                        if(is_cf && save_content_error_iframe_reloads == 2){\n                            setTimeout(function(){\n                                mw.askusertostay = false;\n                                mw.$('#save_content_error_iframe_modal').remove();\n                            }, 150);\n\n                        }\n                    });\n\n                });\n            }\n        });\n        xhr.success(function(sdata) {\n            mw.$('.edit.changed').removeClass('changed');\n            mw.$('.orig_changed').removeClass('orig_changed');\n            if (document.querySelector('.edit.changed') !== null) {\n                mw.drag.save();\n            } else {\n                mw.askusertostay = false;\n                mw.trigger('saveEnd', sdata);\n            }\n            if(success){\n                success.call(sdata)\n            }\n\n        });\n        xhr.fail(function(jqXHR, textStatus, errorThrown) {\n            mw.trigger('saveFailed', textStatus, errorThrown);\n            if(fail){\n                fail.call(sdata)\n            }\n        });\n        return xhr;\n    },\n    saveDraftOld: '',\n    DraftSaving: false,\n    initDraft: false,\n    saveDraft: function() {\n        if (mw.drag.draftDisabled) return false;\n        if (mw.drag.DraftSaving) return false;\n        if (!mw.drag.initDraft) return false;\n        if (document.body.textContent != mw.drag.saveDraftOld) {\n            mw.drag.saveDraftOld = document.body.textContent;\n            var body = mw.drag.parseContent().body,\n                edits = body.querySelectorAll('.edit.changed'),\n                data = mw.drag.collectData(edits);\n            if (mw.tools.isEmptyObject(data)) return false;\n            data['is_draft'] = true;\n            mw.drag.DraftSaving = true;\n            var xhr = mw.drag.coreSave(data);\n            xhr.always(function(msg) {\n                mw.drag.DraftSaving = false;\n                mw.drag.initDraft = false;\n                mw.trigger('saveDraftCompleted');\n\n            });\n        }\n    }\n}\n","mw.liveedit.editFields = {\r\n    handleKeydown: function() {\r\n        mw.$('.edit').on('keydown', function(e){\r\n            var istab = (e.which || e.keyCode) === 9,\r\n                isShiftTab = istab && e.shiftKey,\r\n                tabOnly = istab && !e.shiftKey,\r\n                target;\r\n\r\n            if(istab){\r\n                e.preventDefault();\r\n                target = mw.wysiwyg.validateCommonAncestorContainer(getSelection().focusNode);\r\n            }\r\n            if(tabOnly){\r\n                if(target.nodeName === 'LI'){\r\n                    var parent = target.parentNode;\r\n                    if(parent.children[0] !== target){\r\n                        var prev = target.previousElementSibling;\r\n                        var ul = document.createElement(parent.nodeName);\r\n                        ul.appendChild(target);\r\n                        prev.appendChild(ul)\r\n                    }\r\n                }\r\n                else if(target.nodeName === 'TD' || mw.tools.hasParentsWithTag(target, 'td')){\r\n                    target = target.nodeName === 'TD' ? target : mw.tools.firstParentWithTag(target, 'td');\r\n                    nexttd = target.nextElementSibling;\r\n                    if(!!nexttd){\r\n                        mw.wysiwyg.cursorToElement(nexttd, 'start');\r\n                    }\r\n                    else{\r\n                        var nextRow = target.parentNode.nextElementSibling;\r\n                        if(!!nextRow){\r\n                            mw.wysiwyg.cursorToElement(nextRow.querySelector('td'), 'start');\r\n                        }\r\n                    }\r\n                }\r\n                else{\r\n                    mw.wysiwyg.insert_html('&nbsp;&nbsp;');\r\n                }\r\n\r\n            }\r\n            else if(isShiftTab){\r\n                if(target.nodeName === 'LI'){\r\n                    var parent = target.parentNode;\r\n                    var isSub = parent.parentNode.nodeName === 'LI';\r\n                    if(isSub){\r\n                        var split = mw.wysiwyg.listSplit(parent, mw.$('li', parent).index(target));\r\n\r\n                        var parentLi = parent.parentNode;\r\n                        mw.$(parentLi).after(split.middle);\r\n                        if(!!split.top){\r\n                            mw.$(parentLi).append(split.top);\r\n                        }\r\n                        if(!!split.bottom){\r\n                            mw.$(split.middle).append(split.bottom);\r\n                        }\r\n\r\n                        mw.$(parent).remove();\r\n                    }\r\n                }\r\n                else if(target.nodeName === 'TD' || mw.tools.hasParentsWithTag(target, 'td')){\r\n                    var target = target.nodeName === 'TD' ? target : mw.tools.firstParentWithTag(target, 'td');\r\n                    var nexttd = target.previousElementSibling;\r\n                    if(!!nexttd){\r\n                        mw.wysiwyg.cursorToElement(nexttd, 'start');\r\n                    }\r\n                    else{\r\n                        var nextRow = target.parentNode.previousElementSibling;\r\n                        if(!!nextRow){\r\n                            mw.wysiwyg.cursorToElement(nextRow.querySelector('td:last-child'), 'start');\r\n                        }\r\n                    }\r\n                }\r\n                else{\r\n                    var range = getSelection().getRangeAt(0);\r\n                    clone = range.cloneRange();\r\n                    clone.setStart(range.startContainer, range.startOffset - 2);\r\n                    clone.setEnd(range.startContainer, range.startOffset);\r\n                    var nv = clone.cloneContents().firstChild.nodeValue;\r\n                    var nvcheck = nv.replace(/\\s/g,'');\r\n                    if( nvcheck === '' ){\r\n                        clone.deleteContents();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n","\r\n\r\n    mw.$(window).on('load', function(){\r\n      mw.$(document.body).removeClass('mw-external-loading');\r\n    });\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","mw.liveedit.editors = {\r\n  prepare: function() {\r\n      mw.$(window).on(\"mouseup touchend\", function(e) {\r\n\r\n          var sel = getSelection();\r\n          if (sel.rangeCount > 0) {\r\n              var range = sel.getRangeAt(0),\r\n                  common = mw.wysiwyg.validateCommonAncestorContainer(range.commonAncestorContainer);\r\n\r\n              if (mw.tools.hasClass(common, 'edit') || mw.tools.hasParentsWithClass(common, 'edit')) {\r\n                  var nodrop_state = !mw.tools.hasClass(common, 'nodrop') && !mw.tools.hasParentsWithClass(common, 'nodrop');\r\n                  if (nodrop_state) {\r\n                      mw.wysiwyg.enableEditors();\r\n                  } else {\r\n                      mw.wysiwyg.disableEditors();\r\n                  }\r\n              } else {\r\n                  mw.wysiwyg.disableEditors();\r\n              }\r\n          }\r\n\r\n          sel = window.getSelection();\r\n          if (sel.rangeCount > 0) {\r\n              var r = sel.getRangeAt(0);\r\n              var cac = mw.wysiwyg.validateCommonAncestorContainer(r.commonAncestorContainer);\r\n          }\r\n          if (mw.tools.hasAnyOfClassesOnNodeOrParent(cac, ['edit', 'mw-admin-editor-area']) && (sel.rangeCount > 0 && !sel.getRangeAt(0).collapsed)) {\r\n\r\n              if ($.contains(e.target, cac) || $.contains(cac, e.target) || cac === e.target) {\r\n                  setTimeout(function() {\r\n                      var ep = mw.event.page(e);\r\n                      if (cac.isContentEditable && !sel.isCollapsed && !mw.tools.hasClass(cac, 'plain-text') && !mw.tools.hasClass(cac, 'safe-element')) {\r\n                          if (typeof(window.getSelection().getRangeAt(0).getClientRects()[0]) == 'undefined') {\r\n                              return;\r\n                          }\r\n                          mw.smallEditorCanceled = false;\r\n                          var top = ep.y - mw.smallEditor.height() - window.getSelection().getRangeAt(0).getClientRects()[0].height;\r\n                          mw.smallEditor.css({\r\n                              visibility: \"visible\",\r\n                              opacity: 0.7,\r\n                              top: (top > 55 ? top : 55),\r\n                              left: ep.x + mw.smallEditor.width() < mw.$(window).width() ? ep.x : ($(window).width() - mw.smallEditor.width() - 5)\r\n                          });\r\n\r\n                      } else {\r\n                          mw.smallEditorCanceled = true;\r\n                          mw.smallEditor.css({\r\n                              visibility: \"hidden\"\r\n                          });\r\n                      }\r\n\r\n                  }, 33);\r\n              }\r\n          } else {\r\n              if (mw.smallEditor && !mw.tools.hasParentsWithClass(e.target, 'mw_small_editor')) {\r\n                      mw.smallEditorCanceled = true;\r\n                      mw.smallEditor.css({\r\n                          visibility: \"hidden\"\r\n                      });\r\n              }\r\n          }\r\n          setTimeout(function() {\r\n              if (window.getSelection().rangecount > 0 && window.getSelection().getRangeAt(0).collapsed) {\r\n                  if (typeof(mw.smallEditor) != 'undefined') {\r\n                      mw.smallEditorCanceled = true;\r\n                      mw.smallEditor.css({\r\n                          visibility: \"hidden\"\r\n                      });\r\n                  }\r\n              }\r\n          }, 39);\r\n      });\r\n      mw.smallEditorOff = 150;\r\n\r\n      mw.$(window).on(\"mousemove touchmove touchstart\", function(e) {\r\n          if (!!mw.smallEditor && !mw.isDrag && !mw.smallEditorCanceled && !mw.smallEditor.hasClass(\"editor_hover\")) {\r\n              var off = mw.smallEditor.offset();\r\n              var ep = mw.event.page(e);\r\n              if (typeof off !== 'undefined') {\r\n                  if (\r\n                      ((ep.x - mw.smallEditorOff) > (off.left + mw.smallEditor.width()))\r\n                      || ((ep.y - mw.smallEditorOff) > (off.top + mw.smallEditor.height()))\r\n                      || ((ep.x + mw.smallEditorOff) < (off.left)) || ((ep.y + mw.smallEditorOff) < (off.top))) {\r\n                      if (typeof mw.smallEditor !== 'undefined') {\r\n                          mw.smallEditor.css(\"visibility\", \"hidden\");\r\n                          mw.smallEditorCanceled = true;\r\n                      }\r\n                  }\r\n              }\r\n          }\r\n      });\r\n      mw.$(window).on(\"scroll\", function(e) {\r\n          if (typeof(mw.smallEditor) !== \"undefined\") {\r\n              mw.smallEditor.css(\"visibility\", \"hidden\");\r\n              mw.smallEditorCanceled = true;\r\n          }\r\n      });\r\n      mw.$(\"#live_edit_toolbar, #mw_small_editor\").on(\"mousedown touchstart\", function(e) {\r\n\r\n          mw.$(\".wysiwyg_external\").empty();\r\n          if (e.target.nodeName !== 'INPUT' && e.target.nodeName !== 'SELECT' && e.target.nodeName !== 'OPTION' && e.target.nodeName !== 'CHECKBOX') {\r\n              e.preventDefault();\r\n          }\r\n          if (typeof(mw.smallEditor) !== \"undefined\") {\r\n              if (!mw.tools.hasParentsWithClass(e.target, 'mw_small_editor')) {\r\n                  mw.smallEditor.css(\"visibility\", \"hidden\");\r\n                  mw.smallEditorCanceled = true;\r\n              }\r\n          }\r\n      });\r\n  }\r\n};\r\n","mw.AfterDrop = function(){\r\n\r\n\r\n\r\n    this.loadNewModules = function(){\r\n        mw.pauseSave = true;\r\n        var need_re_init = false;\r\n        var all = mw.$(\".edit .module-item\"), count = 0;\r\n        all.each(function(c) {\r\n            (function (el) {\r\n                var parent = el.parentNode;\r\n                var xhr = mw._({\r\n                    selector: el,\r\n                    done: function(module) {\r\n                        mw.drag.fancynateLoading(module);\r\n                        mw.pauseSave = false;\r\n                        mw.wysiwyg.init_editables();\r\n                        if(mw.liveEditDomTree) {\r\n                            mw.liveEditDomTree.refresh(parent);\r\n                            mw.liveEditDomTree.select(parent);\r\n\r\n                        }\r\n                    },\r\n                    fail:function () {\r\n                        mw.$(this).remove();\r\n                        mw.notification.error('Error loading module.');\r\n                    }\r\n                }, true);\r\n               if(xhr) {\r\n                   xhr.always(function () {\r\n                       count++;\r\n                       if(all.length === count) {\r\n                           mw.dragCurrent = null;\r\n                       }\r\n                   });\r\n               }\r\n               else {\r\n                   count++;\r\n               }\r\n\r\n                need_re_init = true;\r\n            })(this);\r\n        });\r\n        if (mw.have_new_items === true) {\r\n            need_re_init = true;\r\n        }\r\n        if (need_re_init === true) {\r\n            if (!mw.isDrag) {\r\n                if (typeof callback === 'function') {\r\n                    callback.call(this);\r\n                }\r\n            }\r\n        }\r\n        mw.have_new_items = false;\r\n    };\r\n\r\n    this.__timeInit = null;\r\n\r\n    this.init = function(){\r\n        var scope = this;\r\n        if(scope.__timeInit){\r\n           clearTimeout(scope.__timeInit);\r\n        }\r\n        scope.__timeInit = setTimeout(function(){\r\n\r\n            mw.$(\".mw-drag-current-bottom, .mw-drag-current-top\").removeClass('mw-drag-current-bottom mw-drag-current-top');\r\n            mw.$(\".currentDragMouseOver\").removeClass('currentDragMouseOver');\r\n\r\n            mw.$(\".mw_drag_current\").each(function(){\r\n                mw.$(this).removeClass('mw_drag_current').css({\r\n                    visibility:'visible',\r\n                    opacity:''\r\n                });\r\n            });\r\n            mw.$(\".currentDragMouseOver\").removeClass('currentDragMouseOver')\r\n            mw.$(\".mw-empty\").not(':empty').removeClass('mw-empty');\r\n            scope.loadNewModules()\r\n            mw.dropable.hide().removeClass('mw_dropable_onleaveedit');\r\n\r\n        }, 78)\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n/*************************************************************\r\n\r\n\r\n        Options: Object literal\r\n\r\n        Default: {\r\n            classes:{\r\n                edit:'edit',\r\n                element:'element',\r\n                module:'module',\r\n                noDrop:'nodrop', // - disable drop\r\n                allowDrop:'allow-drop' //- enable drop in .nodrop\r\n            }\r\n        }\r\n\r\n\r\n\r\n    mw.analizer = new mw.ElementAnalizer(Options);\r\n\r\n\r\n\r\n\r\n*************************************************************/\r\n\r\nmw.ElementAnalyzer = function(options){\r\n\r\n\r\n\r\n    this.data = {\r\n        dropableAction:null,\r\n        currentGrabbed:null,\r\n        target:null,\r\n        dropablePosition:null\r\n    };\r\n\r\n    this.dataReset = function(){\r\n        this.data = {\r\n            dropableAction:null,\r\n            currentGrabbed:null,\r\n            target:null,\r\n            dropablePosition:null\r\n        }\r\n    };\r\n\r\n    this.options = options || {};\r\n    this.defaults = {\r\n        classes:{\r\n            edit: 'edit',\r\n            element: 'element',\r\n            module: 'module',\r\n            noDrop: 'nodrop',\r\n            allowDrop: 'allow-drop',\r\n            emptyElement: 'mw-empty',\r\n            zone: 'mw-zone'\r\n        },\r\n        rows:['mw-row', 'mw-ui-row', 'row'],\r\n        columns:['mw-col', 'mw-ui-col', 'col', 'column', 'columns'],\r\n        columnMatches:'[class*=\"col-\"]',\r\n        rowMatches:'[class*=\"row-\"]',\r\n    };\r\n    this.settings = $.extend({}, this.options, this.defaults);\r\n\r\n    this.prepare = function(){\r\n        this.cls = this.settings.classes;\r\n        this.initCSS();\r\n    };\r\n\r\n    this.initCSS = function(){\r\n        var css = 'body.dragStart .'+this.cls.noDrop+'{'\r\n            +'pointer-events: none;'\r\n        +'}'\r\n        +'body.dragStart .'+this.cls.allowDrop+'{'\r\n            +'pointer-events: all;'\r\n        +'}';\r\n\r\n        var style = document.createElement('style');\r\n        document.getElementsByTagName('head')[0].appendChild(style);\r\n        style.innerHTML = css;\r\n    };\r\n\r\n\r\n    this._isEditLike = function(node){\r\n        node = node || this.data.target;\r\n        var case1 = mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(node, [this.cls.edit,this.cls.module]);\r\n        var case2 = mw.tools.hasClass(node, 'module') && mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(node.parentNode, [this.cls.edit,this.cls.module]);\r\n        var edit = mw.tools.firstParentOrCurrentWithAnyOfClasses(node, this.cls.edit);\r\n        return (case1 || case2) && !mw.tools.hasClass(edit, this.cls.noDrop);\r\n    };\r\n    this._canDrop = function(node) {\r\n        node = node || this.data.target;\r\n        return mw.tools.parentsOrCurrentOrderMatchOrOnlyFirstOrNone(node, [this.cls.allowDrop, this.cls.noDrop]);\r\n    };\r\n\r\n    this._layoutInLayout = function() {\r\n        if (!this.data.currentGrabbed || !document.body.contains(this.data.currentGrabbed)) {\r\n            return false;\r\n        }\r\n        var currentGrabbedIsLayout = (this.data.currentGrabbed.getAttribute('data-module-name') === 'layouts' || mw.dragCurrent.getAttribute('data-type') === 'layouts');\r\n        var targetIsLayout = mw.tools.firstMatchesOnNodeOrParent(this.data.target, ['[data-module-name=\"layouts\"]', '[data-type=\"layouts\"]']);\r\n        return {\r\n            target:targetIsLayout,\r\n            result:currentGrabbedIsLayout && !!targetIsLayout\r\n        };\r\n    };\r\n\r\n    this.canDrop = function(node){\r\n        node = node || this.data.target;\r\n        var can = (this._isEditLike(node) && this._canDrop(node) && !this._layoutInLayout().result);\r\n        return can;\r\n    };\r\n\r\n\r\n\r\n    this.analizePosition = function(event, node){\r\n        node = node || this.data.target;\r\n        var height = node.offsetHeight,\r\n            offset = mw.$(node).offset();\r\n        if (mw.event.page(event).y > offset.top + (height / 2)) {\r\n            this.data.dropablePosition =  'bottom';\r\n        } else {\r\n            this.data.dropablePosition =  'top';\r\n        }\r\n    };\r\n\r\n    this.analizeActionOfElement = function(node, pos){\r\n        node = node || this.data.target;\r\n        pos = node || this.data.dropablePosition;\r\n    };\r\n    this.afterAction = function(node, pos){\r\n        if(!this._afterAction){\r\n            this._afterAction = new mw.AfterDrop();\r\n        }\r\n\r\n        this._afterAction.init();\r\n\r\n    };\r\n    this.dropableHide = function(){\r\n\r\n    };\r\n    this.analizeAction = function(node, pos){\r\n        node = node || this.data.target;\r\n        pos = pos || this.data.dropablePosition;\r\n        if(this.helpers.isEmpty()){\r\n            this.data.dropableAction = 'append';\r\n            return;\r\n        }\r\n        var actions =  {\r\n            Around:{\r\n                top:'before',\r\n                bottom:'after'\r\n            },\r\n            Inside:{\r\n               top:'prepend',\r\n               bottom:'append'\r\n            }\r\n        };\r\n\r\n        if(!pos){\r\n            return;\r\n        }\r\n\r\n\r\n\r\n        if(mw.tools.hasClass(node, 'allow-drop')){\r\n            this.data.dropableAction = actions.Inside[pos];\r\n        }\r\n        else if(this.helpers.isElement()){\r\n            this.data.dropableAction = actions.Around[pos];\r\n        }\r\n        else if(this.helpers.isEdit()){\r\n            this.data.dropableAction = actions.Inside[pos];\r\n        }\r\n        else if(this.helpers.isLayoutModule()){\r\n            this.data.dropableAction = actions.Around[pos];\r\n        }\r\n        else if(this.helpers.isModule()){\r\n            this.data.dropableAction = actions.Around[pos];\r\n        }\r\n    };\r\n\r\n    this.action = function(event){\r\n        var node = event.target;\r\n        var final = {};\r\n        if(this._isEditLike(node)){\r\n            if(this._canDrop(node)){\r\n\r\n            }\r\n        }\r\n    };\r\n\r\n\r\n\r\n    this.helpers = {\r\n        scope:this,\r\n        isBlockLevel:function(node){\r\n            node = node || (this.data ? this.data.target : null);\r\n            return mw.tools.isBlockLevel(node);\r\n        },\r\n        isInlineLevel:function(node){\r\n            node = node || this.data.target;\r\n            return mw.tools.isInlineLevel(node);\r\n        },\r\n        canAccept:function(target, what){\r\n            var accept = target.dataset('accept');\r\n            if(!accept) return true;\r\n            accept = accept.trim().split(',').map(Function.prototype.call, String.prototype.trim);\r\n            var wtype = 'all';\r\n            if(mw.tools.hasClass(what, 'module-layout')){\r\n                wtype = 'layout';\r\n            }\r\n            else if(mw.tools.hasClass(what, 'module')){\r\n                wtype = 'module';\r\n            }\r\n            else if(mw.tools.hasClass(what, 'element')){\r\n                wtype = 'element';\r\n            }\r\n            if(wtype=='all') return true\r\n\r\n            return accept.indexOf(wtype) !== -1;\r\n        },\r\n        getBlockElements:function(selector, root){\r\n            root = root || document.body;\r\n            selector = selector || '*';\r\n            var all = root.querySelectorAll(selector), i = 0; final = [];\r\n            for( ; i<all.length; i++){\r\n                if(this.scope.helpers.isBlockLevel(all[i])){\r\n                    final.push(all[i])\r\n                }\r\n            }\r\n            return final;\r\n        },\r\n        getElementsLike:function(selector, root){\r\n            root = root || document.body;\r\n            selector = selector || '*';\r\n            var all = root.querySelectorAll(selector), i = 0; final = [];\r\n            for( ; i<all.length; i++){\r\n                if(!this.scope.helpers.isColLike(all[i]) &&\r\n                    !this.scope.helpers.isRowLike(all[i]) &&\r\n                    !this.scope.helpers.isEdit(all[i]) &&\r\n                    this.scope.helpers.isBlockLevel(all[i])){\r\n                    final.push(all[i]);\r\n                }\r\n            }\r\n            return final;\r\n        },\r\n        isEdit:function(node){\r\n            node = node || this.scope.data.target;\r\n            return mw.tools.hasClass(node, this.scope.cls.edit);\r\n        },\r\n        isModule:function(node){\r\n            node = node || this.scope.data.target;\r\n            return mw.tools.hasClass(node, this.scope.cls.module) && (mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(node, [this.scope.cls.module, this.scope.cls.edit]));\r\n        },\r\n        isElement:function(node){\r\n            node = node || this.scope.data.target;\r\n            return mw.tools.hasClass(node, this.scope.cls.element);\r\n        },\r\n        isEmpty:function(node){\r\n            node = node || this.scope.data.target;\r\n            return mw.tools.hasClass(node, 'mw-empty');\r\n        },\r\n        isRowLike:function(node){\r\n            node = node || this.scope.data.target;\r\n            var is = false;\r\n            if(!node.className) return is;\r\n            is = mw.tools.hasAnyOfClasses(node, this.scope.settings.rows);\r\n            if(is){\r\n                return is;\r\n            }\r\n            return mw.tools.matches(node, this.scope.settings.rowMatches);\r\n        },\r\n        isColLike:function(node){\r\n            node = node || this.scope.data.target;\r\n            var is = false;\r\n            if(!node.className) return is;\r\n            is = mw.tools.hasAnyOfClasses(node, this.scope.settings.columns);\r\n            if(is){\r\n                return is;\r\n            }\r\n            if(mw.tools.hasAnyOfClasses(node, ['mw-col-container', 'mw-ui-col-container'])){\r\n                return false;\r\n            }\r\n            return mw.tools.matches(node, this.scope.settings.columnMatches);\r\n        },\r\n        isLayoutModule:function(node){\r\n            node = node || this.scope.data.target;\r\n            return false;\r\n\r\n        },\r\n        noop:function(){}\r\n    };\r\n\r\n\r\n    this.interactionTarget = function(next){\r\n        node = this.data.target;\r\n        if(next) node = node.parentNode;\r\n        while(node && !this.helpers.isBlockLevel(node)){\r\n            node = node.parentNode;\r\n        }\r\n        return node;\r\n    };\r\n    this.validateInteractionTarget = function(node){\r\n        node = node || this.data.target;\r\n        if (!mw.tools.firstParentOrCurrentWithClass(node, this.cls.edit)) {\r\n           return false;\r\n        }\r\n        var cls = [\r\n            this.cls.edit,\r\n            this.cls.element,\r\n            this.cls.module,\r\n            this.cls.emptyElement\r\n        ];\r\n        while(node && node !== document.body){\r\n            if(mw.tools.hasAnyOfClasses(node, cls)){\r\n                return node;\r\n            }\r\n            node = node.parentNode;\r\n        }\r\n        return false;\r\n    };\r\n    this.on = function(events, listener) {\r\n        events = events.trim().split(' ');\r\n        for (var i=0 ; i<events.length; i++) {\r\n             document.body.addEventListener(events[i], listener, false);\r\n        }\r\n    };\r\n    this.loadNewModules = function(){\r\n        mw.pauseSave = true;\r\n        var need_re_init = false;\r\n        mw.$(\".edit .module-item\").each(function(c) {\r\n\r\n            (function (el) {\r\n                var xhr = mw._({\r\n                    selector: el,\r\n                    done: function(module) {\r\n                        mw.drag.fancynateLoading(module);\r\n                        mw.pauseSave = false;\r\n                        mw.wysiwyg.init_editables();\r\n                    },\r\n                    fail:function () {\r\n                        mw.$(this).remove();\r\n                        mw.notification.error('Error loading module.')\r\n                    }\r\n                }, true);\r\n                need_re_init = true;\r\n            })(this);\r\n        });\r\n        if (mw.have_new_items === true) {\r\n            need_re_init = true;\r\n        }\r\n        mw.have_new_items = false;\r\n    };\r\n    this.whenUp = function(){\r\n        var scope = this;\r\n        this.on('mouseup touchend', function(){\r\n            if(scope.data.currentGrabbed){\r\n                scope.data.currentGrabbed = null;\r\n            }\r\n        });\r\n    };\r\n\r\n    this.getTarget = function(t){\r\n        t = t || this.validateInteractionTarget();\r\n        if(!t){\r\n            return;\r\n        }\r\n        if (this.canDrop(t)) {\r\n            return t;\r\n        } else {\r\n            return this.redirect(t);\r\n        }\r\n    };\r\n\r\n    this.redirect = function(node){\r\n        node = node || this.data.target;\r\n        var islayOutInLayout = this._layoutInLayout(node);\r\n        if(islayOutInLayout.result){\r\n            var res =  this.validateInteractionTarget(/*node === islayOutInLayout.target ? islayOutInLayout.target.parentNode : */islayOutInLayout.target);\r\n            return  res;\r\n        }\r\n        if(node === document.body || node.parentNode === document.body) return null;\r\n        return this.getTarget(node.parentNode);\r\n    };\r\n\r\n    this.interactionAnalizer = function(e){\r\n\r\n        var scope = this;\r\n        mw.dropable.hide();\r\n\r\n        if(this.data.currentGrabbed){\r\n            if (e.type.indexOf('touch') !== -1) {\r\n                var coords = mw.event.page(e);\r\n                scope.data.target = document.elementFromPoint(coords.x, coords.y);\r\n            }\r\n            else {\r\n                scope.data.target = e.target;\r\n            }\r\n            scope.interactionTarget();\r\n            scope.data.target = scope.getTarget();\r\n\r\n            if(scope.data.target){\r\n                    scope.analizePosition(e);\r\n                    scope.analizeAction();\r\n                    mw.dropable.show();\r\n            }\r\n            else{\r\n\r\n                    var near = mw.dropables.findNearest(e);\r\n                    if(near.element){\r\n                        scope.data.target = near.element;\r\n                        scope.data.dropablePosition = near.position;\r\n                        mw.dropables.findNearestException = true;\r\n                        mw.dropable.show();\r\n                    }\r\n                    else{\r\n                        mw.currentDragMouseOver = null;\r\n                        mw.dropable.hide();\r\n                        scope.dataReset();\r\n\r\n                    }\r\n\r\n            }\r\n\r\n            var el = mw.$(scope.data.target);\r\n            mw.currentDragMouseOver = scope.data.target;\r\n\r\n            var edit = mw.tools.firstParentOrCurrentWithClass(mw.currentDragMouseOver, 'edit');\r\n            mw.tools.classNamespaceDelete(mw.dropable[0], 'mw-dropable-tagret-rel-');\r\n            if(edit) {\r\n                mw.tools.addClass(mw.dropable[0], 'mw-dropable-tagret-rel-' + edit.getAttribute('rel'));\r\n                var rel = edit.getAttribute('rel');\r\n                mw.tools.addClass(mw.dropable[0], 'mw-dropable-tagret-rel-' + rel);\r\n            }\r\n\r\n            mw.dropables.set(scope.data.dropablePosition, el.offset(), el.height(), el.width());\r\n\r\n            if(el[0] && !mw.tools.hasAnyOfClasses(el[0], ['mw-drag-current-'+scope.data.dropablePosition])){\r\n                mw.$('.mw-drag-current-top,.mw-drag-current-bottom').removeClass('mw-drag-current-top mw-drag-current-bottom');\r\n                mw.tools.addClass(el[0], 'mw-drag-current-'+scope.data.dropablePosition)\r\n            }\r\n        }\r\n    };\r\n\r\n    this.whenMove = function(){\r\n        var scope = this;\r\n        this.on('mousemove touchmove', function(e){\r\n            scope.interactionAnalizer(e)\r\n        });\r\n    };\r\n    this.init = function(){\r\n        this.prepare();\r\n    };\r\n\r\n    this.init();\r\n};\r\n\r\nmw.ea = new mw.ElementAnalyzer();\r\n","mw.liveedit.handleCustomEvents = function() {\n    mw.on('moduleOver ElementOver', function(e, etarget, oevent){\n        var target = mw.tools.firstParentOrCurrentWithAnyOfClasses(oevent.target, ['element', 'module']);\n        if(target.id){\n            mw.liveEditSelector.active(true);\n            mw.liveEditSelector.setItem(target, mw.liveEditSelector.interactors);\n        }\n    });\n\n    mw.$(document.body).on('click', function (e) {\n        var target = e.target;\n        var can = mw.tools.firstParentOrCurrentWithAnyOfClasses(target, [\n           'edit', 'module', 'element'\n        ]);\n        if(can) {\n            var toSelect = mw.tools.firstNotInlineLevel(target);\n\n            mw.liveEditSelector.select(target);\n\n            if(mw.liveEditDomTree) {\n                mw.liveEditDomTree.select(mw.wysiwyg.validateCommonAncestorContainer(target));\n\n            }\n        }\n\n\n    });\n\n\n    mw.on(\"DragHoverOnEmpty\", function(e, el) {\n        if ($.browser.webkit) {\n            var _el = mw.$(el);\n            _el.addClass(\"hover\");\n            if (!_el.hasClass(\"mw-webkit-drag-hover-binded\")) {\n                _el.addClass(\"mw-webkit-drag-hover-binded\");\n                _el.mouseleave(function() {\n                    _el.removeClass(\"hover\");\n                });\n            }\n        }\n    });\n    mw.on(\"IconElementClick\", function(e, el) {\n        mw.editorIconPicker.tooltip(el)\n        setTimeout(function () {\n            mw.wysiwyg.contentEditable(el, false);\n        });\n    });\n\n    mw.on(\"ComponentClick\", function(e, node, type){\n\n        if (type === 'icon'){\n            mw.editorIconPicker.tooltip(node)\n            return;\n\n        }\n        if(mw.settings.live_edit_open_module_settings_in_sidebar) {\n            mw.log('ComponentClick' + type);\n            if (!mw.liveEditSettings) {\n                return; // admin mode\n            }\n            var uitype = type;\n            if (type === 'element') {\n                uitype = 'none';\n            }\n            if (type === 'safe-element') {\n                //uitype = 'element' ;\n                uitype = 'none';\n            }\n            if (node.nodeName === 'IMG') {\n                uitype = 'image';\n            }\n\n            if (mw.liveEditSettings.active) {\n                if (mw.sidebarSettingsTabs) {\n                    if (uitype !== 'module') {\n                        mw.sidebarSettingsTabs.setLastClicked();\n                    } else {\n                        mw.sidebarSettingsTabs.set(2);\n                    }\n                }\n                mw.liveNodeSettings.set(uitype, node);\n            }\n\n        }\n    });\n\n    mw.on(\"ElementClick\", function(e, el, c) {\n        mw.$(\".element-current\").not(el).removeClass('element-current');\n        if (mw.liveEditSelectMode === 'element') {\n            mw.$(el).addClass('element-current');\n        }\n\n        mw.$('.module').each(function(){\n            mw.wysiwyg.contentEditable(this, false)\n        });\n    });\n    mw.on(\"PlainTextClick\", function(e, el) {\n        mw.wysiwyg.contentEditable(el, true);\n        mw.$('.module').each(function(){\n            mw.wysiwyg.contentEditable(this, false);\n        });\n    });\n\n\n    mw.on(\"editUserIsTypingForLong\", function(node){\n        if(typeof(mw.liveEditSettings) != 'undefined'){\n            if(mw.liveEditSettings.active){\n                mw.liveEditSettings.hide();\n            }\n        }\n    });\n    mw.on(\"TableTdClick\", function(e, el) {\n        if (mw.liveedit && mw.liveedit.inline) {\n            mw.liveedit.inline.setActiveCell(el, e);\n            var td_parent_table = mw.tools.firstParentWithTag(el, 'table');\n            if (td_parent_table) {\n                mw.liveedit.inline.tableController(td_parent_table);\n            }\n        }\n    });\n\n    mw.on('UserInteraction', function(){\n        mw.dropables.userInteractionClasses();\n        mw.liveEditSelector.positionSelected();\n\n    });\n\n    mw.on('ElementOver moduleOver', function(e, target){\n        var over_target_el = null;\n        if(e.type === 'onElementOver'){\n            over_target_el = mw.tools.firstParentOrCurrentWithAnyOfClasses(target, ['element'])\n            if(over_target_el && !mw.tools.hasClass('element-over',over_target_el)){\n                mw.tools.addClass(over_target_el, 'element-over')\n            }\n        } else if(e.type === 'moduleOver'){\n            over_target_el = mw.tools.firstParentOrCurrentWithAnyOfClasses(target, ['module'])\n            if(over_target_el && !mw.tools.hasClass('module-over',over_target_el)){\n                mw.tools.addClass(over_target_el, 'module-over')\n            }\n        }\n        if(over_target_el){\n            mw.$(\".element-over,.module-over\").not(over_target_el).removeClass('element-over module-over');\n        }\n    });\n\n\n\n    mw.on('CloneableOver', function(e, target, isOverControl){\n        mw.drag.onCloneableControl(target, isOverControl)\n    });\n\n    var onModuleBetweenModulesTime = null;\n\n    mw.on('ModuleBetweenModules', function(e, el, pos){\n        clearTimeout(onModuleBetweenModulesTime);\n        onModuleBetweenModulesTime = setTimeout(function(){\n            if($(\"#moduleinbetween\").length === 0){\n                var tip = mw.tooltip({\n                    content:'To drop this element here, select Clean container first',\n                    element:el[0],\n                    position:pos+'-center',\n                    skin:'dark',\n                    id:'moduleinbetween'\n                });\n                setTimeout(function(){\n                    mw.$(\"#moduleinbetween\").fadeOut(function(){\n                        mw.$(this).remove();\n                    });\n                }, 3000);\n            }\n        }, 1000);\n    });\n};\n","mw.liveedit.handleEvents = function() {\n    mw.$(document.body).on('touchmove mousemove', function(e){\n        if(mw.liveEditSelector.interactors.active) {\n            if( !mw.liveedit.data.get('move', 'hasModuleOrElement')){\n                if(e.target !== mw.drag.plusTop && e.target !== mw.drag.plusBottom) {\n                    mw.liveEditSelector.hideItem(mw.liveEditSelector.interactors);\n                }\n            }\n        }\n    });\n    mw.$(\"#live-edit-dropdown-actions-content a\").off('click');\n\n    mw.$(document).on('mousedown touchstart', function(e){\n        if(!mw.tools.hasAnyOfClassesOnNodeOrParent(e.target, ['mw-defaults', 'edit', 'element'])){\n            mw.$(\".element-current\").removeClass(\"element-current\");\n        }\n    });\n\n    mw.$(\"span.edit:not('.nodrop')\").each(function(){\n        mw.tools.setTag(this, 'div');\n    });\n\n\n    mw.$(\"#mw-toolbar-css-editor-btn\").click(function() {\n        mw.liveedit.widgets.cssEditorDialog();\n    });\n    mw.$(\"#mw-toolbar-html-editor-btn\").click(function() {\n        mw.liveedit.widgets.htmlEditorDialog();\n    });\n\n    mw.$(\"#mw-toolbar-reset-content-editor-btn\").click(function() {\n        mw.tools.open_reset_content_editor();\n    });\n    mw.$(document.body).on('keyup', function(e) {\n        mw.$(\".mw_master_handle\").css({\n            left: \"\",\n            top: \"\"\n        });\n        mw.on.stopWriting(e.target, function() {\n            if (mw.tools.hasClass(e.target, 'edit') || mw.tools.hasParentsWithClass(this, 'edit')) {\n                mw.liveEditState.record({\n                    target:e.target,\n                    value:e.target.innerHTML\n                });\n                mw.drag.saveDraft();\n            }\n        });\n    });\n\n    mw.$(document.body).on(\"keydown\", function(e) {\n\n        if (e.keyCode === 83 && e.ctrlKey) {\n\n            if (e.altKey) {\n                return;\n            }\n\n            if (typeof(mw.settings.live_edit_disable_keyboard_shortcuts) != 'undefined') {\n                if (mw.settings.live_edit_disable_keyboard_shortcuts === true) {\n                    return;\n                }\n            }\n            mw.event.cancel(e, true);\n            mw.drag.save();\n        }\n    });\n\n    mw.$(document.body).on(\"paste\", function(e) {\n        if(mw.tools.hasClass(e.target, 'plain-text')){\n            e.preventDefault();\n            var text = (e.originalEvent || e).clipboardData.getData('text/plain');\n            document.execCommand(\"insertHTML\", false, text);\n        }\n    });\n\n    mw.$(document.body).on(\"mousedown mouseup touchstart touchend\", function(e) {\n\n        if (e.type === 'mousedown' || e.type === 'touchstart') {\n            if (!mw.wysiwyg.elementHasFontIconClass(e.target)\n                && !mw.tools.hasAnyOfClassesOnNodeOrParent(e.target, ['tooltip-icon-picker', 'mw-tooltip'])) {\n\n                mw.editorIconPicker.tooltip('hide');\n                try {\n                    $(mw.liveedit.widgets._iconEditor.tooltip).hide();\n                } catch(e) {\n\n                }\n\n            }\n            if (!mw.tools.hasClass(e.target, 'ui-resizable-handle') && !mw.tools.hasParentsWithClass(e.target, 'ui-resizable-handle')) {\n                mw.tools.addClass(document.body, 'state-element')\n            } else {\n                mw.tools.removeClass(document.body, 'state-element');\n            }\n\n            if (!mw.tools.hasParentsWithClass(e.target, 'mw-tooltip-insert-module') && !mw.tools.hasAnyOfClasses(e.target, ['mw-plus-bottom', 'mw-plus-top'])) {\n                mw.$('.mw-tooltip-insert-module').remove();\n                mw.drag.plus.locked = false;\n            }\n\n        } else {\n            mw.tools.removeClass(document.body, 'state-element');\n        }\n    });\n    mw.$('span.mw-powered-by').on(\"click\", function(e) {\n        mw.tools.open_global_module_settings_modal('white_label/admin', 'mw-powered-by');\n        return false;\n    });\n\n    mw.$(\".edit a, #mw-toolbar-right a\").click(function() {\n        var el = this;\n        if (!el.isContentEditable) {\n            if (el.onclick === null) {\n                var href = (el.getAttribute('href') || '').trim();\n                if(href) {\n                    if (!(href.indexOf(\"javascript:\") === 0 || href.indexOf('#') === 0)) {\n                        return mw.liveedit.beforeleave(this.href);\n                    }\n                }\n            }\n        }\n    });\n\n};\n","mw.iframecallbacks = {\r\n    noop: function() {\r\n\r\n    },\r\n    insert_link: function (url, target, link_content) {\r\n        if(url.length){\r\n            target = url[1];\r\n            link_content = url[2];\r\n            url = url[0];\r\n        } else if(url.url ) {\r\n            url= url.url;\r\n            target = target || url.target || '_self';\r\n            link_content = link_content || url.text || '_self';\r\n        }\r\n        url = url.trim();\r\n        var contains = false;\r\n        var arr = ['mailto:', 'tel:', 'skype:', 'sms:', 'geopoint:', 'whatsapp:'],\r\n            i = 0;\r\n        for( ; i < arr.length; i++ ){\r\n            if(url.indexOf(arr[i]) === 0){\r\n                contains = true;\r\n            }\r\n        }\r\n        if (!contains && !!url) {\r\n            //url = url.indexOf(\"http\") === 0 ? url : (location.protocol + \"//\" + url);\r\n        }\r\n        target = target || '_self';\r\n\r\n        var link_inner_text = false;\r\n        if(link_content){\r\n            link_inner_text = link_content;\r\n        }\r\n\r\n        var sel, range, a;\r\n\r\n        sel = getSelection();\r\n        if(!sel.rangeCount){\r\n            return;\r\n        }\r\n\r\n        range = sel.getRangeAt(0);\r\n        var jqAction = url ? 'attr' : 'removeAttr';\r\n\r\n        mw.wysiwyg.change(range.startContainer);\r\n\r\n        if (!!mw.current_element && mw.current_element.nodeName === 'IMG') {\r\n            if (mw.current_element.parentNode.nodeName !== 'A') {\r\n                a = document.createElement('a');\r\n                if(url){\r\n                    a.href = url;\r\n                }\r\n                a.target = target;\r\n\r\n                mw.$(mw.current_element).wrap(a);\r\n            }\r\n            else {\r\n                mw.$(mw.current_element.parentNode)[jqAction]('href', url);\r\n\r\n                mw.current_element.parentNode.target = target;\r\n            }\r\n        }\r\n\r\n\r\n        if (range.commonAncestorContainer.nodeName === 'A') {\r\n            mw.$(range.commonAncestorContainer)[jqAction](\"href\", url).attr(\"target\", target);\r\n            if(link_inner_text){\r\n                mw.$(range.commonAncestorContainer).html(link_inner_text);\r\n            }\r\n            return false;\r\n        }\r\n\r\n\r\n        var start = range.startContainer;\r\n\r\n\r\n        if (window.getSelection().isCollapsed) {\r\n\r\n            if (!!mw.current_element && mw.current_element.nodeName !== 'A') {\r\n                if (mw.tools.hasChildrenWithTag(mw.current_element, 'a')) {\r\n                    mw.$(mw.tools.firstChildWithTag(mw.current_element, 'a'))[jqAction](\"href\", url).attr(\"target\", target);\r\n                    if(link_inner_text){\r\n                        mw.$(mw.tools.firstChildWithTag(mw.current_element, 'a')).html(link_inner_text);\r\n                    }\r\n                    return false;\r\n                }\r\n            } else if (!!mw.current_element && mw.current_element.nodeName === 'A') {\r\n                mw.$(mw.current_element).attr(\"href\", url).attr(\"target\", target);\r\n                if(link_inner_text){\r\n                    mw.$(mw.current_element).html(link_inner_text);\r\n                }\r\n                return false;\r\n            }\r\n\r\n            if (mw.tools.hasParentsWithTag(start, 'a')) {\r\n                mw.$(mw.tools.firstParentWithTag(start, 'a'))[jqAction](\"href\", url).attr(\"target\", target);\r\n                if(link_inner_text){\r\n                    mw.$(mw.tools.firstParentWithTag(start, 'a')).html(link_inner_text);\r\n                }\r\n                return false;\r\n            }\r\n            if (mw.tools.hasChildrenWithTag(start, 'a')) {\r\n                mw.$(mw.tools.firstChildWithTag(start, 'a'))[jqAction](\"href\", url).attr(\"target\", target);\r\n                if(link_inner_text){\r\n                    mw.$(mw.tools.firstChildWithTag(start, 'a')).html(link_inner_text);\r\n                }\r\n                return false;\r\n            }\r\n\r\n        }\r\n\r\n\r\n        var link = mw.wysiwyg.findTagAcrossSelection('a');\r\n        if (!!link) {\r\n            mw.$(link)[jqAction](\"href\", url);\r\n            mw.$(link).attr(\"target\", target);\r\n            if(link_inner_text){\r\n                mw.$(link).html(link_inner_text);\r\n            }\r\n        }\r\n        else {\r\n            if (!window.getSelection().isCollapsed) {\r\n                a = document.createElement('a');\r\n                a.href = url;\r\n                a.target = target;\r\n                sel = window.getSelection();\r\n                range = sel.getRangeAt(0);\r\n                try {\r\n                    range.surroundContents(a);\r\n                }\r\n                catch (e) {\r\n                    mw.wysiwyg.execCommand(\"CreateLink\", false, url);\r\n                }\r\n            }\r\n            else {\r\n\r\n                var html = '<a href=\"' + url + '\" target=\"' + target + '\">' + (link_inner_text ? link_inner_text : url) + '</a>';\r\n                mw.wysiwyg.insert_html(html);\r\n            }\r\n        }\r\n        if(link_content && a) {\r\n            a.innerHTML = link_content\r\n        }\r\n    },\r\n\r\n    set_bg_image: function (url) {\r\n        return mw.wysiwyg.set_bg_image(url);\r\n    },\r\n    fontColor: function (color) {\r\n        return mw.wysiwyg.fontColor(color);\r\n    },\r\n    fontbg: function (color) {\r\n        return mw.wysiwyg.fontbg(color);\r\n    },\r\n    change_bg_color: function (color) {\r\n        return mw.wysiwyg.change_bg_color(color);\r\n    },\r\n    change_border_color: function (color) {\r\n        return mw.wysiwyg.change_border_color(color);\r\n    },\r\n    change_shadow_color: function (color) {\r\n        return mw.wysiwyg.change_shadow_color(color);\r\n    },\r\n\r\n    add_link_to_menu: function () {\r\n\r\n    },\r\n    editlink: function (a, b) {\r\n        mw.wysiwyg.restore_selection();\r\n        var link = mw.wysiwyg.findTagAcrossSelection('a');\r\n        link.href = a;\r\n\r\n        mw.wysiwyg.change(link);\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","mw.require('selector.js');\r\n\r\nvar _handleInsertTargetDisplay;\r\nvar handleInsertTargetDisplay = function (target, pos) {\r\n     if(!_handleInsertTargetDisplay) {\r\n        _handleInsertTargetDisplay = mw.element('<div class=\"mw-handle-insert-target-display\" />');\r\n        mw.element(document.body).append(_handleInsertTargetDisplay);\r\n    }\r\n    if (target === 'hide'){\r\n       _handleInsertTargetDisplay\r\n           .removeClass('mw-handle-insert-target-display-top')\r\n           .removeClass('mw-handle-insert-target-display-bottom')\r\n           .hide();\r\n       return;\r\n    }   else {\r\n        _handleInsertTargetDisplay.show();\r\n    }\r\n\r\n    var $el = $(target);\r\n    var off = $el.offset();\r\n    var css = { left: off.left, width: $el.outerWidth()};\r\n    if (pos === 'top') {\r\n        css.top = off.top;\r\n    } else if(pos === 'bottom') {\r\n        css.top = off.top + $el.outerHeight();\r\n    }\r\n    _handleInsertTargetDisplay\r\n        .removeClass('mw-handle-insert-target-display-top')\r\n        .removeClass('mw-handle-insert-target-display-bottom')\r\n        .addClass(pos === 'top' ? 'mw-handle-insert-target-display-top' : 'mw-handle-insert-target-display-bottom')\r\n        .css(css);\r\n}\r\n\r\nvar dynamicModulesMenuTime = null;\r\nvar dynamicModulesMenu = function(e, el) {\r\n    if(!mw.inaccessibleModules){\r\n        mw.inaccessibleModules = document.createElement('div');\r\n        mw.inaccessibleModules.className = 'mw-ui-btn-nav mwInaccessibleModulesMenu';\r\n        document.body.appendChild(mw.inaccessibleModules);\r\n        mw.$(mw.inaccessibleModules).on('mouseenter', function(){\r\n            this._hovered = true;\r\n        }).on('mouseleave', function(){\r\n            this._hovered = false;\r\n        });\r\n    }\r\n\r\n    var $el;\r\n    if(e.type === 'moduleOver' || e.type === 'ModuleClick'){\r\n\r\n        var parentModule = mw.tools.lastParentWithClass(el, 'module');\r\n        var childModule = mw.tools.firstChildWithClass(el, 'module');\r\n\r\n        $el = mw.$(el);\r\n        if(!!parentModule && ( $el.offset().top - mw.$(parentModule).offset().top) < 10 ){\r\n            el.__disableModuleTrigger = parentModule;\r\n            $el.addClass('inaccessibleModule');\r\n        }\r\n        else if(!!childModule && ( mw.$(childModule).offset().top - $el.offset().top) < 10 ) {\r\n            childModule.__disableModuleTrigger = el;\r\n            mw.$(childModule).addClass('inaccessibleModule');\r\n        }\r\n        else{\r\n            $el.removeClass('inaccessibleModule');\r\n        }\r\n    }\r\n\r\n\r\n    var modules = mw.$(\".inaccessibleModule\", el);\r\n    if(modules.length === 0){\r\n        var parent = mw.tools.firstParentWithClass(el, 'module');\r\n        if(parent){\r\n            if(($el.offset().top - mw.$(parent).offset().top) < 10) {\r\n                modules = mw.$([el]);\r\n                el = parent;\r\n                $el = mw.$(el);\r\n\r\n            }\r\n        }\r\n    }\r\n    if (e.type === 'ModuleClick') {\r\n        mw.liveEditSelector.select(el);\r\n    }\r\n\r\n    if(modules.length && !mw.inaccessibleModules._hovered) {\r\n        mw.inaccessibleModules.innerHTML = '';\r\n    }\r\n    modules.each(function(){\r\n        var span = document.createElement('span');\r\n        span.className = 'mw-handle-item mw-ui-btn mw-ui-btn-small';\r\n        var type = mw.$(this).attr('data-type') || mw.$(this).attr('type');\r\n        if(type){\r\n            var title = mw.live_edit.registry[type] ? mw.live_edit.registry[type].title : type;\r\n            title = title.replace(/\\_/, ' ');\r\n            span.innerHTML = mw.live_edit.getModuleIcon(type) + title;\r\n            var el = this;\r\n            span.onclick = function(){\r\n                mw.tools.module_settings(el);\r\n            };\r\n            mw.inaccessibleModules.appendChild(span);\r\n        }\r\n    });\r\n    if(modules.length > 0){\r\n        var off = mw.$(el).offset();\r\n        if(mw.tools.collision(el, mw.handleModule.wrapper)){\r\n            off.top = parseFloat(mw.handleModule.wrapper.style.top);\r\n            off.left = parseFloat(mw.handleModule.wrapper.style.left);\r\n        }\r\n        mw.inaccessibleModules.style.top = off.top + 'px';\r\n        mw.inaccessibleModules.style.left = off.left + 'px';\r\n        clearTimeout(dynamicModulesMenuTime);\r\n        mw.$(mw.inaccessibleModules).show();\r\n    }\r\n    else{\r\n        dynamicModulesMenuTime = setTimeout(function(){\r\n            if(!mw.inaccessibleModules._hovered) {\r\n                mw.$(mw.inaccessibleModules).hide();\r\n            }\r\n\r\n        }, 3000);\r\n\r\n    }\r\n\r\n\r\n    return $el[0];\r\n\r\n};\r\n\r\nvar handleDomtreeSync = {};\r\n\r\nmw.Handle = function(options) {\r\n\r\n    this.options = options || {};\r\n\r\n    var scope = this;\r\n\r\n    this._visible = true;\r\n    this.visible = function () {\r\n        return this._visible;\r\n    };\r\n\r\n    this.createWrapper = function() {\r\n        this.wrapper = document.createElement('div');\r\n        this.wrapper.id = this.options.id || ('mw-handle-' + mw.random());\r\n        this.wrapper.className = 'mw-defaults mw-handle-item ' + (this.options.className || 'mw-handle-type-default');\r\n        this.wrapper.contenteditable = false;\r\n\r\n        mw.$(this.wrapper).on('mousedown', function () {\r\n            mw.tools.addClass(this, 'mw-handle-item-mouse-down');\r\n        });\r\n        mw.$(document).on('mouseup', function () {\r\n            mw.tools.removeClass(scope.wrapper, 'mw-handle-item-mouse-down');\r\n        });\r\n        document.body.appendChild(this.wrapper);\r\n    };\r\n\r\n    this.create = function() {\r\n        this.createWrapper();\r\n        this.createHandler();\r\n\r\n        this.createMenu();\r\n    };\r\n\r\n    this.setTitle = function (icon, title) {\r\n        this.handleIcon.innerHTML = icon;\r\n        this.handleTitle.innerHTML = title;\r\n    };\r\n\r\n    this.hide = function () {\r\n        mw.$(this.wrapper).hide().removeClass('active');\r\n        this._visible = false;\r\n        return this;\r\n    };\r\n\r\n    this.show = function () {\r\n        mw.$(this.wrapper).show();\r\n        this._visible = true;\r\n        return this;\r\n    };\r\n\r\n    this.createHandler = function(){\r\n        this.handle = document.createElement('span');\r\n        this.handleIcon = document.createElement('span');\r\n        this.handleTitle = document.createElement('span');\r\n        this.handle.className = 'mw-handle-handler';\r\n        this.handleIcon.dataset.tip = 'Drag to rearrange';\r\n        this.handleIcon.className = 'tip mw-handle-handler-icon';\r\n        this.handleTitle.className = 'mw-handle-handler-title';\r\n\r\n        this.handle.appendChild(this.handleIcon);\r\n        this.createButtons();\r\n        this.handle.appendChild(this.handleTitle);\r\n        this.wrapper.appendChild(this.handle);\r\n\r\n        this.handleTitle.onclick = function () {\r\n            mw.$(scope.wrapper).toggleClass('active');\r\n        };\r\n        mw.$(document.body).on('click', function (e) {\r\n            if(!mw.tools.hasParentWithId(e.target, scope.wrapper.id)){\r\n                mw.$(scope.wrapper).removeClass('active');\r\n            }\r\n        });\r\n    };\r\n\r\n    this.menuButton = function (data) {\r\n        var btn = document.createElement('span');\r\n        btn.className = 'mw-handle-menu-item';\r\n        if(data.icon) {\r\n            var iconClass = data.icon;\r\n            if (iconClass.indexOf('mdi-') === 0) {\r\n                iconClass = 'mdi ' + iconClass\r\n            }\r\n            var icon = document.createElement('span');\r\n            icon.className = iconClass + ' mw-handle-menu-item-icon';\r\n            btn.appendChild(icon);\r\n        }\r\n        btn.appendChild(document.createTextNode(data.title));\r\n        if(data.className){\r\n            btn.className += (' ' + data.className);\r\n        }\r\n        if(data.id){\r\n            btn.id = data.id;\r\n        }\r\n        if(data.action){\r\n            btn.onmousedown = function (e) {\r\n                e.preventDefault();\r\n            };\r\n            btn.onclick = function (e) {\r\n                e.preventDefault();\r\n                data.action.call(scope, e, this, data);\r\n                scope.hide()\r\n            };\r\n        }\r\n        return btn;\r\n    };\r\n\r\n    this._defaultButtons = [\r\n\r\n    ];\r\n\r\n    this.createMenuDynamicHolder = function(item){\r\n        var dn = document.createElement('div');\r\n        dn.className = 'mw-handle-menu-dynamic' + (item.className ? ' ' + item.className : '');\r\n        return dn;\r\n    };\r\n    this.createMenu = function(){\r\n        this.menu = document.createElement('div');\r\n        this.menu.className = 'mw-handle-menu ' + (this.options.menuClass ? this.options.menuClass : 'mw-handle-menu-default');\r\n        if (this.options.menu) {\r\n            for (var i = 0; i < this.options.menu.length; i++) {\r\n                if(this.options.menu[i].title !== '{dynamic}') {\r\n                    this.menu.appendChild(this.menuButton(this.options.menu[i])) ;\r\n                }\r\n                else {\r\n                    this.menu.appendChild(this.createMenuDynamicHolder(this.options.menu[i])) ;\r\n                }\r\n\r\n            }\r\n        }\r\n        this.wrapper.appendChild(this.menu);\r\n    };\r\n    this.createButton = function(obj){\r\n        var btn = document.createElement('span');\r\n        btn.className = 'tip mdi ' + obj.icon + (obj.className ? ' ' + obj.className : '');\r\n        btn.dataset.tip = obj.title;\r\n        if (obj.hover) {\r\n            btn.addEventListener('mouseenter', obj.hover[0] , false);\r\n            btn.addEventListener('mouseleave', obj.hover[1] , false);\r\n        }\r\n        btn.onclick = function () {\r\n            mw.tools.removeClass(this, 'active')\r\n            obj.action(this);\r\n            scope.hide();\r\n        };\r\n        return btn;\r\n    };\r\n\r\n    this.createButtons = function(){\r\n        this.buttonsHolder = document.createElement('div');\r\n        this.buttonsHolder.className = 'mw-handle-buttons';\r\n        if (this.options.buttons) {\r\n            for (var i = 0; i < this.options.buttons.length; i++) {\r\n                this.buttonsHolder.appendChild(this.createButton(this.options.buttons[i])) ;\r\n            }\r\n        }\r\n         this.handle.appendChild(this.buttonsHolder);\r\n    };\r\n    this.create();\r\n    this.hide();\r\n};\r\n\r\nmw._activeModuleOver = {\r\n    module: null,\r\n    element: null\r\n};\r\n\r\nmw._initHandles = {\r\n    getNodeHandler:function (node) {\r\n        if(mw._activeElementOver === node){\r\n            return mw.handleElement\r\n        } else if(mw._activeModuleOver === node) {\r\n            return mw.handleModule\r\n        } else if(mw._activeRowOver === node) {\r\n            return mw.handleColumns;\r\n        }\r\n    },\r\n    getAllNodes: function (but) {\r\n        var all = [\r\n            mw._activeModuleOver,\r\n            mw._activeRowOver,\r\n            mw._activeElementOver\r\n        ];\r\n        all = all.filter(function (item) {\r\n            return !!item && item.nodeType === 1;\r\n        });\r\n        return all;\r\n    },\r\n    getAll: function (but) {\r\n        var all = [\r\n            mw.handleModule,\r\n            mw.handleModuleActive,\r\n            mw.handleColumns,\r\n            mw.handleElement\r\n        ];\r\n        all = but ? all.filter(function (x) {\r\n            return x !== but;\r\n        }) :  all;\r\n        return all.filter(function (item) {\r\n            if(item){\r\n                return item.visible();\r\n            }\r\n\r\n        });\r\n    },\r\n    hideAll:function (but) {\r\n        this.getAll(but).forEach(function (item) {\r\n            item.hide();\r\n        });\r\n    },\r\n    collide: function(a, b) {\r\n        return !(\r\n            ((a.y + a.height) < (b.y)) ||\r\n            (a.y > (b.y + b.height)) ||\r\n            ((a.x + a.width) < b.x) ||\r\n            (a.x > (b.x + b.width))\r\n        );\r\n    },\r\n    _manageCollision: false,\r\n    manageCollision:function () {\r\n\r\n        var scope = this,\r\n            max = 35,\r\n            skip = [];\r\n\r\n        scope.getAll().forEach(function (curr) {\r\n            var master = curr, masterRect;\r\n            //if (skip.indexOf(master) === -1){\r\n            scope.getAll(curr).forEach(function (item) {\r\n                masterRect = master.wrapper.getBoundingClientRect();\r\n                var irect = item.wrapper.getBoundingClientRect();\r\n                if (scope.collide(masterRect, irect)) {\r\n                    skip.push(item);\r\n                    var topMore = item === mw.handleElement ? 10 : 0;\r\n                    item.wrapper.style.top = (parseInt(master.wrapper.style.top, 10) + topMore) + 'px';\r\n                    item.wrapper.style.left = ((parseInt(master.wrapper.style.left, 10) + masterRect.width) + 10) + 'px';\r\n                    master = curr;\r\n                }\r\n            });\r\n        });\r\n\r\n        var cloner = document.querySelector('.mw-cloneable-control');\r\n        if(cloner) {\r\n            scope.getAll().forEach(function (curr) {\r\n                masterRect = curr.wrapper.getBoundingClientRect();\r\n                var clonerect = cloner.getBoundingClientRect();\r\n\r\n                if (scope.collide(masterRect, clonerect)) {\r\n                    cloner.style.top = curr.wrapper.style.top;\r\n                    cloner.style.left = ((parseInt(curr.wrapper.style.left, 10) + masterRect.width) + 10) + 'px';\r\n                }\r\n            });\r\n        }\r\n    },\r\n\r\n    elements: function(){\r\n        mw.handleElement = new mw.Handle({\r\n            id: 'mw-handle-item-element',\r\n            className: 'mw-handle-type-default',\r\n            buttons: [\r\n                    {\r\n                        title: mw.lang('Insert'),\r\n                        icon: 'mdi-plus-circle',\r\n                        className: 'mw-handle-insert-button',\r\n                        hover: [\r\n                            function (e){  handleInsertTargetDisplay(mw._activeElementOver, mw.handleElement.positionedAt)  },\r\n                            function (e){  handleInsertTargetDisplay('hide')  }\r\n                        ],\r\n                        action: function (el) {\r\n                             if (!mw.tools.hasClass(el, 'active')) {\r\n                                mw.tools.addClass(el, 'active');\r\n                                mw.drag.plus.locked = true;\r\n                                mw.$('.mw-tooltip-insert-module').remove();\r\n                                mw.drag.plusActive = this === mw.drag.plusTop ? 'top' : 'bottom';\r\n\r\n                                var tooltip = new mw.ToolTip({\r\n                                    content: document.getElementById('plus-modules-list').innerHTML,\r\n                                    element: el,\r\n                                    position: mw.drag.plus.tipPosition(this.currentNode),\r\n                                    template: 'mw-tooltip-default mw-tooltip-insert-module',\r\n                                    id: 'mw-plus-tooltip-selector',\r\n                                    overlay: true\r\n                                });\r\n                                 tooltip.on('removed', function () {\r\n                                     mw.drag.plus.locked = false;\r\n                                 });\r\n                                 mw._initHandles.hideAll();\r\n\r\n                                var tip = tooltip.tooltip.get(0);\r\n                                setTimeout(function (){\r\n                                    $('#mw-plus-tooltip-selector').addClass('active').find('.mw-ui-searchfield').focus();\r\n                                }, 10);\r\n                                mw.tabs({\r\n                                    nav: tip.querySelectorAll('.mw-ui-btn'),\r\n                                    tabs: tip.querySelectorAll('.module-bubble-tab'),\r\n                                });\r\n\r\n                                mw.$('.mw-ui-searchfield', tip).on('input', function () {\r\n                                    var resultsLength = mw.drag.plus.search(this.value, tip);\r\n                                    if (resultsLength === 0) {\r\n                                        mw.$('.module-bubble-tab-not-found-message').html(mw.msg.no_results_for + ': <em>' + this.value + '</em>').show();\r\n                                    }\r\n                                    else {\r\n                                        mw.$(\".module-bubble-tab-not-found-message\").hide();\r\n                                    }\r\n                                });\r\n                                mw.$('#mw-plus-tooltip-selector li').each(function () {\r\n                                    this.onclick = function () {\r\n                                        var name = mw.$(this).attr('data-module-name');\r\n                                        var conf = { class: this.className };\r\n                                        if(name === 'layout') {\r\n                                            conf.template = mw.$(this).attr('template');\r\n                                        }\r\n                                        mw.module.insert(mw._activeElementOver, name, conf, mw.handleElement.positionedAt);\r\n                                        tooltip.remove();\r\n                                    };\r\n                                });\r\n                        }\r\n                    }\r\n                }\r\n            ],\r\n            menu: [\r\n                {\r\n                    title: 'Edit HTML',\r\n                    icon: 'mw-icon-code',\r\n                    action: function () {\r\n                        mw.editSource(mw._activeElementOver);\r\n                    }\r\n                },\r\n                {\r\n                    title: 'Edit Style',\r\n                    icon: 'mw-icon-edit',\r\n                    action: function () {\r\n                        mw.liveEditSettings.show();\r\n                        mw.sidebarSettingsTabs.set(3);\r\n                        if(mw.cssEditorSelector){\r\n                            mw.liveEditSelector.active(true);\r\n                            mw.liveEditSelector.select(mw._activeElementOver);\r\n                        } else{\r\n                            mw.$(mw.liveEditWidgets.cssEditorInSidebarAccordion()).on('load', function () {\r\n                                setTimeout(function(){\r\n                                    mw.liveEditSelector.active(true);\r\n                                    mw.liveEditSelector.select(mw._activeElementOver);\r\n                                }, 333);\r\n                            });\r\n                        }\r\n                        mw.liveEditWidgets.cssEditorInSidebarAccordion();\r\n                    }\r\n                },\r\n                {\r\n                    title: 'Remove',\r\n                    icon: 'mw-icon-bin',\r\n                    className:'mw-handle-remove',\r\n                    action: function () {\r\n                        mw.drag.delete_element(mw._activeElementOver);\r\n                        mw.handleElement.hide()\r\n                    }\r\n                }\r\n            ]\r\n        });\r\n\r\n        mw.$(mw.handleElement.wrapper).on('mouseenter', function () {\r\n            mw.liveEditSelector.select(mw._activeElementOver);\r\n        });\r\n        mw.$(mw.handleElement.wrapper).draggable({\r\n            handle: mw.handleElement.handleIcon,\r\n            cursorAt: {\r\n                //top: -30\r\n            },\r\n            start: function() {\r\n                mw.isDrag = true;\r\n                mw.dragCurrent = mw.ea.data.currentGrabbed = mw._activeElementOver;\r\n\r\n                handleDomtreeSync.start = mw.dragCurrent.parentNode;\r\n\r\n                if(!mw.dragCurrent.id){\r\n                    mw.dragCurrent.id = 'element_' + mw.random();\r\n                }\r\n                mw.$(mw.dragCurrent).invisible().addClass(\"mw_drag_current\");\r\n                mw.trigger(\"AllLeave\");\r\n                mw.drag.fix_placeholders();\r\n                mw.$(document.body).addClass(\"dragStart\");\r\n                mw.image_resizer._hide();\r\n                mw.wysiwyg.change(mw.dragCurrent);\r\n                mw.smallEditor.css(\"visibility\", \"hidden\");\r\n                mw.smallEditorCanceled = true;\r\n            },\r\n            stop: function() {\r\n                mw.$(document.body).removeClass(\"dragStart\");\r\n\r\n                if(mw.liveEditDomTree) {\r\n                    mw.liveEditDomTree.refresh(handleDomtreeSync.start)\r\n                }\r\n            }\r\n        });\r\n\r\n        mw.$(mw.handleElement.wrapper).on('click', function() {\r\n            if (!$(mw._activeElementOver).hasClass(\"element-current\")) {\r\n                mw.$(\".element-current\").removeClass(\"element-current\");\r\n\r\n                if (mw._activeElementOver.nodeName === 'IMG') {\r\n\r\n                    mw.trigger(\"ImageClick\", mw._activeElementOver);\r\n                } else {\r\n                    mw.trigger(\"ElementClick\", mw._activeElementOver);\r\n                }\r\n            }\r\n\r\n        });\r\n\r\n        mw.on(\"ElementOver\", function(a, element, originalEvent) {\r\n            mw._activeElementOver = element;\r\n            mw.$(\".mw_edit_delete, .mw_edit_delete_element, .mw-sorthandle-moveit, .column_separator_title\").show();\r\n            if (!mw.ea.canDrop(element)) {\r\n                mw.$(\".mw_edit_delete, .mw_edit_delete_element, .mw-sorthandle-moveit, .column_separator_title\").hide();\r\n                return false;\r\n            }\r\n            var el = mw.$(element);\r\n\r\n            var o = el.offset();\r\n\r\n            var pleft = parseFloat(el.css(\"paddingLeft\"));\r\n            var left_spacing = o.left;\r\n            if (mw.tools.hasClass(element, 'jumbotron')) {\r\n                left_spacing = left_spacing + pleft;\r\n\r\n            }\r\n            // Centered: left_spacing += (el.width()/2 - mw.handleElement.wrapper.offsetWidth/2);\r\n            if(left_spacing<0){\r\n                left_spacing = 0;\r\n            }\r\n            //todo: another icon\r\n            var isSafe = false; // mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(element, ['safe-mode', 'regular-mode']);\r\n            var _icon = isSafe ? '<svg  xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 504.03 440\" height=\"17\" class=\"safe-element-svg\"><path fill=\"green\" d=\"M252,2.89C178.7,2.89,102.4,19.44,102.4,19.44A31.85,31.85,0,0,0,76.76,50.69v95.59c0,165.67,159.7,234.88,159.7,234.88A31.65,31.65,0,0,0,252,385.27a32.05,32.05,0,0,0,15.56-4.11c.06,0,159.69-69.21,159.69-234.88V50.69a31.82,31.82,0,0,0-25.64-31.25S325.33,2.89,252,2.89Zm95.59,95.59a15.94,15.94,0,0,1,11.26,27.2L238.45,246.11a16,16,0,0,1-11.33,4.73,15.61,15.61,0,0,1-11.2-4.73l-55-55a15.93,15.93,0,0,1,22.53-22.53l43.69,43.82L336.34,103.15a16,16,0,0,1,11.27-4.67Zm0,0\"/></svg>' : '<span class=\"mdi mdi-drag tip\" data-tip=\"' + mw.lang('') + '\"></span>';\r\n\r\n            var icon = '<span class=\"mw-handle-element-title-icon '+(isSafe ? 'tip' : '')+'\"  '+(isSafe ? ' data-tip=\"Current element is protected \\n  from accidental deletion\" data-tipposition=\"top-left\"' : '')+' >'+ _icon +'</span>';\r\n\r\n            var title = '<i class=\"mdi mdi-cog mw-handle-handler-settings-icon\"></i>';\r\n\r\n            mw.handleElement.setTitle(icon, title);\r\n\r\n            if(el.hasClass('allow-drop')){\r\n                mw.handleElement.hide();\r\n            } else{\r\n                mw.handleElement.show();\r\n            }\r\n            mw.handleElement.positionedAt = 'top';\r\n            var posTop = o.top - 30;\r\n            var elHeight = el.height();\r\n            if (originalEvent.pageY > (o.top + elHeight/2)) {\r\n                posTop = o.top + elHeight;\r\n                mw.handleElement.positionedAt = 'bottom';\r\n            }\r\n\r\n            mw.$(mw.handleElement.wrapper).css({\r\n                top: posTop,\r\n                left: left_spacing\r\n            }).removeClass('active');\r\n\r\n            if(!element.id) {\r\n                element.id = \"element_\" + mw.random();\r\n            }\r\n\r\n            mw.dropable.removeClass(\"mw_dropable_onleaveedit\");\r\n            mw._initHandles.manageCollision();\r\n\r\n        });\r\n\r\n\r\n    },\r\n    modules: function () {\r\n        var handlesModulesButtons = [\r\n            {\r\n                title: mw.lang('Edit'),\r\n                icon: 'mdi-pencil',\r\n                action: function () {\r\n                    mw.drag.module_settings(mw._activeModuleOver,\"admin\");\r\n                    mw.handleModule.hide();\r\n                }\r\n            },\r\n            {\r\n                title: mw.lang('Insert'),\r\n                className: 'mw-handle-insert-button',\r\n                icon: 'mdi-plus-circle',\r\n                hover: [\r\n                    function (e) {\r\n                        handleInsertTargetDisplay(mw._activeModuleOver, mw.handleModule.positionedAt);\r\n                    },\r\n                    function (e) {\r\n                        handleInsertTargetDisplay('hide');\r\n                    }\r\n                ],\r\n                action: function (node) {\r\n                    if(mw.handleModule.isLayout) {\r\n                        mw.layoutPlus.showSelectorUI(node);\r\n                    } else {\r\n                        mw.drag.plus.rendModules(node);\r\n                    }\r\n\r\n                }\r\n            },\r\n        ];\r\n\r\n        var handlesModuleConfig = {\r\n            id: 'mw-handle-item-module',\r\n            buttons: handlesModulesButtons,\r\n            menu: [\r\n                {\r\n                    title: mw.lang('Edit'),\r\n                    icon: 'mdi-pencil',\r\n                    action: function () {\r\n                        mw.drag.module_settings(mw._activeModuleOver,\"admin\");\r\n                        mw.handleModule.hide();\r\n                    }\r\n                },\r\n                {\r\n                    title: 'Move Up',\r\n                    icon: 'mdi mdi-chevron-double-up',\r\n                    className:'mw_handle_module_up',\r\n                    action: function () {\r\n                        mw.drag.replace($(mw._activeModuleOver), 'prev');\r\n                        mw.handleModule.hide()\r\n                    }\r\n                },\r\n                {\r\n                    title: 'Move Down',\r\n                    icon: 'mdi mdi-chevron-double-down',\r\n                    className:'mw_handle_module_down',\r\n                    action: function () {\r\n                        mw.drag.replace($(mw._activeModuleOver), 'next');\r\n                        mw.handleModule.hide()\r\n                    }\r\n                },\r\n                {\r\n                    title: '{dynamic}',\r\n                    className:'mw_handle_module_submodules'\r\n                },\r\n                {\r\n                    title: '{dynamic}',\r\n                    className:'mw_handle_module_spacing'\r\n                },\r\n                {\r\n                    title: 'Reset',\r\n                    icon: 'mw-icon-reload',\r\n                    className:'mw-handle-remove',\r\n                    action: function () {\r\n                        if(mw._activeModuleOver && mw._activeModuleOver.id){\r\n                            mw.tools.confirm_reset_module_by_id(mw._activeModuleOver.id)\r\n                        }\r\n                    }\r\n                },\r\n                {\r\n                    title: 'Remove',\r\n                    icon: 'mw-icon-bin',\r\n                    className:'mw-handle-remove',\r\n                    action: function () {\r\n                        mw.drag.delete_element(mw._activeModuleOver);\r\n                        mw.handleModule.hide();\r\n                    }\r\n                }\r\n            ]\r\n        };\r\n        var handlesModuleConfigActive = {\r\n            id: 'mw-handle-item-module-active',\r\n            buttons: handlesModulesButtons,\r\n            menu: [\r\n                {\r\n                    title: 'Settings',\r\n                    icon: 'mw-icon-gear',\r\n                    action: function () {\r\n                        mw.drag.module_settings(getActiveDragCurrent(),\"admin\");\r\n                        $(mw.handleModuleActive.wrapper).removeClass('active');\r\n                    }\r\n                },\r\n                {\r\n                    title: 'Move Up',\r\n                    icon: 'mdi mdi-chevron-double-up',\r\n                    className:'mw_handle_module_up',\r\n                    action: function () {\r\n                        mw.drag.replace($(getActiveDragCurrent()), 'prev');\r\n                    }\r\n                },\r\n                {\r\n                    title: 'Move Down',\r\n                    icon: 'mdi mdi-chevron-double-down',\r\n                    className:'mw_handle_module_down',\r\n                    action: function () {\r\n                        mw.drag.replace($(getActiveDragCurrent()), 'next');\r\n                    }\r\n                },\r\n                {\r\n                    title: '{dynamic}',\r\n                    className:'mw_handle_module_submodules'\r\n                },\r\n                {\r\n                    title: '{dynamic}',\r\n                    className:'mw_handle_module_spacing'\r\n                },\r\n                {\r\n                    title: 'Reset',\r\n                    icon: 'mw-icon-reload',\r\n                    className:'mw-handle-remove',\r\n                    action: function () {\r\n                        if(mw._activeModuleOver && mw._activeModuleOver.id){\r\n                            mw.tools.confirm_reset_module_by_id(mw._activeModuleOver.id)\r\n                        }\r\n                    }\r\n                },\r\n                {\r\n                    title: 'Remove',\r\n                    icon: 'mw-icon-bin',\r\n                    className:'mw-handle-remove',\r\n                    action: function () {\r\n                        mw.drag.delete_element(getActiveDragCurrent());\r\n                        mw.handleModuleActive.hide();\r\n                    }\r\n                }\r\n            ]\r\n        };\r\n\r\n        var getActiveDragCurrent = function () {\r\n            //var el = mw.liveEditSelector && mw.liveEditSelector.selected ?  mw.liveEditSelector.selected[0] : null;\r\n            var el = mw.liveEditSelector.activeModule;\r\n            if (el && el.nodeType === 1) {\r\n                return el;\r\n            }\r\n            if(mw.handleModuleActive._target) {\r\n                return mw.handleModuleActive._target;\r\n            }\r\n        };\r\n\r\n        var getDragCurrent = function () {\r\n            if(mw._activeModuleOver){\r\n                return mw._activeModuleOver;\r\n            }\r\n        };\r\n        var dragConfig = function (curr, handle) {\r\n            return {\r\n                handle: handle.handleIcon,\r\n                distance:20,\r\n                cursorAt: {\r\n                    //top: -30\r\n                },\r\n                start: function() {\r\n                    mw.isDrag = true;\r\n                    mw.dragCurrent = curr();\r\n                    handleDomtreeSync.start = mw.dragCurrent.parentNode;\r\n                    if (!mw.dragCurrent.id) {\r\n                        mw.dragCurrent.id = 'module_' + mw.random();\r\n                    }\r\n                    if(mw.liveEditTools.isLayout(mw.dragCurrent)){\r\n                        mw.$(mw.dragCurrent).css({\r\n                            opacity:0\r\n                        }).addClass(\"mw_drag_current\");\r\n                    } else {\r\n                        mw.$(mw.dragCurrent).invisible().addClass(\"mw_drag_current\");\r\n                    }\r\n\r\n                    mw.trigger(\"AllLeave\");\r\n                    mw.drag.fix_placeholders();\r\n                    mw.$(document.body).addClass(\"dragStart\");\r\n                    mw.image_resizer._hide();\r\n                    mw.wysiwyg.change(mw.dragCurrent);\r\n                    mw.smallEditor.css(\"visibility\", \"hidden\");\r\n                    mw.smallEditorCanceled = true;\r\n                },\r\n                stop: function() {\r\n                    mw.$(document.body).removeClass(\"dragStart\");\r\n                    if(mw.liveEditDomTree) {\r\n                        mw.liveEditDomTree.refresh(handleDomtreeSync.start)\r\n                    }\r\n                }\r\n            };\r\n        };\r\n\r\n        mw.handleModule = new mw.Handle(handlesModuleConfig);\r\n        mw.handleModuleActive = new mw.Handle(handlesModuleConfigActive);\r\n\r\n        mw.handleModule.type = 'hover';\r\n        mw.handleModuleActive.type = 'active';\r\n\r\n        mw.handleModule._hideTime = null;\r\n        mw\r\n            .$(mw.handleModule.wrapper)\r\n            .draggable(dragConfig(getDragCurrent, mw.handleModule))\r\n            .on(\"mousedown\", function(e){\r\n                mw.liveEditSelectMode = 'none';\r\n            });\r\n\r\n\r\n        mw\r\n            .$(mw.handleModuleActive.wrapper)\r\n            .draggable(dragConfig(getActiveDragCurrent, mw.handleModuleActive))\r\n            .on(\"mousedown\", function(e){\r\n                mw.liveEditSelectMode = 'none';\r\n            });\r\n\r\n\r\n        var positionModuleHandle = function(e, pelement, handle, event){\r\n\r\n            handle._element = pelement\r\n\r\n            var element ;\r\n\r\n            if(handle.type === 'hover') {\r\n                element = dynamicModulesMenu(e, pelement) || pelement;\r\n                mw._activeModuleOver = element;\r\n            } else {\r\n                //pelement = mw.tools.lastMatchesOnNodeOrParent(pelement, ['.module']);\r\n\r\n                element = dynamicModulesMenu(e, pelement) || pelement;\r\n                handle._target = pelement;\r\n            }\r\n\r\n\r\n\r\n            mw.$(\".mw-handle-menu-dynamic\", handle.wrapper).empty();\r\n            mw.$('.mw_handle_module_up,.mw_handle_module_down').hide();\r\n            var $el, hasedit;\r\n            var isLayout = element && element.getAttribute('data-type') === 'layouts';\r\n            handle.isLayout = isLayout;\r\n            handle.handle.classList[isLayout ? 'add' : 'remove']('mw-handle-target-layout');\r\n            if(isLayout){\r\n\r\n                $el = mw.$(element);\r\n                hasedit = mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst($el[0].parentNode,['edit', 'module']);\r\n\r\n                if(hasedit){\r\n                    if($el.prev('[data-type=\"layouts\"]')[0]){\r\n                        mw.$('.mw_handle_module_up').show();\r\n                    }\r\n                    if($el.next('[data-type=\"layouts\"]')[0]){\r\n                        mw.$('.mw_handle_module_down').show();\r\n                    }\r\n                }\r\n            }\r\n\r\n            var el = mw.$(element);\r\n            var o = el.offset();\r\n            var width = el.width();\r\n            var pleft = parseFloat(el.css(\"paddingLeft\"));\r\n\r\n            var lebar =  document.querySelector(\"#live_edit_toolbar\");\r\n            var minTop = lebar ? lebar.offsetHeight : 0;\r\n            if(mw.templateTopFixed) {\r\n                var ex = document.querySelector(mw.templateTopFixed);\r\n                if(ex && !ex.contains(el[0])){\r\n                    minTop += ex.offsetHeight;\r\n                }\r\n            }\r\n\r\n            var marginTop =  30;\r\n            var topPos = o.top;\r\n\r\n            if(topPos<minTop){\r\n                topPos = minTop;\r\n                marginTop = 0\r\n            }\r\n            var ws = mw.$(window).scrollTop();\r\n            if(topPos<(ws+minTop)){\r\n                topPos=(ws+minTop);\r\n                // marginTop =  -15;\r\n                if(el[0].offsetHeight <100){\r\n                    topPos = o.top+el[0].offsetHeight;\r\n                    marginTop =  0;\r\n                }\r\n            }\r\n\r\n            var handleLeft = o.left + pleft;\r\n            if (handleLeft < 0) {\r\n                handleLeft = 0;\r\n            }\r\n\r\n            var topPosFinal = topPos //+ marginTop;\r\n            var $lebar = mw.$(lebar), $leoff = $lebar.offset();\r\n\r\n            var outheight = el.outerHeight();\r\n\r\n            if(topPosFinal < ($leoff.top + $lebar.height())){\r\n                topPosFinal = (o.top + outheight) - (outheight > 100 ? 0 : handle.wrapper.clientHeight);\r\n            }\r\n\r\n            if(el.attr('data-type') === 'layouts') {\r\n                topPosFinal = o.top + 10;\r\n                handleLeft = handleLeft + 10;\r\n            }\r\n            var elHeight = el.height();\r\n\r\n            handle.positionedAt = 'top';\r\n            if (event.pageY > (o.top + elHeight/2)) {\r\n                topPosFinal += elHeight;\r\n                handle.positionedAt = 'bottom';\r\n            }\r\n\r\n            clearTimeout(handle._hideTime);\r\n            handle.show();\r\n            mw.$(handle.wrapper)\r\n                .removeClass('active')\r\n                .css({\r\n                    top: topPosFinal,\r\n                    left: handleLeft,\r\n                    //width: width,\r\n                    //marginTop: marginTop\r\n                }).addClass('mw-active-item');\r\n\r\n\r\n\r\n\r\n            var canDrag = mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(element.parentNode, ['edit', 'module'])\r\n                && mw.tools.parentsOrCurrentOrderMatchOrOnlyFirstOrNone(element, ['allow-drop', 'nodrop']);\r\n            if(canDrag){\r\n                mw.$(handle.wrapper).removeClass('mw-handle-no-drag');\r\n            } else {\r\n                mw.$(handle.wrapper).addClass('mw-handle-no-drag');\r\n            }\r\n            if ( !el ) {\r\n                return;\r\n            }\r\n            var title = el.dataset(\"mw-title\");\r\n            var id = el.attr(\"id\");\r\n\r\n\r\n\r\n            var module_type = (el.dataset(\"type\") || el.attr(\"type\"));\r\n            if(typeof(module_type) == 'undefined'){\r\n                return;\r\n            }\r\n\r\n            var cln = el[0].querySelector('.cloneable');\r\n            if(cln || mw.tools.hasClass(el[0], 'cloneable')){\r\n                if(($(cln).offset().top - el.offset().top) < 20){\r\n                    mw.tools.addClass(mw.drag._onCloneableControl, 'mw-module-near-cloneable');\r\n                } else {\r\n                    mw.tools.removeClass(mw.drag._onCloneableControl, 'mw-module-near-cloneable');\r\n                }\r\n            }\r\n\r\n            var mod_icon = mw.live_edit.getModuleIcon(module_type);\r\n            var mod_handle_title = (title ? title : mw.msg.settings);\r\n            /*if(module_type === 'layouts'){\r\n                mod_handle_title = '';\r\n            }*/\r\n\r\n            handle.setTitle(mod_icon, mod_handle_title);\r\n            handle.handleTitle.dataset.tip = mw.lang('Module') + ': ' + mod_handle_title\r\n            handle.handleTitle.classList.add('tip');\r\n             if(!handle) {\r\n                return;\r\n            }\r\n\r\n            mw.tools.classNamespaceDelete(handle, 'module-active-');\r\n            mw.tools.addClass(handle, 'module-active-' + module_type.replace(/\\//g, '-'));\r\n\r\n            if (mw.live_edit_module_settings_array && mw.live_edit_module_settings_array[module_type]) {\r\n\r\n                var new_el = document.createElement('div');\r\n                new_el.className = 'mw_edit_settings_multiple_holder';\r\n\r\n                var settings = mw.live_edit_module_settings_array[module_type];\r\n                mw.$(settings).each(function () {\r\n                    if (this.view) {\r\n                        var new_el = document.createElement('a');\r\n                        new_el.className = 'mw_edit_settings_multiple';\r\n                        new_el.title = this.title;\r\n                        new_el.draggable = 'false';\r\n                        var btn_id = 'mw_edit_settings_multiple_btn_' + mw.random();\r\n                        new_el.id = btn_id;\r\n                        if (this.type && this.type === 'tooltip') {\r\n                            new_el.href = 'javascript:mw.drag.current_module_settings_tooltip_show_on_element(\"' + btn_id + '\",\"' + this.view + '\", \"tooltip\"); void(0);';\r\n\r\n                        } else {\r\n                            new_el.href = 'javascript:mw.drag.module_settings(undefined,\"' + this.view + '\"); void(0);';\r\n                        }\r\n                        var icon = '';\r\n                        if (this.icon) {\r\n                            icon = '<i class=\"mw-edit-module-settings-tooltip-icon ' + this.icon + '\"></i>';\r\n                        }\r\n                        new_el.innerHTML =  (icon + '<span class=\"mw-edit-module-settings-tooltip-btn-title\">' + this.title+'</span>');\r\n                        mw.$(\".mw_handle_module_spacing\", handle.wrapper).append(new_el);\r\n                    }\r\n                });\r\n            } else {\r\n\r\n            }\r\n\r\n            /*************************************/\r\n\r\n\r\n            if(!element.id) {\r\n                element.id = \"module_\" + mw.random();\r\n            }\r\n            mw._initHandles.manageCollision();\r\n        };\r\n\r\n        mw.on('ModuleClick', function(e, pelement, event){\r\n            mw.handleModule.hide();\r\n            positionModuleHandle(e, pelement, mw.handleModuleActive, event);\r\n\r\n        });\r\n\r\n        mw.on('moduleOver', function (e, pelement, event) {\r\n            if(mw.handleModuleActive._element === pelement) {\r\n                return;\r\n            }\r\n            positionModuleHandle(e, pelement, mw.handleModule, event);\r\n            if(mw._activeModuleOver === mw.handleModuleActive._target) {\r\n                mw.handleModule.hide();\r\n            }\r\n\r\n            var nodes = [];\r\n            mw.$('.module', pelement).each(function () {\r\n\r\n                var type = this.getAttribute('data-type');\r\n\r\n                var hastitle = mw.live_edit.registry[type] ? mw.live_edit.registry[type].title : false;\r\n                var icon = mw.live_edit.getModuleIcon(type);\r\n                if(!icon){\r\n                    icon  = '<span class=\"mw-icon-gear mw-handle-menu-item-icon\"></span>';\r\n                }\r\n                if (hastitle) {\r\n                    var menuitem = '<span class=\"mw-handle-menu-item dynamic-submodule-handle\" data-module=\"'+this.id+'\">'\r\n                        + icon\r\n                        + hastitle.replace(/_/g, ' ')\r\n                        + '</span>';\r\n                    nodes.push(menuitem);\r\n                }\r\n\r\n            });\r\n            var el = mw.$('.mw_handle_module_submodules');\r\n            el.empty();\r\n            $.each(nodes, function () {\r\n                el.append(this);\r\n            });\r\n            mw.$('.text-background', pelement).each(function () {\r\n                var bgEl = this;\r\n                $.each([0,1], function(i){\r\n                    var icon  = '<span class=\"mw-icon-gear mw-handle-menu-item-icon\"></span>';\r\n                    var menuitem = document.createElement('span');\r\n                    menuitem.className = 'mw-handle-menu-item text-background-handle';\r\n                    menuitem.innerHTML = icon + 'background text';\r\n                    menuitem.__for = bgEl;\r\n                    // menuitem = mw.$(menuitem);\r\n                    el.eq(i).append(menuitem)\r\n                })\r\n\r\n            });\r\n\r\n\r\n            mw.$('.text-background-handle').on('click', function () {\r\n                var ok = mw.$('<button class=\"mw-ui-btn mw-ui-btn-medium mw-ui-btn-info pull-right\">OK</button>');\r\n                var cancel = mw.$('<button class=\"mw-ui-btn mw-ui-btn-medium pull-left\">Cancel</button>');\r\n                var footer = mw.$('<div></div>');\r\n                var area = $('<textarea class=\"mw-ui-field w100\" style=\"height: 200px\"/>');\r\n                var node = this.__for;\r\n                area.val(mw.$(node).html());\r\n                footer.append(cancel);\r\n                footer.append(ok);\r\n                var dialog = mw.dialog({\r\n                    content: area,\r\n                    footer: footer\r\n                });\r\n                ok.on('click', function () {\r\n                    mw.liveEditState.record({\r\n                        target: node,\r\n                        value: node.innerHTML\r\n                    });\r\n                    mw.$(node).html(area.val());\r\n                    dialog.remove();\r\n                    mw.liveEditState.record({\r\n                        target: node,\r\n                        value: node.innerHTML\r\n                    });\r\n                });\r\n                cancel.on('click', function () {\r\n                    dialog.remove();\r\n                });\r\n            });\r\n            mw.$('.dynamic-submodule-handle').on('click', function () {\r\n                mw.tools.module_settings('#' + this.dataset.module);\r\n            });\r\n        });\r\n    },\r\n    columns:function(){\r\n        mw.handleColumns = new mw.Handle({\r\n            id: 'mw-handle-item-columns',\r\n            // className:'mw-handle-type-element',\r\n            menu:[\r\n                {\r\n                    title: 'One column',\r\n                    action: function () {\r\n                        mw.drag.create_columns(this,1);\r\n                    }\r\n                },\r\n                {\r\n                    title: '2 columns',\r\n                    action: function () {\r\n                        mw.drag.create_columns(this,2);\r\n                    }\r\n                },\r\n                {\r\n                    title: '3 columns',\r\n                    action: function () {\r\n                        mw.drag.create_columns(this,3);\r\n                    }\r\n                },\r\n                {\r\n                    title: '4 columns',\r\n                    action: function () {\r\n                        mw.drag.create_columns(this,4);\r\n                    }\r\n                },\r\n                {\r\n                    title: '5 columns',\r\n                    action: function () {\r\n                        mw.drag.create_columns(this,5);\r\n                    }\r\n                },\r\n                {\r\n                    title: 'Remove',\r\n                    icon: 'mw-icon-bin',\r\n                    className:'mw-handle-remove',\r\n                    action: function () {\r\n                        mw.drag.delete_element(mw._activeRowOver, function () {\r\n                            mw.$(mw.drag.columns.resizer).hide();\r\n                            mw.handleColumns.hide();\r\n                        });\r\n                    }\r\n                }\r\n            ]\r\n        });\r\n        mw.handleColumns.setTitle('<span class=\"mw-handle-columns-icon\"></span>', '');\r\n\r\n        mw.$(mw.handleColumns.wrapper).draggable({\r\n            handle: mw.handleColumns.handleIcon,\r\n            cursorAt: {\r\n                //top: -30\r\n            },\r\n            start: function() {\r\n                mw.isDrag = true;\r\n                var curr = mw._activeRowOver ;\r\n                mw.dragCurrent = mw.ea.data.currentGrabbed = curr;\r\n                handleDomtreeSync.start = mw.dragCurrent.parentNode;\r\n                mw.dragCurrent.id == \"\" ? mw.dragCurrent.id = 'element_' + mw.random() : '';\r\n                mw.$(mw.dragCurrent).invisible().addClass(\"mw_drag_current\");\r\n                mw.trigger(\"AllLeave\");\r\n                mw.drag.fix_placeholders();\r\n                mw.$(document.body).addClass(\"dragStart\");\r\n                mw.image_resizer._hide();\r\n                mw.wysiwyg.change(mw.dragCurrent);\r\n                mw.smallEditor.css(\"visibility\", \"hidden\");\r\n                mw.smallEditorCanceled = true;\r\n                mw.$(mw.drag.columns.resizer).hide()\r\n            },\r\n            stop: function() {\r\n                mw.$(document.body).removeClass(\"dragStart\");\r\n                if(mw.liveEditDomTree) {\r\n                    mw.liveEditDomTree.refresh(handleDomtreeSync.start)\r\n                }\r\n            }\r\n        });\r\n\r\n        mw.on(\"RowOver\", function(a, element) {\r\n\r\n            mw._activeRowOver = element;\r\n            var el = mw.$(element);\r\n            var o = el.offset();\r\n            var htop = o.top - 35;\r\n            var left = o.left;\r\n\r\n            if (htop < 55 && document.getElementById('live_edit_toolbar') !== null) {\r\n                htop = 55;\r\n                left = left - 100;\r\n            }\r\n            if (htop < 0 && document.getElementById('live_edit_toolbar') === null) {\r\n                htop = 0;\r\n            }\r\n\r\n\r\n            mw.handleColumns.show()\r\n\r\n            mw.$(mw.handleColumns.wrapper).css({\r\n                top: htop,\r\n                left: left,\r\n                //width: width\r\n            });\r\n            mw._initHandles.manageCollision();\r\n\r\n            var size = mw.$(element).children(\".mw-col\").length;\r\n            mw.$(\"a.mw-make-cols\").removeClass(\"active\");\r\n            mw.$(\"a.mw-make-cols\").eq(size - 1).addClass(\"active\");\r\n            if(!element.id){\r\n                element.id = \"element_row_\" + mw.random() ;\r\n            }\r\n\r\n\r\n\r\n\r\n        });\r\n    },\r\n    nodeLeave: function () {\r\n        var scope = this;\r\n\r\n        mw.on(\"ElementLeave\", function(e, target) {\r\n            mw.handleElement.hide();\r\n        });\r\n        mw.on(\"ModuleLeave\", function(e, target) {\r\n            clearTimeout(mw.handleModule._hideTime);\r\n            mw.handleModule._hideTime = setTimeout(function () {\r\n                mw.handleModule.hide();\r\n            }, 3000);\r\n\r\n            //.removeClass('mw-active-item');\r\n        });\r\n        mw.on(\"RowLeave\", function(e, target) {\r\n            //mw.handleColumns.hide();\r\n        });\r\n    }\r\n};\r\n\r\n\r\n\r\n\r\n$(document).ready(function () {\r\n\r\n    mw._initHandles.modules();\r\n    mw._initHandles.elements();\r\n    mw._initHandles.columns();\r\n    mw._initHandles.nodeLeave();\r\n\r\n\r\n\r\n});\r\n","mw.liveedit.initLoad = function() {\n    setTimeout(function(){\n        mw.$(\".mw-dropdown_type_navigation a\").each(function() {\n            var el = mw.$(this);\n            var li = el.parent();\n            el.attr(\"href\", \"javascript:;\");\n            var val = li.dataset(\"category-id\");\n            li.attr(\"value\", val);\n        });\n\n        mw.$(\"#module_category_selector\").change(function() {\n            var val = mw.$(this).getDropdownValue();\n\n            if (val === 'all') {\n                mw.$(\".list-modules li\").show();\n                return false;\n            }\n            (val !== -1 && val !== \"-1\") ? mw.liveedit.toolbar_sorter(Modules_List_modules, val): '';\n        });\n        mw.$(\"#elements_category_selector\").change(function() {\n            var val = mw.$(this).getDropdownValue();\n\n            if (val === 'all') {\n                mw.$(\".list-elements li\").show();\n                return false;\n            }\n            (val !== -1 && val !== \"-1\") ? mw.liveedit.toolbar_sorter(Modules_List_elements, val): '';\n        });\n\n\n\n\n        mw.interval('regular-mode', function(){\n            // mw.$('.row').addClass('nodrop');\n            // mw.$('.row .col, .row [class*=\"col-\"]').addClass('allow-drop');\n            // mw.$('.nodrop .allow-drop').addClass('regular-mode');\n            mw.$('.safe-element[class*=\"mw-micon-\"]').removeClass('safe-element');\n        })\n\n    }, 100);\n\n\n    mw.wysiwyg.prepareContentEditable();\n\n    mw.image.resize.init(\".element-image\");\n    mw.$(document.body).on('mousedown touchstart', function(event) {\n\n\n        if (mw.$(\".editor_hover\").length === 0) {\n            mw.$(mw.wysiwyg.external).empty().css(\"top\", \"-9999px\");\n            mw.$(document.body).removeClass('hide_selection');\n        }\n        if (!mw.tools.hasClass(event.target, 'mw_handle_row') &&\n            !mw.tools.hasParentsWithClass(event.target, 'mw_handle_row') &&\n            !mw.tools.hasClass(event.target, 'mw-row') &&\n            !mw.tools.hasParentsWithClass(event.target, 'mw-row')) {\n\n            mw.$(\".mw-row\").each(function() {\n                this.clicked = false;\n            });\n        }\n        if (mw.tools.hasClass(event.target, 'mw-row')) {\n            mw.$(\".mw-row\").each(function() {\n                if (this !== event.target) {\n                    this.clicked = false;\n                }\n            });\n            event.target.clicked = true;\n        } else if (mw.tools.hasParentsWithClass(event.target, 'mw-row')) {\n            var row = mw.tools.firstParentWithClass(event.target, 'mw-row');\n            mw.$(\".mw-row\").each(function() {\n                if (this !== row) {\n                    this.clicked = false;\n                }\n            });\n            row.clicked = true;\n        }\n    });\n\n\n    mw.$(document.body).on('mouseup touchend',function(event) {\n        mw.target.item = event.target;\n        mw.target.tag = event.target.tagName.toLowerCase();\n        mw.mouseDownOnEditor = false;\n        mw.SmallEditorIsDragging = false;\n        if (!mw.image.isResizing &&\n            mw.target.tag !== 'img' &&\n            event.target !== mw.image_resizer && !mw.tools.hasClass(mw.target.item.className, 'image_change') && !mw.tools.hasClass(mw.target.item.parentNode.className, 'image_change') && mw.$(mw.image_resizer).hasClass(\"active\")) {\n            mw.image_resizer._hide();\n        }\n    });\n\n    mw.liveedit.toolbar.prepare();\n    mw.liveedit.toolbar.fixPad();\n    mw.liveedit.editors.prepare();\n    mw.liveedit.toolbar.setEditor();\n}\n","mw.liveedit.initReady = function() {\n    mw.liveedit.data.init();\n    mw.liveEditSelector = new mw.Selector({\n        root: document.body,\n        autoSelect: false\n    });\n\n    mw.paddingCTRL = new mw.paddingEditor({\n\n    });\n\n    mw.drag.create();\n\n    mw.liveedit.editFields.handleKeydown();\n\n    mw.dragSTOPCheck = false;\n\n    var t = document.querySelectorAll('[field=\"title\"]'),\n        l = t.length,\n        i = 0;\n\n    for (; i < l; i++) {\n        mw.$(t[i]).addClass(\"nodrop\");\n    }\n\n\n\n    mw.wysiwyg.init_editables();\n    mw.wysiwyg.prepare();\n    mw.wysiwyg.init();\n    mw.ea = mw.ea || new mw.ElementAnalyzer();\n};\n","mw.liveedit.inline = {\n    bar: function (id) {\n        if (typeof id === 'undefined') {\n            return false;\n        }\n        if (mw.$(\"#\" + id).length === 0) {\n            var bar = document.createElement('div');\n            bar.id = id;\n            mw.wysiwyg.contentEditable(bar, false);\n            bar.className = 'mw-defaults mw-inline-bar';\n            document.body.appendChild(bar);\n            return bar;\n        }\n        else {\n            return mw.$(\"#\" + id)[0];\n        }\n    },\n    tableControl: false,\n    tableController: function (el, e) {\n        if (typeof e !== 'undefined') {\n            e.stopPropagation();\n        }\n        if (mw.liveedit.inline.tableControl === false) {\n            mw.liveedit.inline.tableControl = mw.liveedit.inline.bar('mw-inline-tableControl');\n            mw.liveedit.inline.tableControl.innerHTML = ''\n                + '<ul class=\"mw-ui-box mw-ui-navigation mw-ui-navigation-horizontal\">'\n                + '<li>'\n                + '<a href=\"javascript:;\">Insert<span class=\"mw-icon-dropdown\"></span></a>'\n                + '<ul>'\n                + '<li><a href=\"javascript:;\" onclick=\"mw.liveedit.inline.tableManager.insertRow(\\'above\\', mw.liveedit.inline.activeCell);\">Row Above</a></li>'\n                + '<li><a href=\"javascript:;\" onclick=\"mw.liveedit.inline.tableManager.insertRow(\\'under\\', mw.liveedit.inline.activeCell);\">Row Under</a></li>'\n                + '<li><a href=\"javascript:;\" onclick=\"mw.liveedit.inline.tableManager.insertColumn(\\'left\\', mw.liveedit.inline.activeCell)\">Column on left</a></li>'\n                + '<li><a href=\"javascript:;\" onclick=\"mw.liveedit.inline.tableManager.insertColumn(\\'right\\', mw.liveedit.inline.activeCell)\">Column on right</a></li>'\n                + '</ul>'\n                + '</li>'\n                + '<li>'\n                + '<a href=\"javascript:;\">Style<span class=\"mw-icon-dropdown\"></span></a>'\n                + '<ul>'\n                + '<li><a href=\"javascript:;\" onclick=\"mw.liveedit.inline.tableManager.setStyle(\\'mw-wysiwyg-table\\', mw.liveedit.inline.activeCell);\">Bordered</a></li>'\n                + '<li><a href=\"javascript:;\" onclick=\"mw.liveedit.inline.tableManager.setStyle(\\'mw-wysiwyg-table-zebra\\', mw.liveedit.inline.activeCell);\">Bordered Zebra</a></li>'\n                + '<li><a href=\"javascript:;\" onclick=\"mw.liveedit.inline.tableManager.setStyle(\\'mw-wysiwyg-table-simple\\', mw.liveedit.inline.activeCell);\">Simple</a></li>'\n                + '<li><a href=\"javascript:;\" onclick=\"mw.liveedit.inline.tableManager.setStyle(\\'mw-wysiwyg-table-simple-zebra\\', mw.liveedit.inline.activeCell);\">Simple Zebra</a></li>'\n                + '</ul>'\n                + '</li>'\n                + '<li>'\n                + '<a href=\"javascript:;\">Delete<span class=\"mw-icon-dropdown\"></span></a>'\n                + '<ul>'\n                + '<li><a href=\"javascript:;\" onclick=\"mw.liveedit.inline.tableManager.deleteRow(mw.liveedit.inline.activeCell);\">Row</a></li>'\n                + '<li><a href=\"javascript:;\" onclick=\"mw.liveedit.inline.tableManager.deleteColumn(mw.liveedit.inline.activeCell);\">Column</a></li>'\n                + '</ul>'\n                + '</li>'\n                + '</ul>';\n        }\n        var off = mw.$(el).offset();\n        mw.$(mw.liveedit.inline.tableControl).css({\n            top: off.top - 45,\n            left: off.left,\n            display: 'block'\n        });\n    },\n    activeCell: null,\n    setActiveCell: function (el, event) {\n        if (!mw.tools.hasClass(el.className, 'tc-activecell')) {\n            mw.$(\".tc-activecell\").removeClass('tc-activecell');\n            mw.$(el).addClass('tc-activecell');\n            mw.liveedit.inline.activeCell = el;\n        }\n    },\n    tableManager: {\n        insertColumn: function (dir, cell) {\n            cell = mw.$(cell)[0];\n            if (cell === null) {\n                return false;\n            }\n            dir = dir || 'right';\n            var rows = mw.$(cell.parentNode.parentNode).children('tr');\n            var i = 0, l = rows.length, index = mw.tools.index(cell);\n            for (; i < l; i++) {\n                var row = rows[i];\n                var cell = mw.$(row).children('td')[index];\n                if (dir == 'left' || dir == 'both') {\n                    mw.$(cell).before(\"<td>&nbsp;</td>\");\n                }\n                if (dir == 'right' || dir == 'both') {\n                    mw.$(cell).after(\"<td>&nbsp;</td>\");\n                }\n            }\n        },\n        insertRow: function (dir, cell) {\n            var cell = mw.$(cell)[0];\n            if (cell === null) {\n                return false;\n            }\n            var dir = dir || 'under';\n            var parent = cell.parentNode, cells = mw.$(parent).children('td'), i = 0, l = cells.length, html = '';\n            for (; i < l; i++) {\n                html += '<td>&nbsp;</td>';\n            }\n            var html = '<tr>' + html + '</tr>';\n            if (dir == 'under' || dir == 'both') {\n                mw.$(parent).after(html)\n            }\n            if (dir == 'above' || dir == 'both') {\n                mw.$(parent).before(html)\n            }\n        },\n        deleteRow: function (cell) {\n            mw.$(cell.parentNode).remove();\n        },\n        deleteColumn: function (cell) {\n            var index = mw.tools.index(cell), body = cell.parentNode.parentNode, rows = mw.$(body).children('tr'), l = rows.length, i = 0;\n            for (; i < l; i++) {\n                var row = rows[i];\n                mw.$(row.getElementsByTagName('td')[index]).remove();\n            }\n        },\n        setStyle: function (cls, cell) {\n            var table = mw.tools.firstParentWithTag(cell, 'table');\n            mw.tools.classNamespaceDelete(table, 'mw-wysiwyg-table');\n            mw.$(table).addClass(cls);\n        }\n    }\n}\n","mw.layoutPlus = {\n    create: function(){\n        this._top = $('<span class=\"mw-defaults mw-layout-plus mw-layout-plus-top\">Add Layout</span>');\n        this._bottom = $('<span class=\"mw-defaults mw-layout-plus mw-layout-plus-bottom\">Add Layout</span>');\n        mw.$(document.body).append(this._top).append(this._bottom);\n\n        this._top.on('mouseenter', function () {\n            mw.tools.addClass(document.body, 'body-mw-layout-plus-hover');\n            mw.liveEditSelector.select(mw.layoutPlus._active);\n        });\n        this._top.on('mouseleave', function () {\n            mw.tools.removeClass(document.body, 'body-mw-layout-plus-hover');\n        });\n        this._bottom.on('mouseenter', function () {\n            mw.tools.addClass(document.body, 'body-mw-layout-plus-hover');\n            mw.liveEditSelector.select(mw.layoutPlus._active);\n        });\n        this._bottom.on('mouseleave', function () {\n            mw.tools.removeClass(document.body, 'body-mw-layout-plus-hover')\n        });\n    },\n    hide: function () {\n        this._top.css({top: -999, left: -999});\n        this._bottom.css({top: -999, left: -999});\n        this.pause = false;\n    },\n    pause: false,\n    _active: null,\n    position:function(){\n        var $layout = mw.$(this._active);\n        var off = $layout.offset();\n        var left = (off.left + ($layout.outerWidth()/2));\n        this._top.css({top: off.top - 20, left: left});\n        this._bottom.css({top: off.top + $layout.outerHeight(), left: left});\n    },\n    _prepareList:function (tip, action) {\n        var scope = this;\n        var items = mw.$('.modules-list li', tip);\n        mw.$('input', tip).on('input', function () {\n                mw.tools.search(this.value, items, function (found) {\n                    $(this)[found?'show':'hide']();\n                });\n        });\n        mw.$('.modules-list li', tip).on('click', function () {\n            var id = mw.id('mw-layout-'), el = '<div id=\"' + id + '\"></div>';\n            var $active = mw.$(mw.layoutPlus._active);\n            $active[action](el);\n\n            var name = $active.attr('data-module-name');\n            var template = $(this).attr('template');\n            var conf = {class: mw.layoutPlus._active.className, template: template};\n\n            /*mw.liveEditState.record({\n                action: function () {\n                    mw.$('#' + id).replaceWith('<div id=\"' + id + '\"></div>');\n                }\n            });*/\n\n            mw.load_module('layouts', '#' + id, function () {\n                mw.wysiwyg.change(document.getElementById(id));\n                mw.drag.fixes();\n                /*mw.liveEditState.record({\n                    action: function () {\n                        mw.load_module('layouts', '#' + id, undefined, conf);\n                    }\n                });*/\n                setTimeout(function () {\n                    mw.drag.fix_placeholders();\n                }, 40);\n                mw.dropable.hide();\n                mw.layoutPlus.mode === 'Dialog' ? mw.dialog.get(tip).remove()  : $(tip).remove();\n            }, conf);\n            scope.pause = false;\n        });\n    },\n    mode: 'Dialog', //'tooltip', 'Dialog',\n    showSelectorUI: function (el) {\n        var scope = this;\n        scope.pause = true;\n        var tip = new mw[mw.layoutPlus.mode]({\n            content: document.getElementById('plus-layouts-list').innerHTML,\n            element: el,\n            position: 'right-center',\n            template: 'mw-tooltip-default mw-tooltip-insert-module',\n            id: 'mw-plus-tooltip-selector',\n            title: mw.lang('Select layout'),\n            width: 800,\n            overlay: true\n        });\n        scope._prepareList(document.getElementById('mw-plus-tooltip-selector'), 'before');\n        $('#mw-plus-tooltip-selector input').focus();\n        $('#mw-plus-tooltip-selector').addClass('active');\n    },\n    initSelector: function () {\n        var scope = this;\n        this._top.on('click', function () {\n            scope.showSelectorUI(this);\n        });\n        this._bottom.on('click', function () {\n            scope.showSelectorUI(this);\n        });\n\n    },\n    handle: function () {\n        var scope = this;\n        mw.$(window).on('resize', function (e) {\n            if (scope._active) {\n                scope.position();\n            }\n        });\n        mw.on('moduleOver ModuleClick', function (e, module) {\n            if (module.dataset.type === 'layouts' && !scope.pause) {\n                scope._active = module;\n                scope.position();\n            } else {\n                scope.hide();\n            }\n        });\n    },\n    _ready: false,\n    init: function () {\n        if (!this._ready) {\n            this._ready = true;\n            this.create();\n            this.handle();\n            this.initSelector();\n        }\n    }\n};\n\n$(window).on('load', function () {\n    mw.layoutPlus.init();\n});\n","mw.live_edit = mw.live_edit || {};\r\n\r\nmw.live_edit.registry = mw.live_edit.registry || {};\r\n\r\nmw.live_edit.hasAbilityToDropElementsInside = function(target) {\r\n    var items = /^(span|h[1-6]|hr|ul|ol|input|table|b|em|i|a|img|textarea|br|canvas|font|strike|sub|sup|dl|button|small|select|big|abbr|body)$/i;\r\n    if (typeof target === 'string') {\r\n        return !items.test(target);\r\n    }\r\n    if(!mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(target, ['allow-drop', 'nodrop'])){\r\n        return false;\r\n    }\r\n    if(mw.tools.hasAnyOfClasses(target, ['plain-text'])){\r\n        return false;\r\n    }\r\n    var x = items.test(target.nodeName);\r\n    if (x) {\r\n        return false;\r\n    }\r\n    if (mw.tools.hasParentsWithClass(target, 'module')) {\r\n        if (mw.tools.hasParentsWithClass(target, 'edit')) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    } else if (mw.tools.hasClass(target, 'module')) {\r\n        return false;\r\n    }\r\n    return true;\r\n};\r\n\r\n\r\n\r\nmw.live_edit.showSettings = function (a, opts) {\r\n\r\n    var liveedit = opts.liveedit || false;\r\n    var mode = opts.mode ||  'modal';\r\n\r\n    var view = opts.view || 'admin';\r\n    var module_type;\r\n    if (typeof a === 'string') {\r\n        module_type = a;\r\n        var module_id = a;\r\n        var mod_sel = mw.$(a + ':first');\r\n        if (mod_sel.length > 0) {\r\n            var attr = $(mod_sel).attr('id');\r\n            if (typeof attr !== typeof undefined && attr !== false) {\r\n                attr = !attr.contains(\"#\") ? attr : attr.replace(\"#\", '');\r\n                module_id = attr;\r\n            }\r\n            var attr2 = $(mod_sel).attr('type');\r\n            attr = $(mod_sel).attr('data-type');\r\n            if (typeof attr !== typeof undefined && attr !== false) {\r\n                module_type = attr;\r\n            } else if (typeof attr2 !== typeof undefined && attr2 !== false) {\r\n                module_type = attr2;\r\n            }\r\n            a = mod_sel[0]\r\n        }\r\n    }\r\n\r\n    var curr = a || $(\"#mw_handle_module\").data(\"curr\");\r\n    if(!curr){\r\n        return;\r\n    }\r\n    if(typeof(curr) === 'undefined'){\r\n        return;\r\n    }\r\n    var attributes = {};\r\n\r\n    if (curr && curr.attributes) {\r\n        $.each(curr.attributes, function (index, attr) {\r\n            attributes[attr.name] = attr.value;\r\n        });\r\n    }\r\n\r\n    var iframe_id_sidebar = 'js-iframe-module-settings-' + curr.id;\r\n    var iframe_id_sidebar_wrapper_id = 'sidebar-frame-wrapper-' + iframe_id_sidebar;\r\n\r\n    var data1 = attributes;\r\n\r\n    module_type = null;\r\n    if (data1['data-type'] !== undefined) {\r\n        module_type = data1['data-type'];\r\n        data1['data-type'] = data1['data-type'] + '/admin';\r\n    }\r\n    if (data1['data-module-name'] !== undefined) {\r\n        delete(data1['data-module-name']);\r\n    }\r\n    if (data1['type'] !== undefined) {\r\n        module_type = data1['type'];\r\n        data1['type'] = data1['type'] + '/admin';\r\n    }\r\n    if (module_type != null && view !== undefined) {\r\n        data1['data-type'] = data1['type'] = module_type + '/' + view;\r\n    }\r\n    if (typeof data1['class'] !== 'undefined') {\r\n        delete(data1['class']);\r\n    }\r\n    if (typeof data1['style'] !== 'undefined') {\r\n        delete(data1['style']);\r\n    }\r\n    if (typeof data1.contenteditable !== 'undefined') {\r\n        delete(data1.contenteditable);\r\n    }\r\n    data1.live_edit = liveedit;\r\n    data1.module_settings = 'true';\r\n    if (view !== undefined) {\r\n        data1.view = view;\r\n    }\r\n    else {\r\n        data1.view = 'admin';\r\n    }\r\n    if (data1.from_url == undefined) {\r\n        //data1.from_url = mw.top().win.location;\r\n        data1.from_url = window.parent.location;\r\n    }\r\n    var modal_name = 'module-settings-' + curr.id;\r\n    if (typeof(data1.view.hash) == 'function') {\r\n        //var modal_name = 'module-settings-' + curr.id +(data1.view.hash());\r\n    }\r\n    //data1.live_edit_sidebar = true;\r\n\r\n    var src = mw.settings.site_url + \"api/module?\" + json2url(data1);\r\n\r\n    if (self !== top || /*!mw.liveEditSettings.active || */ mode === 'modal') {\r\n        //remove from sidebar\r\n        $(\"#\" + iframe_id_sidebar).remove();\r\n\r\n        //close sidebar\r\n        if(mw.liveEditSettings && mw.liveEditSettings.active){\r\n             mw.liveEditSettings.hide();\r\n        }\r\n        var has = mw.$('#' + modal_name);\r\n        if(has.length){\r\n            var dialog = mw.dialog.get(has[0]);\r\n            dialog.show();\r\n            return dialog;\r\n        }\r\n        var nmodal = mw.dialogIframe({\r\n            url: src,\r\n            width: 532,\r\n            height: 'auto',\r\n            autoHeight:true,\r\n            id: modal_name,\r\n            title:'',\r\n            className: 'mw-dialog-module-settings',\r\n            closeButtonAction: 'remove'\r\n        });\r\n\r\n        nmodal.iframe.contentWindow.thismodal = nmodal;\r\n        return nmodal;\r\n\r\n    } else {\r\n\r\n\r\n        if(!mw.liveEditSettings.active){\r\n            mw.liveEditSettings.show();\r\n        }\r\n\r\n        if(mw.sidebarSettingsTabs){\r\n            mw.sidebarSettingsTabs.set(2);\r\n        }\r\n\r\n\r\n\r\n        data1.live_edit_sidebar = true;\r\n\r\n        var src = mw.settings.site_url + \"api/module?\" + json2url(data1);\r\n\r\n\r\n        var mod_settings_iframe_html_fr = '' +\r\n            '<div class=\"js-module-settings-edit-item-group-frame loading\" id=\"' + iframe_id_sidebar_wrapper_id + '\">' +\r\n            '<iframe src=\"' + src + '\" frameborder=\"0\" onload=\"this.parentNode.classList.remove(\\'loading\\')\">' +\r\n            '</div>';\r\n\r\n\r\n        var sidebar_title_box = mw.live_edit.getModuleTitleBar(module_type, curr.id);\r\n\r\n\r\n         var mod_settings_iframe_html = '<div  id=\"' + iframe_id_sidebar + '\" class=\"js-module-settings-edit-item-group\">'\r\n            + sidebar_title_box\r\n            + mod_settings_iframe_html_fr\r\n            + '</div>';\r\n\r\n\r\n        if (!$(\"#\" + iframe_id_sidebar).length) {\r\n            $(\"#js-live-edit-module-settings-items\").append(mod_settings_iframe_html);\r\n        }\r\n\r\n        if ($(\"#\" + iframe_id_sidebar).length) {\r\n            $('.js-module-settings-edit-item-group').hide();\r\n            $(\"#\" + iframe_id_sidebar).attr('data-settings-for-module', curr.id);\r\n\r\n            $(\"#\" + iframe_id_sidebar).show();\r\n        }\r\n    }\r\n\r\n};\r\n\r\n\r\nmw.live_edit.getModuleTitleBar = function (module_type, module_id) {\r\n\r\n    var mod_icon = mw.live_edit.getModuleIcon(module_type);\r\n    var mod_title = mw.live_edit.getModuleTitle(module_type);\r\n    var mod_descr = mw.live_edit.getModuleDescription(module_type);\r\n\r\n    var sidebar_title_box = \"<div class='mw_module_settings_sidebar_title_wrapper js-module-titlebar-\"+module_id+\"'>\" + mod_icon;\r\n    sidebar_title_box = sidebar_title_box + \"<div class='js-module-sidebar-settings-menu-holder'>\" + \"</div>\";\r\n    sidebar_title_box = sidebar_title_box + \"<div class='mw_module_settings_sidebar_title'>\" + mod_title + \"</div>\";\r\n\r\n    if (mod_title != mod_descr) {\r\n        //  sidebar_title_box = sidebar_title_box + \"<div class='mw_module_settings_sidebar_description'>\" + mod_descr + \"</div>\";\r\n    }\r\n    sidebar_title_box = sidebar_title_box + \"</div>\";\r\n    return sidebar_title_box;\r\n};\r\n\r\nmw.live_edit.getModuleIcon = function (module_type) {\r\n    if (mw.live_edit.registry[module_type] && mw.live_edit.registry[module_type].icon) {\r\n        return '<span class=\"mw_module_settings_sidebar_icon\" style=\"background-image: url(' + mw.live_edit.registry[module_type].icon + ')\"></span>';\r\n    }\r\n    else {\r\n        return '<span class=\"mw-icon-gear\"></span>&nbsp;&nbsp;';\r\n    }\r\n};\r\nmw.live_edit.getModuleTitle = function (module_type) {\r\n    if (mw.live_edit.registry[module_type] && mw.live_edit.registry[module_type].title) {\r\n        return mw.live_edit.registry[module_type].title;\r\n    } else if (mw.live_edit.registry[module_type] && mw.live_edit.registry[module_type].name) {\r\n        return mw.live_edit.registry[module_type].name;\r\n    }\r\n    else {\r\n        return '';\r\n    }\r\n};\r\nmw.live_edit.getModuleDescription = function (module_type) {\r\n    if (mw.live_edit.registry[module_type] && typeof(mw.live_edit.registry[module_type].description) != 'undefined') {\r\n        return mw.live_edit.registry[module_type].description;\r\n    }\r\n    else {\r\n        return '';\r\n    }\r\n};\r\n\r\n\r\n","\r\n/**\r\n * Makes Droppable area\r\n *\r\n * @return Dom Element\r\n */\r\nmw.dropables = {\r\n    prepare: function() {\r\n        var dropable = document.createElement('div');\r\n        dropable.className = 'mw_dropable';\r\n        dropable.innerHTML = '<span class=\"mw_dropable_arr\"></span>';\r\n        document.body.appendChild(dropable);\r\n        mw.dropable = mw.$(dropable);\r\n        mw.dropable.hide = function(){\r\n            return mw.$(this).addClass('mw_dropable_hidden');\r\n        };\r\n        mw.dropable.show = function(){\r\n            return mw.$(this).removeClass('mw_dropable_hidden');\r\n        };\r\n        mw.dropable.hide()\r\n    },\r\n    userInteractionClasses:function(){\r\n        var bgHolders = document.querySelectorAll(\".edit.background-image-holder, .edit .background-image-holder, .edit[style*='background-image'], .edit [style*='background-image']\");\r\n        var noEditModules = document.querySelectorAll('.module' + mw.noEditModules.join(',.module'));\r\n        var edits = document.querySelectorAll('.edit');\r\n        var i = 0, i1 = 0, i2 = 0;\r\n        for ( ; i<bgHolders.length; i++ ) {\r\n            var curr = bgHolders[i];\r\n            var po = mw.tools.parentsOrder(curr, ['edit', 'module']);\r\n            if(po.module === -1 || (po.edit<po.module && po.edit !== -1)){\r\n                if(!mw.tools.hasClass(curr, 'module')){\r\n                    mw.tools.addClass(curr, 'element');\r\n                }\r\n                curr.style.backgroundImage = curr.style.backgroundImage || 'none';\r\n            }\r\n        }\r\n        for ( ; i1<noEditModules.length; i1++ ) {\r\n            mw.tools.removeClass(noEditModules[i], 'module');\r\n        }\r\n        for ( ; i2<edits.length; i2++ ) {\r\n            var all = mw.ea.helpers.getElementsLike(\":not(.element)\", edits[i2]), i2a = 0;\r\n            var allAllowDrops = edits[i2].querySelectorAll(\".allow-drop\"), i3a = 0;\r\n            for( ; i3a<allAllowDrops.length; i3a++){\r\n                mw.tools.addClass(allAllowDrops[i3a], 'element');\r\n            }\r\n            for( ; i2a<all.length; i2a++){\r\n                if(!mw.tools.hasClass(all[i2a], 'module')){\r\n                    if(mw.ea.canDrop(all[i2a])){\r\n                        mw.tools.addClass(all[i2a], 'element');\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        if(document.body.classList){\r\n            var displayEditor = mw.wysiwyg.isSelectionEditable();\r\n            if(!displayEditor){\r\n                var editor = document.querySelector('.mw_editor');\r\n                if(editor && editor.contains(document.activeElement)) displayEditor = true;\r\n            }\r\n            var focusedNode = mw.wysiwyg.validateCommonAncestorContainer(getSelection().focusNode);\r\n            var isSafeMode = mw.tools.firstParentOrCurrentWithAnyOfClasses(focusedNode, ['safe-mode']) ;\r\n            var isPlainText = mw.tools.firstParentOrCurrentWithAnyOfClasses(focusedNode, ['plain-text']) ;\r\n            document.body.classList[( displayEditor ? 'add' : 'remove' )]('mw-active-element-iseditable');\r\n            document.body.classList[( isSafeMode ? 'add' : 'remove' )]('mw-active-element-is-in-safe-mode');\r\n            document.body.classList[( isPlainText ? 'add' : 'remove' )]('mw-active-element-is-plain-text');\r\n        }\r\n    },\r\n    findNearest:function(event,selectors){\r\n\r\n    selectors = (selectors || mw.drag.section_selectors).slice(0);\r\n\r\n\r\n    for(var ix = 0 ; i<selectors.length ; ix++){\r\n        selectors[ix] = '.edit ' + selectors[ix].trim();\r\n    }\r\n\r\n    selectors = selectors.join(',');\r\n\r\n      var coords = { y:99999999 },\r\n          y = mw.event.page(event).y,\r\n          all = document.querySelectorAll(selectors),\r\n          i = 0,\r\n          final = {\r\n            element:null,\r\n            position:null\r\n          };\r\n      for( ; i< all.length; i++){\r\n        var ord = mw.tools.parentsOrder(all[i], ['edit', 'module']);\r\n        if(ord.edit === -1 || ((ord.module !== -1 && ord.edit !== -1 ) && ord.module < ord.edit)){\r\n          continue;\r\n        }\r\n        if(!mw.tools.parentsOrCurrentOrderMatchOrOnlyFirstOrNone(all[i], ['allow-drop', 'nodrop'])){\r\n          continue;\r\n        }\r\n        var el = mw.$(all[i]), offtop = el.offset().top;\r\n        var v1 = offtop - y;\r\n        var v2 = y - (offtop + el[0].offsetHeight);\r\n        var v = v1 > 0 ? v1 : v2;\r\n        if(coords.y > v){\r\n\r\n          final.element = all[i];\r\n        }\r\n        if(coords.y > v && v1 > 0){\r\n          final.position = 'top';\r\n        }\r\n        else if(coords.y > v && v2 > 0){\r\n          final.position = 'bottom';\r\n        }\r\n        if(coords.y > v){\r\n\r\n          coords.y = v\r\n        }\r\n\r\n      }\r\n      return final;\r\n    },\r\n    display: function(el) {\r\n\r\n        el = mw.$(el);\r\n        var offset = el.offset();\r\n        var width = el.outerWidth();\r\n        var height = el.outerHeight();\r\n        mw.dropable.css({\r\n            top: offset.top + height,\r\n            left: offset.left,\r\n            width: width\r\n        });\r\n    },\r\n    set: function(pos, offset, height, width) {\r\n        if (pos === 'top') {\r\n\r\n            mw.dropable.css({\r\n                top: offset.top - 2,\r\n                left: offset.left,\r\n                width: width,\r\n                height: ''\r\n            });\r\n            mw.dropable.data(\"position\", \"top\");\r\n            mw.dropable.addClass(\"mw_dropable_arr_up\");\r\n        } else if (pos === 'bottom') {\r\n\r\n            mw.dropable.css({\r\n                top: offset.top + height + 2,\r\n                left: offset.left,\r\n                width: width,\r\n                height: ''\r\n            });\r\n            mw.dropable.data(\"position\", \"bottom\");\r\n            mw.dropable.removeClass(\"mw_dropable_arr_up\");\r\n            mw.dropable.removeClass(\"mw_dropable_arr_rigt\");\r\n        } else if (pos === 'left') {\r\n            mw.dropable.data(\"position\", 'left');\r\n            mw.dropable.css({\r\n                top: offset.top,\r\n                height: height,\r\n                width: '',\r\n                left: offset.left\r\n            });\r\n        } else if (pos === 'right') {\r\n            mw.dropable.data(\"position\", 'right');\r\n            mw.dropable.addClass(\"mw_dropable_arr_rigt\");\r\n            mw.dropable.css({\r\n                top: offset.top,\r\n                left: offset.left + width,\r\n                height: height,\r\n                width: ''\r\n            });\r\n        }\r\n    }\r\n};\r\n\r\n\r\n mw.triggerLiveEditHandlers = {\r\n    cacheEnabled: false,\r\n     reseSetCache: function(key) {\r\n        this[key] = {};\r\n     },\r\n    shouldTrigger:function(key, node) {\r\n        if(!this.cacheEnabled) return true;\r\n        var countMax = 3;\r\n        if(!this[key] || this[key].node !== node) {\r\n            this[key] = {\r\n                node:node,\r\n                count:0\r\n            };\r\n        }\r\n        if(this[key].count < countMax) {\r\n            this[key].count++;\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n    _moduleRegister: null,\r\n    module: function(ev){\r\n        targetFrom = ev ? ev.target :  mw.mm_target;\r\n        var module = mw.tools.firstMatchesOnNodeOrParent(targetFrom, '.module:not(.no-settings)');\r\n        //var module = mw.tools.lastMatchesOnNodeOrParent(targetFrom, '.module:not(.no-settings)');\r\n        var triggerTarget =  module.__disableModuleTrigger || module;\r\n        if(module){\r\n            //if(this.shouldTrigger('_moduleRegister', triggerTarget)) {\r\n                mw.trigger(\"moduleOver\", [triggerTarget, ev]);\r\n            //}\r\n        } else {\r\n            if (\r\n                mw.mm_target.id !== 'mw-handle-item-module'\r\n                && mw.mm_target.id !== 'mw-handle-item-module-active'\r\n                && !mw.tools.hasParentWithId(mw.mm_target, 'mw-handle-item-module')\r\n                && !mw.tools.hasParentWithId(mw.mm_target, 'mw-handle-item-module-active')\r\n                && !mw.tools.hasAnyOfClassesOnNodeOrParent(mw.mm_target, ['mwInaccessibleModulesMenu'])) {\r\n                /*if(this._moduleRegister !== null) {*/\r\n                    mw.trigger(\"ModuleLeave\", mw.mm_target);\r\n                    /*this._moduleRegister = null;\r\n                }*/\r\n            }\r\n        }\r\n    },\r\n    cloneable: function () {\r\n        var cloneable = mw.tools.firstParentOrCurrentWithAnyOfClasses(mw.mm_target, ['cloneable', 'mw-cloneable-control']);\r\n\r\n        if(!!cloneable){\r\n            if(mw.tools.hasClass(cloneable, 'mw-cloneable-control')){\r\n                mw.trigger(\"CloneableOver\", [mw.drag._onCloneableControl.__target, true]);\r\n            }\r\n            else if(mw.tools.hasParentsWithClass(cloneable, 'mw-cloneable-control')){\r\n                mw.trigger(\"CloneableOver\", [mw.drag._onCloneableControl.__target, true]);\r\n            }\r\n            else{\r\n                mw.trigger(\"CloneableOver\", [cloneable, false]);\r\n            }\r\n\r\n        }\r\n        else{\r\n            if(mw.drag._onCloneableControl && mw.mm_target !== mw.drag._onCloneableControl){\r\n                mw.drag._onCloneableControl.style.display = 'none';\r\n            }\r\n        }\r\n    },\r\n    _elementRegister:null,\r\n    element: function(ev) {\r\n        var element = mw.tools.firstParentOrCurrentWithClass(mw.mm_target, 'element');\r\n        if(element /*&& this._elementRegister !== element*/) {\r\n            this._elementRegister = element;\r\n            if (!mw.tools.hasClass(element, 'module')\r\n                && (mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(element, ['edit', 'module'])\r\n                    && mw.tools.parentsOrCurrentOrderMatchOrOnlyFirstOrNone(element, ['allow-drop', 'nodrop']))) {\r\n\r\n                mw.trigger(\"ElementOver\", [element, ev]);\r\n            }\r\n            else /*if(this._elementRegister !== null)*/{\r\n                //if (!mw.tools.firstParentOrCurrentWithId(mw.mm_target, 'mw_handle_element')) {\r\n                    this._elementRegister = null;\r\n                    //mw.trigger(\"ElementLeave\", element);\r\n                //}\r\n            }\r\n        } else if(!element && !mw.tools.firstParentOrCurrentWithId(mw.mm_target, 'mw-handle-item-element')) {\r\n            this._elementRegister = null;\r\n            mw.trigger(\"ElementLeave\");\r\n        }\r\n        if (mw.mm_target === mw.image_resizer && this._elementRegister !== mw.image.currentResizing[0]) {\r\n            this._elementRegister = mw.image.currentResizing[0];\r\n            mw.trigger(\"ElementOver\", [mw.image.currentResizing[0], ev]);\r\n        }\r\n    },\r\n    _layoutRegister:null,\r\n    layout: function () {\r\n         var targetLayout = mw.tools.firstParentOrCurrentWithClass(mw.mm_target, 'mw-layout-root');\r\n         if (targetLayout && this._layoutRegister !== targetLayout) {\r\n             this._layoutRegister = targetLayout;\r\n             mw.trigger(\"LayoutOver\", targetLayout);\r\n         }\r\n    },\r\n     _rowRegister:null,\r\n    row: function () {\r\n         var row = mw.tools.firstParentOrCurrentWithClass(mw.mm_target, 'mw-row');\r\n\r\n         if (row && this._rowRegister !== row) {\r\n             this._rowRegister = row;\r\n             mw.trigger(\"RowOver\", row);\r\n         } else if (this._rowRegister !== null) {\r\n             this._rowRegister = null;\r\n             mw.trigger(\"RowLeave\", mw.mm_target);\r\n         }\r\n    },\r\n     col: function () {\r\n            if (!mw.drag.columns.resizing) {\r\n                var column = mw.tools.firstParentOrCurrentWithClass(mw.mm_target, 'mw-col');\r\n                if (column) {\r\n                    mw.trigger(\"ColumnOver\", column);\r\n                } else {\r\n                    mw.trigger(\"ColumnOut\", mw.mm_target);\r\n                }\r\n            }\r\n     }\r\n };\r\n mw.liveEditHandlers = function(event){\r\n    if (mw.drag.columns.resizing === false ) {\r\n        mw.triggerLiveEditHandlers.cloneable(event);\r\n        mw.triggerLiveEditHandlers.layout(event);\r\n        mw.triggerLiveEditHandlers.element(event);\r\n        mw.triggerLiveEditHandlers.module(event);\r\n        if (mw.drag.columns.resizing === false && mw.tools.hasParentsWithClass(mw.mm_target, 'edit') && (!mw.tools.hasParentsWithClass(mw.mm_target, 'module') ||\r\n            mw.tools.hasParentsWithClass(mw.mm_target, 'allow-drop'))) {\r\n            mw.triggerLiveEditHandlers.row();\r\n            mw.triggerLiveEditHandlers.col();\r\n        }\r\n    }\r\n\r\n    mw.image._dragTxt(event);\r\n\r\n    var bg, bgTarget, bgCanChange;\r\n    if(event.target){\r\n      bg = event.target.style && event.target.style.backgroundImage && !mw.tools.hasClass(event.target, 'edit');\r\n      bgTarget = event.target;\r\n      if(!bg){\r\n          var _c = 0, bgp = event.target;\r\n          while (!bg || bgp === document.body){\r\n              bgp = bgp.parentNode;\r\n              if(!bgp) {\r\n                  break;\r\n              }\r\n              _c++;\r\n              bg = bgp.style && bgp.style.backgroundImage && !mw.tools.hasClass(bgp, 'edit');\r\n              bgTarget = bgp;\r\n          }\r\n      }\r\n    }\r\n\r\n    if(bg){\r\n        bgCanChange = mw.drag.columns.resizing === false\r\n        && (mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(bgTarget, ['edit','module']) || mw.tools.hasClass(event.target, 'element'));\r\n    }\r\n\r\n    if (!mw.image.isResizing && mw.image_resizer) {\r\n\r\n        if (event.target.nodeName === 'IMG' && (mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(event.target, ['edit','module'])) && mw.drag.columns.resizing === false) {\r\n            mw.image_resizer._show();\r\n            mw.image.resize.resizerSet(event.target, false);\r\n        }\r\n        else if (bg && bgCanChange) {\r\n            mw.image_resizer._show();\r\n            mw.image.resize.resizerSet(bgTarget, false);\r\n        }\r\n\r\n        else if(mw.tools.hasClass(mw.mm_target, 'mw-image-holder-content')||mw.tools.hasParentsWithClass(mw.mm_target, 'mw-image-holder-content')){\r\n            mw.image_resizer._show();\r\n            mw.image.resize.resizerSet(mw.tools.firstParentWithClass(mw.mm_target, 'mw-image-holder').querySelector('img'), false);\r\n        }\r\n        else {\r\n            if (!event.target.mwImageResizerComponent) {\r\n                if(mw.image_resizer){\r\n                    mw.image_resizer._hide();\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n\r\nmw.liveNodeSettings = {\r\n    _working: false,\r\n    set: function (type, el) {\r\n        if (this._working) return;\r\n        this._working = true;\r\n        var scope = this;\r\n        setTimeout(function () {\r\n            scope._working = false;\r\n        }, 78);\r\n\r\n        if(this[type]){\r\n            mw.sidebarSettingsTabs.set(2);\r\n            return this[type](el);\r\n        }\r\n    },\r\n    element: function (el) {\r\n        if (!this.__is_sidebar_opened()) {\r\n            return;\r\n        }\r\n\r\n    },\r\n    none: function (el) {\r\n        if (!this.__is_sidebar_opened()) {\r\n            return;\r\n        }\r\n\r\n    },\r\n    module: function (el) {\r\n        mw.live_edit.showSettings(undefined, {mode:\"sidebar\", liveedit:true})\r\n    },\r\n    image: function (el) {\r\n        if (!this.__is_sidebar_opened()) {\r\n            return;\r\n        }\r\n\r\n        mw.$(\"#mw-live-edit-sidebar-image-frame\")\r\n            .contents()\r\n            .find(\"#mwimagecurrent\")\r\n            .attr(\"src\", el.src)\r\n\r\n    },\r\n    initImage: function () {\r\n        var url = mw.external_tool('imageeditor');\r\n        mw.$(\"#js-live-edit-image-settings-holder\").append('<iframe src=\"' + url + '\" frameborder=\"0\" id=\"mw-live-edit-sidebar-image-frame\"></iframe>');\r\n    },\r\n    icon: function () {\r\n\r\n    },\r\n    __is_sidebar_opened: function () {\r\n        if (mw.liveEditSettings  &&  mw.liveEditSettings.active) {\r\n            return true;\r\n        }\r\n    }\r\n};\r\n\r\n$(document).ready(function(){\r\n    mw.on('liveEditSettingsReady', function(){\r\n        mw.liveNodeSettings.initImage();\r\n    });\r\n});\r\n","mw.liveEditWidgets = {\r\n    _cssEditorInSidebarAccordion : null,\r\n    cssEditorInSidebarAccordion : function () {\r\n        if(!this._cssEditorInSidebarAccordion){\r\n            this._cssEditorInSidebarAccordion = document.createElement('iframe') ;\r\n            this._cssEditorInSidebarAccordion.id = 'mw-css-editor-sidebar-iframe' ;\r\n            this._cssEditorInSidebarAccordion.src = mw.external_tool('rte_css_editor');\r\n            this._cssEditorInSidebarAccordion.style.opacity = 0;\r\n            this._cssEditorInSidebarAccordion.scrolling = 'no';\r\n            this._cssEditorInSidebarAccordion.frameBorder = 0;\r\n            var holder = document.querySelector('#mw-css-editor-sidebar-iframe-holder');\r\n            holder.appendChild(this._cssEditorInSidebarAccordion);\r\n            mw.tools.loading(holder, 90);\r\n            mw.tools.iframeAutoHeight(this._cssEditorInSidebarAccordion);\r\n            this._cssEditorInSidebarAccordion.onload = function () {\r\n                this.contentWindow.document.body.style.padding = 0;\r\n                this.contentWindow.document.body.style.backgroundColor = 'transparent';\r\n                mw.tools.loading(holder, false);\r\n                this.style.opacity = 1;\r\n            };\r\n            mw.$(this._cssEditorInSidebarAccordion)\r\n                .height($(this._cssEditorInSidebarAccordion)\r\n                    .parents('.mw-ui-box').outerHeight() -\r\n                    mw.$(this._cssEditorInSidebarAccordion).parents('.tabitem').outerHeight());\r\n        }\r\n        return this._cssEditorInSidebarAccordion;\r\n    },\r\n    _tplSettings : null,\r\n    loadTemplateSettings: function (url) {\r\n        if (!this._tplSettings) {\r\n            this._tplSettings = document.createElement('iframe') ;\r\n            this._tplSettings.id = 'mw-live-edit-sidebar-settings-iframe-holder-template-settings-frame' ;\r\n            this._tplSettings.className = 'mw-live-edit-sidebar-settings-iframe' ;\r\n            this._tplSettings.src = url;\r\n            this._tplSettings.scrolling = 'no';\r\n            this._tplSettings.frameBorder = 0;\r\n            mw.$('#mw-live-edit-sidebar-settings-iframe-holder-template-settings').html(this._tplSettings);\r\n            mw.tools.iframeAutoHeight(this._tplSettings);\r\n            this._tplSettings.onload = function () {\r\n                this.contentWindow.document.querySelector('.mw-module-live-edit-settings').style.padding = 0;\r\n            };\r\n            mw.$(this._tplSettings)\r\n                .height($(this._tplSettings)\r\n                        .parents('.mw-ui-box').outerHeight() -\r\n                    mw.$(this._tplSettings).parents('.tabitem').outerHeight());\r\n        }\r\n        return this._tplSettings;\r\n    }\r\n};\r\n\r\nmw.liveEditTools = {\r\n    isLayout: function (node) {\r\n        return (!!node && !!node.getAttribute && (node.getAttribute('data-module-name') === 'layouts' || node.getAttribute('data-type') === 'layouts'));\r\n    }\r\n};\r\n","\r\nmw.liveedit = {};\r\nmw.isDrag = false;\r\nmw.resizable_row_width = false;\r\nmw.mouse_over_handle = false;\r\nmw.external_content_dragged = false;\r\n\r\nmw.have_new_items = false;\r\n\r\nmw.dragCurrent = null;\r\nmw.currentDragMouseOver = null;\r\nmw.liveEditSelectMode = 'element';\r\n\r\nmw.modulesClickInsert = true;\r\n\r\nmw.mouseDownOnEditor = false;\r\nmw.mouseDownStarted = false;\r\nmw.SmallEditorIsDragging = false;\r\n\r\nmw.states = {};\r\nmw.live_edit_module_settings_array = [];\r\n\r\nmw.noEditModules = [\r\n    '[type=\"template_settings\"]'\r\n];\r\n\r\nmw.isDragItem = mw.isBlockLevel = function (obj) {\r\n    return mw.ea.helpers.isBlockLevel(obj);\r\n};\r\n\r\n\r\n\r\n!function(a){function f(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent(\"MouseEvents\");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch=\"ontouchend\"in document,a.support.touch){var e,b=a.ui.mouse.prototype,c=b._mouseInit,d=b._mouseDestroy;b._touchStart=function(a){var b=this;!e&&b._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,b._touchMoved=!1,f(a,\"mouseover\"),f(a,\"mousemove\"),f(a,\"mousedown\"))},b._touchMove=function(a){e&&(this._touchMoved=!0,f(a,\"mousemove\"))},b._touchEnd=function(a){e&&(f(a,\"mouseup\"),f(a,\"mouseout\"),this._touchMoved||f(a,\"click\"),e=!1)},b._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,\"_touchStart\"),touchmove:a.proxy(b,\"_touchMove\"),touchend:a.proxy(b,\"_touchEnd\")}),c.call(b)},b._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,\"_touchStart\"),touchmove:a.proxy(b,\"_touchMove\"),touchend:a.proxy(b,\"_touchEnd\")}),d.call(b)}}}(jQuery);\r\n\r\nmw.tools.addClass(document.body, 'mw-live-edit');\r\n\r\n$(document).ready(function() {\r\n\r\n    if ((\"ontouchstart\" in document.documentElement)) {\r\n        mw.$('body').addClass('touchscreen-device');\r\n    }\r\n\r\n    mw.liveedit.initReady();\r\n    mw.liveedit.handleEvents();\r\n    mw.liveedit.handleCustomEvents();\r\n\r\n    mw.liveedit.cssEditor = new mw.liveeditCSSEditor();\r\n\r\n});\r\n\r\nmw.require('stylesheet.editor.js');\r\n$(window).on(\"load\", function() {\r\n    mw.liveedit.initLoad();\r\n});\r\n\r\n$(window).on('resize', function() {\r\n    mw.liveedit.toolbar.setEditor();\r\n});\r\n\r\n\r\n\r\n\r\n","mw.liveedit.manageContent = {\r\n    //w: '95%',\r\n   //  w: '1220px',\r\n     w: '985px',\r\n   // w: 'auto',\r\n    page: function () {\r\n        var modal = mw.dialogIframe({\r\n            url: mw.settings.api_url + \"module/?type=content/edit_page&live_edit=true&quick_edit=false&id=mw-quick-page&recommended_parent=\" + mw.settings.page_id,\r\n            width: this.w,\r\n            height: 'auto',\r\n            autoHeight: true,\r\n            name: 'quick_page',\r\n            overlay: true,\r\n            title: 'New Page',\r\n            scrollMode: 'inside'\r\n        });\r\n        mw.$(modal.main).addClass('mw-add-content-modal');\r\n    },\r\n    category: function () {\r\n        var modal = mw.dialogIframe({\r\n            url: mw.settings.api_url + \"module/?type=categories/edit_category&live_edit=true&quick_edit=false&id=mw-quick-category&recommended_parent=\" + mw.settings.page_id,\r\n          //  width: '600px',\r\n            width: this.w,\r\n            height: 'auto',\r\n            autoHeight: true,\r\n            name: 'quick_page',\r\n            overlay: true,\r\n            title: 'New Category',\r\n            scrollMode: 'inside'\r\n        });\r\n        mw.$(modal.main).addClass('mw-add-content-modal');\r\n    },\r\n    edit: function (id, content_type, subtype, parent, category) {\r\n        var str = \"\";\r\n\r\n        if (parent) {\r\n            str = \"&recommended_parent=\" + parent;\r\n        }\r\n\r\n        if (content_type) {\r\n            str = str + '&content_type=' + content_type;\r\n        }\r\n\r\n        if (category) {\r\n            str = str + '&category=' + category;\r\n        }\r\n\r\n        if (subtype) {\r\n            str = str + '&subtype=' + subtype;\r\n        }\r\n\r\n        var actionType = '';\r\n\r\n        if (id === 0) {\r\n            actionType = 'Add';\r\n        } else {\r\n            actionType = 'Edit';\r\n        }\r\n\r\n        var actionOf = 'Content';\r\n        if (content_type === 'post') {\r\n            actionOf = 'Post'\r\n        } else if (content_type === 'page') {\r\n            actionOf = 'Page'\r\n        } else if (content_type === 'product') {\r\n            actionOf = 'Product'\r\n        } else if (content_type === 'category') {\r\n            actionOf = 'Category'\r\n        }\r\n\r\n        var modal = mw.dialogIframe({\r\n            url: mw.settings.api_url + \"module/?type=content/edit&live_edit=true&quick_edit=false&is-current=true&id=mw-quick-page&content-id=\" + id + str,\r\n       //     width: '800px',\r\n            width: this.w,\r\n            height: 'auto',\r\n            autoHeight: true,\r\n            name: 'quick_page',\r\n            id: 'quick_page',\r\n            overlay: true,\r\n            title: actionType + ' ' + actionOf,\r\n            scrollMode: 'inside'\r\n        });\r\n        mw.$(modal.main).addClass('mw-add-content-modal');\r\n    },\r\n    page_2: function () {\r\n        var modal = mw.dialogIframe({\r\n            url: mw.settings.api_url + \"module/?type=content/quick_add&live_edit=true&id=mw-new-content-add-ifame\",\r\n            width: this.w,\r\n            height: 'auto',\r\n            name: 'quick_page',\r\n            overlay: true,\r\n            title: 'New Page',\r\n            scrollMode: 'inside'\r\n        });\r\n        mw.$(modal.main).addClass('mw-add-content-modal');\r\n    },\r\n    post: function () {\r\n        var modal = mw.dialogIframe({\r\n            url: mw.settings.api_url + \"module/?type=content/edit_page&live_edit=true&quick_edit=false&id=mw-quick-post&subtype=post&parent-page-id=\" + mw.settings.page_id + \"&parent-category-id=\" + mw.settings.category_id,\r\n            width: this.w,\r\n            height: 'auto',\r\n            autoHeight: true,\r\n            name: 'quick_post',\r\n            overlay: true,\r\n            title: 'New Post'\r\n        });\r\n        mw.$(modal.main).addClass('mw-add-content-modal');\r\n    },\r\n    product: function () {\r\n        var modal = mw.dialogIframe({\r\n            url: mw.settings.api_url + \"module/?type=content/edit_page&live_edit=true&quick_edit=false&id=mw-quick-product&subtype=product&parent-page-id=\" + mw.settings.page_id + \"&parent-category-id=\" + mw.settings.category_id,\r\n            width: this.w,\r\n            height: 'auto',\r\n            autoHeight: true,\r\n            name: 'quick_product',\r\n            overlay: true,\r\n            title: 'New Product'\r\n        });\r\n        mw.$(modal.main).addClass('mw-add-content-modal');\r\n    }\r\n}\r\n","mw.liveedit.modulesToolbar = {\r\n    init: function (selector) {\r\n        var items = selector || \".modules-list li[data-module-name]\";\r\n        var $items = mw.$(items);\r\n        $items.on('mouseup touchend', function (){\r\n            if(!document.body.classList.contains('dragStart') && !this.classList.contains('module-item-layout')) {\r\n                if(mw.liveEditSelector.selected[0]) {\r\n                    mw.element(mw.liveEditSelector.selected[0]).after(this.outerHTML);\r\n                    setTimeout(function (){\r\n                        mw.drag.load_new_modules();\r\n                        mw.tools.scrollTo(mw.liveEditSelector.selected[0].nextElementSibling, undefined, 200)\r\n                    }, 78)\r\n                } else {\r\n                    mw.notification.warning('Select element from the page or drag the <b>' + this.dataset.filter + '</b> to the desired place');\r\n                }\r\n            }\r\n        });\r\n        $items.draggable({\r\n            revert: true,\r\n            revertDuration: 0,\r\n            distance: 20,\r\n            start: function(a, b) {\r\n                mw.isDrag = true;\r\n                mw.dragCurrent = mw.ea.data.currentGrabbed = mw.GlobalModuleListHelper;\r\n                mw.$(document.body).addClass(\"dragStart\");\r\n                mw.image_resizer._hide();\r\n\r\n            },\r\n            stop: function() {\r\n                mw.isDrag = false;\r\n                mw.pauseSave = true;\r\n                var el = this;\r\n                mw.$(document.body).removeClass(\"dragStart\");\r\n                setTimeout(function() {\r\n                    mw.drag.load_new_modules();\r\n                    mw.drag.toolbar_modules(el);\r\n                }, 200);\r\n            }\r\n        });\r\n        $items.on('mouseenter touchstart', function() {\r\n            mw.$(this).draggable(\"option\", \"helper\", function() {\r\n                var el = $(this);\r\n                var clone = el.clone(true);\r\n                clone.appendTo(document.body);\r\n                clone.addClass('mw-module-drag-clone');\r\n                mw.GlobalModuleListHelper = clone[0];\r\n                clone.css({\r\n                    width: el.width(),\r\n                    height: el.height()\r\n                });\r\n                return clone[0];\r\n            });\r\n        });\r\n\r\n    }\r\n};\r\n","\r\n(function(mw){\r\n\r\n    mw.paddingEditor = function( options ) {\r\n\r\n        options = options || {};\r\n\r\n        var defaults = {\r\n            height: 10\r\n        };\r\n\r\n        this.settings = $.extend({}, defaults, options);\r\n\r\n        this._pageY = -1;\r\n        this._active = null;\r\n        this._paddingTopDown = false;\r\n        this._paddingBottomDown = false;\r\n        var scope = this;\r\n\r\n        this.create = function() {\r\n            this.paddingTop = document.createElement('div');\r\n            this.paddingTop.className = 'mw-padding-ctrl mw-padding-ctrl-top';\r\n\r\n            this.paddingBottom = document.createElement('div');\r\n            this.paddingBottom.className = 'mw-padding-ctrl mw-padding-ctrl-bottom';\r\n\r\n            this.paddingTop.style.height = this.settings.height + 'px';\r\n            this.paddingBottom.style.height = this.settings.height + 'px';\r\n\r\n\r\n            // this.paddingBottom.style.visibility = 'hidden';\r\n            // this.paddingTop.style.visibility = 'hidden';\r\n\r\n            document.body.appendChild(this.paddingTop);\r\n            document.body.appendChild(this.paddingBottom);\r\n        };\r\n\r\n\r\n        this.record = function() {\r\n            if(!scope._active){\r\n                return;\r\n            }\r\n\r\n            var rec_scope = scope._active;\r\n            if(rec_scope.parentNode){\r\n                rec_scope = rec_scope.parentNode;\r\n            }\r\n        //    var root = mw.tools.firstParentOrCurrentWithAnyOfClasses(scope._active.parentNode, ['edit', 'element', 'module']);\r\n            var root = mw.tools.firstParentOrCurrentWithAnyOfClasses(rec_scope, ['edit', 'element', 'module']);\r\n            mw.liveEditState.record({\r\n                target:root,\r\n                value: root.innerHTML\r\n            });\r\n        };\r\n\r\n\r\n\r\n        if(scope && scope._active){\r\n\r\n        }\r\n        this.handleMouseMove = function() {\r\n            mw.$(this.paddingTop).on('mousedown touchstart', function(){\r\n                scope._paddingTopDown = true;\r\n                mw.liveEditSelectMode = 'none';\r\n                mw.$('html').addClass('padding-control-start');\r\n            });\r\n            mw.$(this.paddingBottom).on('mousedown touchstart', function(){\r\n                scope._paddingBottomDown = true;\r\n                mw.liveEditSelectMode = 'none';\r\n                mw.$('html').addClass('padding-control-start');\r\n                scope.record();\r\n            });\r\n            mw.$(document.body).on('mouseup touchend', function(){\r\n                if(scope._paddingTopDown || scope._paddingBottomDown) {\r\n                    scope.record();\r\n                }\r\n                mw.liveEditSelectMode = 'element';\r\n\r\n                scope._paddingTopDown = false;\r\n                scope._paddingBottomDown = false;\r\n                scope._working = false;\r\n                mw.$(scope._info).removeClass('active');\r\n                scope.activeMark(false);\r\n                mw.liveEditSelector.active(true);\r\n                mw.$('html').removeClass('padding-control-start');\r\n            });\r\n            mw.event.windowLeave(function (e) {\r\n                if(scope._paddingTopDown || scope._paddingBottomDown) {\r\n                    scope.record();\r\n                }\r\n                mw.liveEditSelectMode = 'element';\r\n                scope._paddingTopDown = false;\r\n                scope._paddingBottomDown = false;\r\n                scope._working = false;\r\n                mw.$(scope._info).removeClass('active');\r\n                mw.liveEditSelector.active(true);\r\n                mw.$('html').removeClass('padding-control-start');\r\n            });\r\n            mw.$(document).on('mousemove touchmove', function(e){\r\n                if(scope._active){\r\n                    var isDown = e.pageY < scope._pageY;\r\n                    var inc = isDown ? scope._pageY - e.pageY : e.pageY - scope._pageY;\r\n                    var curr;\r\n                    if(scope && scope._active && scope._paddingTopDown){\r\n                        scope._working = true;\r\n                        curr = scope._active._currPaddingTop || (parseFloat($(scope._active).css('paddingTop')));\r\n\r\n                        if(isDown){\r\n                            scope._active.style.paddingTop = (curr <= 0 ? 0 : curr-inc) + 'px';\r\n                        } else {\r\n                            scope._active.style.paddingTop = (curr + inc) + 'px';\r\n                        }\r\n                        scope._active._currPaddingTop = parseFloat(scope._active.style.paddingTop);\r\n                        scope.position(scope._active);\r\n                        scope.info();\r\n                        scope._active.setAttribute('staticdesign', true);\r\n                        scope.activeMark(true);\r\n                        mw.wysiwyg.change(scope._active);\r\n                        mw.liveEditSelector.pause();\r\n                        mw.trigger('PaddingControl', scope._active);\r\n                    } else if(scope && scope._active && scope._paddingBottomDown){\r\n                        scope._working = true;\r\n                        curr = scope._active._currPaddingBottom || (parseFloat($(scope._active).css('paddingBottom')));\r\n                        if(isDown){\r\n                            scope._active.style.paddingBottom = (curr <= 0 ? 0 : curr-inc) + 'px';\r\n                        } else {\r\n                            scope._active.style.paddingBottom = (curr + inc) + 'px';\r\n                        }\r\n                        scope._active._currPaddingBottom = parseFloat(scope._active.style.paddingBottom);\r\n                        scope.position(scope._active);\r\n                        scope.info();\r\n                        scope._active.setAttribute('staticdesign', true);\r\n                        scope.activeMark(true);\r\n                        mw.wysiwyg.change(scope._active);\r\n                        mw.liveEditSelector.pause();\r\n                        mw.trigger('PaddingControl', scope._active);\r\n                    }\r\n                    scope._pageY = e.pageY;\r\n                    scope._activePadding = curr;\r\n\r\n                }\r\n\r\n                if (scope._active && mw.liveedit.data.get('move', 'hasLayout')) {\r\n                    scope.show();\r\n                    scope.position();\r\n                } else {\r\n                    scope.hide();\r\n                }\r\n            });\r\n        };\r\n        this.show = function(){\r\n            scope.paddingTop.style.display = 'block';\r\n            scope.paddingBottom.style.display = 'block';\r\n        };\r\n\r\n        this.hide = function(){\r\n            scope.paddingTop.style.display = 'none';\r\n            scope.paddingBottom.style.display = 'none';\r\n        };\r\n\r\n        this.position = function(targetIsLayout) {\r\n            var $el = mw.$(targetIsLayout);\r\n            var off = $el.offset();\r\n            scope._active = targetIsLayout;\r\n            scope.paddingTop.style.top = off.top + 'px';\r\n            scope.paddingBottom.style.top = (off.top + $el.outerHeight() - this.settings.height) + 'px';\r\n        };\r\n\r\n        this.selectors = [\r\n            '.mw-padding-gui-element',\r\n            '.mw-padding-control-element',\r\n        ];\r\n\r\n        this.prepareSelectors = function(){\r\n            /* var i = 0;\r\n            for( ; i < this.selectors.length; i++){\r\n                if(this.selectors[i].indexOf('[id') === -1){\r\n                    this.selectors[i] += '[id]';\r\n                }\r\n            } */\r\n        };\r\n\r\n        this.addSelector = function(selector){\r\n            this.selectors.push(selector);\r\n            this.prepareSelectors();\r\n        };\r\n\r\n        this.eventsHandlers = function() {\r\n            mw.on('moduleOver ModuleClick', function(e, el){\r\n                if(!scope._working){\r\n                    var targetIsLayout = mw.tools.firstMatchesOnNodeOrParent(el, scope.selectors);\r\n                    if(targetIsLayout){\r\n                        if(mw.tools.hasClass(targetIsLayout, 'module')){\r\n                            var child = mw.$(targetIsLayout).children(scope.selectors.join(','))[0];\r\n                            targetIsLayout = child || targetIsLayout;\r\n                        }\r\n                        scope.position(targetIsLayout);\r\n                    } else {\r\n\r\n                    }\r\n                }\r\n            });\r\n        };\r\n\r\n        this.init = function() {\r\n            this.create();\r\n            this.eventsHandlers();\r\n            this.handleMouseMove();\r\n            this.prepareSelectors();\r\n            this.hide();\r\n        };\r\n\r\n        this.activeMark = function (state) {\r\n            if(typeof state === 'undefined') {\r\n                state = false;\r\n            }\r\n            if(!this._activeMark) {\r\n                this._activeMark = document.createElement('div');\r\n                this._activeMark.className = 'mw-padding-control-active-mark';\r\n                document.body.appendChild(this._activeMark);\r\n            }\r\n            if (state) {\r\n                mw.tools.addClass(this._activeMark, 'active');\r\n                var active = scope._paddingTopDown ? scope.paddingTop : scope.paddingBottom;\r\n                var off = scope._active.getBoundingClientRect();\r\n                this._activeMark.style.left = off.left + 'px';\r\n                this._activeMark.style.width = off.width + 'px';\r\n                this._activeMark.style.height = scope._activePadding + 'px';\r\n                if (scope._paddingTopDown) {\r\n                    this._activeMark.style.top = (off.top + scrollY) + 'px';\r\n                } else {\r\n                    this._activeMark.style.top = ((off.top + scrollY + mw.$(scope._active).outerHeight()) - parseFloat(scope._active.style.paddingBottom)) + 'px';\r\n                }\r\n            } else {\r\n                mw.tools.removeClass(this._activeMark, 'active');\r\n            }\r\n        };\r\n\r\n        this.generateCSS = function(obj, media){\r\n            if(!obj || !scope._active) return;\r\n\r\n            media = (media || 'all').trim();\r\n            var selector = mw.tools.generateSelectorForNode(scope._active);\r\n            var objCss = '{';\r\n            for (var i in obj) {\r\n                objCss += (i + ':' + obj[i] + ';');\r\n            }\r\n            objCss += '}';\r\n            var css = '@media ' + media  + ' {' + selector + objCss + '}';\r\n            return css;\r\n        };\r\n\r\n        this.info = function() {\r\n            if(!this._info){\r\n                this._info = document.createElement('div');\r\n                this._info.className = 'mw-padding-control-info';\r\n                document.body.appendChild(this._info);\r\n            }\r\n            mw.$(this._info).addClass('active');\r\n            var off;\r\n            if (scope._paddingTopDown) {\r\n                off = mw.$(scope.paddingTop).offset();\r\n                this._info.style.top = (off.top + scope.settings.height) + 'px';\r\n                this._info.innerHTML = scope._active.style.paddingTop;\r\n            } else if (scope._paddingBottomDown) {\r\n                off = mw.$(scope.paddingBottom).offset();\r\n                this._info.style.top = (off.top - scope.settings.height - 30) + 'px';\r\n                this._info.innerHTML = scope._active.style.paddingBottom;\r\n            }\r\n            this._info.style.left = (off.left + (scope._active.clientWidth/2)) + 'px';\r\n        };\r\n        this.init();\r\n    };\r\n\r\n})(window.mw);\r\n","mw.drag = mw.drag || {};\r\nmw.drag.plus = {\r\n    locked: false,\r\n    disabled: false,\r\n   // mouse_moved: false,\r\n    init: function (holder) {\r\n\r\n        if(this.disabled) return;\r\n\r\n        mw.drag.plusTop = document.querySelector('.mw-plus-top');\r\n        mw.drag.plusBottom = document.querySelector('.mw-plus-bottom');\r\n\r\n        if(mw.drag.plusTop) {\r\n            mw.drag.plusTop.style.top = -9999 + 'px';\r\n        }\r\n        if(mw.drag.plusBottom) {\r\n            mw.drag.plusBottom.style.top = -9999 + 'px';\r\n        }\r\n        mw.$(holder).on('mousemove touchmove click', function (e) {\r\n\r\n\r\n            if (mw.drag.plus.locked === false && mw.isDrag === false) {\r\n                if (e.pageY % 2 === 0 && mw.tools.isEditable(e)) {\r\n                    var whichPlus;\r\n\r\n                    var node = mw.drag.plus.selectNode(e.target);\r\n                    if(node && e.type === 'mousemove') {\r\n                        var off = $(node).offset();\r\n                        whichPlus = (e.pageY - off.top) > ((off.top + node.offsetHeight) - e.pageY) ? 'top' : 'bottom';\r\n                    }\r\n                    mw.drag.plus.set(node, whichPlus);\r\n                    mw.$(document.body).removeClass('editorKeyup');\r\n                }\r\n            }\r\n            else {\r\n                mw.drag.plusTop.style.top = -9999 + 'px';\r\n                mw.drag.plusBottom.style.top = -9999 + 'px';\r\n            }\r\n        });\r\n        mw.$(holder).on('mouseleave', function (e) {\r\n            if (mw.drag.plus.locked === false && (e.target !== mw.drag.plusTop && e.target !== mw.drag.plusBottom) ) {\r\n                mw.drag.plus.set(undefined);\r\n            }\r\n        });\r\n        mw.drag.plus.action();\r\n    },\r\n    selectNode: function (target) {\r\n\r\n        if(!target || mw.tools.hasAnyOfClassesOnNodeOrParent(target, ['noplus', 'noedit', 'noplus']) || mw.tools.hasClass(target, 'edit')) {\r\n            mw.drag.plusTop.style.top = -9999 + 'px';\r\n            mw.drag.plusBottom.style.top = -9999 + 'px';\r\n            return;\r\n        }\r\n        var comp = mw.tools.firstMatchesOnNodeOrParent(target, ['.module', '.element', 'p', '.mw-empty']);\r\n\r\n        if (comp\r\n            // && mw.tools.parentsOrCurrentOrderMatchOrOnlyFirstOrNone(target, ['regular-mode', 'safe-mode'])\r\n            && mw.tools.parentsOrCurrentOrderMatchOrOnlyFirstOrNone(target, ['allow-drop', 'nodrop']))  {\r\n            return comp;\r\n        }\r\n        else {\r\n            mw.drag.plusTop.style.top = -9999 + 'px';\r\n            mw.drag.plusBottom.style.top = -9999 + 'px';\r\n            return undefined;\r\n        }\r\n    },\r\n    set: function (node, whichPlus) {\r\n            if (typeof node === 'undefined') {\r\n                return;\r\n            }\r\n            var $node = mw.$(node)\r\n            var off = $node.offset(),\r\n                toolbar = document.querySelector('#live_edit_toolbar');\r\n            var oleft = Math.max(0, off.left - 10);\r\n            if(toolbar && off.top < toolbar.offsetHeight){\r\n              off.top = toolbar.offsetHeight + 10;\r\n            }\r\n            mw.drag.plusTop.style.top = off.top + 'px';\r\n            mw.drag.plusTop.style.left = oleft + ($node.width()/2) + 'px';\r\n            // mw.drag.plusTop.style.display = 'block';\r\n            mw.drag.plusTop.currentNode = node;\r\n            mw.drag.plusBottom.style.top = (off.top + node.offsetHeight) + 'px';\r\n            mw.drag.plusBottom.style.left = oleft + ($node.width()/2) + 'px';\r\n            if(whichPlus) {\r\n                if(whichPlus === 'top') {\r\n                    mw.drag.plusTop.style.top = -9999 + 'px';\r\n\r\n                } else {\r\n                     mw.drag.plusBottom.style.top = -9999 + 'px';\r\n                }\r\n            }\r\n            mw.drag.plusBottom.currentNode = node;\r\n            mw.tools.removeClass([mw.drag.plusTop, mw.drag.plusBottom], 'active');\r\n\r\n    },\r\n    tipPosition: function (node) {\r\n        return 'right-center';\r\n        var off = mw.$(node).offset();\r\n        if (off.top > 130) {\r\n            if ((off.top + node.offsetHeight) < ($(document.body).height() - 130)) {\r\n                return 'right-center';\r\n            }\r\n            else {\r\n                return 'right-bottom';\r\n            }\r\n        }\r\n        else {\r\n            return 'right-top';\r\n        }\r\n    },\r\n    rendModules: function (el) {\r\n        var other = el === mw.drag.plusTop ? mw.drag.plusBottom : mw.drag.plusTop;\r\n        if (!mw.tools.hasClass(el, 'active')) {\r\n            mw.tools.addClass(el, 'active');\r\n            mw.tools.removeClass(other, 'active');\r\n            mw.drag.plus.locked = true;\r\n            mw.$('.mw-tooltip-insert-module').remove();\r\n            mw.drag.plusActive = this === mw.drag.plusTop ? 'top' : 'bottom';\r\n            var tip = new mw.tooltip({\r\n                content: document.getElementById('plus-modules-list').innerHTML,\r\n                element: el,\r\n                position: mw.drag.plus.tipPosition(this.currentNode),\r\n                template: 'mw-tooltip-default mw-tooltip-insert-module',\r\n                id: 'mw-plus-tooltip-selector'\r\n            });\r\n            setTimeout(function (){\r\n                $('#mw-plus-tooltip-selector').addClass('active').find('.mw-ui-searchfield').focus();\r\n            }, 10)\r\n            mw.tabs({\r\n                nav: tip.querySelectorAll('.mw-ui-btn'),\r\n                tabs: tip.querySelectorAll('.module-bubble-tab'),\r\n            });\r\n\r\n            mw.$('.mw-ui-searchfield', tip).on('keyup paste', function () {\r\n                var resultsLength = mw.drag.plus.search(this.value, tip);\r\n                if (resultsLength === 0) {\r\n                    mw.$('.module-bubble-tab-not-found-message').html(mw.msg.no_results_for + ': <em>' + this.value + '</em>').show();\r\n                }\r\n                else {\r\n                    mw.$(\".module-bubble-tab-not-found-message\").hide();\r\n                }\r\n            });\r\n            mw.$('#plus-modules-list li').each(function () {\r\n                var name = mw.$(this).attr('data-module-name');\r\n                if(name === 'layout'){\r\n                    var template = mw.$(this).attr('template');\r\n                    mw.$(this).attr('onclick', 'InsertModule(\"' + name + '\", {class:this.className, template:\"'+template+'\"})');\r\n                } else {\r\n                    mw.$(this).attr('onclick', 'InsertModule(\"' + name + '\", {class:this.className})');\r\n                }\r\n            });\r\n\r\n        }\r\n    },\r\n    action: function () {\r\n        var pls = [mw.drag.plusTop, mw.drag.plusBottom];\r\n        var $pls = mw.$(pls);\r\n        $pls.on('mouseenter', function () {\r\n            mw.tools.addClass(document.body, 'body-mw-module-plus-hover');\r\n            mw.liveEditSelector.select(mw.drag.plusTop.currentNode);\r\n        });\r\n        $pls.on('mouseleave', function () {\r\n            mw.tools.removeClass(document.body, 'body-mw-module-plus-hover')\r\n        });\r\n        $pls.on('click', function () {\r\n            mw.drag.plus.rendModules(this)\r\n        });\r\n\r\n    },\r\n    search: function (val, root) {\r\n        var all = root.querySelectorAll('.module_name'),\r\n            l = all.length,\r\n            i = 0;\r\n        val = val.toLowerCase();\r\n        var found = 0;\r\n        var isEmpty = val.replace(/\\s+/g, '') === '';\r\n        for (; i < l; i++) {\r\n            var text = all[i].innerHTML.toLowerCase();\r\n            var li = mw.tools.firstParentWithTag(all[i], 'li');\r\n            var filter = (li.dataset.filter || '').trim().toLowerCase();\r\n            if (text.contains(val) || isEmpty) {\r\n                li.style.display = '';\r\n                if (text.contains(val)) found++;\r\n            }\r\n            else if(filter.contains(val)){\r\n                li.style.display = '';\r\n                found++;\r\n            }\r\n            else {\r\n                li.style.display = 'none';\r\n            }\r\n        }\r\n        return found;\r\n    }\r\n};\r\n\r\n\r\nvar insertModule = function (target, module, config, pos) {\r\n    return new Promise(function (resolve) {\r\n        pos = pos || 'bottom';\r\n        var action;\r\n        var id = mw.id('mw-module-'), el = '<div id=\"' + id + '\"></div>';\r\n        if (pos === 'top') {\r\n            action = 'before';\r\n            if(mw.tools.hasClass(target, 'allow-drop')) {\r\n                action = 'prepend';\r\n            }\r\n        } else if (pos === 'bottom') {\r\n            action = 'after';\r\n            if(mw.tools.hasClass(target, 'allow-drop')) {\r\n                action = 'append';\r\n            }\r\n        }\r\n        mw.$(mw.drag.plusBottom.currentNode)[action](el);\r\n        mw.load_module(module, '#' + id, function () {\r\n            resolve(this);\r\n        }, config);\r\n    });\r\n};\r\n\r\nInsertModule = function (module, cls, action) {\r\n\r\n    var position = mw.drag.plusActive === 'top' ? 'top' : 'bottom';\r\n\r\n    insertModule(mw.drag.plusTop.currentNode, module, cls, position).then(function (el) {\r\n        mw.wysiwyg.change(el);\r\n        mw.drag.plus.locked = false;\r\n        mw.drag.fixes();\r\n        setTimeout(function () { mw.drag.fix_placeholders(); }, 40);\r\n        mw.dropable.hide();\r\n    });\r\n    mw.$('.mw-tooltip').hide();\r\n\r\n};\r\n\r\n\r\n","(function (){\r\n    var css = function(element, css){\r\n        for(var i in css){\r\n            element.style[i] = typeof css[i] === 'number' ? css[i] + 'px' : css[i];\r\n        }\r\n    };\r\n\r\n    mw.Selector = function(options) {\r\n\r\n        options = options || {};\r\n\r\n        var defaults = {\r\n            autoSelect: true,\r\n            document: document,\r\n            toggleSelect: false, // second click unselects element\r\n            strict: false // only match elements that have id\r\n        };\r\n\r\n        this.options = $.extend({}, defaults, options);\r\n        this.document = this.options.document;\r\n\r\n\r\n        this.buildSelector = function(){\r\n            var stop = this.document.createElement('div');\r\n            var sright = this.document.createElement('div');\r\n            var sbottom = this.document.createElement('div');\r\n            var sleft = this.document.createElement('div');\r\n\r\n            stop.className = 'mw-selector mw-selector-top';\r\n            sright.className = 'mw-selector mw-selector-right';\r\n            sbottom.className = 'mw-selector mw-selector-bottom';\r\n            sleft.className = 'mw-selector mw-selector-left';\r\n\r\n            this.document.body.appendChild(stop);\r\n            this.document.body.appendChild(sright);\r\n            this.document.body.appendChild(sbottom);\r\n            this.document.body.appendChild(sleft);\r\n\r\n            this.selectors.push({\r\n                top:stop,\r\n                right:sright,\r\n                bottom:sbottom,\r\n                left:sleft,\r\n                active:false\r\n            });\r\n        };\r\n        this.getFirstNonActiveSelector = function(){\r\n            var i = 0;\r\n            for( ; i <  this.selectors.length; i++){\r\n                if(!this.selectors[i].active){\r\n                    return this.selectors[i]\r\n                }\r\n            }\r\n            this.buildSelector();\r\n            return this.selectors[this.selectors.length-1];\r\n        };\r\n        this.deactivateAll = function(){\r\n            var i = 0;\r\n            for( ; i <  this.selectors.length; i++){\r\n                this.selectors[i].active = false;\r\n            }\r\n        };\r\n\r\n\r\n        this.pause = function(){\r\n            this.active(false);\r\n            this.hideAll();\r\n        };\r\n        this.hideAll = function(){\r\n            var i = 0;\r\n            for( ; i <  this.selectors.length; i++){\r\n                this.hideItem(this.selectors[i]);\r\n            }\r\n            this.hideItem(this.interactors)\r\n        };\r\n\r\n        this.hideItem = function(item){\r\n\r\n            item.active = false;\r\n            for (var x in item){\r\n                if(!item[x]) continue;\r\n                item[x].style.visibility = 'hidden';\r\n            }\r\n        };\r\n        this.showItem = function(item){\r\n            for (var x in item) {\r\n                if(typeof item[x] === 'boolean' || !item[x].className || item[x].className.indexOf('mw-selector') === -1) continue;\r\n                item[x].style.visibility = 'visible';\r\n            }\r\n        };\r\n\r\n        this.buildInteractor = function(){\r\n            var stop = this.document.createElement('div');\r\n            var sright = this.document.createElement('div');\r\n            var sbottom = this.document.createElement('div');\r\n            var sleft = this.document.createElement('div');\r\n\r\n            stop.className = 'mw-selector mw-interactor mw-selector-top';\r\n            sright.className = 'mw-selector mw-interactor mw-selector-right';\r\n            sbottom.className = 'mw-selector mw-interactor mw-selector-bottom';\r\n            sleft.className = 'mw-selector mw-interactor mw-selector-left';\r\n\r\n            this.document.body.appendChild(stop);\r\n            this.document.body.appendChild(sright);\r\n            this.document.body.appendChild(sbottom);\r\n            this.document.body.appendChild(sleft);\r\n\r\n            this.interactors = {\r\n                top:stop,\r\n                right:sright,\r\n                bottom:sbottom,\r\n                left:sleft\r\n            };\r\n        };\r\n        this.isSelected = function(e){\r\n            var target = e.target?e.target:e;\r\n            return this.selected.indexOf(target) !== -1;\r\n        };\r\n\r\n        this.unsetItem = function(e){\r\n            var target = e.target?e.target:e;\r\n            for(var i = 0;i<this.selectors.length;i++){\r\n                if(this.selectors[i].active === target){\r\n                    this.hideItem(this.selectors[i]);\r\n                    break;\r\n                }\r\n            }\r\n            this.selected.splice(this.selected.indexOf(target), 1);\r\n        };\r\n\r\n        this.positionSelected = function(){\r\n            for(var i = 0;i<this.selectors.length;i++){\r\n                this.position(this.selectors[i], this.selectors[i].active)\r\n            }\r\n        };\r\n        this.position = function(item, target){\r\n            var off = mw.$(target).offset();\r\n            css(item.top, {\r\n                top:off.top,\r\n                left:off.left,\r\n                width:target.offsetWidth\r\n            });\r\n            css(item.right, {\r\n                top:off.top,\r\n                left:off.left+target.offsetWidth,\r\n                height:target.offsetHeight\r\n            });\r\n            css(item.bottom, {\r\n                top:off.top+target.offsetHeight,\r\n                left:off.left,\r\n                width:target.offsetWidth\r\n            });\r\n            css(item.left, {\r\n                top:off.top,\r\n                left:off.left,\r\n                height:target.offsetHeight\r\n            });\r\n        };\r\n\r\n        this.setItem = function(e, item, select, extend){\r\n            if(!e || !this.active()) return;\r\n            var target = e.target ? e.target : e;\r\n            if (this.options.strict) {\r\n                target = mw.tools.firstMatchesOnNodeOrParent(target, ['[id]', '.edit']);\r\n            }\r\n            var validateTarget = !mw.tools.firstMatchesOnNodeOrParent(target, ['.mw-control-box', '.mw-defaults']);\r\n            if(!target || !validateTarget) return;\r\n            if($(target).hasClass('mw-select-skip')){\r\n                return this.setItem(target.parentNode, item, select, extend);\r\n            }\r\n            if(select){\r\n                if(this.options.toggleSelect && this.isSelected(target)){\r\n                    this.unsetItem(target);\r\n                    return false;\r\n                }\r\n                else{\r\n                    if(extend){\r\n                        this.selected.push(target);\r\n                    }\r\n                    else{\r\n                        this.selected = [target];\r\n                    }\r\n                    mw.$(this).trigger('select', [this.selected]);\r\n                }\r\n\r\n            }\r\n\r\n\r\n            this.position(item, target);\r\n\r\n            item.active = target;\r\n\r\n            this.showItem(item);\r\n        };\r\n\r\n        this.select = function(e, target){\r\n            if(!e && !target) return;\r\n            if(!e.nodeType){\r\n                target = target || e.target;\r\n            } else{\r\n                target = e;\r\n            }\r\n\r\n            if(e.ctrlKey){\r\n                this.setItem(target, this.getFirstNonActiveSelector(), true, true);\r\n            }\r\n            else{\r\n                this.hideAll();\r\n                this.setItem(target, this.selectors[0], true, false);\r\n            }\r\n\r\n        };\r\n\r\n        this.deselect = function(e, target){\r\n            e.preventDefault();\r\n            target = target || e.target;\r\n\r\n            this.unsetItem(target);\r\n\r\n        };\r\n\r\n        this.init = function(){\r\n            this.buildSelector();\r\n            this.buildInteractor();\r\n            var scope = this;\r\n            mw.$(this.root).on(\"click\", function(e){\r\n                if(scope.options.autoSelect && scope.active()){\r\n                    scope.select(e);\r\n                }\r\n            });\r\n\r\n            mw.$(this.root).on( \"mousemove touchmove touchend\", function(e){\r\n                if(scope.options.autoSelect && scope.active()){\r\n                    scope.setItem(e, scope.interactors);\r\n                }\r\n            });\r\n            mw.$(this.root).on( 'scroll', function(){\r\n                scope.positionSelected();\r\n            });\r\n            mw.$(window).on('resize orientationchange', function(){\r\n                scope.positionSelected();\r\n            });\r\n        };\r\n\r\n        this._active = false;\r\n        this.active = function (state) {\r\n            if(typeof state === 'undefined') {\r\n                return this._active;\r\n            }\r\n            if(this._active !== state) {\r\n                this._active = state;\r\n                mw.$(this).trigger('stateChange', [state]);\r\n            }\r\n        };\r\n        this.selected = [];\r\n        this.selectors = [];\r\n        this.root = options.root;\r\n        this.init();\r\n    };\r\n\r\n})()\r\n","mw.editSource = function (node) {\r\n    if (!mw._editSource) {\r\n        mw._editSource = {\r\n            wrapper: document.createElement('div'),\r\n            area: document.createElement('textarea'),\r\n            ok: document.createElement('mwbtn'),\r\n            cancel: document.createElement('mwbtn'),\r\n            nav:document.createElement('div'),\r\n            validator:document.createElement('div')\r\n        };\r\n        mw.$(mw._editSource.ok).addClass('mw-ui-btn mw-ui-btn-medium mw-ui-btn-info').html(mw.lang('OK'));\r\n        mw.$(mw._editSource.cancel).addClass('mw-ui-btn mw-ui-btn-medium').html(mw.lang('Cancel'));\r\n\r\n        mw._editSource.wrapper.appendChild(mw._editSource.area);\r\n        mw._editSource.wrapper.appendChild(mw._editSource.nav);\r\n        mw._editSource.nav.appendChild(mw._editSource.cancel);\r\n        mw._editSource.nav.appendChild(mw._editSource.ok);\r\n        mw._editSource.nav.className = 'mw-inline-source-editor-buttons';\r\n        mw._editSource.wrapper.className = 'mw-inline-source-editor';\r\n        document.body.appendChild(mw._editSource.wrapper);\r\n        mw.$(mw._editSource.cancel).on('click', function () {\r\n            mw.$(mw._editSource.target).html(mw._editSource.area.value);\r\n            mw.$(mw._editSource.wrapper).removeClass('active');\r\n            mw._editSource.ok.disabled = false;\r\n        });\r\n        mw.$(mw._editSource.area).on('input', function () {\r\n            mw._editSource.validator.innerHTML = mw._editSource.area.value;\r\n            mw._editSource.ok.disabled = mw._editSource.validator.innerHTML !== mw._editSource.area.value;\r\n            mw._editSource.ok.classList[mw._editSource.ok.disabled ? 'add' : 'remove']('disabled');\r\n            var hasErr = mw.$('.mw-inline-source-editor-error', mw._editSource.nav);\r\n            if(mw._editSource.ok.disabled) {\r\n                if(!hasErr.length) {\r\n                    mw.$(mw._editSource.nav).prepend('<span class=\"mw-inline-source-editor-error\">' + mw.lang('Invalid HTML') + '</span>');\r\n                }\r\n            }\r\n            else {\r\n                hasErr.remove()\r\n            }\r\n        });\r\n        mw.$(mw._editSource.ok).on('click', function () {\r\n            if(!mw._editSource.ok.disabled){\r\n                mw.$(mw._editSource.target).html(mw._editSource.area.value);\r\n                mw.$(mw._editSource.wrapper).removeClass('active');\r\n                mw.wysiwyg.change(mw._editSource.target);\r\n            }\r\n        });\r\n    }\r\n    mw._editSource.area.value = node.innerHTML;\r\n    mw._editSource.target = node;\r\n    var $node = mw.$(node), off = $node.offset(), nwidth = $node.outerWidth();\r\n    var sl = mw.$('.mw-live-edit-sidebar-tabs-wrapper').offset();\r\n    if (off.left + nwidth > sl.left) {\r\n        off.left -= ((off.left + nwidth) - sl.left + 10);\r\n    }\r\n    mw.$(mw._editSource.area)\r\n        .height($node.outerHeight())\r\n        .width(nwidth);\r\n\r\n    mw.$(mw._editSource.wrapper)\r\n        .css(off)\r\n        .addClass('active');\r\n\r\n\r\n};\r\n","mw.tempCSS = function(options){\r\n\r\n    var scope = this;\r\n\r\n    options = options || {};\r\n\r\n    var defaults = {\r\n        document: document,\r\n        css: {}\r\n    };\r\n\r\n    this.settings = $.extend({}, defaults, options);\r\n\r\n    this.styleElement = function() {\r\n        if(!this._styleElement){\r\n            this._styleElement = this.settings.document.createElement('style');\r\n            this._styleElement.type = 'text/css';\r\n            this._styleElement.appendChild(document.createTextNode('')); // webkit\r\n            this.settings.document.body.appendChild(this._styleElement);\r\n        }\r\n        return this._styleElement;\r\n    };\r\n\r\n    this.modifyObject = function(){\r\n\r\n    };\r\n\r\n    this.addStyle = function(element, style, media){\r\n        if(!element) return;\r\n        if(element.tagName) {\r\n            element = mw.tools.generateSelectorForNode(element);\r\n        }\r\n    };\r\n};\r\n","mw.liveedit.toolbar = {\n    fixPad: function () {\n        document.body.style.paddingTop = parseFloat($(document.body).css(\"paddingTop\")) + mw.$(\"#live_edit_toolbar\").height() + 'px';\n    },\n    setEditor: function(){\n\n    },\n    prepare: function () {\n        mw.$(\"#liveedit_wysiwyg\")\n            .on('mousedown touchstart',function() {\n                if (mw.$(\".mw_editor_btn_hover\").length === 0) {\n                    mw.mouseDownOnEditor = true;\n                    mw.$(this).addClass(\"hover\");\n                }\n            })\n            .on('mouseup touchend',function() {\n                mw.mouseDownOnEditor = false;\n                mw.$(this).removeClass(\"hover\");\n            });\n        mw.$(window).scroll(function() {\n            if ($(window).scrollTop() > 10) {\n                mw.tools.addClass(document.getElementById('live_edit_toolbar'), 'scrolling');\n            } else {\n                mw.tools.removeClass(document.getElementById('live_edit_toolbar'), 'scrolling');\n            }\n\n        });\n        mw.$(\"#live_edit_toolbar\").hover(function() {\n            mw.$(document.body).addClass(\"toolbar-hover\");\n        }, function() {\n            mw.$(document.body).removeClass(\"toolbar-hover\");\n        });\n    },\n    editor: {\n        init: function () {\n            this.ed = document.getElementById('liveedit_wysiwyg');\n            this.nextBTNS = mw.$(\".liveedit_wysiwyg_next\");\n            this.prevBTNS = mw.$(\".liveedit_wysiwyg_prev\") ;\n        },\n        calc: {\n            SliderButtonsNeeded: function (parent) {\n                var t = {left: false, right: false};\n                if (parent == null || !parent) {\n                    return;\n                }\n                var el = parent.firstElementChild;\n                if ($(parent).width() > mw.$(el).width()) return t;\n                var a = mw.$(parent).offset().left + mw.$(parent).width();\n                var b = mw.$(el).offset().left + mw.$(el).width();\n                if (b > a) {\n                    t.right = true;\n                }\n                if ($(el).offset().left < mw.$(parent).offset().left) {\n                    t.left = true;\n                }\n                return t;\n            },\n            SliderNormalize: function (parent) {\n                if (parent === null || !parent) {\n                    return false;\n                }\n                var el = parent.firstElementChild;\n                var a = mw.$(parent).offset().left + mw.$(parent).width();\n                var b = mw.$(el).offset().left + mw.$(el).width();\n                if (b < a) {\n                    return (a - b);\n                }\n                return false;\n            },\n            SliderNext: function (parent, step) {\n                if (parent === null || !parent) {\n                    return false;\n                }\n                var el = parent.firstElementChild;\n                if ($(parent).width() > mw.$(el).width()) return 0;\n                var a = mw.$(parent).offset().left + mw.$(parent).width();\n                var b = mw.$(el).offset().left + mw.$(el).width();\n                step = step || mw.$(parent).width();\n                var curr = parseFloat(window.getComputedStyle(el, null).left);\n                if (a < b) {\n                    if ((b - step) > a) {\n                        return (curr - step);\n                    }\n                    else {\n                        return curr - (b - a);\n                    }\n                }\n                else {\n                    return curr - (b - a);\n                }\n            },\n            SliderPrev: function (parent, step) {\n                if (parent === null || !parent) {\n                    return false;\n                }\n                var el = parent.firstElementChild;\n                step = step || mw.$(parent).width();\n                var curr = parseFloat(window.getComputedStyle(el, null).left);\n                if (curr < 0) {\n                    if ((curr + step) < 0) {\n                        return (curr + step);\n                    }\n                    else {\n                        return 0;\n                    }\n                }\n                else {\n                    return 0;\n                }\n            }\n        },\n\n        step: function () {\n            return $(mw.liveedit.toolbar.editor.ed).width();\n        },\n        denied: false,\n        buttons: function () {\n            var b = mw.liveedit.toolbar.editor.calc.SliderButtonsNeeded(mw.liveedit.toolbar.editor.ed);\n            if (!b) {\n                return;\n            }\n            if (b.left) {\n                mw.liveedit.toolbar.editor.prevBTNS.addClass('active');\n            }\n            else {\n                mw.liveedit.toolbar.editor.prevBTNS.removeClass('active');\n            }\n            if (b.right) {\n                mw.liveedit.toolbar.editor.nextBTNS.addClass('active');\n            }\n            else {\n                mw.liveedit.toolbar.editor.nextBTNS.removeClass('active');\n            }\n        },\n        slideLeft: function () {\n            if (!mw.liveedit.toolbar.editor.denied) {\n                mw.liveedit.toolbar.editor.denied = true;\n                var el = mw.liveedit.toolbar.editor.ed.firstElementChild;\n                var to = mw.liveedit.toolbar.editor.calc.SliderPrev(mw.liveedit.toolbar.editor.ed, mw.liveedit.toolbar.editor.step());\n                $(el).animate({left: to}, function () {\n                    mw.liveedit.toolbar.editor.denied = false;\n                    mw.liveedit.toolbar.editor.buttons();\n                });\n            }\n        },\n        slideRight: function () {\n            if (!mw.liveedit.toolbar.editor.denied) {\n                mw.liveedit.toolbar.editor.denied = true;\n                var el = mw.liveedit.toolbar.editor.ed.firstElementChild;\n\n                var to = mw.liveedit.toolbar.editor.calc.SliderNext(mw.liveedit.toolbar.editor.ed, mw.liveedit.toolbar.editor.step());\n                $(el).animate({left: to}, function () {\n                    mw.liveedit.toolbar.editor.denied = false;\n                    mw.liveedit.toolbar.editor.buttons();\n                });\n            }\n        },\n        fixConvertible: function (who) {\n            who = who || \".wysiwyg-convertible\";\n            who = $(who);\n            if (who.length > 1) {\n                $(who).each(function () {\n                    mw.liveedit.toolbar.editor.fixConvertible(this);\n                });\n                return false;\n            }\n            else {\n                var w = $(window).width();\n                var w1 = who.offset().left + who.width();\n                if (w1 > w) {\n                    who.css(\"left\", -(w1 - w));\n                }\n                else {\n                    who.css(\"left\", 0);\n                }\n            }\n        }\n    }\n\n};\n","mw.liveedit = mw.liveedit || {};\nmw.liveedit.widgets = {\n    htmlEditorDialog: function () {\n        var src = mw.settings.site_url + 'api/module?id=mw_global_html_editor&live_edit=true&module_settings=true&type=editor/code_editor&autosize=true';\n        // window.open(src, \"Code editor\", \"toolbar=no, menubar=no,scrollbars=yes,resizable=yes,location=no,directories=no,status=yes\");\n        mw.dialogIframe({\n            url: src,\n            title: 'Code editor',\n            height: 'auto',\n            width: '95%'\n        });\n    },\n    cssEditorDialog: function () {\n        var src = mw.settings.site_url + 'api/module?id=mw_global_css_editor&live_edit=true&module_settings=true&type=editor/css_editor&autosize=true';\n        return mw.dialogIframe({\n            url: src,\n            // width: 500,\n            height:'auto',\n            autoHeight: true,\n            name: 'mw-css-editor-front',\n            title: 'CSS Editor',\n            template: 'default',\n            center: false,\n            resize: true,\n            draggable: true\n        });\n    }\n};\n","/* WYSIWYG Editor */\n/* ContentEditable Functions */\n\nmw.require('css_parser.js');\nmw.require('icon_selector.js');\nmw.require('events.js');\n\n//mw.lib.require('rangy');\n\nclassApplier = window.classApplier || [];\nif (!Element.prototype.matches) {\n    Element.prototype.matches =\n        Element.prototype.matchesSelector ||\n        Element.prototype.mozMatchesSelector ||\n        Element.prototype.msMatchesSelector ||\n        Element.prototype.oMatchesSelector ||\n        Element.prototype.webkitMatchesSelector ||\n        function (s) {\n            var matches = (this.document || this.ownerDocument).querySelectorAll(s),\n                i = matches.length;\n            while (--i >= 0 && matches.item(i) !== this) {\n            }\n            return i > -1;\n        };\n}\n\nif (typeof Selection.prototype.containsNode === 'undefined') {\n    Selection.prototype.containsNode = function (a) {\n        if (this.rangeCount === 0) {\n            return false;\n        }\n        var r = this.getRangeAt(0);\n        if (r.commonAncestorContainer === a) {\n            return true;\n        }\n        if (r.endContainer === a) {\n            return true;\n        }\n        if (r.startContainer === a) {\n            return true;\n        }\n        if (r.commonAncestorContainer.parentNode === a) {\n            return true;\n        }\n        if (a.nodeType !== 3) {\n            var c = mw.wysiwyg.validateCommonAncestorContainer(r.commonAncestorContainer),\n                b = c.querySelectorAll(a.nodeName.toLowerCase()),\n                l = b.length,\n                i = 0;\n            if (l > 0) {\n                for (; i < l; i++) {\n                    if (b[i] === a) {\n                        return true;\n                    }\n                }\n            }\n        }\n        return false;\n    }\n}\n\nif (typeof Range.prototype.querySelector === 'undefined') {\n    Range.prototype.querySelector = function (s) {\n        var r = this;\n        var f = r.extractContents();\n        var node = f.querySelector(s);\n        r.insertNode(f);\n        return node;\n    }\n}\n\nif (typeof Range.prototype.querySelectorAll === 'undefined') {\n    Range.prototype.querySelectorAll = function (s) {\n        var r = this;\n        var f = r.extractContents();\n        var nodes = f.querySelectorAll(s);\n        r.insertNode(f);\n        return nodes;\n    };\n}\nmw.wysiwyg = {\n\n    isSafeMode: function (el) {\n        if (!el) {\n            var sel = window.getSelection();\n            if(!sel.rangeCount) return false;\n            var range = sel.getRangeAt(0);\n            el = mw.wysiwyg.validateCommonAncestorContainer(range.commonAncestorContainer);\n        }\n        var hasSafe = mw.tools.hasAnyOfClassesOnNodeOrParent(el, ['safe-mode']);\n        var regInsafe = mw.tools.parentsOrCurrentOrderMatchOrNone(el, ['regular-mode', 'safe-mode']);\n        return hasSafe && !regInsafe;\n    },\n    parseClassApplierSheet: function () {\n        var sheet = document.querySelector('link[classApplier]');\n        if (sheet !== null) {\n            var rules = sheet.sheet.rules;\n            for (var i = 0; i < rules.length; i++) {\n                if (!rules[i].selectorText) continue;\n\n                var rule = rules[i].selectorText.trim();\n                var spl = rule.split('.')\n                if (rule.indexOf('.') === 0\n                    && rule.indexOf(':') === -1\n                    && rule.indexOf('#') === -1\n                    && spl.length === 2\n                    && rule.indexOf('[') === -1) {\n                    classApplier.push(spl[1]);\n                }\n            }\n        }\n    },\n    initClassApplier: function () {\n        this.parseClassApplierSheet();\n        var dropdown = mw.$('#format_main ul');\n        classApplier.forEach(function (cls, i) {\n            dropdown.append('<li value=\".' + cls + '\"><a href=\"#\"><div class=\"' + cls + '\">Custom ' + i + '</div></a></li>')\n        })\n    },\n    editInsideModule: function (el) {\n        el = el.target ? el.target : el;\n        var order = mw.tools.parentsOrder(el, ['edit', 'module']);\n        if (order.edit < order.module) {\n            return true;\n        }\n        else {\n            return false;\n        }\n    },\n    pasteFromWordUI: function () {\n        if (!mw.wysiwyg.isSelectionEditable()) return false;\n        mw.wysiwyg.save_selection();\n        var cleaner = mw.$('<div class=\"mw-cleaner-block\" contenteditable=\"true\"><small class=\"muted\">Paste document here.</small></div>')\n        var inserter = mw.$('<span class=\"mw-ui-btn mw-ui-btn-medium mw-ui-btn-invert pull-right\">Insert</span>')\n        var clean = mw.dialog({\n            content: cleaner,\n            overlay: true,\n            title: 'Paste from word',\n            footer: inserter,\n            height: 'auto',\n            autoHeight: true\n        });\n        cleaner.on('paste', function () {\n            setTimeout(function () {\n                cleaner[0].innerHTML = mw.wysiwyg.clean_word(cleaner[0].innerHTML);\n            }, 100)\n\n        });\n        cleaner.on('click', function () {\n            if (!$(this).hasClass('active')) {\n                mw.$(this).addClass('active')\n                mw.$(this).html('')\n            }\n        });\n        inserter.on('click', function () {\n            mw.wysiwyg.restore_selection();\n            mw.wysiwyg.insert_html(cleaner.html());\n            clean.remove();\n        });\n        //cleaner.after(inserter)\n    },\n    globalTarget: document.body,\n    allStatements: function (c, f) {\n        var sel = window.getSelection(),\n            range = sel.getRangeAt(0),\n            common = mw.wysiwyg.validateCommonAncestorContainer(range.commonAncestorContainer);\n        //var nodrop_state = !mw.tools.hasClass(common, 'nodrop') && !mw.tools.hasParentsWithClass(common, 'nodrop');\n        var nodrop_state = mw.tools.parentsOrCurrentOrderMatchOrOnlyFirstOrNone(common, ['allow-drop', 'nodrop']);\n\n        if (mw.wysiwyg.isSelectionEditable() && nodrop_state) {\n            if (typeof c === 'function') {\n                c.call();\n            }\n        }\n        else {\n            if (typeof f === 'function') {\n                f.call();\n            }\n        }\n    },\n    action: {\n        removeformat: function () {\n            var sel = window.getSelection();\n            var r = sel.getRangeAt(0);\n            var c = r.commonAncestorContainer;\n            mw.wysiwyg.removeStyles(c, sel);\n        }\n    },\n    removeStyles: function (common, sel) {\n        if (!!common.querySelectorAll) {\n            var all = common.querySelectorAll('*'), l = all.length, i = 0;\n            for (; i < l; i++) {\n                var el = all[i];\n                if (typeof sel !== 'undefined' && sel.containsNode(el, true)) {\n                    mw.$(el).removeAttr(\"style\");\n                }\n            }\n        }\n        else {\n            mw.wysiwyg.removeStyles(common.parentNode);\n        }\n    },\n    init_editables: function (module) {\n        if (window['mwAdmin']) {\n            if (typeof module !== 'undefined') {\n                mw.wysiwyg.contentEditable(module, false);\n                mw.$(module.querySelectorAll(\".edit\")).each(function () {\n                    mw.wysiwyg.contentEditable(this, true);\n                    mw.on.DOMChange(this, function () {\n                        mw.wysiwyg.change(this);\n                    });\n                });\n            }\n            else {\n                var editables = document.querySelectorAll('[contenteditable]'), l = editables.length, x = 0;\n                for (; x < l; x++) {\n                    mw.wysiwyg.contentEditable(editables[x], 'inherit');\n                }\n                mw.$(\".edit\").each(function () {\n                    mw.on.DOMChange(this, function () {\n                        mw.wysiwyg.change(this);\n                        if (this.querySelectorAll('*').length === 0 && mw.live_edit.hasAbilityToDropElementsInside(this)) {\n                            mw.wysiwyg.modify(this, function () {\n                                if (!mw.wysiwyg.isSafeMode(this)) {\n                                    this.innerHTML = '<p class=\"element\">' + this.innerHTML + '</p>';\n                                }\n                            });\n                        }\n                        mw.wysiwyg.normalizeBase64Images(this);\n                    }, false, true);\n                    mw.$(this).mouseenter(function () {\n                        if (this.querySelectorAll('*').length === 0 && mw.live_edit.hasAbilityToDropElementsInside(this)) {\n\n                            mw.wysiwyg.modify(this, function () {\n                                if (!mw.wysiwyg.isSafeMode(this)) {\n                                    this.innerHTML = '<p class=\"element\">' + this.innerHTML + '&nbsp;</p>';\n                                }\n                            });\n                        }\n                    });\n                });\n                mw.$(\".empty-element, .ui-resizable-handle\").each(function () {\n                    mw.wysiwyg.contentEditable(this, false);\n                });\n                mw.on.moduleReload(function () {\n                    mw.wysiwyg.nceui();\n                })\n            }\n        }\n    },\n    modify: function (el, callback) {\n        var curr = mw.askusertostay;\n        if (typeof el === 'function') {\n            callback = el;\n            callback.call();\n        }\n        else {\n            callback.call(el);\n        }\n        mw.askusertostay = curr;\n    },\n    fixElements: function (parent) {\n        var a = parent.querySelectorAll(\".element\"), l = a.length;\n        i = 0;\n        for (; i < l; i++) {\n            if (a[i].innerHTML === '' || a[i].innerHTML.replace(/\\s+/g, '') === '') {\n                a[i].innerHTML = '&zwj;&nbsp;&zwj;';\n            }\n        }\n    },\n    removeEditable: function (skip) {\n        skip = skip || [];\n             var i=0, i2,\n                all = document.getElementsByClassName('edit'),\n                len = all.length;\n            for (; i < len; i++) {\n                if(skip.length) {\n                    var shouldSkip = false;\n                    mw.wysiwyg.contentEditable(all[i], false);\n                    for (i2=0;i2<skip.length;i2++){\n                        if(skip[i2] === all[i]) {\n                            shouldSkip = true;\n                        }\n                    }\n                    if(!shouldSkip) {\n                        mw.wysiwyg.contentEditable(all[i], false);\n                    }\n\n                } else {\n                    mw.wysiwyg.contentEditable(all[i], false);\n                }\n\n            }\n\n    },\n    _lastCopy: null,\n    handleCopyEvent: function (event) {\n        this._lastCopy = event.target;\n    },\n    contentEditableSplitTypes: function (el) {\n\n    },\n    contentEditable: function (el, state) {\n        if (!el) {\n            return;\n        }\n        if(el.nodeType !== 1){\n            el = mw.wysiwyg.validateCommonAncestorContainer(el);\n            if (!el) {\n                return;\n            }\n        }\n        if(typeof state === 'undefined'){\n            return el.contentEditable;\n        }\n        if (state) {\n            mw.on.DOMChangePause = true;\n            if (!el._handleCopy) {\n                el._handleCopy = true;\n                mw.$(el).on('copy', function(ev){\n                    mw.wysiwyg.handleCopyEvent(ev);\n                });\n            }\n        }\n        if(state === true){\n            state = 'true';\n        } else if(state === false) {\n            state = 'false';\n        }\n        if(state === 'true'){\n            if(mw.wysiwyg.isSafeMode(el)){\n            } else {\n\n                el = mw.tools.firstParentOrCurrentWithAnyOfClasses(el, ['edit', 'regular-mode']);\n            }\n        }\n        if (typeof(mw.liveedit) != 'undefined' && mw.liveedit.data.set('mouseup', 'isIcon')) {\n            state = false;\n        }\n        if(el && el.contentEditable !== state) { // chrome setter needs a check\n\n            el.contentEditable = state;\n        }\n\n        mw.on.DOMChangePause = false;\n    },\n\n    prepareContentEditable: function () {\n        mw.on(\"EditMouseDown\", function (e, el, target, originalEvent) {\n            mw.$('.safe-mode').each(function () {\n                mw.wysiwyg.contentEditable(this, 'inherit');\n            });\n\n            if (!mw.wysiwyg.isSafeMode(target)) {\n\n                    var orderValid = mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(originalEvent.target, ['edit', 'module']);\n                    mw.$('.safe-mode').each(function () {\n                        mw.wysiwyg.contentEditable(this, false);\n                    });\n                    mw.wysiwyg.contentEditable(target, orderValid);\n\n            }\n            else {\n                var firstBlock = target;\n                var blocks = ['p', 'div', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'header', 'section', 'footer', 'ul', 'ol'];\n                var blocksClass = ['safe-element'];\n                var po = mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(firstBlock, ['edit', 'module']);\n\n                if (po) {\n                    if (blocks.indexOf(firstBlock.nodeName.toLocaleLowerCase()) === -1 && !mw.tools.hasAnyOfClassesOnNodeOrParent(firstBlock, blocksClass)) {\n                        var cls = [];\n                        blocksClass.forEach(function (item) {\n                            cls.push('.' + item);\n                        });\n                        cls = cls.concat(blocks);\n                        firstBlock = mw.tools.firstMatchesOnNodeOrParent(firstBlock, cls);\n                    }\n                     mw.$(\"[contenteditable='true']\").not(firstBlock).attr(\"contenteditable\", \"false\");\n                    mw.wysiwyg.contentEditable(firstBlock, true);\n                }\n\n            }\n\n\n        });\n    },\n    hide_drag_handles: function () {\n        mw.$(\".mw-wyswyg-plus-element\").hide();\n    },\n    show_drag_handles: function () {\n        mw.$(\".mw-wyswyg-plus-element\").show();\n    },\n\n    _external: function () {\n        var external = document.createElement('div');\n        external.className = 'wysiwyg_external';\n        document.body.appendChild(external);\n        return external;\n    },\n    isSelectionEditable: function (sel) {\n        try {\n            var node = (sel || window.getSelection()).focusNode;\n            if (node === null) {\n                return false;\n            }\n            if (node.nodeType === 1) {\n                return node.isContentEditable;\n            }\n            else {\n                return node.parentNode.isContentEditable;\n            }\n        }\n        catch (e) {\n            return false;\n        }\n    },\n    execCommandFilter: function (a, b, c) {\n        var arr = ['justifyCenter', 'justifyFull', 'justifyLeft', 'justifyRight'];\n        var align;\n        var node = window.getSelection().focusNode;\n        var elementNode = mw.wysiwyg.validateCommonAncestorContainer(node);\n        if (a === 'insertorderedlist' || a === 'insertunorderedlist') {\n            var paragraph = mw.tools.firstParentOrCurrentWithTag(elementNode, 'p');\n            if (paragraph) {\n                var tag = a === 'insertorderedlist' ? 'ol' : 'ul';\n                var ul = document.createElement(tag);\n                var li = document.createElement('li');\n                ul.appendChild(li);\n                while (paragraph.firstChild) {\n                    li.appendChild(paragraph.firstChild);\n                }\n                paragraph.parentNode.insertBefore(ul, paragraph.nextSibling);\n                paragraph.remove();\n                return;\n            }\n        }\n\n\n\n        if (mw.wysiwyg.isSafeMode(elementNode) && arr.indexOf(a) !== -1) {\n            align = a.split('justify')[1].toLowerCase();\n            if (align === 'full') {\n                align = 'justify';\n            }\n            elementNode.style.textAlign = align;\n            mw.wysiwyg.change(elementNode);\n            return false;\n        }\n\n\n        if (elementNode.nodeName === 'P') {\n            align = a.split('justify')[1].toLowerCase();\n            if (align === 'full') {\n                align = 'justify';\n            }\n            elementNode.style.textAlign = align;\n            mw.wysiwyg.change(elementNode);\n            return false;\n        }\n        return true;\n    },\n    execCommand: function (a, b, c) {\n        document.execCommand('styleWithCss', 'false', false);\n        var sel = getSelection();\n\n        var node = sel.focusNode, elementNode;\n        if (node) {\n            elementNode = mw.wysiwyg.validateCommonAncestorContainer(node);\n        }\n\n        try {  // 0x80004005\n            if (document.queryCommandSupported(a) && mw.wysiwyg.isSelectionEditable()) {\n                b = b || false;\n                c = c || false;\n\n                var before = mw.$(node).clone()[0];\n                if (sel.rangeCount > 0 && mw.wysiwyg.execCommandFilter(a, b, c)) {\n                    document.execCommand(a, b, c);\n                }\n\n                if (node !== null && mw.loaded) {\n                    mw.wysiwyg.change(node);\n                    mw.trigger('execCommand', [a, node, before, elementNode]);\n                }\n            }\n        }\n        catch (e) {\n        }\n    },\n    selection: '',\n    _do: function (what) {\n        mw.wysiwyg.execCommand(what);\n        if (typeof mw.wysiwyg.action[what] === 'function') {\n            mw.wysiwyg.action[what]();\n        }\n    },\n    save_selected_element: function () {\n        mw.$(\"#mw-text-editor\").addClass(\"editor_hover\");\n    },\n    deselect_selected_element: function () {\n        mw.$(\"#mw-text-editor\").removeClass(\"editor_hover\");\n    },\n    nceui: function () {\n        if (mw.settings.liveEdit) {\n            mw.wysiwyg.execCommand('enableObjectResizing', false, 'false');\n            mw.wysiwyg.execCommand('2D-Position', false, false);\n            mw.wysiwyg.execCommand(\"enableInlineTableEditing\", null, false);\n        }\n    },\n    _pasteManager: undefined,\n    pasteManager: function (html) {\n        html = mw.wysiwyg.clean_word(html)\n        mw.wysiwyg._pasteManager = this._pasteManager || document.createElement('div');\n        mw.wysiwyg._pasteManager.innerHTML = html;\n        mw.$('*', mw.wysiwyg._pasteManager).removeAttr('style');\n        return mw.wysiwyg._pasteManager.innerHTML;\n    },\n    cleanExcel: function (clipboard) {\n        var html = clipboard.getData('text/html');\n        var parser = mw.tools.parseHtml(html).body;\n        mw.$(\"[style*='mso-spacerun']\", parser).remove()\n        mw.$(\"style\", parser).remove()\n        mw.$('table', parser)\n            .width('100%')\n            .addClass('mw-wysiwyg-table')\n            .removeAttr('width');\n        return parser.innerHTML;\n    },\n    pastedFromExcel: function (clipboard) {\n        var html = clipboard.getData('text/html');\n        return html.indexOf('ProgId content=Excel.Sheet') !== -1\n    },\n    areSameLike: function (el1, el2) {\n        if (!el1 || !el2) return false;\n        if (el1.nodeType !== el2.nodeType) return false;\n        if (!!el1.className.trim() || !!el2.className.trim()) {\n            return false;\n        }\n\n        var css1 = (el1.getAttribute('style') || '').replace(/\\s/g, '');\n        var css2 = (el2.getAttribute('style') || '').replace(/\\s/g, '');\n\n        if (css1 === css2 && el1.nodeName === el2.nodeName) {\n            return true;\n        }\n\n        return false;\n    },\n    cleanUnwantedTags: function (body) {\n        var scope = this;\n        mw.$('*', body).each(function () {\n            if (this.nodeName !== 'A' && mw.ea.helpers.isInlineLevel(this) && (this.className.trim && !this.className.trim())) {\n                if (scope.areSameLike(this, this.nextElementSibling) && this.nextElementSibling === this.nextSibling) {\n                    if (this.nextSibling !== this.nextElementSibling) {\n                        this.appendChild(this.nextSibling);\n                    }\n                    this.innerHTML = this.innerHTML + this.nextElementSibling.innerHTML;\n                    this.nextElementSibling.innerHTML = '';\n                    this.nextElementSibling.className = 'mw-skip-and-remove';\n                }\n            }\n        });\n        mw.$('.mw-skip-and-remove', body).remove();\n        return body;\n    },\n    doLocalPaste: function (clipboard) {\n        var html = clipboard.getData('text/html');\n        var parser = mw.tools.parseHtml(html).body;\n\n        mw.$('[style]', parser).removeAttr('style');\n        mw.$('[id]', parser).each(function () {\n            this.id = 'dlp-item-' + mw.random();\n        });\n        mw.wysiwyg.insert_html(parser.innerHTML);\n    },\n    isLocalPaste: function (clipboard) {\n        var html = clipboard.getData('text/html');\n        var parser = mw.tools.parseHtml(html).body;\n        return (this._lastCopy && this._lastCopy.innerHTML && this._lastCopy.innerHTML.contains(html)) || parser.querySelector('.module,.element,.edit') !== null;\n    },\n    paste: function (e) {\n        var html, clipboard;\n\n        if (!!e.originalEvent) {\n            clipboard = e.originalEvent.clipboardData || window.clipboardData;\n        }\n        else {\n            clipboard = e.clipboardData || window.clipboardData;\n        }\n        if (mw.wysiwyg.isSafeMode(e.target)) {\n            if (typeof clipboard !== 'undefined' && typeof clipboard.getData === 'function' && mw.wysiwyg.editable(e.target)) {\n                var text = clipboard.getData('text');\n                if(text) {\n                    mw.wysiwyg.insert_html(text);\n                }\n                e.preventDefault();\n                return '';\n            }\n        }\n        if (mw.wysiwyg.isLocalPaste(clipboard)) {\n            mw.wysiwyg.doLocalPaste(clipboard);\n            e.preventDefault();\n            return '';\n        }\n\n\n        if (mw.wysiwyg.pastedFromExcel(clipboard)) {\n            html = mw.wysiwyg.cleanExcel(clipboard)\n            mw.wysiwyg.insert_html(html);\n            e.preventDefault();\n            return '';\n        }\n\n\n        if (clipboard.files.length > 0) {\n            var i = 0;\n            for (; i < clipboard.files.length; i++) {\n                var item = clipboard.files[i];\n                if (item.type.indexOf('image/') != -1) {\n                    var reader = new FileReader();\n                    reader.onload = function (e) {\n                        mw.wysiwyg.insert_html('<img src=\"' + (e.target.result) + '\">');\n                        mw.wysiwyg.normalizeBase64Images();\n                    }\n                    reader.readAsDataURL(item)\n                }\n            }\n            e.preventDefault();\n        }\n        else {\n            if (typeof clipboard !== 'undefined' && typeof clipboard.getData === 'function' && mw.wysiwyg.editable(e.target)) {\n\n                    html = clipboard.getData('text/html');\n                    var text = clipboard.getData('text');\n                    var isPlainText = false;\n                    if (!html && text) {\n                        isPlainText = true;\n                        if (/\\r\\n/.test(text)) {\n                            var wrapper = mw.wysiwyg.validateCommonAncestorContainer(getSelection().focusNode);\n                            wrapper = mw.tools.firstMatchesOnNodeOrParent(wrapper, ['.element', 'p', 'div', '.edit'])\n                            var tag = wrapper.nodeName.toLowerCase();\n                            html = '<' + tag + ' id=\"element_' + mw.random() + '\">' + text.replace(/\\r\\n/g, \"<br>\") + '</' + tag + '>';\n                        }\n\n                    }\n                    else {\n\n                    }\n\n                if (!!html) {\n                    if (mw.form) {\n                        var is_link = mw.form.validate.url(html);\n                        if (is_link) {\n                            html = \"<a href='\" + html + \"'>\" + html + \"</a>\";\n                        }\n                    }\n\n                    html = mw.wysiwyg.pasteManager(html);\n\n                    mw.wysiwyg.insert_html(html);\n                    if (e.target.querySelector) {\n                        mw.$(e.target.querySelectorAll('[style*=\"outline\"]')).css({\n                            outline: 'none'\n                        })\n                    }\n                    e.preventDefault();\n\n                }\n            }\n        }\n    },\n    hasContentFromWord: function (node) {\n        if (node.getElementsByTagName(\"o:p\").length > 0 ||\n            node.getElementsByTagName(\"v:shapetype\").length > 0 ||\n            node.getElementsByTagName(\"v:path\").length > 0 ||\n            node.querySelector('.MsoNormal') !== null) {\n            return true;\n        }\n        return false;\n    },\n    prepare: function () {\n        mw.wysiwyg.external = mw.wysiwyg._external();\n        mw.$(\"#liveedit_wysiwyg\").on(\"mousedown mouseup click\", function (event) {\n            event.preventDefault();\n        });\n        var items = mw.$(\".element\").not(\".module\");\n        mw.$(\".mw_editor\").hover(function () {\n            mw.$(this).addClass(\"editor_hover\")\n        }, function () {\n            mw.$(this).removeClass(\"editor_hover\")\n        });\n    },\n    deselect: function (s) {\n        var s = s || window.getSelection();\n        s.empty ? s.empty() : s.removeAllRanges();\n    },\n    editors_disabled: false,\n    enableEditors: function () {\n        mw.$(\".mw_editor, #mw_small_editor\").removeClass(\"mw-editor-disabled\");\n        mw.wysiwyg.editors_disabled = false;\n    },\n    disableEditors: function () {\n        /*  mw.$(\".mw_editor, #mw_small_editor\").addClass(\"mw-editor-disabled\");\n         mw.wysiwyg.editors_disabled = false;   */\n    },\n    checkForTextOnlyElements: function (e, method) {\n        var e = e || false;\n        var method = method || 'selection';\n        if (method === 'selection') {\n            var sel = window.getSelection();\n            var f = sel.focusNode;\n            f = mw.tools.hasClass(f, 'edit') ? f : mw.tools.firstParentWithClass(f, 'edit');\n            if (f.attributes != undefined && !!f.attributes.field && f.attributes.field.nodeValue == 'title') {\n                if (!!e) {\n                    mw.event.cancel(e, true);\n                }\n                return false;\n            }\n        }\n    },\n    merge: {\n        /* Executes on backspace or delete */\n        isMergeable: function (el) {\n            if (!el) return false;\n            if (el.nodeType === 3) return true;\n            var is = false;\n            var css =  getComputedStyle(el)\n\n            var display = css.getPropertyValue('display');\n\n            var position = css.getPropertyValue('position');\n            var isInline = display === 'inline';\n            if (isInline) return true;\n            var mergeables = ['p', '.element', 'div:not([class])', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n            mergeables.forEach(function (item) {\n                if (el.matches(item)) {\n                    is = true;\n                }\n            });\n\n            if (is) {\n                if (el.querySelector('.module') !== null || mw.tools.hasClass(el, 'module')) {\n                    is = false;\n                }\n            }\n            return is;\n        },\n        manageBreakables: function (curr, next, dir, event) {\n            var isnonbreakable = mw.wysiwyg.merge.isInNonbreakable(curr, dir);\n            if (isnonbreakable) {\n                var conts = getSelection().getRangeAt(0);\n                event.preventDefault();\n\n                if (next !== null) {\n\n                    if (next.nodeType === 3 && /\\r|\\n/.exec(next.nodeValue) !== null) {\n                        event.preventDefault();\n                        return false;\n                    }\n\n                    if (dir == 'next') {\n                        mw.wysiwyg.cursorToElement(next)\n                    }\n                    else {\n                        mw.wysiwyg.cursorToElement(next, 'end')\n                    }\n                }\n                else {\n                    return false;\n                }\n            }\n        },\n        isInNonbreakable: function (el, dir) {\n            var absNext = mw.wysiwyg.merge.findNextNearest(el, dir);\n\n            if (absNext.nodeType === 3 && /\\r|\\n/.exec(absNext.nodeValue) !== null) {\n                absNext = mw.wysiwyg.merge.findNextNearest(el, dir, true)\n            }\n\n            if (absNext.nodeType === 1) {\n                if (mw.tools.hasAnyOfClasses(absNext, ['nodrop', 'allow-drop'])) {\n                    return false;\n                }\n                if (absNext.querySelector('.nodrop', '.allow-drop') !== null) {\n                    return false;\n                }\n            }\n            if (mw.wysiwyg.merge.alwaysMergeable(absNext) && (mw.wysiwyg.merge.alwaysMergeable(absNext.firstElementChild) || !absNext.firstElementChild)) {\n                return false;\n            }\n            if (el.textContent == '') {\n\n                var absNextNext = mw.wysiwyg.merge.findNextNearest(absNext, dir);\n                if (absNext.nodeType == 3 && /\\r|\\n/.exec(absNext.nodeValue) !== null) {\n                    return mw.wysiwyg.merge.isInNonbreakableClass(absNextNext)\n                }\n            }\n\n            if (el.nodeType === 1 && !!el.textContent.trim()) {\n                return false;\n            }\n            if (el.nextSibling === null && el.nodeType === 3 && dir == 'next') {\n                var absNext = mw.wysiwyg.merge.findNextNearest(el, dir);\n                var absNextNext = mw.wysiwyg.merge.findNextNearest(absNext, dir);\n                if (/\\r|\\n/.exec(absNext.nodeValue) !== null) {\n                    return mw.wysiwyg.merge.isInNonbreakableClass(absNextNext)\n                }\n\n                if (absNextNext.nodeType === 1) {\n                    return mw.wysiwyg.merge.isInNonbreakableClass(absNextNext) || mw.wysiwyg.merge.isInNonbreakableClass(absNextNext.firstChild);\n                }\n                else if (absNextNext.nodeType === 3) {\n                    return true\n                }\n                else {\n                    return false;\n                }\n            }\n\n            if (el.previousSibling === null && el.nodeType === 3 && dir == 'prev') {\n                var absNext = mw.wysiwyg.merge.findNextNearest(el, 'prev');\n                var absNextNext = mw.wysiwyg.merge.findNextNearest(absNext, 'prev');\n                if (absNextNext.nodeType === 1) {\n                    return mw.wysiwyg.merge.isInNonbreakableClass(absNextNext);\n                }\n                else if (absNextNext.nodeType === 3) {\n                    return true;\n                }\n                else {\n                    return false;\n                }\n            }\n            el = mw.wysiwyg.validateCommonAncestorContainer(el)\n\n            var is = mw.wysiwyg.merge.isInNonbreakableClass(el)\n            return is;\n\n        },\n        isInNonbreakableClass: function (el, dir) {\n            var absNext = mw.wysiwyg.merge.findNextNearest(el, dir);\n\n            if (el.nodeType == 3 && /\\r|\\n/.exec(absNext.nodeValue) === null) return false;\n            el = mw.wysiwyg.validateCommonAncestorContainer(el)\n            var classes = ['unbreakable', '*col', '*row', '*btn', '*icon', 'module', 'edit'];\n            var is = false;\n            classes.forEach(function (item) {\n                if (item.indexOf('*') === 0) {\n                    var item = item.split('*')[1];\n                    if (el.className.indexOf(item) !== -1) {\n                        is = true;\n                    }\n                    else {\n                        mw.tools.foreachParents(el, function (loop) {\n                            if (this.className.indexOf(item) !== -1 && !this.contains(el)) {\n                                is = true;\n                                mw.tools.stopLoop(loop);\n                            }\n                            else {\n\n                                is = false;\n                                mw.tools.stopLoop(loop);\n                            }\n                        })\n                    }\n                }\n                else {\n                    if (mw.tools.hasClass(el, item) || mw.tools.hasParentsWithClass(el, item)) {\n                        is = true;\n                    }\n                }\n            });\n            return is;\n        },\n        getNext: function (curr) {\n            var next = curr.nextSibling;\n            while (curr !== null && curr.nextSibling === null) {\n                curr = curr.parentNode;\n                next = curr.nextSibling;\n            }\n            return next;\n        },\n        getPrev: function (curr) {\n            var next = curr.previousSibling;\n            while (curr !== null && curr.previousSibling === null) {\n                curr = curr.parentNode;\n                next = curr.previousSibling;\n            }\n            return next;\n        },\n        findNextNearest: function (el, dir, searchElement) {\n            searchElement = typeof searchElement === 'undefined' ? false : true;\n            if (dir == 'next') {\n                var dosearch = searchElement ? 'nextElementSibling' : 'nextSibling'\n                var next = el[dosearch];\n                if (next === null) {\n                    while (el[dosearch] === null) {\n                        el = el.parentNode;\n                        next = el[dosearch];\n\n                    }\n                }\n            }\n            else {\n                var dosearch = searchElement ? 'previousElementSibling' : 'previousSibling'\n                var next = el[dosearch];\n                if (next === null) {\n                    while (el[dosearch] === null) {\n                        el = el.parentNode;\n                        next = el[dosearch];\n\n                    }\n                }\n            }\n            return next;\n        },\n        alwaysMergeable: function (el) {\n\n            if (!el) {\n                return false;\n            }\n            if (el.nodeType === 3) {\n                return mw.wysiwyg.merge.alwaysMergeable(mw.wysiwyg.validateCommonAncestorContainer(el))\n            }\n            if (el.nodeType === 1) {\n                if (/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i.test(el.tagName)) {\n                    return true;\n                }\n                if (/^(?:strong|em|i|b|li)$/i.test(el.tagName)) {\n                    return true;\n                }\n                if (/^(?:span)$/i.test(el.tagName) && !el.className) {\n                    return true;\n                }\n            }\n\n            if (mw.tools.hasClass(el, 'module')) return false;\n            if (mw.tools.hasParentsWithClass(el, 'module')) {\n                var ord = mw.tools.parentsOrder(el, ['edit', 'module']);\n                //todo\n            }\n\n            var selectors = [\n                    'p.element', 'div.element', 'div:not([class])',\n                    'h1.element', 'h2.element', 'h3.element', 'h4.element', 'h5.element', 'h6.element',\n                    '.edit  h1', '.edit  h2', '.edit  h3', '.edit  h4', '.edit  h5', '.edit  h6',\n                    '.edit p'\n                ],\n                final = false,\n                i = 0;\n            for (; i < selectors.length; i++) {\n                var item = selectors[i];\n                if (el.matches(item)) {\n                    final = true;\n                    break;\n                }\n            }\n\n            return final;\n\n        }\n    },\n    init: function (selector) {\n\n        selector = selector || \".mw_editor_btn\";\n        var mw_editor_btns = mw.$(selector).not('.ready');\n        mw_editor_btns\n            .addClass('ready')\n            .on(\"click\", function (event) {\n                if (mw.wysiwyg.editors_disabled) {\n                    return false;\n                }\n                event.preventDefault();\n                if (!$(this).hasClass('disabled')) {\n                    var rectarget = mw.wysiwyg.validateCommonAncestorContainer(getSelection().focusNode);\n                    rectarget = mw.tools.firstParentOrCurrentWithAnyOfClasses(rectarget, ['element', 'edit']);\n                    if(mw.liveEditState){\n                        var currState = mw.liveEditState.state()\n                        if(currState[0].$id !== 'wysiwyg   '){\n                            mw.liveEditState.record({\n                                target: rectarget,\n                                value: rectarget.innerHTML,\n                                $id: 'wysiwyg'\n                            });\n                        }\n                    }\n\n                    var command = mw.$(this).dataset('command');\n                    if (!command.contains('custom-')) {\n                        mw.wysiwyg._do(command);\n                    }\n                    else {\n                        var name = command.replace('custom-', \"\");\n                        if(name === 'link') {\n                            mw.wysiwyg.link(undefined, undefined, getSelection().toString());\n                        } else {\n                            mw.wysiwyg[name]();\n                        }\n\n                    }\n                    if(mw.liveEditState){\n                        mw.liveEditState.record({\n                            target: rectarget,\n                            value: rectarget.innerHTML\n                        });\n                    }\n\n                    mw.$(this).removeClass(\"mw_editor_btn_mousedown\");\n                    mw.wysiwyg.check_selection(event.target);\n\n                }\n                if (event.type === 'mousedown' && !$(this).hasClass('disabled')) {\n                    mw.$(this).addClass(\"mw_editor_btn_mousedown\");\n                }\n            });\n        mw_editor_btns.hover(function () {\n            mw.$(this).addClass(\"mw_editor_btn_hover\");\n        }, function () {\n            mw.$(this).removeClass(\"mw_editor_btn_hover\");\n        });\n        if (mw.wysiwyg.ready) return;\n        mw.wysiwyg.ready = true;\n        mw.$(document.body).on('mouseup', function (event) {\n            if (event.target.isContentEditable) {\n                if(event.target.nodeName){\n                    mw.wysiwyg.check_selection(event.target);\n                }\n            }\n        });\n        mw.$(document.body).on('keydown', function (event) {\n\n            if ((event.keyCode == 46 || event.keyCode == 8) && event.type == 'keydown') {\n                mw.tools.removeClass(mw.image_resizer, 'active');\n                mw.wysiwyg.change('.element-current');\n            }\n            if (event.type === 'keydown') {\n\n                if (mw.tools.isField(event.target) || !event.target.isContentEditable) {\n                    return true;\n                }\n                var sel = window.getSelection();\n                if (mw.event.is.enter(event)) {\n                    setTimeout(function () {\n                        if(mw.liveEditDomTree) {\n                            var focused = mw.wysiwyg.validateCommonAncestorContainer(sel.focusNode)\n                            mw.liveEditDomTree.refresh(focused.parentNode)\n                        }\n                    }, 10);\n                    if (mw.wysiwyg.isSafeMode(event.target)) {\n                        var isList = mw.tools.firstMatchesOnNodeOrParent(event.target, ['li', 'ul', 'ol']);\n                        if (!isList) {\n                            event.preventDefault();\n                            var id = mw.id('mw-br-');\n                            mw.wysiwyg.insert_html('<br>\\u200C');\n                        }\n                    }\n                }\n                if (sel.rangeCount > 0) {\n                    var r = sel.getRangeAt(0);\n                    if (event.keyCode == 9 && !event.shiftKey && sel.focusNode.parentNode.iscontentEditable && sel.isCollapsed) {   /* tab key */\n                        mw.wysiwyg.insert_html('&nbsp;&nbsp;&nbsp;&nbsp;');\n                        return false;\n                    }\n                    return mw.wysiwyg.manageDeleteAndBackspace(event, sel);\n                }\n\n\n            }\n        });\n        mw.on.tripleClick(document.body, function (target) {\n            mw.wysiwyg.select_all(target);\n            if (mw.tools.hasParentsWithClass(target, 'element')) {\n                //mw.wysiwyg.select_all(mw.tools.firstParentWithClass(target, 'element'));\n            }\n            var s = window.getSelection();\n            if(!s.rangeCount) {\n                return;\n            }\n            var r = s.getRangeAt(0);\n            var c = r.cloneContents();\n            //var common = mw.wysiwyg.validateCommonAncestorContainer(r.commonAncestorContainer);\n            var common = r.commonAncestorContainer;\n            if (common.nodeType === 1) {\n                if (mw.tools.hasClass(common, 'element')) {\n                    mw.wysiwyg.select_all(common)\n                }\n\n            }\n            else {\n                common = mw.wysiwyg.validateCommonAncestorContainer(r.commonAncestorContainer);\n                if (mw.tools.hasClass(common, 'element')) {\n                    mw.wysiwyg.select_element(common)\n                }\n            }\n            var a = common.querySelectorAll('*'), l = a.length, i = 0;\n            for (; i < l; i++) {\n                if (!!s.containsNode && s.containsNode(a[i], true)) {\n                    r.setEndBefore(a[i]);\n                    break;\n                    return false;\n                }\n            }\n        });\n\n\n        mw.$(document.body).on('keyup', function (e) {\n            mw.smallEditorCanceled = true;\n            mw.smallEditor.css({\n                visibility: \"hidden\"\n            });\n            if (e.target.isContentEditable && !mw.tools.isField(e.target)) {\n                mw.wysiwyg.change(e.target)\n\n\n                if (!document.body.editor_typing_startTime) {\n                    document.body.editor_typing_startTime = new Date();\n                }\n\n\n                var started_typing = mw.tools.hasAnyOfClasses(this, ['isTyping']);\n                if (!started_typing) {\n                    // isTyping class is removed from livedit.js\n                    mw.tools.addClass(this, 'isTyping');\n                    document.body.editor_typing_startTime = new Date();\n\n                   // mw.tools.addClass(this, 'isTypingStill');\n\n                    // var myVarisTypingStill;\n                    //\n                    // var myVarisTypingStillTimeoutFunction = function() {\n                    //     myVarisTypingStill = setTimeout(function(){\n                    //         if(document.body){\n                    //             if(!mw.tools.hasAnyOfClasses(document.body, ['isTyping'])){\n                    //                 mw.tools.removeClass(document.body, 'isTypingStill');\n                    //             }\n                    //\n                    //         }\n                    //     }, 1337);\n                    // }\n                    //\n                    // clearTimeout(myVarisTypingStill);\n                    // myVarisTypingStillTimeoutFunction();\n\n\n\n                    if(mw._initHandles){\n                        mw._initHandles.hideAll();\n                    }\n                } else {\n                    // user is typing\n                    started_typing_endTime = new Date();\n                    var timeDiff = started_typing_endTime - document.body.editor_typing_startTime; //in ms\n                    timeDiff /= 1000;\n                    var seconds = Math.round(timeDiff);\n                    document.body.editor_typing_seconds = seconds;\n                }\n\n                if (document.body.editor_typing_seconds) {\n                    //how much seconds user is typing\n                    if (document.body.editor_typing_seconds > 10) {\n                        mw.trigger('editUserIsTypingForLong', this)\n                        document.body.editor_typing_seconds = 0;\n                        document.body.editor_typing_startTime = 0;\n                    }\n                }\n\n\n                mw.$(this._onCloneableControl).hide();\n                if (mw.event.is.enter(e)) {/*\n\n                    mw.$(\".element-current\").removeClass(\"element-current\");\n                    var el = document.querySelectorAll('.edit .element'), l = el.length, i = 0;\n                    for (; i < l; i++) {\n                        if (!el[i].id) {\n                            el[i].id = mw.wysiwyg.createElementId();\n                        }\n                    }\n                    e.preventDefault();\n                    if (!e.shiftKey) {\n                        var p = mw.wysiwyg.findTagAcrossSelection('p');\n                    }\n                    var newNode = mw.wysiwyg.validateCommonAncestorContainer(getSelection().focusNode);\n                    if (newNode.id) {\n                        newNode.id = mw.wysiwyg.createElementId();\n                    }*/\n                }\n            }\n\n            if (e.target.isContentEditable\n                && !e.shiftKey\n                && !e.ctrlKey\n                && e.keyCode !== 27\n                && e.keyCode !== 116\n                && e.keyCode !== 17\n                && (e.keyCode < 37 || e.keyCode > 40)) {\n                mw.wysiwyg.change(e.target);\n            }\n\n            if(e && e.target) {\n                mw.wysiwyg.check_selection(e.target);\n            }\n\n        });\n    },\n    createElementId: function () {\n        return 'mw-element_' + mw.random();\n    },\n    change: function (el) {\n        if (typeof el === 'string') {\n            el = document.querySelector(el);\n        }\n        var target = null;\n        if (mw.tools.hasClass(el, 'edit')) {\n            mw.tools.addClass(el, 'changed');\n            target = el;\n            mw.trigger('editChanged', target)\n        }\n        else if (mw.tools.hasParentsWithClass(el, 'edit')) {\n            target = mw.tools.firstParentWithClass(el, 'edit');\n            mw.tools.addClass(target, 'changed');\n            mw.trigger('editChanged', target)\n        }\n        if (target !== null) {\n            mw.tools.foreachParents(target, function () {\n                if (mw.tools.hasClass(this, 'edit')) {\n                    mw.tools.addClass(this, 'changed');\n                    mw.trigger('editChanged', this)\n                }\n            });\n            mw.askusertostay = true;\n            mw.drag.initDraft = true;\n        }\n\n    },\n    validateCommonAncestorContainer: function (c) {\n        if( !c || !c.parentNode || c.parentNode === document.body ){\n            return null;\n        }\n        try {   /* Firefox returns wrong target (div) when you click on a spin-button */\n            if (typeof c.querySelector === 'function') {\n                return c;\n            }\n            else {\n                return mw.wysiwyg.validateCommonAncestorContainer(c.parentNode);\n            }\n        }\n        catch (e) {\n            return null;\n        }\n    },\n\n    editable: function (el) {\n        var el = mw.wysiwyg.validateCommonAncestorContainer(el);\n        return el.isContentEditable && ['SELECT', 'INPUT', 'TEXTAREA'].indexOf(el.nodeName) === -1;\n    },\n    getNextNode: function (node) {\n        if (node.nextSibling) {\n            return node.nextSibling\n        } else {\n            return this.getNextNode(node.parentNode);\n        }\n    },\n    cursorToElement: function (node, a) {\n\n        if (!node) {\n            return false;\n        }\n        if(mw.tools.hasAnyOfClassesOnNodeOrParent(node, ['safe-element', 'icon', 'mw-icon', 'material-icons', 'mw-wysiwyg-custom-icon'])){\n            return;\n        }\n        mw.wysiwyg.contentEditable(node, true);\n        a = (a || 'start').trim();\n        var sel = window.getSelection();\n        var r = document.createRange();\n        sel.removeAllRanges();\n        if (a === 'start') {\n            r.selectNodeContents(node);\n            r.collapse(true);\n            sel.addRange(r);\n        }\n        else if (a === 'end') {\n            r.selectNodeContents(node);\n            r.collapse(false);\n            sel.addRange(r);\n        }\n        else if (a === 'before') {\n            r.selectNode(node);\n            r.collapse(false);\n            sel.addRange(r);\n        }\n        else if (a === 'after') {\n            var range = document.createRange();\n            range.setStartAfter(node);\n            range.collapse(true);\n\n            sel.removeAllRanges();\n            sel.addRange(range);\n        }\n\n    },\n    rfapplier: function (tag, classname, style_object) {\n        var parent, fnode = getSelection().focusNode;\n        var id = mw.id('mw-applier-element-');\n        this.execCommand(\"insertHTML\", false, '<'+tag+' '+(classname ? 'class=\"' + classname + '\"' : '')+' id=\"'+id+'\">'+ getSelection()+'</'+tag+'>');\n        var $el = mw.$('#' + id);\n        if (style_object) {\n            $el.css(style_object);\n        }\n        return $el[0];\n    },\n    applier: function (tag, classname, style_object) {\n        var classname = classname || '';\n        if (mw.wysiwyg.isSelectionEditable()) {\n            var range = window.getSelection().getRangeAt(0);\n            var selectionContents = range.extractContents();\n            var el = document.createElement(tag);\n            el.className = classname;\n            typeof style_object !== 'undefined' ? mw.$(el).css(style_object) : '';\n            el.appendChild(selectionContents);\n            range.insertNode(el);\n            mw.wysiwyg.change(el);\n            return el;\n        }\n    },\n    external_tool: function (el, url) {\n        var el = mw.$(el).eq(0);\n        var offset = el.offset();\n        mw.$(mw.wysiwyg.external).css({\n            top: offset.top - mw.$(window).scrollTop() + el.height(),\n            left: offset.left\n        });\n        mw.$(mw.wysiwyg.external).html(\"<iframe src='\" + url + \"' scrolling='no' frameborder='0' />\");\n        var frame = mw.wysiwyg.external.querySelector('iframe');\n        frame.contentWindow.thisframe = frame;\n    },\n    getExternalData: function (url, cb) {\n        var has = mw.storage.get(url);\n        if (has) {\n            cb.call(has, has)\n        }\n        else {\n            $.get(url, function (data) {\n                mw.storage.set(url, data)\n                cb.call(data, data)\n            })\n        }\n    },\n    todo_external_tool: function (el, url) {\n        var el = mw.$(el).eq(0);\n        var offset = el.offset();\n        mw.$(mw.wysiwyg.external).css({\n            top: offset.top - mw.$(window).scrollTop() + el.height(),\n            left: offset.left\n        });\n        mw.$(mw.wysiwyg.external).html(\"<iframe scrolling='no' frameborder='0' />\");\n        var frame = mw.wysiwyg.external.querySelector('iframe');\n\n        frame.contentWindow.thisframe = frame;\n        if (url.indexOf('#') !== -1) {\n            frame.src = '#' + url.split('#')[1]\n        }\n\n        mw.wysiwyg.getExternalData(url, function (html) {\n\n            frame.contentWindow.document.open();\n            frame.contentWindow.document.write(html);\n            frame.contentWindow.document.close();\n        })\n    },\n    createelement: function () {\n        var el = mw.wysiwyg.applier('div', 'mw_applier element');\n    },\n    fontcolorpicker: function () {\n\n        mw.wysiwyg._fontcolorpicker.show();\n        setTimeout(function () {\n            mw.wysiwyg._fontcolorpicker.show();\n        }, 20);\n    },\n    fontbgcolorpicker: function () {\n\n        setTimeout(function () {\n            mw.wysiwyg._bgfontcolorpicker.show();\n        }, 20);\n\n\n    },\n    fontColor: function (color) {\n        if (/^[0-9A-F]{3,6}$/i.test(color) && !color.contains(\"#\")) {\n            color = \"#\" + color;\n        }\n        var rectarget = mw.wysiwyg.validateCommonAncestorContainer(getSelection().focusNode);\n        rectarget = mw.tools.firstParentOrCurrentWithAnyOfClasses(rectarget, ['element', 'edit']);\n        if(mw.liveEditState){\n            var currState = mw.liveEditState.state()\n            if(currState[0].$id !== 'wysiwyg   '){\n                mw.liveEditState.record({\n                    target: rectarget,\n                    value: rectarget.innerHTML,\n                    $id: 'wysiwyg'\n                });\n            }\n        }\n        if (color == 'none') {\n            mw.wysiwyg.execCommand('removeFormat', false, \"foreColor\");\n        } else {\n            document.execCommand(\"styleWithCSS\", null, true);\n            mw.wysiwyg.execCommand('forecolor', null, color);\n        }\n        mw.liveEditState.record({\n            target: rectarget,\n            value: rectarget.innerHTML,\n        });\n    },\n    fontbg: function (color) {\n\n        if (/^[0-9A-F]{3,6}$/i.test(color) && !color.contains(\"#\")) {\n            color = \"#\" + color;\n        }\n        if (color === 'none') {\n            mw.wysiwyg.execCommand('removeFormat', false, \"backcolor\");\n        } else {\n            document.execCommand(\"styleWithCSS\", null, true);\n            mw.wysiwyg.execCommand('backcolor', null, color);\n        }\n    },\n    request_change_bg_color: function (el) {\n        mw.wysiwyg.external_tool(el, mw.external_tool('color_picker') + '#change_bg_color');\n        mw.$(mw.wysiwyg.external).find(\"iframe\").width(280).height(320);\n    },\n    change_bg_color: function (color) {\n        color = color !== 'transparent' ? '#' + color : color;\n        mw.$(\".element-current\").css(\"backgroundColor\", color);\n        mw.wysiwyg.change('.element-current');\n    },\n    request_border_color: function (el) {\n        mw.wysiwyg.external_tool(el, mw.external_tool('color_picker') + '#change_border_color');\n        mw.$(mw.wysiwyg.external).find(\"iframe\").width(280).height(320);\n    },\n    change_border_color: function (color) {\n        if (color != \"transparent\") {\n            mw.$(\".element-current\").css(mw.border_which + \"Color\", \"#\" + color);\n            mw.$(\".ed_bordercolor_pick span\").css(\"background\", \"#\" + color);\n            mw.wysiwyg.change('.element-current');\n        }\n        else {\n            mw.$(\".element-current\").css(mw.border_which + \"Color\", \"transparent\");\n            mw.$(\".ed_bordercolor_pick span\").css(\"background\", \"\");\n            mw.wysiwyg.change('.element-current');\n        }\n    },\n    request_change_shadow_color: function (el) {\n        mw.wysiwyg.external_tool(el, mw.external_tool('color_picker') + '#change_shadow_color');\n        mw.$(mw.wysiwyg.external).find(\"iframe\").width(280).height(320);\n    },\n    change_shadow_color: function (color) {\n        mw.current_element_styles = getComputedStyle(mw.$('.element-current')[0], null);\n        if (mw.current_element_styles.boxShadow != \"none\") {\n            var arr = mw.current_element_styles.boxShadow.split(' ');\n            var len = arr.length;\n            var x = parseFloat(arr[len - 4]);\n            var y = parseFloat(arr[len - 3]);\n            var blur = parseFloat(arr[len - 2]);\n            mw.$(\".element-current\").css(\"box-shadow\", x + \"px \" + y + \"px \" + blur + \"px #\" + color);\n            mw.$(\".ed_shadow_color\").dataset(\"color\", color);\n\n        }\n        else {\n            mw.$(\".element-current\").css(\"box-shadow\", \"0px 0px 6px #\" + color);\n            mw.$(\".ed_shadow_color\").dataset(\"color\", color);\n        }\n        mw.wysiwyg.change('.element-current');\n    },\n    fontFamily: function (font_name) {\n        var range = getSelection().getRangeAt(0);\n        document.execCommand(\"styleWithCSS\", null, true);\n        var el = mw.wysiwyg.validateCommonAncestorContainer(range.commonAncestorContainer);\n        if (range.collapsed) {\n\n            mw.wysiwyg.select_all(el);\n            document.execCommand('fontName', null, font_name);\n            range.collapse()\n        }\n        else {\n            document.execCommand('fontName', null, font_name);\n        }\n\n        mw.wysiwyg.change(el)\n\n    },\n    nestingFixes: function (root) {  /*\n     var root = root || document.body;\n     var all = root.querySelectorAll('.mw-span-font-size'),\n     l = all.length,\n     i=0;\n     for( ; i<l; i++ ){\n     var el = all[i];\n     if(el.firstChild === el.lastChild && el.firstChild.nodeType !== 3){\n     // mw.$(el.firstChild).unwrap();\n     }\n     } */\n    },\n    lineHeight: function (a) {\n        a = a || 'normal';\n        a = (typeof a === 'number') ? (a + 'px') : a;\n        var r = getSelection().getRangeAt(0).commonAncestorContainer;\n        var el = mw.wysiwyg.validateCommonAncestorContainer(r);\n        r.style.fontSize = a;\n        mw.wysiwyg.change(r);\n    },\n    fontSize: function (a) {\n\n        if (window.getSelection().isCollapsed) {\n            return false;\n        }\n        mw.wysiwyg.allStatements(function () {\n\n            rangy.init();\n            var clstemp = 'mw-font-size-' + mw.random();\n            var classApplier = rangy.createCssClassApplier(\"mw-font-size \" + clstemp, true);\n            classApplier.applyToSelection();\n\n            var all = document.querySelectorAll('.' + clstemp),\n                l = all.length,\n                i = 0;\n            for ( ; i < l; i++ ) {\n                all[i].style.fontSize = a + 'px';\n                mw.tools.removeClass(all[i], clstemp);\n                mw.wysiwyg.change(all[i]);\n            }\n\n            mw.$('.edit .mw-font-size').removeClass('mw-font-size')\n\n        });\n    },\n    fontSizePrompt: function () {\n        var size = prompt(\"Please enter font size\", \"\");\n\n        if (size != null) {\n            var a = parseInt(size);\n            if (a > 0) {\n                this.fontSize(a);\n            }\n        }\n    },\n    resetActiveButtons: function () {\n        mw.$('.mw_editor_btn_active').removeClass('mw_editor_btn_active');\n    },\n    setActiveButtons: function (node) {\n        mw.require('css_parser.js');\n\n        var css = mw.CSSParser(node);\n        if (css && css.get) {\n            var font = css.get.font();\n            var family_array = font.family.split(',');\n            if (family_array.length == 1) {\n                var fam = font.family;\n\n            } else {\n                //var fam = mw.tools.getFirstEqualFromTwoArrays(family_array, mw.wysiwyg.editorFonts);\n                var fam = family_array.shift();\n            }\n\n            var ddval = mw.$(\".mw_dropdown_action_font_family\");\n            if (ddval.length != 0 && ddval.setDropdownValue != undefined) {\n                mw.$(\".mw_dropdown_action_font_family\").each(function () {\n                    mw.$(this).setDropdownValue(fam);\n                })\n            }\n        }\n    },\n    setActiveFontSize: function () {\n        mw.require('css_parser.js');\n\n        var sel = getSelection();\n        var range = sel.getRangeAt(0);\n        if(range.collapsed) {\n            var node = mw.wysiwyg.validateCommonAncestorContainer(sel.focusNode);\n            var css_node_get=mw.CSSParser(node).get;\n            if(typeof(css_node_get) !== 'undefined'){\n            var size = Math.round(parseFloat(css_node_get.font().size));\n            }\n            mw.$(\".mw_dropdown_action_font_size .mw-dropdown-val\").html(size + 'px')\n        } else {\n            var curr = range.startContainer;\n            var end = range.endContainer;\n            var common = mw.wysiwyg.validateCommonAncestorContainer(range.commonAncestorContainer);\n            var size = Math.round(parseFloat(mw.CSSParser(common).get.font().size));\n            while (curr && curr !== end) {\n                var node = mw.wysiwyg.validateCommonAncestorContainer(curr);\n                curr = curr.nextElementSibling;\n                var css_node_get=mw.CSSParser(node).get;\n                if(typeof(css_node_get) !== 'undefined'){\n                    var sizec = Math.round(parseFloat(css_node_get.font().size));\n                    if (sizec !== size) {\n                        mw.$(\".mw_dropdown_action_font_size .mw-dropdown-val\").html(mw.lang('Size'));\n                        return;\n                    }\n                }\n            }\n            mw.$(\".mw_dropdown_action_font_size .mw-dropdown-val\").html(size + 'px')\n\n        }\n    },\n\n    listSplit: function (list, index) {\n        if (!list || typeof index == 'undefined') return;\n        var curr = list.children[index];\n        var listtop = document.createElement(list.nodeName);\n        var listbottom = document.createElement(list.nodeName);\n        var final = {middle: curr}\n\n        for (var itop = 0; itop < index; itop++) {\n            listtop.appendChild(list.children[itop])\n        }\n        for (var ibot = 1; ibot < list.children.length; ibot++) {\n            //for(var ibot = index+1; ibot < list.children.length; ibot++){\n\n            listbottom.appendChild(list.children[ibot])\n        }\n\n        if (listtop.children.length > 0) {\n            final.top = listtop\n        }\n        if (listbottom.children.length > 0) {\n            final.bottom = listbottom\n        }\n        return final;\n\n    },\n    isFormatElement: function (obj) {\n        var items = /^(div|h[1-6]|p)$/i;\n        return items.test(obj.nodeName);\n    },\n    decorators: {\n        b: '.mw_editor_bold',\n        strong: '.mw_editor_bold',\n        i: '.mw_editor_italic',\n        em: '.mw_editor_italic',\n        u: '.mw_editor_underline',\n        s: '.mw_editor_strike',\n        strike: '.mw_editor_strike'\n    },\n    setDecorators: function (sel) {\n        sel = sel || getSelection();\n        var node = sel.focusNode;\n        while (node.nodeName !== 'DIV' && node.nodeName !== 'BODY') {\n            for (var x in mw.wysiwyg.decorators) {\n                if (node.nodeName.toLowerCase() === x) {\n                    mw.$(mw.wysiwyg.decorators[x]).addClass('mw_editor_btn_active')\n                }\n            }\n            node = node.parentNode;\n        }\n    },\n    started_checking: false,\n    check_selection: function (target) {\n        target = target || false;\n\n        mw.require('css_parser.js');\n\n\n        if (!mw.wysiwyg.started_checking) {\n            mw.wysiwyg.started_checking = true;\n\n            var selection = window.getSelection();\n\n            if (selection.rangeCount > 0) {\n                mw.wysiwyg.resetActiveButtons();\n                var range = selection.getRangeAt(0);\n                var start = range.startContainer;\n                var end = range.endContainer;\n                var common = range.commonAncestorContainer;\n                var children = range.cloneContents().childNodes, i = 0, l = children.length;\n\n                var list = mw.tools.firstParentWithTag(common, ['ul', 'ol']);\n                if (!!list) {\n                    mw.$('.mw_editor_' + list.nodeName.toLowerCase()).addClass('mw_editor_btn_active');\n                }\n                if (common.nodeType !== 3) {\n                    var commonCSS = mw.CSSParser(common);\n                    var align = commonCSS.get.alignNormalize();\n                    mw.$(\".mw_editor_alignment\").removeClass('mw_editor_btn_active');\n                    mw.$(\".mw-align-\" + align).addClass('mw_editor_btn_active');\n                    for (; i < l; i++) {\n                        if(children[i].nodeName){\n                        mw.wysiwyg.setActiveButtons(children[i]);\n                        }\n                    }\n\n                }\n                else {\n                    if (typeof common.parentElement !== 'undefined' && common.parentElement !== null) {\n                        var align = mw.CSSParser(common.parentElement).get.alignNormalize();\n                        mw.$(\".mw_editor_alignment\").removeClass('mw_editor_btn_active');\n                        mw.$(\".mw-align-\" + align).addClass('mw_editor_btn_active');\n                        mw.wysiwyg.setActiveButtons(common.parentElement);\n                    }\n                }\n                if (mw.wysiwyg.isFormatElement(common)) {\n                    var format = common.nodeName.toLowerCase();\n                    var ddval = mw.$(\".mw_dropdown_action_format\");\n                    if (ddval.length != 0 && ddval.setDropdownValue != undefined) {\n                        mw.$(\".mw_dropdown_action_format\").setDropdownValue(format);\n                    }\n                }\n                else {\n                    mw.tools.foreachParents(common, function (loop) {\n                        if (mw.wysiwyg.isFormatElement(this)) {\n                            var format = this.nodeName.toLowerCase();\n                            var ddval = mw.$(\".mw_dropdown_action_format\");\n                            if (ddval.length != 0 && ddval.setDropdownValue != undefined) {\n                                mw.$(\".mw_dropdown_action_format\").setDropdownValue(format);\n                            }\n                            mw.tools.stopLoop(loop);\n                        }\n                    });\n                }\n                mw.wysiwyg.setActiveFontSize();\n                mw.wysiwyg.setDecorators(selection)\n            }\n\n            if (!!target && target.nodeName) {\n\n\n                mw.wysiwyg.setActiveButtons(target);\n                if (target.tagName === 'A') {\n                    mw.$(\".mw_editor_link\").addClass('mw_editor_btn_active');\n                }\n                var parent_a = mw.tools.firstParentWithTag(target, 'a');\n                if (!!parent_a) {\n                    mw.$(\".mw_editor_link\").addClass('mw_editor_btn_active');\n                }\n            }\n            mw.wysiwyg.started_checking = false;\n        }\n    },\n    link: function (url, node_id, text) {\n        mw.require('external_callbacks.js');\n        mw.wysiwyg.save_selection();\n        var el = node_id ? document.getElementById(node_id) : mw.tools.firstParentWithTag(getSelection().focusNode, 'a');\n        var val;\n        var sel = getSelection();\n\n        if(el) {\n            val = {\n                url: url || el.href,\n                text: text || el.innerHTML,\n                target: el.target === '_blank'\n            }\n\n        } else if(!sel.isCollapsed) {\n            var html = document.createElement('div');\n            if(sel.rangeCount) {\n                var frag = sel.getRangeAt(0).cloneContents();\n                while (frag.firstChild) {\n                    html.append(frag.firstChild);\n                }\n            }\n            val = {\n                text: text || html.innerHTML,\n                url: url || ''\n            }\n        }\n\n        new mw.LinkEditor({\n            mode: 'dialog'\n        })\n        .setValue(val)\n        .promise()\n        .then(function (result){\n            mw.wysiwyg.restore_selection();\n            mw.iframecallbacks.insert_link(result, (result.target ? '_blank' : '_self') , result.text);\n        });\n\n\n\n    },\n\n    unlink: function () {\n        var sel = window.getSelection();\n        if (!sel.isCollapsed) {\n            mw.wysiwyg.execCommand('unlink', null, null);\n        }\n        else {\n            var link = mw.wysiwyg.findTagAcrossSelection('a');\n            if (!!link) {\n                mw.wysiwyg.select_element(link);\n                mw.wysiwyg.execCommand('unlink', null, null);\n            }\n        }\n        mw.$(\".mw_editor_link\").removeClass(\"mw_editor_btn_active\");\n    },\n    findTagAcrossSelection: function (tag, selection) {\n        var selection = selection || window.getSelection();\n        if (selection.anchorNode.nodeName.toLowerCase() === tag) {\n            return selection.anchorNode;\n        }\n        var range = selection.getRangeAt(0);\n        var common = range.commonAncestorContainer;\n        var parent = mw.tools.firstParentWithTag(common, [tag]);\n        if (!!parent) {\n            return parent;\n        }\n        if (typeof common.querySelectorAll !== 'undefined') {\n            var items = common.querySelectorAll(tag), l = items.length, i = 0, arr = [];\n            if (l > 0) {\n                for (; i < l; i++) {\n                    if (selection.containsNode(items[i], true)) {\n                        arr.push(items[i])\n                    }\n                }\n                if (arr.length > 0) {\n                    return arr.length === 1 ? arr[0] : arr;\n                }\n            }\n        }\n        return false;\n    },\n    image_link: function (url) {\n        mw.$(\"img.element-current\").wrap(\"<a href='\" + url + \"'></a>\");\n        mw.wysiwyg.change('.element-current');\n    },\n    request_media: function (hash, types) {\n        mw.require('external_callbacks.js');\n        types = types || false;\n        if (hash === '#editimage') {\n            types = 'images';\n            //hash = 'noop';\n        }\n        var url = !!types ? \"rte_image_editor?types=\" + types + '' + hash : \"rte_image_editor\" + hash;\n\n        url = mw.settings.site_url + 'editor_tools/' + url;\n        var sel = mw.wysiwyg.save_selection();\n        var modal = mw.top().dialogIframe({\n            url: url,\n            name: \"mw_rte_image\",\n            width: 460,\n            height: 'auto',\n            autoHeight:true,\n            overlay: true\n        }, function(res) {\n            if(hash === '#set_bg_image'){\n                mw.wysiwyg.set_bg_image(res);\n                return;\n            }\n\n            mw.wysiwyg.restore_selection();\n\n\n            if(hash === '#editimage') {\n                if(mw.image.currentResizing) {\n                    if (mw.image.currentResizing[0].nodeName === 'IMG') {\n                        mw.image.currentResizing.attr(\"src\", res);\n                        mw.image.currentResizing.css('height', 'auto');\n                    }\n                    else {\n                        mw.image.currentResizing.css(\"backgroundImage\", 'url(' + mw.files.safeFilename(res) + ')');\n                        if(parent.mw.image.currentResizing) {\n                        mw.wysiwyg.bgQuotesFix(parent.mw.image.currentResizing[0])\n                        }\n                    }\n                    if(mw.image.currentResizing) {\n                        mw.wysiwyg.change(mw.image.currentResizing[0]);\n                    }\n                    mw.image.currentResizing.load(function () {\n                        mw.image.resize.resizerSet(this);\n                    });\n                }\n            }\n            else {\n                if(res.indexOf('<') !== -1) {\n                    mw.wysiwyg.insert_html(res);\n                } else {\n                    mw.wysiwyg.insertMedia(res);\n                }\n            }\n\n            this.remove();\n\n        });\n    },\n    media: function (action) {\n\n        if (mw.settings.liveEdit && typeof mw.target.item === 'undefined') return false;\n        action = action || 'insert_html';\n        action = action.replace(/#/g, '');\n\n        if (mw.wysiwyg.isSelectionEditable() || mw.$(mw.target.item).hasClass(\"image_change\") || mw.$(mw.target.item.parentNode).hasClass(\"image_change\") || mw.target.item === mw.image_resizer) {\n            mw.wysiwyg.save_selection();\n            var dialog;\n            var handleResult = function (res) {\n                var url = res.src ? res.src : res;\n                if(action === 'editimage') {\n                    if(mw.image.currentResizing) {\n                        if (mw.image.currentResizing[0].nodeName === 'IMG') {\n                            mw.image.currentResizing.attr(\"src\", url);\n                            mw.image.currentResizing.css('height', 'auto');\n                        }\n                        else {\n                            mw.image.currentResizing.css(\"backgroundImage\", 'url(' + mw.files.safeFilename(url) + ')');\n                            if(parent.mw.image.currentResizing) {\n                                mw.wysiwyg.bgQuotesFix(parent.mw.image.currentResizing[0])\n                            }\n                        }\n                        if(mw.image.currentResizing) {\n                            mw.wysiwyg.change(mw.image.currentResizing[0]);\n                        }\n                        mw.image.currentResizing.load(function () {\n                            mw.image.resize.resizerSet(this);\n                        });\n                    }\n                }\n                else {\n                    mw.wysiwyg.insertMedia(url);\n                }\n                dialog.remove()\n            }\n            var picker = new mw.filePicker({\n                type: 'images',\n                label: false,\n                autoSelect: false,\n                footer: true,\n                _frameMaxHeight: true,\n                fileUploaded: function (file) {\n                    handleResult(file.src);\n                    dialog.remove()\n                },\n                onResult: handleResult,\n                cancel: function () {\n                    dialog.remove()\n                }\n            });\n            dialog = mw.dialog({\n                content: picker.root,\n                title: mw.lang('Select image'),\n                footer: false,\n                width: 1200\n            })\n\n\n        }\n\n    },\n    request_bg_image: function () {\n        mw.wysiwyg.request_media('#set_bg_image');\n    },\n    set_bg_image: function (url) {\n        mw.$(\".element-current\").css(\"backgroundImage\", \"url(\" + url + \")\");\n        mw.wysiwyg.change('.element-current');\n    },\n    insert_html: function (html) {\n        if (typeof html === 'string') {\n            var isembed = html.contains('<iframe') || html.contains('<embed') || html.contains('<object');\n        }\n        else {\n            var isembed = false;\n        }\n        if (isembed) {\n            var id = 'frame-' + mw.random();\n            var frame = html;\n            html = '<span id=\"' + id + '\"></span>';\n        }\n        if (!!window.MSStream) {\n            mw.wysiwyg.restore_selection();\n            if (mw.wysiwyg.isSelectionEditable()) {\n                var range = window.getSelection().getRangeAt(0);\n                var el = document.createElement('span');\n                el.innerHTML = html;\n                range.insertNode(el);\n                mw.$(el).replaceWith(el.innerHTML);\n            }\n        }\n        else {\n            if (!document.selection) {\n                mw.wysiwyg.execCommand('inserthtml', false, html);\n            }\n            else {\n                document.selection.createRange().pasteHTML(html)\n            }\n        }\n        if (isembed) {\n            var el = document.getElementById(id);\n            mw.wysiwyg.contentEditable(el.parentNode, false);\n            mw.$(el).replaceWith(frame);\n        }\n        var sel = getSelection();\n        if(sel.rangeCount){\n            mw.wysiwyg.change(mw.wysiwyg.validateCommonAncestorContainer(sel.getRangeAt(0).commonAncestorContainer));\n\n        }\n    },\n    selection_length: function () {\n        var n = window.getSelection().getRangeAt(0).cloneContents().childNodes,\n            l = n.length,\n            i = 0;\n        var final = 0;\n        for (; i < l; i++) {\n            var item = n[i];\n            if (item.nodeType === 1) {\n                final = final + item.textContent.length;\n            }\n            else if (item.nodeType === 3) {\n                final = final + item.nodeValue.length;\n            }\n        }\n        return final;\n    },\n    insertMedia: function (url, type) {\n        var ext = url.split('.').pop().toLowerCase();\n        var name = url.split('/').pop()\n        if(!type) {\n            if(['png','gif','jpg','jpeg','tiff','bmp','svg'].indexOf(ext) !== -1) {\n                type = 'image';\n            }\n            if(['mp4','ogg'].indexOf(ext) !== -1) {\n                type = 'video';\n            }\n        }\n        if(type === 'image') {\n            return this.insert_image(url);\n        } else if(type === 'video') {\n            var id = 'image_' + mw.random();\n            var img = '<span class=\"mwembed\"><video id=\"' + id + '\" contentEditable=\"false\" src=\"' + url + '\" controls></video></span>';\n            mw.wysiwyg.insert_html(img);\n        } else {\n            var id = 'image_' + mw.random();\n            var img = '<a id=\"' + id + '\" contentEditable=\"true\" src=\"' + url + '\">'+name+'</a>';\n            mw.wysiwyg.insert_html(img);\n        }\n    },\n    insert_image: function (url) {\n        var id = 'image_' + mw.random();\n        var img = '<img id=\"' + id + '\" contentEditable=\"true\" class=\"element\" src=\"' + url + '\" />';\n        mw.wysiwyg.insert_html(img);\n        mw.settings.liveEdit ? mw.$(\"#\" + id).attr(\"contenteditable\", false) : '';\n        mw.$(\"#\" + id).removeAttr(\"_moz_dirty\");\n        mw.wysiwyg.change(document.getElementById(id));\n        return id;\n    },\n    save_selection: function () {\n        var selection = window.getSelection();\n        if (selection.rangeCount > 0) {\n            var range = selection.getRangeAt(0);\n        }\n        else {\n            var range = document.createRange();\n            range.selectNode(document.querySelector('.edit .element'));\n        }\n        mw.wysiwyg.selection = {};\n        mw.wysiwyg.selection.sel = selection;\n        mw.wysiwyg.selection.range = range;\n        mw.wysiwyg.selection.element = mw.$(mw.wysiwyg.validateCommonAncestorContainer(range.commonAncestorContainer));\n    },\n    restore_selection: function () {\n        if (!!mw.wysiwyg.selection) {\n            mw.wysiwyg.selection.element.attr(\"contenteditable\", \"true\");\n            mw.wysiwyg.selection.element.focus();\n            mw.wysiwyg.selection.sel.removeAllRanges();\n            mw.wysiwyg.selection.sel.addRange(mw.wysiwyg.selection.range)\n        }\n    },\n    select_all: function (el) {\n        var range = document.createRange();\n        range.selectNodeContents(el);\n        var selection = window.getSelection();\n        selection.removeAllRanges();\n        selection.addRange(range);\n    },\n    select_element: function (el) {\n        var range = document.createRange();\n        try {\n            range.selectNode(el);\n            var selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n        } catch (e) {\n\n        }\n    },\n    formatNative: function (command) {\n        var el = mw.wysiwyg.validateCommonAncestorContainer(window.getSelection().focusNode);\n        if (mw.wysiwyg.isSafeMode()) {\n            mw.$('[contenteditable]').removeAttr('contenteditable');\n            var parent = mw.tools.firstBlockLevel(el.parentNode);\n            parent.contentEditable = true;\n        }\n        mw.wysiwyg.execCommand('formatBlock', false, '<' + command + '>');\n        mw.wysiwyg.execCommand('formatBlock', false, command );\n    },\n    format: function (command) {\n        var target = mw.wysiwyg.validateCommonAncestorContainer(getSelection().getRangeAt(0).commonAncestorContainer);\n        mw.liveEditState.record({\n            target: target.parentNode,\n            value: target.parentNode.innerHTML\n        });\n        var el = mw.tools.setTag(target, command);\n        mw.wysiwyg.cursorToElement(el, 'end');\n        mw.liveEditState.record({\n            target: el.parentNode,\n            value: el.parentNode.innerHTML\n        });\n        // return this.formatNative(command);\n    },\n    fontFamilies: ['Arial', 'Tahoma', 'Verdana', 'Georgia', 'Times New Roman'],\n    fontFamiliesExtended: [],\n    fontFamiliesTemplate: [],\n    initFontSelectorBox: function () {\n        mw.wysiwyg.initFontFamilies();\n\n        var l = mw.wysiwyg.fontFamilies.length, i = 0, html = '';\n        for (; i < l; i++) {\n\n            html += '<li value=\"' + mw.wysiwyg.fontFamilies[i] + '\"><a style=\"font-family:' + mw.wysiwyg.fontFamilies[i] + '\" href=\"javascript:;\">' + mw.wysiwyg.fontFamilies[i] + '</a></li>'\n        }\n\n        var l = mw.wysiwyg.fontFamiliesTemplate.length, i = 0;\n        for (; i < l; i++) {\n            if (mw.wysiwyg.fontFamilies.indexOf(mw.wysiwyg.fontFamiliesTemplate[i]) === -1 && mw.wysiwyg.fontFamiliesTemplate[i] != '') {\n                html += '<li value=\"' + mw.wysiwyg.fontFamiliesTemplate[i] + '\"><a style=\"font-family:' + mw.wysiwyg.fontFamiliesTemplate[i] + '\" href=\"javascript:;\">' + mw.wysiwyg.fontFamiliesTemplate[i] + '</a></li>'\n            }\n        }\n        var l = mw.wysiwyg.fontFamiliesExtended.length, i = 0;\n        for (; i < l; i++) {\n            if (mw.wysiwyg.fontFamilies.indexOf(mw.wysiwyg.fontFamiliesExtended[i]) === -1 && mw.wysiwyg.fontFamiliesExtended[i] != '') {\n                html += '<li value=\"' + mw.wysiwyg.fontFamiliesExtended[i] + '\"><a style=\"font-family:' + mw.wysiwyg.fontFamiliesExtended[i] + '\" href=\"javascript:;\">' + mw.wysiwyg.fontFamiliesExtended[i] + '</a></li>'\n            }\n        }\n\n        mw.$(\".mw_dropdown_action_font_family ul\").empty().append(html);\n\n        mw.$(\".mw_dropdown_action_font_family\").off('change');\n        mw.$(\".mw_dropdown_action_font_family\").on('change', function () {\n            var val = mw.$(this).getDropdownValue();\n            mw.wysiwyg.fontFamily(val);\n        });\n        mw.$(\".mw_dropdown_action_font_family\").each(function () {\n            mw.$(\"[value]\", mw.$(this)).on('mousedown touchstart', function (event) {\n                mw.$(mw.tools.firstParentWithClass(this, 'mw-dropdown')).setDropdownValue(this.getAttribute('value'), true);\n                return false;\n            });\n        });\n    },\n\n    initFontFamilies: function () {\n        if (window.getComputedStyle(document.body) == null) {\n            return;\n        }\n\n        var body_font = window.getComputedStyle(document.body, null).fontFamily.split(',')[0].replace(/'/g, \"\").replace(/\"/g, '');\n        if (mw.wysiwyg.fontFamilies.indexOf(body_font) === -1) {\n            mw.wysiwyg.fontFamilies.push(body_font);\n        }\n\n        var scan_for_fonts = ['body', 'html', 'h1', 'h2', 'h3', 'h4', 'h5', 'p', 'a[class]'];\n\n        $.each(scan_for_fonts, function (index, value) {\n            var sel = mw.$(document.querySelector(value));\n            if (sel.length > 0) {\n                var body_font = window.getComputedStyle(sel[0], null).fontFamily.split(',');\n                $.each(body_font, function (font_index, fvalue) {\n                    var font_value = fvalue;\n                    font_value = font_value.replace(/'/gi, \"\").replace(/\"/gi, '');\n                    if (mw.wysiwyg.fontFamilies.indexOf(font_value) === -1) {\n                        mw.wysiwyg.fontFamilies.push(font_value);\n                    }\n                });\n            }\n        });\n    },\n    initExtendedFontFamilies: function (string) {\n        var families = [];\n        if (typeof(string) == 'string') {\n            families = string.split(',')\n        } else if (typeof(string) == 'object') {\n            families = string\n        }\n        $.each(families, function (font_index, fvalue) {\n            var font_value = fvalue;\n            font_value = font_value.replace(/'/gi, \"\").replace(/\"/gi, '');\n            if (mw.wysiwyg.fontFamilies.indexOf(font_value) === -1 && mw.wysiwyg.fontFamiliesExtended.indexOf(font_value) === -1) {\n                mw.wysiwyg.fontFamiliesExtended.push(font_value);\n            }\n        });\n    },\n    fontIconFamilies: ['fas', 'fab', 'far', 'fa', 'mw-ui-icon', 'mw-icon', 'material-icons', 'mw-wysiwyg-custom-icon', 'icon', 'mdi'],\n\n    elementHasFontIconClass: function (el) {\n        var icon_classes = mw.wysiwyg.fontIconFamilies;\n        if (el.tagName === 'I' || el.tagName === 'SPAN') {\n            if (mw.tools.hasAnyOfClasses(el, icon_classes)) {\n                return true;\n            }\n            else if (el.className.indexOf('mw-micon-') !== -1) {\n                return true;\n            }\n            else if (el.className.indexOf('mw-icon-') !== -1) {\n                return true;\n            }\n            else {\n                return mw.tools.firstParentOrCurrentWithAnyOfClasses(el.parentNode, icon_classes);\n            }\n        }\n    },\n    firstElementThatHasFontIconClass: function (el) {\n        var icon_classes = mw.wysiwyg.fontIconFamilies.map(function (value) {\n            return '.'+value\n        });\n        icon_classes.push('[class*=\"mw-micon-\"]');\n        var p = mw.tools.firstMatchesOnNodeOrParent(el, icon_classes);\n        if (p && (p.tagName === 'I' || p.tagName === 'SPAN')) {\n            return p;\n        }\n    },\n    elementRemoveFontIconClasses: function (el) {\n        var l = mw.wysiwyg.fontIconFamilies.length, i = 0;\n        for (; i < l; i++) {\n            var search_class = mw.wysiwyg.fontIconFamilies[i]\n            mw.tools.classNamespaceDelete(el, search_class + '-');\n        }\n    },\n    iframe_editor: function (textarea, iframe_url, content_to_set) {\n        var content_to_set = content_to_set || false;\n        var id = mw.$(textarea).attr(\"id\");\n        mw.$(\"#iframe_editor_\" + id).remove();\n        var url = iframe_url;\n        var iframe = document.createElement('iframe');\n        iframe.className = 'mw-editor-iframe-loading';\n        iframe.id = \"iframe_editor_\" + id;\n        iframe.width = mw.$(textarea).width();\n        iframe.height = mw.$(textarea).height();\n        iframe.scrolling = \"no\";\n        iframe.setAttribute('frameborder', 0);\n        iframe.src = url;\n        iframe.style.resize = 'vertical';\n        iframe.onload = function () {\n            iframe.className = 'mw-editor-iframe-loaded';\n            var b = mw.$(this).contents().find(\".edit\");\n            var b = mw.$(this).contents().find(\"[field='content']\")[0];\n            if (typeof b != 'undefined' && b !== null) {\n                mw.wysiwyg.contentEditable(b, true)\n                mw.$(b).on(\"blur keyup\", function () {\n                    textarea.value = mw.$(this).html();\n                });\n                if (!!content_to_set) {\n                    mw.$(b).html(content_to_set);\n                }\n                mw.on.DOMChange(b, function () {\n                    textarea.value = mw.$(this).html();\n                    mw.askusertostay = true;\n                });\n            }\n        }\n        mw.$(textarea).after(iframe);\n        mw.$(textarea).hide();\n        return iframe;\n    },\n    word_listitem_get_level: function (item) {\n        var msspl = item.getAttribute('style').split('mso-list');\n        if (msspl.length > 1) {\n            var mssplitems = msspl[1].split(' ');\n            for (var i = 0; i < mssplitems.length; i++) {\n                if (mssplitems[i].indexOf('level') !== -1) {\n                    return parseInt(mssplitems[i].split('level')[1], 10);\n                }\n            }\n        }\n    },\n\n    word_list_build: function (lists, count) {\n        var i, check = false, max = 0;\n        count = count || 0;\n        if (count === 0) {\n            for (i in lists) {\n                var curr = lists[i];\n                if (!curr.nodeName || curr.nodeType !== 1) continue;\n                var $curr = mw.$(curr);\n                lists[i] = mw.tools.setTag(curr, 'li');\n            }\n        }\n\n        lists.each(function () {\n            var num = this.textContent.trim().split('.')[0], check = parseInt(num, 10);\n            var curr = mw.$(this);\n            if (!curr.attr('data-type')) {\n                if (!isNaN(check) && num > 0) {\n                    this.innerHTML = this.innerHTML.replace(num + '.', '');\n                    curr.attr('data-type', 'ol');\n                }\n                else {\n                    curr.attr('data-type', 'ul');\n                }\n            }\n            if (!this.__done) {\n                this.__done = false;\n                var level = parseInt($(this).attr('data-level'));\n                if (!isNaN(level) && level > max) {\n                    max = level;\n                }\n                if (!isNaN(level) && level > 1) {\n                    var prev = this.previousElementSibling;\n                    if (!!prev && prev.nodeName == 'LI') {\n                        var type = this.getAttribute('data-type');\n                        var wrap = document.createElement(type == 'ul' ? 'ul' : 'ol');\n                        wrap.setAttribute('data-level', level)\n                        mw.$(wrap).append(this);\n                        mw.$(wrap).appendTo(prev);\n                        check = true;\n                    }\n                    else if (!!prev && (prev.nodeName == 'UL' || prev.nodeName == 'OL')) {\n                        var where = mw.$('li[data-level=\"' + level + '\"]', prev);\n                        if (where.length > 0) {\n                            where.after(this);\n                            check = true;\n                        }\n                        else {\n                            var type = this.getAttribute('data-type');\n                            var wrap = document.createElement(type == 'ul' ? 'ul' : 'ol');\n                            wrap.setAttribute('data-level', level)\n                            mw.$(wrap).append(this);\n                            mw.$(wrap).appendTo($('li:last', prev))\n                            check = true;\n                        }\n                    }\n                    else if (!prev && (this.parentNode.nodeName != 'UL' && this.parentNode.nodeName != 'OL')) {\n                        var $curr = mw.$([this]), curr = this;\n                        while ($(curr).next('li[data-level=\"' + level + '\"]').length > 0) {\n                            $curr.push($(curr).next('li[data-level=\"' + level + '\"]')[0]);\n                            curr = mw.$(curr).next('li[data-level=\"' + level + '\"]')[0];\n                        }\n                        $curr.wrapAll($curr.eq(0).attr('data-type') == 'ul' ? '<ul></ul>' : '<ol></ol>')\n                        check = true;\n                    }\n                }\n            }\n        })\n\n        mw.$(\"ul[data-level!='1'], ol[data-level!='1']\").each(function () {\n            var level = parseInt($(this).attr('data-level'));\n            if (!!this.previousElementSibling) {\n                var plevel = parseInt($(this.previousElementSibling).attr('data-level'));\n                if (level > plevel) {\n                    mw.$('li:last', this.previousElementSibling).append(this)\n                    check = true;\n                }\n            }\n        })\n        if (count === 0) {\n            setTimeout(function () {\n                mw.wysiwyg.word_list_build($('li[data-level]'), 1);\n                mw.wysiwyg.wrap_li_roots()\n            }, 1)\n        }\n        return lists;\n    },\n    wrap_li_roots: function () {\n        var all = document.querySelectorAll('li[data-level]'), i = 0, has = false;\n        for (; i < all.length; i++) {\n            var parent = all[i].parentElement.nodeName;\n            if (parent != 'OL' && parent != 'UL') {\n                has = true;\n                var group = mw.$([]), curr = all[i];\n                while (!!curr && curr.nodeName == 'LI') {\n                    group.push(curr);\n                    curr = curr.nextElementSibling;\n                }\n                var el = document.createElement(all[i].getAttribute('data-type') == 'ul' ? 'ul' : 'ol');\n                el.className = 'element';\n                group.wrapAll(el)\n                break;\n            }\n        }\n        if (has) return mw.wysiwyg.wrap_li_roots()\n    },\n    isWordHtml: function (html) {\n        return html.indexOf('urn:schemas-microsoft-com:office:word') !== -1;\n    },\n    bgQuotesFix: function (el) {\n        el = mw.$(el)[0];\n        if (!!el && el.nodeType === 1) {\n            var first = el.outerHTML.split('>')[0];\n            if (el.style.backgroundImage.indexOf('\"') !== -1 && first.indexOf('style=\"') !== -1) {\n                el.attributes.style.nodeValue = el.attributes.style.nodeValue.replace(/\\\"/g, \"'\")\n            }\n        }\n    },\n    clean_word_list: function (html) {\n\n        if (!mw.wysiwyg.isWordHtml(html)) return html;\n        if (html.indexOf('</body>') != -1) {\n            html = html.split('</body>')[0]\n        }\n        var parser = mw.tools.parseHtml(html).body;\n\n        var lists = mw.$('[style*=\"mso-list:\"]', parser);\n        lists.each(function () {\n            var level = mw.wysiwyg.word_listitem_get_level(this);\n            if (!!level) {\n                this.setAttribute('data-level', level)\n                this.setAttribute('class', 'level-' + level)\n            }\n\n        });\n\n        mw.$('[style]', parser).removeAttr('style');\n\n        if (lists.length > 0) {\n            lists = mw.wysiwyg.word_list_build(lists);\n            var start = mw.$([]);\n            mw.$('li', parser).each(function () {\n                this.innerHTML = this.innerHTML\n                    .replace(/�/g, '')/* Not a dot */\n                    .replace(new RegExp(String.fromCharCode(160), \"g\"), \"\")\n                    .replace(/&nbsp;/gi, '')\n                    .replace(/\\�/g, '')\n                    .replace(/<\\/?span[^>]*>/g, \"\")\n                    .replace('�', '');\n            });\n        }\n        return parser.innerHTML;\n    },\n    clean_word: function (html) {\n        html = mw.wysiwyg.clean_word_list(html);\n        html = html.replace(/<td([^>]*)>/gi, '<td>');\n        html = html.replace(/<table([^>]*)>/gi, '<table cellspacing=\"0\" cellpadding=\"0\" border=\"1\" style=\"width:100%;\" width=\"100%\" class=\"element\">');\n        html = html.replace(/<o:p>\\s*<\\/o:p>/g, '');\n        html = html.replace(/<o:p>[\\s\\S]*?<\\/o:p>/g, '&nbsp;');\n        html = html.replace(/\\s*mso-[^:]+:[^;\"]+;?/gi, '');\n        html = html.replace(/\\s*MARGIN: 0cm 0cm 0pt\\s*;/gi, '');\n        html = html.replace(/\\s*MARGIN: 0cm 0cm 0pt\\s*\"/gi, \"\\\"\");\n        html = html.replace(/\\s*TEXT-INDENT: 0cm\\s*;/gi, '');\n        html = html.replace(/\\s*TEXT-INDENT: 0cm\\s*\"/gi, \"\\\"\");\n        html = html.replace(/\\s*TEXT-ALIGN: [^\\s;]+;?\"/gi, \"\\\"\");\n        html = html.replace(/\\s*PAGE-BREAK-BEFORE: [^\\s;]+;?\"/gi, \"\\\"\");\n        html = html.replace(/\\s*FONT-VARIANT: [^\\s;]+;?\"/gi, \"\\\"\");\n        html = html.replace(/\\s*tab-stops:[^;\"]*;?/gi, '');\n        html = html.replace(/\\s*tab-stops:[^\"]*/gi, '');\n        html = html.replace(/\\s*face=\"[^\"]*\"/gi, '');\n        html = html.replace(/\\s*face=[^ >]*/gi, '');\n        html = html.replace(/\\s*FONT-FAMILY:[^;\"]*;?/gi, '');\n        html = html.replace(/<(\\w[^>]*) class=([^ |>]*)([^>]*)/gi, \"<$1$3\");\n        html = html.replace(/<STYLE[^>]*>[\\s\\S]*?<\\/STYLE[^>]*>/gi, '');\n        html = html.replace(/<(?:META|LINK)[^>]*>\\s*/gi, '');\n        html = html.replace(/\\s*style=\"\\s*\"/gi, '');\n        html = html.replace(/<SPAN\\s*[^>]*>\\s*&nbsp;\\s*<\\/SPAN>/gi, '&nbsp;');\n        html = html.replace(/<SPAN\\s*[^>]*><\\/SPAN>/gi, '');\n        html = html.replace(/<(\\w[^>]*) lang=([^ |>]*)([^>]*)/gi, \"<$1$3\");\n        html = html.replace(/<SPAN\\s*>([\\s\\S]*?)<\\/SPAN>/gi, '$1');\n        html = html.replace(/<FONT\\s*>([\\s\\S]*?)<\\/FONT>/gi, '$1');\n        html = html.replace(/<\\\\?\\?xml[^>]*>/gi, '');\n        html = html.replace(/<w:[^>]*>[\\s\\S]*?<\\/w:[^>]*>/gi, '');\n        html = html.replace(/<\\/?\\w+:[^>]*>/gi, '');\n        html = html.replace(/<\\!--[\\s\\S]*?-->/g, '');\n        html = html.replace(/<(U|I|STRIKE)>&nbsp;<\\/\\1>/g, '&nbsp;');\n        html = html.replace(/<H\\d>\\s*<\\/H\\d>/gi, '');\n        html = html.replace(/<(\\w+)[^>]*\\sstyle=\"[^\"]*DISPLAY\\s?:\\s?none[\\s\\S]*?<\\/\\1>/ig, '');\n        html = html.replace(/<(\\w[^>]*) language=([^ |>]*)([^>]*)/gi, \"<$1$3\");\n        html = html.replace(/<(\\w[^>]*) onmouseover=\"([^\\\"]*)\"([^>]*)/gi, \"<$1$3\");\n        html = html.replace(/<(\\w[^>]*) onmouseout=\"([^\\\"]*)\"([^>]*)/gi, \"<$1$3\");\n        html = html.replace(/<H(\\d)([^>]*)>/gi, '<h$1>');\n        html = html.replace(/<font size=2>(.*)<\\/font>/gi, '$1');\n        html = html.replace(/<font size=3>(.*)<\\/font>/gi, '$1');\n        html = html.replace(/<a name=.*>(.*)<\\/a>/gi, '$1');\n        html = html.replace(/<H1([^>]*)>/gi, '<H2$1>');\n        html = html.replace(/<\\/H1\\d>/gi, '<\\/H2>');\n        //html = html.replace(/<span>/gi, '$1');\n        html = html.replace(/<\\/span\\d>/gi, '');\n        html = html.replace(/<(H\\d)><FONT[^>]*>([\\s\\S]*?)<\\/FONT><\\/\\1>/gi, '<$1>$2<\\/$1>');\n        html = html.replace(/<(H\\d)><EM>([\\s\\S]*?)<\\/EM><\\/\\1>/gi, '<$1>$2<\\/$1>');\n        return html;\n    },\n    cleanTables: function (root) {\n        var toRemove = \"tbody > *:not(tr), thead > *:not(tr), tr > *:not(td)\",\n            all = root.querySelectorAll(toRemove),\n            l = all.length,\n            i = 0;\n        for (; i < l; i++) {\n            mw.$(all[i]).remove();\n        }\n        var tables = root.querySelectorAll('table'),\n            l = tables.length,\n            i = 0;\n        for (; i < l; i++) {\n            var item = tables[i],\n                l = item.children.length,\n                i = 0;\n            for (; i < l; i++) {\n                var item = item.children[i];\n                if (typeof item !== 'undefined' && item.nodeType !== 3) {\n                    var name = item.nodeName.toLowerCase();\n                    var posibles = \"thead tfoot tr tbody col colgroup\";\n                    if (!posibles.contains(name)) {\n                        mw.$(item).remove();\n                    }\n                }\n            }\n        }\n    },\n    cleanHTML: function (root) {\n        var root = root || document.body;\n        mw.tools.foreachChildren(root, function () {\n            if (mw.wysiwyg.hasContentFromWord(this)) {\n                this.innerHTML = mw.wysiwyg.clean_word(this.innerHTML);\n            }\n            mw.wysiwyg.cleanTables(this);\n        });\n    },\n    normalizeBase64Image: function (node, callback) {\n        if (typeof node.src !== 'undefined' && node.src.indexOf('data:image/') === 0) {\n            var type = node.src.split('/')[1].split(';')[0];\n            var obj = {\n                file: node.src,\n                name: mw.random().toString(36) + \".\" + type\n            }\n            $.post(mw.settings.api_url + \"media/upload\", obj, function (data) {\n                var data = $.parseJSON(data);\n                node.src = data.src;\n                if (typeof callback === 'function') {\n                    callback.call(node);\n                }\n                mw.wysiwyg.change(node);\n                mw.trigger('imageSrcChanged', [node, node.src])\n            });\n        }\n        else if (node.style.backgroundImage.indexOf('data:image/') !== -1) {\n            var bg = node.style.backgroundImage.replace(/url\\(/g, '').replace(/\\)/g, '')\n            var type = bg.split('/')[1].split(';')[0];\n            var obj = {\n                file: bg,\n                name: mw.random().toString(36) + \".\" + type\n            };\n            $.post(mw.settings.api_url + \"media/upload\", obj, function (data) {\n                var data = $.parseJSON(data);\n                node.style.backgroundImage = 'url(\\'' + data.src + '\\')';\n\n                if (typeof callback === 'function') {\n                    callback.call(node);\n                }\n                mw.wysiwyg.change(node);\n                mw.trigger('nodeBackgroundChanged', [node, node.src])\n            });\n        }\n    },\n    normalizeBase64Images: function (root) {\n        var root = root || document.body;\n        var all = root.querySelectorAll(\".edit img[src*='data:image/'], .edit [style*='data:image/'][style*='background-image']\"),\n            l = all.length, i = 0;\n        if (l > 0) {\n            for (; i < l; i++) {\n                mw.tools.addClass(all[i], 'element');\n                mw.wysiwyg.normalizeBase64Image(all[i]);\n            }\n        }\n    },\n    documentCommonFonts: function () {\n      var checkNodes = $('html, body, h1:first, h2:first, p:first');\n      var result = [];\n        checkNodes.each(function () {\n            var font = $(this).css('fontFamily').split(',')[0].trim();\n            if(result.indexOf(font) === -1) {\n                result.push(font)\n            }\n        });\n        return result;\n    }\n}\nmw.disable_selection = function (element) {\n    var el = element || \".module\";\n    el = mw.$(el, \".edit\").not(\".unselectable\");\n    el.attr(\"unselectable\", \"on\");\n    el.addClass(\"unselectable\");\n    el.on(\"selectstart\", function (event) {\n        event.preventDefault();\n        return false;\n    });\n};\n\nmw.wysiwyg.dropdowns = function () {\n    mw.$(\".mw_dropdown_action_font_size\").not('.ready').addClass('ready').change(function () {\n        var val = mw.$(this).getDropdownValue();\n        mw.wysiwyg.fontSize(val);\n        mw.$('.mw-dropdown-val', this).append('px');\n    });\n    mw.$(\".mw_dropdown_action_format\").not('.ready').addClass('ready').change(function () {\n\n        var val = mw.$(this).getDropdownValue();\n        mw.wysiwyg.format(val);\n    });\n    mw.wysiwyg.initFontSelectorBox();\n    mw.$(\"#wysiwyg_insert\").not('.ready').addClass('ready').on(\"change\", function () {\n        var fnode = window.getSelection().focusNode;\n        var isPlain = mw.tools.firstParentOrCurrentWithClass(fnode, 'plain-text');\n        if (mw.wysiwyg.isSelectionEditable()) {\n            var val = mw.$(this).getDropdownValue();\n\n            var isTextlike = val == 'icon';\n            if (!isTextlike && isPlain) {\n                return false;\n            }\n\n            if (val == 'hr') {\n                mw.wysiwyg._do('InsertHorizontalRule');\n            }\n            else if (val == 'box') {\n\n                var div = mw.wysiwyg.applier('div', 'mw-ui-box mw-ui-box-content element');\n                if (mw.wysiwyg.selection_length() <= 2) {\n                    mw.$(div).append(\"<p>&nbsp;</p>\");\n                }\n            }\n            else if (val == 'pre') {\n                var div = mw.wysiwyg.applier('pre', '');\n                if (mw.wysiwyg.selection_length() <= 2) {\n                    mw.$(div).append(\"&nbsp;\");\n                }\n            } else if (val === 'code') {\n                // var div = mw.wysiwyg.applier('code', '');\n                var new_insert_html = prompt(\"Paste your code\");\n                if (new_insert_html != null) {\n                    var div = mw.wysiwyg.applier('code');\n                    div.innerHTML = new_insert_html;\n                }\n            } else if (val === 'insert_html') {\n                var new_insert_html = prompt(\"Paste your html code in the box\");\n                if (new_insert_html != null) {\n\n                    mw.wysiwyg.insert_html(new_insert_html)\n                }\n            } else if (val === 'icon') {\n\n                var icdiv = mw.wysiwyg.applier('i');\n                icdiv.className = \"mw-icon\";\n\n                var mode = 3;\n                if(mode === 3) {\n                    mw.editorIconPicker.tooltip(icdiv)\n                }\n                if(mode === 2) {\n                    var dialog = mw.icons.dialog();\n                    $(dialog).on('Result', function(e, res){\n                        res.render(res.icon, icdiv);\n                        dialog.remove();\n                    })\n                }\n                if(mode === 1) {\n\n                    mw.editorIconPicker.tooltip(icdiv)\n\n                    setTimeout(function () {\n                        mw.sidebarSettingsTabs.set(2)\n                    }, 10);\n                }\n\n\n\n            }\n            else if (val === 'table') {\n                var el = mw.wysiwyg.applier('div', 'element', {width: \"100%\"});\n                el.innerHTML = '<table class=\"mw-wysiwyg-table\"><tbody><tr><td>Lorem Ipsum</td><td  >Lorem Ipsum</td></tr><tr><td  >Lorem Ipsum</td><td  >Lorem Ipsum</td></tr></tbody></table>';\n\n            }\n            else if (val === 'quote') {\n                var div = mw.wysiwyg.applier('blockquote', 'element');\n                mw.$(div).append(\"<cite>By Lorem Ipsum</cite>\");\n            }\n            //  mw.$(this).setDropdownValue(\"Insert\", true, true, \"Insert\");\n        }\n        mw.$(this).find('.mw-dropdown-val').html('insert').find('.mw-dropdown-content').hide()\n        mw.$(this).find('.mw-dropdown-content').hide()\n    })\n};\n$(mwd).ready(function () {\n\n\n    mw.wysiwyg.initClassApplier();\n\n    mw.wysiwyg.dropdowns();\n\n    mw.editorIconPicker = mw.iconPicker({\n        iconOptions: { reset: true }\n    });\n\n\n    mw.editorIconPicker.on('select', function (data){\n        data.render();\n        mw.wysiwyg.change(mw.editorIconPicker.target)\n    });\n    mw.editorIconPicker.on('sizeChange', function (size){\n        mw.editorIconPicker.target.style.fontSize = size + 'px';\n        mw.tools.tooltip.setPosition(mw.editorIconPicker._tooltip, mw.editorIconPicker.target, 'bottom-center');\n        mw.wysiwyg.change(mw.editorIconPicker.target)\n    })\n    mw.editorIconPicker.on('colorChange', function (color){\n        mw.editorIconPicker.target.style.color = color;\n        mw.wysiwyg.change(mw.editorIconPicker.target)\n    });\n\n    mw.editorIconPicker.on('reset', function (color){\n        mw.editorIconPicker.target.style.color = '';\n        mw.editorIconPicker.target.style.fontSize = '';\n        mw.tools.tooltip.setPosition(mw.editorIconPicker._tooltip, mw.editorIconPicker.target, 'bottom-center');\n\n        mw.wysiwyg.change(mw.editorIconPicker.target)\n    });\n\n\n    if (!mw.wysiwyg._fontcolorpicker) {\n        mw.lib.require('colorpicker');\n        mw.wysiwyg._fontcolorpicker = mw.colorPicker({\n            element: document.querySelector('#mw_editor_font_color'),\n            tip: true,\n            showHEX:false,\n            onchange: function (color) {\n                mw.wysiwyg.fontColor(color)\n            }\n        });\n    }\n    if (!mw.wysiwyg._bgfontcolorpicker) {\n        mw.wysiwyg._bgfontcolorpicker = mw.colorPicker({\n            element: document.querySelector('.mw_editor_font_background_color'),\n            tip: true,\n            showHEX: false,\n            onchange: function (color) {\n                mw.wysiwyg.fontbg(color)\n            }\n        });\n    }\n\n    mw.$(document).on('scroll', function () {\n        if (mw.wysiwyg._bgfontcolorpicker && mw.wysiwyg._bgfontcolorpicker.settings) {\n            mw.tools.tooltip.setPosition(mw.wysiwyg._bgfontcolorpicker.tip, mw.wysiwyg._bgfontcolorpicker.settings.element, mw.wysiwyg._bgfontcolorpicker.settings.position)\n            mw.tools.tooltip.setPosition(mw.wysiwyg._fontcolorpicker.tip, mw.wysiwyg._fontcolorpicker.settings.element, mw.wysiwyg._fontcolorpicker.settings.position)\n        }\n\n    })\n\n\n    mw.wysiwyg.nceui();\n    mw.smallEditor = mw.$(\"#mw_small_editor\");\n    mw.smallEditorCanceled = true;\n    mw.bigEditor = mw.$(\"#mw-text-editor\");\n    mw.$(document.body).on('mousedown touchstart', function (event) {\n        var target = event.target;\n        if ($(target).hasClass(\"element\")) {\n            mw.trigger(\"ElementMouseDown\", target);\n        }\n        else if ($(target).parents(\".element\").length > 0) {\n            mw.trigger(\"ElementMouseDown\", mw.$(target).parents(\".element\")[0]);\n        }\n        if ($(target).hasClass(\"edit\")) {\n            mw.trigger(\"EditMouseDown\", [target, target, event]);\n        }\n        else if ($(target).parents(\".edit\").length > 0) {\n            mw.trigger(\"EditMouseDown\", [$(target).parents(\".edit\")[0], target, event]);\n        }\n        var hp = document.getElementById('mw-history-panel');\n        if (hp !== null && hp.style.display != 'none') {\n            if (!hp.contains(target)) {\n                hp.style.display = 'none';\n                mw.$(\"#history_panel_toggle\").removeClass('mw_editor_btn_active');\n            }\n        }\n    });\n\n    mw.wysiwyg.editorFonts = [];\n\n\n});\n$(window).on('load', function () {\n\n    mw.$(this).on('imageSrcChanged', function (e, el, url) {\n\n\n        var node = mw.tools.firstParentOrCurrentWithAnyOfClasses(el, ['mw-image-holder']);\n        if (node) {\n            url = mw.files.safeFilename(url);\n            var img = node.querySelector('img');\n            if(img) {\n                img.src = url;\n            }\n            mw.$(node).css('backgroundImage', 'url(' + url + ')');\n        }\n    });\n\n    mw.$(window).on(\"keydown\", function (e) {\n\n        if (e.type === 'keydown') {\n\n            if (e.keyCode === 13) {\n                var field = mw.tools.mwattr(e.target, 'field');\n                if (field === 'title' || mw.tools.hasClass(e.target, 'plain-text')) {\n                    e.preventDefault();\n                }\n            }\n            if (e.ctrlKey) {\n                var isPlain = mw.tools.firstParentOrCurrentWithClass(e.target, 'plain-text');\n                if (!isPlain) {\n                    var code = e.keyCode;\n                    if (code === 66) {\n\n                        mw.wysiwyg.execCommand('bold');\n                        e.preventDefault();\n                    }\n                    else if (code == 73) {\n\n                        mw.wysiwyg.execCommand('italic');\n                        e.preventDefault();\n                    }\n                    else if (code == 85) {\n\n                        mw.wysiwyg.execCommand('underline');\n                        e.preventDefault();\n                    }\n                }\n                else {\n                    if (e.keyCode != 65 && e.keyCode != 86) { // ctrl v || a\n                        //return false;\n                    }\n\n                }\n            }\n        }\n    });\n    mw.$(\".mw_editor\").each(function () {\n        mw.tools.dropdown(this);\n    });\n    var nodes = document.querySelectorAll(\".edit\"), l = nodes.length, i = 0;\n    for (; i < l; i++) {\n        var node = nodes[i];\n        var rel = mw.tools.mwattr(node, \"rel\");\n        var field = mw.tools.mwattr(node, \"field\");\n        if (field == 'content' && rel == 'content') {\n            if (node.querySelector('p') !== null) {\n                var node = node.querySelector('p');\n            }\n            // node.contentEditable = true;\n        }\n        if (!nodes[i].pasteBinded && !mw.tools.hasParentsWithClass(nodes[i], 'edit')) {\n            nodes[i].pasteBinded = true;\n            nodes[i].addEventListener(\"paste\", function (e) {\n\n                mw.wysiwyg.paste(e);\n                mw.wysiwyg.change(e.target)\n            });\n        }\n\n    }\n    mw.require('wysiwygmdab.js');\n});\n\nmw.linkTip = {\n    init: function (root) {\n        if (root === null || !root) {\n            return false;\n        }\n        mw.$(root).on('click', function (e) {\n            var node = mw.linkTip.find(e.target);\n            if (!!node) {\n                mw.linkTip.tip(node);\n                e.preventDefault()\n            }\n            else {\n                mw.$('.mw-link-tip').remove();\n            }\n        });\n    },\n    find: function (target) {\n        if (mw.tools.hasClass(target, 'module')) {\n            return;\n        }\n        var a = mw.tools.firstMatchesOnNodeOrParent(target, ['a']);\n        if(!a) return;\n\n        if (!mw.tools.parentsOrCurrentOrderMatchOrOnlyFirst(a, ['edit', 'module'])) {\n            return;\n        }\n        return a;\n    },\n    tip: function (node) {\n        if(!node) return;\n\n        var link = document.createElement('a');\n        link.href = node.getAttribute('href');\n        link.target = '_blank';\n        link.className = 'mw-link-tip-link';\n        link.innerHTML = node.getAttribute('href');\n\n        var editBtn = document.createElement('span');\n        editBtn.className = 'mw-link-tip-edit';\n        editBtn.innerHTML = mw.lang('Edit');\n\n        var holder = document.createElement('div');\n\n        holder.appendChild(link);\n        holder.append(' - ');\n        holder.appendChild(editBtn);\n\n        editBtn.onclick = function(e) {\n            e.preventDefault();\n            new mw.LinkEditor({\n                mode: 'dialog'\n            })\n                .setValue({url: node.href, text: node.innerHTML, target: node.target === '_blank'})\n                .promise()\n                .then(function (result){\n                    node.href = result.url;\n                    node.innerHTML = result.text;\n                });\n            mw.$('.mw-link-tip').remove();\n            return false;\n        }\n\n        mw.linkTip._tip = mw.tooltip({content: holder, position: 'bottom-center', skin: 'dark', element: node});\n        mw.$(mw.linkTip._tip).addClass('mw-link-tip');\n\n    }\n}\n\n","\r\nvar canDestroy = function (event) {\r\n    var target = event.target;\r\n    return !mw.tools.hasAnyOfClassesOnNodeOrParent(event, ['safe-element'])\r\n            && mw.tools.parentsOrCurrentOrderMatchOrOnlyFirstOrNone(target, ['allow-drop', 'nodrop']);\r\n};\r\n\r\nmw.wysiwyg._manageDeleteAndBackspaceInSafeMode = {\r\n    emptyNode: function (event, node, sel, range) {\r\n        if(!canDestroy(node)) {\r\n            return;\r\n        }\r\n        var todelete = node;\r\n        if(mw.tools.hasAnyOfClasses(node.parentNode, ['text', 'title'])){\r\n            todelete = node.parentNode;\r\n        }\r\n        var transfer, transferPosition;\r\n        if (mw.event.is.delete(event)) {\r\n            transfer = todelete.nextElementSibling;\r\n            transferPosition = 'start';\r\n        } else {\r\n            transfer = todelete.previousElementSibling;\r\n            transferPosition = 'end';\r\n        }\r\n        var parent = todelete.parentNode;\r\n        mw.liveEditState.record({\r\n            target: parent,\r\n            value: parent.innerHTML\r\n        });\r\n        $(todelete).remove();\r\n        if(transfer && mw.tools.isEditable(transfer)) {\r\n            setTimeout(function () {\r\n                mw.wysiwyg.cursorToElement(transfer, transferPosition);\r\n            });\r\n        }\r\n        mw.liveEditState.record({\r\n            target: parent,\r\n            value: parent.innerHTML\r\n        });\r\n    },\r\n    nodeBoundaries: function (event, node, sel, range) {\r\n        var isStart = range.startOffset === 0 || !((sel.anchorNode.data || '').substring(0, range.startOffset).replace(/\\s/g, ''));\r\n        var curr, content;\r\n        if(mw.event.is.backSpace(event) && isStart && range.collapsed){ // is at the beginning\r\n            curr = node;\r\n            if(mw.tools.hasAnyOfClasses(node.parentNode, ['text', 'title'])){\r\n                curr = node.parentNode;\r\n            }\r\n            var prev = curr.previousElementSibling;\r\n            if(prev && prev.nodeName === node.nodeName && canDestroy(node)) {\r\n                content = node.innerHTML;\r\n                mw.wysiwyg.cursorToElement(prev, 'end');\r\n                prev.appendChild(range.createContextualFragment(content));\r\n                $(curr).remove();\r\n            }\r\n        } else if(mw.event.is.delete(event)\r\n            && range.collapsed\r\n            && range.startOffset === sel.anchorNode.data.replace(/\\s*$/,'').length // is at the end\r\n            && canDestroy(node)){\r\n            curr = node;\r\n            if(mw.tools.hasAnyOfClasses(node.parentNode, ['text', 'title'])){\r\n                curr = node.parentNode;\r\n            }\r\n            var next = curr.nextElementSibling, deleteParent;\r\n            if(mw.tools.hasAnyOfClasses(next, ['text', 'title'])){\r\n                next = next.firstElementChild;\r\n                deleteParent = true;\r\n            }\r\n            if(next && next.nodeName === curr.nodeName) {\r\n                content = next.innerHTML;\r\n                setTimeout(function(){\r\n                    var parent = deleteParent ? next.parentNode.parentNode : next.parentNode;\r\n                    mw.liveEditState.actionRecord(function() {\r\n                            return {\r\n                                target: parent,\r\n                                value: parent.innerHTML\r\n                            };\r\n                        }, function () {\r\n                            curr.append(range.createContextualFragment(content));\r\n                        }\r\n                    );\r\n                });\r\n            }\r\n        }\r\n    }\r\n};\r\nmw.wysiwyg.manageDeleteAndBackspaceInSafeMode = function (event, sel) {\r\n\r\n\r\n    var node = mw.wysiwyg.validateCommonAncestorContainer(sel.focusNode);\r\n    var range = sel.getRangeAt(0);\r\n    if(!node.innerText.replace(/\\s/gi, '')){\r\n        mw.wysiwyg._manageDeleteAndBackspaceInSafeMode.emptyNode(event, node, sel, range);\r\n        return false;\r\n    }\r\n    mw.wysiwyg._manageDeleteAndBackspaceInSafeMode.nodeBoundaries(event, node, sel, range);\r\n    return true;\r\n};\r\nmw.wysiwyg.manageDeleteAndBackspace = function (event, sel) {\r\n    if (!mw.settings.liveEdit && self === top) {\r\n        return;\r\n    }\r\n\r\n    if (mw.event.is.delete(event) || mw.event.is.backSpace(event)) {\r\n        if(!sel.rangeCount) return;\r\n        var r = sel.getRangeAt(0);\r\n        var isSafe = mw.wysiwyg.isSafeMode();\r\n\r\n        if(isSafe) {\r\n            return mw.wysiwyg.manageDeleteAndBackspaceInSafeMode(event, sel);\r\n        }\r\n\r\n        if (!mw.settings.liveEdit) {\r\n            return true;\r\n        }\r\n        var nextNode = null, nextchar, nextnextchar, nextel;\r\n\r\n\r\n            if (mw.event.is.delete(event)) {\r\n                nextchar = sel.focusNode.textContent.charAt(sel.focusOffset);\r\n                nextnextchar = sel.focusNode.textContent.charAt(sel.focusOffset + 1);\r\n                nextel = sel.focusNode.nextSibling || sel.focusNode.nextElementSibling;\r\n\r\n            } else {\r\n                nextchar = sel.focusNode.textContent.charAt(sel.focusOffset - 1);\r\n                nextnextchar = sel.focusNode.textContent.charAt(sel.focusOffset - 2);\r\n                nextel = sel.focusNode.previouSibling || sel.focusNode.previousElementSibling;\r\n\r\n            }\r\n\r\n\r\n            if ((nextchar === ' ' || /\\r|\\n/.exec(nextchar) !== null) && sel.focusNode.nodeType === 3 && !nextnextchar) {\r\n                event.preventDefault();\r\n                return false;\r\n            }\r\n\r\n\r\n            if (nextnextchar === '') {\r\n\r\n\r\n                if (nextchar.replace(/\\s/g, '') === '' && r.collapsed) {\r\n\r\n                    if (nextel && !mw.ea.helpers.isBlockLevel(nextel) && ( typeof nextel.className === 'undefined' || !nextel.className.trim())) {\r\n                        return true;\r\n                    }\r\n                    else if (nextel && nextel.nodeName !== 'BR') {\r\n                        if (sel.focusNode.nodeName === 'P') {\r\n                            if (event.keyCode === 46) {\r\n                                if (sel.focusNode.nextElementSibling.nodeName === 'P') {\r\n                                    return true;\r\n                                }\r\n                            }\r\n                            if (event.keyCode === 8) {\r\n\r\n                                if (sel.focusNode.previousElementSibling.nodeName === 'P') {\r\n                                    return true;\r\n                                }\r\n                            }\r\n                        }\r\n                        event.preventDefault();\r\n                        return false;\r\n                    }\r\n\r\n                }\r\n                else if ((focus.previousElementSibling === null && rootfocus.previousElementSibling === null) && mw.tools.hasAnyOfClassesOnNodeOrParent(rootfocus, ['nodrop', 'allow-drop'])) {\r\n                    return false;\r\n                }\r\n                else {\r\n\r\n                }\r\n            }\r\n            if (nextchar == '') {\r\n\r\n\r\n                //continue check nodes\r\n                if (mw.event.is.delete(event)) {\r\n                    nextNode = mw.wysiwyg.merge.getNext(sel.focusNode);\r\n                }\r\n                if (mw.event.is.backSpace(event)) {\r\n                    nextNode = mw.wysiwyg.merge.getPrev(sel.focusNode);\r\n                }\r\n                if (mw.wysiwyg.merge.alwaysMergeable(nextNode)) {\r\n                    return true;\r\n                }\r\n\r\n                var nonbr = mw.wysiwyg.merge.isInNonbreakable(nextNode);\r\n                if (nonbr) {\r\n                    event.preventDefault();\r\n                    return false;\r\n                }\r\n\r\n                if (nextNode.nodeValue == '') {\r\n\r\n                }\r\n                if (nextNode !== null && mw.wysiwyg.merge.isMergeable(nextNode)) {\r\n                    if (mw.event.is.delete(event)) {\r\n                        mw.wysiwyg.merge.manageBreakables(sel.focusNode, nextNode, 'next', event)\r\n                    }\r\n                    else {\r\n                        mw.wysiwyg.merge.manageBreakables(sel.focusNode, nextNode, 'prev', event)\r\n                    }\r\n                }\r\n                else {\r\n                    event.preventDefault()\r\n                }\r\n                //  }\r\n                if (nextNode === null) {\r\n                    nextNode = sel.focusNode.parentNode.nextSibling;\r\n                    if (!mw.wysiwyg.merge.isMergeable(nextNode)) {\r\n                        event.preventDefault();\r\n                    }\r\n                    if (mw.event.is.delete(event)) {\r\n                        mw.wysiwyg.merge.manageBreakables(sel.focusNode, nextNode, 'next', event)\r\n                    }\r\n                    else {\r\n                        mw.wysiwyg.merge.manageBreakables(sel.focusNode, nextNode, 'prev', event)\r\n                    }\r\n                }\r\n\r\n            } else {\r\n\r\n            }\r\n\r\n\r\n    }\r\n\r\n    return true;\r\n};\r\n"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC9HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACrrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACtFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC/GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC9hBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC5KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC3HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACtLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC3uCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AChGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC1HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACpIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACrPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACnaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACxHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AClRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC3OA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACpQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACnLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACp2FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}